"use strict";(self.webpackChunkbrige_typescript=self.webpackChunkbrige_typescript||[]).push([[484],{484:(t,e,n)=>{n.r(e),n.d(e,{EvmTBTCBridge:()=>u});var r=n(600),a=n(6218),i=n(8951),s=n(9495),o=n(1640),c=n(462),d=n(9755),h=n(6769),w=n(4230),p=Object.defineProperty,l=(t,e,n)=>((t,e,n)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n)(t,"symbol"!=typeof e?e+"":e,n);class u{constructor(t,e,n,r){if(l(this,"network"),l(this,"chain"),l(this,"provider"),l(this,"contracts"),l(this,"chainId"),l(this,"core"),l(this,"gatewayAddress"),l(this,"gateway"),l(this,"tbtcTokenAddr"),this.network=t,this.chain=e,this.provider=n,this.contracts=r,"Mainnet"!==this.network)throw new Error("TBTC is only supported on Mainnet");if(!this.contracts.tbtc)throw new Error("TBTC contract address is required");const a=o.I.getNativeTbtcToken(this.chain);if(!a)throw new Error("Native tbtc token not found");this.chainId=o.y.get(t,e),this.core=new c.EvmWormholeCore(t,e,n,r),this.gatewayAddress=this.contracts.tbtc,this.gateway=new d.C(this.gatewayAddress,["function sendTbtc(uint256 amount, uint16 recipientChain, bytes32 recipient, uint256 arbiterFee, uint32 nonce) payable returns (uint64)","function receiveTbtc(bytes calldata encodedVm)"],n),this.tbtcTokenAddr=(0,o.o)(a)}static async fromRpc(t,e){const[n,r]=await h.E.chainFromRpc(t),a=e[r];if(a.network!==n)throw new Error("Network mismatch: ".concat(a.network," != ").concat(n));return new u(n,r,t,a.contracts)}transfer(t,e,n){var c=this;return(0,r.A)(function*(){const r=new o.az(t).toString(),d=yield(0,a.A)(c.gateway.sendTbtc.populateTransaction(n,(0,o.ax)(e.chain),e.address.toUniversalAddress().toUint8Array(),0n,0n));d.value=yield(0,a.A)(c.core.getMessageFee()),yield*(0,i.A)((0,s.A)(c.approve(r,n,c.gatewayAddress)),a.A),yield c.createUnsignedTransaction((0,o.aC)(d,r),"TBTCBridge.Send")})()}redeem(t,e){var n=this;return(0,r.A)(function*(){if("GatewayTransfer"!==e.payloadName)throw new Error("Invalid VAA payload");const r=new o.az(t).toString(),i=yield(0,a.A)(n.gateway.receiveTbtc.populateTransaction((0,o.aE)(e)));yield n.createUnsignedTransaction((0,o.aC)(i,r),"TBTCBridge.Redeem")})()}approve(t,e,n){var i=this;return(0,r.A)(function*(){const r=h.E.getTokenImplementation(i.provider,i.tbtcTokenAddr);if((yield(0,a.A)(r.allowance(t,n)))<e){const s=yield(0,a.A)(r.approve.populateTransaction(n,e));yield i.createUnsignedTransaction((0,o.aC)(s,t),"TBTC.Approve")}})()}createUnsignedTransaction(t,e){return new w.E((0,o.aD)(t,this.chainId),this.network,this.chain,e,!1)}}(0,o.aF)(o.aG,"TBTCBridge",u)}}]);
//# sourceMappingURL=484.1a0240b5.chunk.js.map