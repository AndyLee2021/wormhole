"use strict";(self.webpackChunkbrige_typescript=self.webpackChunkbrige_typescript||[]).push([[5872],{5872:(e,t,n)=>{n.r(t),n.d(t,{EvmPorticoBridge:()=>A});var r=n(600),o=n(6218),a=n(8951),i=n(9495),s=n(9755),c=n(1640),d=n(462),h=n(3222),u=n(6769),p=n(4230),f=Object.defineProperty,g=(e,t,n)=>((e,t,n)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n);const k=new s.I(["function start((bytes32,address,address,address,address,address,uint256,uint256,uint256,uint256)) returns (address,uint16,uint64)","function receiveMessageAndSwap(bytes)"]),w=new s.I(["function quoteExactInputSingle((address,address,uint256,uint24,uint160)) public view returns (uint256,uint160,uint32,uint256)"]);class l{static async quoteRelayer(e,t,n){var r;if((0,c.m)(t)||(0,c.m)(n))throw new Error("how did you get here tho?");const o=c.k.encode(t.toUniversalAddress().toUint8Array(),!1),a=c.k.encode(n.toUniversalAddress().toUint8Array(),!1),i={targetChain:(0,c.ax)(e),sourceToken:o,targetToken:a};try{const e=await c.ab.post("https://gfx.relayers.xlabs.xyz/api/v1/swap/quote",i);return BigInt(e.data.fee)}catch(s){throw c.ab.isAxiosError(s)?new Error("Error getting relayer fee: ".concat(null==(r=s.response)?void 0:r.statusText)):s}}}const b={ETH:[c.W.tokenId("Arbitrum","native"),c.W.tokenId("Base","native"),c.W.tokenId("Ethereum","native"),c.W.tokenId("Optimism","native")],WETH:[c.W.tokenId("Arbitrum","0x82aF49447D8a07e3bd95BD0d56f35241523fBab1"),c.W.tokenId("Avalanche","0x49D5c2BdFfac6CE2BFdB6640F4F80f226bc10bAB"),c.W.tokenId("Base","0x4200000000000000000000000000000000000006"),c.W.tokenId("Bsc","0x2170Ed0880ac9A755fd29B2688956BD959F933F8"),c.W.tokenId("Ethereum","0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"),c.W.tokenId("Optimism","0x4200000000000000000000000000000000000006"),c.W.tokenId("Polygon","0x7ceB23fD6bC0adD59E62ac25578270cFf1b9f619")],wstETH:[c.W.tokenId("Arbitrum","0x5979D7b546E38E414F7E9822514be443A4800529"),c.W.tokenId("Base","0xc1CBa3fCea344f92D9239c08C0568f6F2F0ee452"),c.W.tokenId("Ethereum","0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0"),c.W.tokenId("Optimism","0x1F32b1c2345538c0c6f582fCB022739c4A194Ebb"),c.W.tokenId("Polygon","0x03b54A6e9a984069379fae1a4fC4dBAE93B3bCCD")],USDT:[c.W.tokenId("Arbitrum","0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9"),c.W.tokenId("Avalanche","0x9702230A8Ea53601f5cD2dc00fDBc13d4dF4A8c7"),c.W.tokenId("Base","0xfde4C96c8593536E31F229EA8f37b2ADa2699bb2"),c.W.tokenId("Bsc","0x55d398326f99059fF775485246999027B3197955"),c.W.tokenId("Ethereum","0xdAC17F958D2ee523a2206206994597C13D831ec7"),c.W.tokenId("Optimism","0x94b008aA00579c1307B0EF2c499aD98a8ce58e58"),c.W.tokenId("Polygon","0xc2132D05D31c914a87C6611C10748AEb04B58e8F"),c.W.tokenId("Celo","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e")]};class A{constructor(e,t,n,r){if(g(this,"network"),g(this,"chain"),g(this,"provider"),g(this,"contracts"),g(this,"chainId"),g(this,"core"),g(this,"tokenBridge"),this.network=e,this.chain=t,this.provider=n,this.contracts=r,!r.portico)throw new Error("Unsupported chain, no contract addresses for: "+t);this.core=new d.EvmWormholeCore(e,t,n,r),this.tokenBridge=new h.EvmTokenBridge(e,t,n,r),this.chainId=c.y.get(e,t)}static async fromRpc(e,t){const[n,r]=await u.E.chainFromRpc(e),o=t[r];if(o.network!==n)throw new Error("Network mismatch: ".concat(o.network," != ").concat(n));return new A(n,r,e,o.contracts)}transfer(e,t,n,s,d,h,u){var p=this;return(0,r.A)(function*(){const{minAmountStart:r,minAmountFinish:f}=u.swapAmounts;if(0n===r)throw new Error("Invalid min swap amount");if(0n===f)throw new Error("Invalid min swap amount");const g=new c.az(e).toString(),[w,l]=(0,c.bg)(p.network,p.chain,n),[b,A]=(0,c.bg)(p.network,t.chain,d),m=(0,c.o)(l),E=(0,c.o)(yield(0,o.A)(p.getTransferrableToken(m))),C=(0,c.o)(t),y=(0,c.o)(A),v=(new Date).valueOf()%16,B=c.dj.serializeFlagSet({flags:{shouldWrapNative:w,shouldUnwrapNative:b},recipientChain:(0,c.ax)(t.chain),bridgeNonce:v,feeTierStart:100,feeTierFinish:100,padding:new Uint8Array(19)}),I=k.encodeFunctionData("start",[[B,m.toLowerCase(),E,y.toLowerCase(),C,h,s.toString(),r.toString(),f.toString(),u.relayerFee.toString()]]),F=p.getTokenGroup(l.address.toString()),T=p.getPorticoAddress(F);w||(yield*(0,a.A)((0,i.A)(p.approve(m,g,s,T)),o.A));const D={to:T,data:I,value:(yield(0,o.A)(p.core.getMessageFee()))+(w?s:0n)};yield p.createUnsignedTransaction((0,c.aC)(D,g),"PorticoBridge.Transfer")})()}redeem(e,t){var n=this;return(0,r.A)(function*(){const r=(0,c.ad)(t.payload.payload.flagSet.recipientChain),a=t.payload.payload.finalTokenAddress.toNative(r).toString(),i=n.getTokenGroup(a),d=n.getPorticoAddress(i),h=yield(0,o.A)(new s.C(d,k.fragments,n.provider).getFunction("receiveMessageAndSwap").populateTransaction((0,c.aE)(t))),u=new c.az(e).toString();yield n.createUnsignedTransaction((0,c.aC)(h,u),"PorticoBridge.Redeem")})()}async isTransferCompleted(e){return await this.tokenBridge.tokenBridge.isTransferCompleted((0,c.aa)(e.hash))}async quoteSwap(e,t,n,r){const[,o]=(0,c.bg)(this.network,this.chain,e),[,a]=(0,c.bg)(this.network,this.chain,t),i=(0,c.o)(o),d=(0,c.o)(a);if((0,c.dk)(i,d))return r;const h=this.getQuoterAddress(n);return(await new s.C(h,w.fragments,this.provider).getFunction("quoteExactInputSingle").staticCall([i,d,r,100,0]))[0]}async quoteRelay(e,t){return await l.quoteRelayer(this.chain,e,t)}async getTransferrableToken(e){const t=c.W.tokenId(this.chain,e),[,n]=(0,c.bg)(this.network,this.chain,t);if("Ethereum"===this.chain)return n;const r=Object.values(b).find(e=>e.find(e=>e.chain===this.chain&&(0,c.o)(e)===(0,c.o)(n)));if(!r)throw new Error("No token group found for ".concat(e," on ").concat(this.chain));const o=r.find(e=>"Ethereum"===e.chain);if(!o)throw new Error("No Ethereum origin token found for ".concat(e," on ").concat(this.chain));const a=await this.tokenBridge.getWrappedAsset(o);return c.W.tokenId(this.chain,a.toString())}supportedTokens(){const e=[];for(const[t,n]of Object.entries(b))for(const r of n)r.chain===this.chain&&e.push({group:t,token:r});return e}getTokenGroup(e){const t=this.supportedTokens().find(t=>(0,c.o)(t.token)===e);if(!t)throw new Error("Token not found");return t.group}approve(e,t,n,a){var i=this;return(0,r.A)(function*(){const r=u.E.getTokenImplementation(i.provider,e);if((yield(0,o.A)(r.allowance(t,a)))<n){const e=yield(0,o.A)(r.approve.populateTransaction(a,n));yield i.createUnsignedTransaction((0,c.aC)(e,t),"PorticoBridge.Approve")}})()}createUnsignedTransaction(e,t){return new p.E((0,c.aD)(e,this.chainId),this.network,this.chain,t,!1)}getPorticoAddress(e){const t=this.contracts.portico;return"USDT"===e&&t.porticoPancakeSwap||t.porticoUniswap}getQuoterAddress(e){const t=this.contracts.portico;return"USDT"===e&&t.pancakeSwapQuoterV2||t.uniswapQuoterV2}}(0,c.aF)(c.aG,"PorticoBridge",A)}}]);
//# sourceMappingURL=5872.1f0318fb.chunk.js.map