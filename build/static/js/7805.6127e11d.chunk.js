/*! For license information please see 7805.6127e11d.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbrige_typescript=self.webpackChunkbrige_typescript||[]).push([[7805],{3234:(e,t,i)=>{i.d(t,{g:()=>a});var s;let n;const r=new Set;const o={};function a(){if(n||(n=Object.freeze({register:c,get:h,on:d}),typeof window>"u"))return n;const e=Object.freeze({register:c});try{window.addEventListener("wallet-standard:register-wallet",t=>{let{detail:i}=t;return i(e)})}catch(t){console.error("wallet-standard:register-wallet event listener could not be added\n",t)}try{window.dispatchEvent(new p(e))}catch(t){console.error("wallet-standard:app-ready event could not be dispatched\n",t)}return n}function c(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s;return(t=t.filter(e=>!r.has(e))).length?(t.forEach(e=>function(e){l=void 0,r.add(e)}(e)),null==(s=o.register)||s.forEach(e=>u(()=>e(...t))),function(){var e;t.forEach(e=>function(e){l=void 0,r.delete(e)}(e)),null==(e=o.unregister)||e.forEach(e=>u(()=>e(...t)))}):()=>{}}let l;function h(){return l||(l=[...r]),l}function d(e,t){var i;return null!=(i=o[e])&&i.push(t)||(o[e]=[t]),function(){var i;o[e]=null==(i=o[e])?void 0:i.filter(e=>t!==e)}}function u(e){try{e()}catch(t){console.error(t)}}class p extends Event{get detail(){return function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)}(this,s,"f")}get type(){return"wallet-standard:app-ready"}constructor(e){super("wallet-standard:app-ready",{bubbles:!1,cancelable:!1,composed:!1}),s.set(this,void 0),function(e,t,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===s?n.call(e,i):n?n.value=i:t.set(e,i)}(this,s,e,"f")}preventDefault(){throw new Error("preventDefault cannot be called")}stopImmediatePropagation(){throw new Error("stopImmediatePropagation cannot be called")}stopPropagation(){throw new Error("stopPropagation cannot be called")}}s=new WeakMap},4528:(e,t,i)=>{i.d(t,{R:()=>d,a:()=>u});var s,n,r,o,a,c,l=function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)},h=function(e,t,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,i):n?n.value=i:t.set(e,i),i};class d{get address(){return l(this,s,"f")}get publicKey(){return l(this,n,"f").slice()}get chains(){return l(this,r,"f").slice()}get features(){return l(this,o,"f").slice()}get label(){return l(this,a,"f")}get icon(){return l(this,c,"f")}constructor(e){s.set(this,void 0),n.set(this,void 0),r.set(this,void 0),o.set(this,void 0),a.set(this,void 0),c.set(this,void 0),new.target===d&&Object.freeze(this),h(this,s,e.address,"f"),h(this,n,e.publicKey.slice(),"f"),h(this,r,e.chains.slice(),"f"),h(this,o,e.features.slice(),"f"),h(this,a,e.label,"f"),h(this,c,e.icon,"f")}}function u(e,t){if(e===t)return!0;const i=e.length;if(i!==t.length)return!1;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}s=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,c=new WeakMap},7805:(e,t,i)=>{i.r(t),i.d(t,{A:()=>Yy,B:()=>At,C:()=>tv,D:()=>qb,E:()=>Ky,F:()=>kb,G:()=>Sb,H:()=>Ct,I:()=>Lb,J:()=>Pb,K:()=>Bb,L:()=>Db,M:()=>Qv,N:()=>Cb,O:()=>Uy,P:()=>Ab,Q:()=>Vb,R:()=>Zy,S:()=>Cy,T:()=>Xy,U:()=>zb,V:()=>AD,W:()=>fk,a:()=>Sy,b:()=>wk,c:()=>Dy,d:()=>Ov,e:()=>Ak,f:()=>sy,g:()=>Oy,h:()=>Cv,i:()=>Ay,j:()=>Bv,k:()=>Ck,l:()=>zy,m:()=>gk,n:()=>Sv,o:()=>Gv,p:()=>bk,q:()=>yt,r:()=>Nk,s:()=>dt,t:()=>Nt,u:()=>ut,v:()=>vt,w:()=>St,x:()=>ht,y:()=>lt,z:()=>Pt});var s,n,r,o,a,c,l=i(454),h=i(7528),d=i(9379),u=i(45),p=i(1640),g=i(1703),f=i(4528),w=i(3234),m=i(8338),y=i(433),v=i(5339),b=i(6791),I=(i(4100),i(4396));const E=["signers"],N=["signers"],A=["headers","signal","cache"],C=["headers","signal"],S=["body","headers","signal"],P=["body","headers","signal"],T=["body","headers","signal"],M=["signers"];var _,O,x=Object.defineProperty,k=(e,t,i)=>((e,t,i)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class D extends Error{constructor(e,t){super(e),this.error=t}}class j extends D{constructor(){super(...arguments),this.name="WalletNotReadyError"}}class R extends D{constructor(){super(...arguments),this.name="WalletLoadError"}}class U extends D{constructor(){super(...arguments),this.name="WalletConfigError"}}class L extends D{constructor(){super(...arguments),this.name="WalletConnectionError"}}class z extends D{constructor(){super(...arguments),this.name="WalletDisconnectedError"}}class q extends D{constructor(){super(...arguments),this.name="WalletDisconnectionError"}}class B extends D{constructor(){super(...arguments),this.name="WalletAccountError"}}class V extends D{constructor(){super(...arguments),this.name="WalletPublicKeyError"}}class H extends D{constructor(){super(...arguments),this.name="WalletNotConnectedError"}}class K extends D{constructor(){super(...arguments),this.name="WalletSendTransactionError"}}class W extends D{constructor(){super(...arguments),this.name="WalletSignTransactionError"}}class F extends D{constructor(){super(...arguments),this.name="WalletSignMessageError"}}class G extends D{constructor(){super(...arguments),this.name="WalletSignInError"}}class Y extends D{constructor(){super(...arguments),this.name="WalletWindowClosedError"}}(O=_||(_={})).Installed="Installed",O.NotDetected="NotDetected",O.Loadable="Loadable",O.Unsupported="Unsupported";class Q extends p.E{get connected(){return!!this.publicKey}async autoConnect(){await this.connect()}async prepareTransaction(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=this.publicKey;if(!s)throw new H;return e.feePayer=e.feePayer||s,e.recentBlockhash=e.recentBlockhash||(await t.getLatestBlockhash({commitment:i.preflightCommitment,minContextSlot:i.minContextSlot})).blockhash,e}}function Z(e){if(typeof window>"u"||typeof document>"u")return;const t=[];function i(){if(e())for(const e of t)e()}const s=setInterval(i,1e3);t.push(()=>clearInterval(s)),"loading"===document.readyState&&(document.addEventListener("DOMContentLoaded",i,{once:!0}),t.push(()=>document.removeEventListener("DOMContentLoaded",i))),"complete"!==document.readyState&&(window.addEventListener("load",i,{once:!0}),t.push(()=>window.removeEventListener("load",i))),i()}function J(e){return"version"in e}class X extends Q{async sendTransaction(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=!0;try{if(J(e)){if(!this.supportedTransactionVersions)throw new K("Sending versioned transactions isn't supported by this wallet");if(!this.supportedTransactionVersions.has(e.version))throw new K("Sending transaction version ".concat(e.version," isn't supported by this wallet"));try{const s=(e=await this.signTransaction(e)).serialize();return await t.sendRawTransaction(s,i)}catch(n){throw n instanceof W?(s=!1,n):new K(null==n?void 0:n.message,n)}}else try{const{signers:s}=i,n=(0,u.A)(i,E);e=await this.prepareTransaction(e,t,n),null!=s&&s.length&&e.partialSign(...s);const r=(e=await this.signTransaction(e)).serialize();return await t.sendRawTransaction(r,n)}catch(n){throw n instanceof W?(s=!1,n):new K(null==n?void 0:n.message,n)}}catch(n){throw s&&this.emit("error",n),n}}async signAllTransactions(e){for(const i of e)if(J(i)){if(!this.supportedTransactionVersions)throw new W("Signing versioned transactions isn't supported by this wallet");if(!this.supportedTransactionVersions.has(i.version))throw new W("Signing transaction version ".concat(i.version," isn't supported by this wallet"))}const t=[];for(const i of e)t.push(await this.signTransaction(i));return t}}class $ extends X{}const ee="solana:signAndSendTransaction",te="solana:signIn",ie="solana:signMessage",se="solana:signTransaction",ne="standard:connect",re="standard:disconnect",oe="standard:events";function ae(e){return ne in e.features&&oe in e.features&&(ee in e.features||se in e.features)}var ce;!function(e){e.Mainnet="mainnet-beta",e.Testnet="testnet",e.Devnet="devnet"}(ce||(ce={}));class le extends ${constructor(){super(),this.name="Bitget",this.url="https://web3.bitget.com",this.icon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiBmaWxsPSIjMDAxRjI5Ii8+CjxwYXRoIGQ9Ik0yMTkuOTQ4IDk1LjcwMjJDMjAxLjYyMyA5NS42OTI5IDE4My4zMyA5NS42ODM1IDE2NC45NDEgOTUuNzExNkMxNTMuODIyIDk1LjcxMTYgMTQ5LjY1MSAxMDkuNjcxIDE1Ny45MjEgMTE3LjkzOUwyODMuMDk4IDI0My4xMTdDMjg3LjAwNCAyNDYuNjkgMjg5LjQ0MSAyNTAuNTc0IDI4OS41MyAyNTUuNjkzQzI4OS40NDEgMjYwLjgxMiAyODcuMDA0IDI2NC42OTYgMjgzLjA5OCAyNjguMjY5TDE1Ny45MjEgMzkzLjQ0NkMxNDkuNjUxIDQwMS43MTUgMTUzLjgyMiA0MTUuNjc0IDE2NC45NDEgNDE1LjY3NEMxODMuMzMgNDE1LjcwMiAyMDEuNjIzIDQxNS42OTMgMjE5Ljk0OCA0MTUuNjgzQzIyOS4xMjIgNDE1LjY3OSAyMzguMzA1IDQxNS42NzQgMjQ3LjUxMSA0MTUuNjc0QzI1OS41NTUgNDE1LjY3NCAyNjYuNzIgNDA5LjI0IDI3My4xNTQgNDAyLjgwNUwzODYuMDQ3IDI4OS45MTJDMzk1LjA1NyAyODAuOTAyIDQwMy4xMTkgMjY4LjkzOSA0MDMuMDA5IDI1NS42OTNDNDAzLjExOSAyNDIuNDQ3IDM5NS4wNTcgMjMwLjQ4NCAzODYuMDQ3IDIyMS40NzRMMjczLjE1NCAxMDguNThDMjY2LjcyIDEwMi4xNDYgMjU5LjU1NSA5NS43MTE2IDI0Ny41MTEgOTUuNzExNkMyMzguMzA1IDk1LjcxMTYgMjI5LjEyMiA5NS43MDY5IDIxOS45NDggOTUuNzAyMloiIGZpbGw9IiMwMEYwRkYiLz4KPC9zdmc+Cg==",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?_.Unsupported:_.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==_.Unsupported&&Z(()=>{var e,t;return!(null==(t=null==(e=window.bitkeep)?void 0:e.solana)||!t.isBitKeep)&&(this._readyState=_.Installed,this.emit("readyStateChange",this._readyState),!0)})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==_.Installed)throw new j;this._connecting=!0;const t=window.bitkeep.solana;let i,s;try{i=await t.getAccount()}catch(e){throw new B(null==e?void 0:e.message,e)}try{s=new p.P(i)}catch(e){throw new V(null==e?void 0:e.message,e)}this._wallet=t,this._publicKey=s,this.emit("connect",s)}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch(t){this.emit("error",new q(null==t?void 0:t.message,t))}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signTransaction(e)||e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signAllTransactions(e)||e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new H;try{const{signature:t}=await i.signMessage(e);return t}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}}class he extends ${constructor(){super(),this.name="Clover",this.url="https://clv.org",this.icon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTM2LjQ4IDBIMTEuNTJDNS4xNTc2OCAwIDAgNS4xNTc2OCAwIDExLjUyVjM2LjQ4QzAgNDIuODQyMyA1LjE1NzY4IDQ4IDExLjUyIDQ4SDM2LjQ4QzQyLjg0MjMgNDggNDggNDIuODQyMyA0OCAzNi40OFYxMS41MkM0OCA1LjE1NzY4IDQyLjg0MjMgMCAzNi40OCAwWiIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyXzc5MTBfMTYzMzUxKSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI0LjAwMDYgMzkuMzYwNkMzMi40ODM3IDM5LjM2MDYgMzkuMzYwNiAzMi40ODM3IDM5LjM2MDYgMjQuMDAwNkMzOS4zNjA2IDE1LjUxNzUgMzIuNDgzNyA4LjY0MDYyIDI0LjAwMDYgOC42NDA2MkMxNS41MTc1IDguNjQwNjIgOC42NDA2MiAxNS41MTc1IDguNjQwNjIgMjQuMDAwNkM4LjY0MDYyIDMyLjQ4MzcgMTUuNTE3NSAzOS4zNjA2IDI0LjAwMDYgMzkuMzYwNlpNMjEuMjg5OSAxNS44Njg4SDI2LjcxMVYyMS4zNDdIMjEuMjkwNFYyNi42NTRIMjYuNzExVjMyLjEzMjJIMjEuMjg5OVYyNi44MjUySDE1Ljg2OTNWMjEuMzQ3SDIxLjI4OTlWMTUuODY4OFpNMjYuNzEyIDIxLjM0N0gzMi4xMzMxVjI2LjgyNTJIMjYuNzEyVjIxLjM0N1oiIGZpbGw9ImJsYWNrIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfNzkxMF8xNjMzNTEiIHgxPSI0OCIgeTE9Ii0xLjQzMDUxZS0wNiIgeDI9IjEuNDMwNTFlLTA2IiB5Mj0iNDgiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iI0E5RkZFMCIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM4NkQ1RkYiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4=",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?_.Unsupported:_.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==_.Unsupported&&Z(()=>{var e;return!(null==(e=window.clover_solana)||!e.isCloverWallet)&&(this._readyState=_.Installed,this.emit("readyStateChange",this._readyState),!0)})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==_.Installed)throw new j;this._connecting=!0;const t=window.clover_solana;let i,s;try{i=await t.getAccount()}catch(e){throw new B(null==e?void 0:e.message,e)}try{s=new p.P(i)}catch(e){throw new V(null==e?void 0:e.message,e)}this._wallet=t,this._publicKey=s,this.emit("connect",s)}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}async disconnect(){this._wallet&&(this._wallet=null,this._publicKey=null),this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signTransaction(e)||e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signAllTransactions(e)||e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new H;try{const{signature:t}=await i.signMessage(e);return Uint8Array.from(t)}catch(t){throw new F(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}}const de=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let a=0;a<t.length;a++)t[a]=255;for(let a=0;a<e.length;a++){const i=e.charAt(a),s=i.charCodeAt(0);if(255!==t[s])throw new TypeError(i+" is ambiguous");t[s]=a}const i=e.length,s=e.charAt(0),n=Math.log(i)/Math.log(256),r=Math.log(256)/Math.log(i);function o(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let r=0,o=0,a=0;for(;e[r]===s;)o++,r++;const c=(e.length-r)*n+1>>>0,l=new Uint8Array(c);for(;r<e.length;){const s=e.charCodeAt(r);if(s>255)return;let n=t[s];if(255===n)return;let o=0;for(let e=c-1;(0!==n||o<a)&&-1!==e;e--,o++)n+=i*l[e]>>>0,l[e]=n%256>>>0,n=n/256>>>0;if(0!==n)throw new Error("Non-zero carry");a=o,r++}let h=c-a;for(;h!==c&&0===l[h];)h++;const d=new Uint8Array(o+(c-h));let u=o;for(;h!==c;)d[u++]=l[h++];return d}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let n=0,o=0,a=0;const c=t.length;for(;a!==c&&0===t[a];)a++,n++;const l=(c-a)*r+1>>>0,h=new Uint8Array(l);for(;a!==c;){let e=t[a],s=0;for(let t=l-1;(0!==e||s<o)&&-1!==t;t--,s++)e+=256*h[t]>>>0,h[t]=e%i>>>0,e=e/i>>>0;if(0!==e)throw new Error("Non-zero carry");o=s,a++}let d=l-o;for(;d!==l&&0===h[d];)d++;let u=s.repeat(n);for(;d<l;++d)u+=e.charAt(h[d]);return u},decodeUnsafe:o,decode:function(e){const t=o(e);if(t)return t;throw new Error("Non-base"+i+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");class ue extends ${constructor(){super(),this.name="Coin98",this.url="https://coin98.com",this.icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NiA3NSI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImEiIHgxPSIxMDEuNjgxJSIgeDI9Ii0xLjU1NyUiIHkxPSIxNS4yNjglIiB5Mj0iODQuOTE3JSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNGMUQ5NjEiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjQ0RBMTQ2Ii8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgPHJlY3Qgd2lkdGg9Ijc1IiBoZWlnaHQ9Ijc1IiBmaWxsPSIjMDAwIiByeD0iMTYiLz4KICAgIDxwYXRoIGZpbGw9InVybCgjYSkiIGZpbGwtcnVsZT0ibm9uemVybyIgZD0iTTYxLjQ0IDBhMTMuNzE0IDEzLjcxNCAwIDAgMSA5LjY4IDQuMDEgMTMuNjYxIDEzLjY2MSAwIDAgMSA0LjAwOCA5LjY2OHY0Ny42NDZhMTMuNjYgMTMuNjYgMCAwIDEtNC4wMDcgOS42NjZBMTMuNzEzIDEzLjcxMyAwIDAgMSA2MS40NCA3NUgxMy42ODZhMTMuNzEzIDEzLjcxMyAwIDAgMS05LjY4LTQuMDFBMTMuNjYgMTMuNjYgMCAwIDEgMCA2MS4zMjRWMTMuNjc4YzAtMy42MjUgMS40NC03LjEwMiA0LjAwNy05LjY2N0ExMy43MTQgMTMuNzE0IDAgMCAxIDEzLjY4NyAwWk0yMC4wNjMgNDYuMjMxaC00LjgyNWExMC4wMzIgMTAuMDMyIDAgMCAwIDIuOTQ2IDcuMDg2IDEwLjA3IDEwLjA3IDAgMCAwIDcuMSAyLjk0MiAxMC4wNjUgMTAuMDY1IDAgMCAwIDcuMTA4LTIuOTM1IDEwLjAzIDEwLjAzIDAgMCAwIDIuOTQ2LTcuMDkzaC00LjgyNGE1LjIwNyA1LjIwNyAwIDAgMS0xLjUzIDMuNjg4IDUuMjI1IDUuMjI1IDAgMCAxLTMuNjk2IDEuNTI4IDUuMjM0IDUuMjM0IDAgMCAxLTMuNjk1LTEuNTI4IDUuMjEzIDUuMjEzIDAgMCAxLTEuNTMtMy42ODhaTTU0LjMzIDMzLjcxNmExMS43NjMgMTEuNzYzIDAgMCAwLTEyLjc5OSAyLjUzOEExMS42OTcgMTEuNjk3IDAgMCAwIDM4Ljk5IDQ5LjAzYTExLjcyMyAxMS43MjMgMCAwIDAgNC4zMjggNS4yNTkgMTEuNzU3IDExLjc1NyAwIDAgMCA2LjUyNiAxLjk3IDExLjc2NiAxMS43NjYgMCAwIDAgOC4yOS0zLjQzNSAxMS43MiAxMS43MiAwIDAgMCAzLjQ0Mi04LjI3NCAxMS43MDIgMTEuNzAyIDAgMCAwLTEuOTc1LTYuNTE0IDExLjczNiAxMS43MzYgMCAwIDAtNS4yNjktNC4zMlptLTQuNDg4IDMuOTJhNi45MzcgNi45MzcgMCAwIDEgNC45IDIuMDI1IDYuOTEgNi45MSAwIDAgMSAyLjAyOCA0Ljg5MiA2Ljg5NyA2Ljg5NyAwIDAgMS0xLjE3IDMuODM0IDYuOTMyIDYuOTMyIDAgMCAxLTEwLjY0MyAxLjA0MiA2LjkwMiA2LjkwMiAwIDAgMS0xLjUtNy41MjIgNi45MDkgNi45MDkgMCAwIDEgMi41NDQtMy4xIDYuOTI4IDYuOTI4IDAgMCAxIDMuODQxLTEuMTY3Wm0uMTcgNC41NTJhMi40MzEgMi40MzEgMCAwIDAtMi4yNDEgMS4xNTQgMi40MTggMi40MTggMCAwIDAtLjM1NiAxLjI1NyAyLjM5NSAyLjM5NSAwIDAgMCAxLjYxOSAyLjI5djEuNzUzaDEuNjE4di0xLjc1NGEyLjQyNyAyLjQyNyAwIDAgMCAxLjU5NC0xLjk1IDIuNDE4IDIuNDE4IDAgMCAwLTEtMi4zMSAyLjQzMSAyLjQzMSAwIDAgMC0xLjIzNC0uNDRabS0yMC4yMi0yMi41NTJhMTEuNzYyIDExLjc2MiAwIDAgMC0xMi43OTYgMi41MzEgMTEuNjk3IDExLjY5NyAwIDAgMC0yLjU1NCAxMi43NjkgMTEuNzIzIDExLjcyMyAwIDAgMCA0LjMyIDUuMjYyIDExLjc1NyAxMS43NTcgMCAwIDAgMTQuODI1LTEuNDQ2IDExLjcxNyAxMS43MTcgMCAwIDAgMy40NDUtOC4yODQgMTEuNzAzIDExLjcwMyAwIDAgMC0xLjk3NC02LjUxMiAxMS43MzYgMTEuNzM2IDAgMCAwLTUuMjY2LTQuMzJabS00LjUxIDMuOTE3YTYuOTQ1IDYuOTQ1IDAgMCAxIDQuODk3IDIuMDI5IDYuOTE4IDYuOTE4IDAgMCAxIDIuMDMyIDQuODg2IDYuOTA2IDYuOTA2IDAgMCAxLTEuMTY4IDMuODQyIDYuOTQgNi45NCAwIDAgMS0xMC42NiAxLjA0OCA2LjkxMSA2LjkxMSAwIDAgMS0xLjUtNy41MzYgNi45MTggNi45MTggMCAwIDEgMi41NS0zLjEwMyA2LjkzNyA2LjkzNyAwIDAgMSAzLjg1LTEuMTY2Wm0yNC41Ni00LjgxYTEwLjA1OSAxMC4wNTkgMCAwIDAtNy4xMDMgMi45NCAxMC4wMiAxMC4wMiAwIDAgMC0yLjk0IDcuMDkgOS45IDkuOSAwIDAgMCAxLjIzIDQuNzk1IDEzLjU3NSAxMy41NzUgMCAwIDEgNC4yMTQtMi4zMjIgNS4wODIgNS4wODIgMCAwIDEtLjYyNS0yLjQ3NyA1LjIwNiA1LjIwNiAwIDAgMSAxLjUwMy0zLjczNiA1LjIyMyA1LjIyMyAwIDAgMSAzLjcyMi0xLjU1NCA1LjIzNCA1LjIzNCAwIDAgMSAzLjcyIDEuNTU0IDUuMjEzIDUuMjEzIDAgMCAxIDEuNTA1IDMuNzM2IDUuMjc5IDUuMjc5IDAgMCAxLS42MjMgMi40NzMgMTMuNTc0IDEzLjU3NCAwIDAgMSA0LjIxMyAyLjMyMiA5LjkwMyA5LjkwMyAwIDAgMCAxLjIzLTQuNzk1IDEwLjAzMiAxMC4wMzIgMCAwIDAtMi45NDYtNy4wODYgMTAuMDcgMTAuMDcgMCAwIDAtNy4xLTIuOTRabS0yMy43NSA3Ljk5aC0xLjYxN3YxLjc1YTIuNDE5IDIuNDE5IDAgMCAwLTEuNTgyIDIuNjg3IDIuNDE0IDIuNDE0IDAgMCAwIDIuMzkgMi4wMDYgMi40NSAyLjQ1IDAgMCAwIDEuNTU1LS41NzQgMi40MTQgMi40MTQgMCAwIDAtLjc0Ni00LjExOXYtMS43NVoiLz4KICA8L2c+Cjwvc3ZnPgo=",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?_.Unsupported:_.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==_.Unsupported&&Z(()=>{var e;return!(null==(e=window.coin98)||!e.sol)&&(this._readyState=_.Installed,this.emit("readyStateChange",this._readyState),!0)})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get connected(){var e;return!(null==(e=this._wallet)||!e.isConnected())}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==_.Installed)throw new j;this._connecting=!0;const t=window.coin98.sol;let i,s;try{i=(await t.connect())[0]}catch(e){throw new B(null==e?void 0:e.message,e)}try{s=new p.P(i)}catch(e){throw new V(null==e?void 0:e.message,e)}this._wallet=t,this._publicKey=s,this.emit("connect",s)}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch(t){this.emit("error",new q(null==t?void 0:t.message,t))}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{const t=await i.request({method:"sol_sign",params:[e]}),s=new p.P(t.publicKey),n=de.decode(t.signature);return e.addSignature(s,p.d.Buffer.from(n)),e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new H;try{const t=await i.request({method:"sol_signAllTransactions",params:[e]}),s=new p.P(t.publicKey),n=t.signatures;return e.map((e,t)=>{const i=de.decode(n[t]);return e.addSignature(s,p.d.Buffer.from(i)),e})}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new H;try{const t=await i.request({method:"sol_signMessage",params:[e]});return de.decode(t.signature)}catch(t){throw new F(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}}class pe extends ${constructor(){super(),this.name="Nightly",this.url="https://nightly.app",this.icon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA5NiA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTQ4IDk2Qzc0LjUwOTcgOTYgOTYgNzQuNTA5NyA5NiA0OEM5NiAyMS40OTAzIDc0LjUwOTcgMCA0OCAwQzIxLjQ5MDMgMCAwIDIxLjQ5MDMgMCA0OEMwIDc0LjUwOTcgMjEuNDkwMyA5NiA0OCA5NloiIGZpbGw9IiM2RDczRjgiLz4KPHBhdGggZD0iTTQ4IDg1LjYzNTZDNDggODUuNjM1NiA1Mi40NTMzIDg1LjYzNTYgNTUuNDQgODIuNTg2N0M1OC45MTU1IDc5LjI4MDEgNTcuMzUxMSA3NS40MzEyIDYyLjI3NTUgNzEuNDMxMkM2Ni45ODY2IDY3LjY0NDUgNzIuOTI0NCA3MC4zMzc5IDcyLjkyNDQgNzAuMzM3OUM3Ny4wMjIyIDYyLjEyNDUgNzQuNzkxMSA1Mi41NjkgNzQuNzkxMSA1Mi41NjlDODEuNzY4OCAzNC4yNTc5IDc1Ljk2NDQgMjEuMTU1NyA3NC40NDQ0IDE3LjM2MDFDNjkuNDQ4OCAyNC4zMzc5IDYzLjE5MTEgMjkuMTczNCA1NS43OTU1IDMyLjQwOUM1My4yMjY2IDMxLjcwNjggNTAuNTk1NSAzMS4zMzM0IDQ4IDMxLjM2MDFDNDUuNDEzMyAzMS4zMzM0IDQyLjc3MzMgMzEuNzA2OCA0MC4yMDQ0IDMyLjQwOUMzMi44MTc3IDI5LjE2NDUgMjYuNTUxMSAyNC4zMzc5IDIxLjU1NTUgMTcuMzYwMUMyMC4wMzU1IDIxLjE1NTcgMTQuMjMxMSAzNC4yNTc5IDIxLjIwODkgNTIuNTY5QzIxLjIwODkgNTIuNTY5IDE4Ljk3NzggNjIuMTI0NSAyMy4wNzU1IDcwLjMzNzlDMjMuMDc1NSA3MC4zMzc5IDI5LjAxMzMgNjcuNjQ0NSAzMy43MjQ0IDcxLjQzMTJDMzguNjU3NyA3NS40MzEyIDM3LjA4NDQgNzkuMjgwMSA0MC41NiA4Mi41ODY3QzQzLjU0NjYgODUuNjM1NiA0OCA4NS42MzU2IDQ4IDg1LjYzNTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNDIuNDc5OSA2NS4yOThDNDIuMjkzMyA1OS4yMTggMzYuMzAyMSA1Ny4yNjI0IDMyLjIxMzMgNTkuODIyNEMzMi4yMTMzIDU5LjgyMjQgMzIuODUzMyA2Mi40MzU4IDM1LjgzOTkgNjMuNzUxM0MzOC4yNzU1IDY0LjgyNjkgMzkuMzI0NCA2My4zODY5IDQyLjQ3OTkgNjUuMjk4WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNMjIuNDk3NyAyMy4wOTM1QzIwLjA4ODggMzEuNTQ2OCAyMS4xMjg4IDQyLjI0MDIgMjQuOTMzMyA1MC4wMjY5QzI4LjgyNjYgNDcuMjcxMyAzMi45MTU1IDQzLjAxMzUgMzUuMDkzMyAzOC41MDY5QzI5Ljk2NDQgMzQuNzExMyAyNS42NjIyIDMxLjEwMjQgMjIuNDk3NyAyMy4wOTM1WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNNTMuNTE5OSA2NS4yOThDNTMuNzA2NiA1OS4yMTggNTkuNjk3NyA1Ny4yNjI0IDYzLjc4NjYgNTkuODIyNEM2My43ODY2IDU5LjgyMjQgNjMuMTQ2NiA2Mi40MzU4IDYwLjE1OTkgNjMuNzUxM0M1Ny43MjQzIDY0LjgyNjkgNTYuNjc1NSA2My4zODY5IDUzLjUxOTkgNjUuMjk4WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNNzMuNTAyMiAyMy4wOTM1Qzc1LjkxMTEgMzEuNTQ2OCA3NC44NzExIDQyLjI0MDIgNzEuMDY2NiA1MC4wMjY5QzY3LjE3MzMgNDcuMjcxMyA2My4wODQ0IDQzLjAxMzUgNjAuOTA2NiAzOC41MDY5QzY2LjAzNTUgMzQuNzExMyA3MC4zMzc3IDMxLjEwMjQgNzMuNTAyMiAyMy4wOTM1WiIgZmlsbD0iIzdCODFGOSIvPgo8cGF0aCBkPSJNNDcuOTk5OSA4NS4zMDY5QzUwLjE0MDQgODUuMzA2OSA1MS44NzU1IDgzLjc3ODcgNTEuODc1NSA4MS44OTM2QzUxLjg3NTUgODAuMDA4NCA1MC4xNDA0IDc4LjQ4MDIgNDcuOTk5OSA3OC40ODAyQzQ1Ljg1OTUgNzguNDgwMiA0NC4xMjQ0IDgwLjAwODQgNDQuMTI0NCA4MS44OTM2QzQ0LjEyNDQgODMuNzc4NyA0NS44NTk1IDg1LjMwNjkgNDcuOTk5OSA4NS4zMDY5WiIgZmlsbD0iIzdCODFGOSIvPgo8L3N2Zz4K",this.supportedTransactionVersions=new Set(["legacy",0]),this._readyState=typeof window>"u"||typeof document>"u"?_.Unsupported:_.NotDetected,this._connecting=!1,this._publicKey=null,this._wallet=null,this._readyState!==_.Unsupported&&Z(()=>{var e;return!(null==(e=null==window?void 0:window.nightly)||!e.solana)&&(this._readyState=_.Installed,this.emit("readyStateChange",this._readyState),!0)})}get connecting(){return this._connecting}get readyState(){return this._readyState}get publicKey(){return this._publicKey}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==_.Installed)throw new j;this._connecting=!0;const t=window.nightly.solana;try{await t.connect()}catch(e){throw new L(null==e?void 0:e.message,e)}if("11111111111111111111111111111111"===t.publicKey.toString())throw new B;let i;try{i=new p.P(t.publicKey.toBytes())}catch(e){throw new V(null==e?void 0:e.message,e)}this._wallet=t,this._publicKey=i,this.emit("connect",i)}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch(t){this.emit("error",new z)}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signTransaction(e)}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signAllTransactions(e)}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new H;try{return i.signMessage((new TextDecoder).decode(e))}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}}const ge="solana:mainnet";class fe extends X{constructor(){super(),this.name="Solong",this.url="https://solongwallet.io",this.icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAGlklEQVR4Ae3bA5DsyhfH8TNr49r2/du2bdu2bdu2zcdNrm3b9toz533rvctUn3Umk9p01WfdvVW/6nROBxJVS1rSkpa0pCUtaUlLWtKSpl4VXos3GJ4sujQFuUKfWl+qT730arzB8Ex9YksKcgXjFOCVeIPhBYydB8mawQ+yiGC8n0EN6zAVcgXhpQjoq1DDdsyDAAB9Pwo1HMC9INk0FIM8Bt1Qh9WohQQCvD+BtEMdtmC8I7y5aIE67MV0SBwDvB3qsE/UHwMJIpC/QB1OYiLEEeCPoQ7nMRcSwwDrao3Zl8aTIEGEUYlL0IAMXuQOr66UvsegDm+ExDJAPNiafSg0AlyIbmjAWX1aQzEkiH6T0QkNaEdpnAN8NNRhPcSF9e9el2ebBhyAuNBvGtLQgIuQOAd4D6jDMRQbM3AmOqEBDfq0xjJIEP3GohkakEFVjAP0y401sAsLnAE+pb6EsC5AA9J4sHsG+kX0PQR1eFJ8AwTWQh0+DjFm4a1Qh2/AOoz/BHX4ZdwD/CDU4aioX2GUMW+AOnB2bqiBBDHe86EOTYw5GRKJwQ/ijUM91OGTxgysxSmowzeNw7j08m5DHX4l7Igg2TY0g9hbLBZ+f7oxC98CdWjDvYzD+MVQh07GfEQsZyDgVWA71OGvorfnQQCAcqaYUFZDHW6j/itAoB70GcergzqsEa0rhGTTEA7mP0koK4xdyeOMmvBBhJU2zsjPMw7lu9O3zShpXheHk4hhcZ4w26AOG4RSxDiUfwZ12KdPqy+FBDHeV6EOZxizIg6HsMGbiQ5jdjzBXRfeefGg3tgbv9BYC0fhZE7sjUMY9Pf9rdcI5XtQh39BjBA/C3VYnM0zcgiDek+GOhzh93mQoMs7kIxze/eMhnxIEOPNM9bcFtTEeAb6I419axu/m2CsgxU4Aw1A/UxIUM/bO/9+cVkDDd5x42x8N1iH8Taow0NhHcZLoQ5Pi/MMzDMW+DTu7g6vIY9AdkAdHmaUMyn6roA6PD22AeLB6DbWplHG7LubfY+kfiIkiH5T0AJ1uFtMA1xUzOc1UIclzvCeXF+o7DygDlvds29RgVVzYj+K4xhgEX4NdcjgecE++rSL+ZdLmIxRB77Ose7l4XPIQB3eF8M60C/n8++ghltE/QLIFfqUiyUE8kOoYSW7jmLIFXeN4X0NaajDDlG/NG6XswrxKdxu+G/weh27j3wCej9uN9zEOjc3sObl4S243XBLhDfWE0mAMQjwZfhxDng7pG/8Sj4/ER/Gd/BdfBhPRGW2A/wxNAfcBOnFCHwZZ6GGs/gqapMAb/QEnIT20Uk8IQkQeB7aof3UihcM9wDvhyboANHXv1+IdWBOB2hsIftto+iSPEif8aGPcjrA50GHyPMiOIT9B/N5apaMgQT8D2poxMdwt8s+hkao4X9ZDxBTIdHwy/h8AeqQxhMhAU9BB9ThPMqHTYCYjU6owy3uPstSfL4Z6uZPC+Mk8gOomz8DEg3vXshAHb4MMXwZarhXGDPwa739w2j48623BPAniOFPUMPsMAL8INTw9AgDrLZOCmjFPEjA3WD1aUJVGAG+CGr4ECRCy6GGg3iyaF0+n/PwFByEGpaJ+qkw1sB7QA3/hUTozdBetFymvXhTWGVMOc7bp36/FhKRamNW9dcxZmpZiI+32ad+vAQSoWejGzpAXXh22Fek3wY1rDD2kVnijR3ExYQMPgkJOUB/nFW0Is3vnw6JhlHX9a4N70Iq/ACBv0MNu7J9WxHw7jaA2deFOtw32zeVHtHLWvMN0dtSkOzwS3spYy7iH1hx2d/wYdyTvnkR3BdeQjjerVBDN14JyZIfQWH5RC7e1rw32npZV54LCc+SPD5/HgqYD3WW5+gTqt6X+rA4v0701hRkKF0+bL+HTM9Hgv/MHH60wyvHWigsafwA1ZAhMguLoL34kbDcQEI1uAH8mcbuxPHImf8i5EMGxqvER9EI7cUqVMTl0Y6HoxHaBzvxNkyC9EEe7oEv4Sy0D/YQ+IS4ver1JNT38z7sWnwbb8TT8Cg8Gs/Gu/Ar7EEXtI/2ud7Ni0GAYCbiJDQiazA57k9nTcdqaJb9UtSvitXbmjavCJ9AMzRkJ/B80boUJBLhDe7Nw1/QCR1i9fgKRg6HByzvjZ/hInQQMjiCT2PSMHxC1a/l8wvwGxyG9kEaW/EtPI4xiiE5JcLrd6PxcLwM78SH8EG8Fc/H/UUXVUByGh8SSYBJgEmASYCJJMAkwBi6A3xCqZhiBz8+AAAAAElFTkSuQmCC",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?_.Unsupported:_.NotDetected,this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==_.Unsupported&&Z(()=>!!window.solong&&(this._readyState=_.Installed,this.emit("readyStateChange",this._readyState),!0))}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get connected(){var e;return!(null==(e=this._wallet)||!e.currentAccount)}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==_.Installed)throw new j;this._connecting=!0;const t=window.solong;let i,s;try{i=await t.selectAccount()}catch(e){throw new B(null==e?void 0:e.message,e)}try{s=new p.P(i)}catch(e){throw new V(null==e?void 0:e.message,e)}this._wallet=t,this._publicKey=s,this.emit("connect",s)}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}async disconnect(){this._wallet&&(this._wallet=null,this._publicKey=null),this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signTransaction(e)||e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}}class we extends ${constructor(){let{params:e={showTorusButton:!1}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{showTorusButton:!1}};super(),this.name="Torus",this.url="https://tor.us",this.icon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzMiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMyAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYuNSIgY3k9IjE2IiByPSIxNiIgZmlsbD0iIzAzNjRGRiIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTExLjIxODYgOS40OTIxOUMxMC40NTM5IDkuNDkyMTkgOS44MzM5OCAxMC4xMTIxIDkuODMzOTggMTAuODc2OFYxMi40ODk4QzkuODMzOTggMTMuMjU0NSAxMC40NTM5IDEzLjg3NDQgMTEuMjE4NiAxMy44NzQ0SDEzLjY2ODRWMjIuODk3NkMxMy42Njg0IDIzLjY2MjMgMTQuMjg4MyAyNC4yODIyIDE1LjA1MyAyNC4yODIySDE2LjY2NkMxNy40MzA3IDI0LjI4MjIgMTguMDUwNiAyMy42NjIzIDE4LjA1MDYgMjIuODk3NlYxMi41MDE1QzE4LjA1MDYgMTIuNDk3NiAxOC4wNTA2IDEyLjQ5MzcgMTguMDUwNiAxMi40ODk4VjEwLjg3NjhDMTguMDUwNiAxMC4xMTIxIDE3LjQzMDcgOS40OTIxOSAxNi42NjYgOS40OTIxOUgxNS4wNTNIMTEuMjE4NloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0yMS4zMzc2IDEzLjg3NDRDMjIuNTQ3NyAxMy44NzQ0IDIzLjUyODcgMTIuODkzNCAyMy41Mjg3IDExLjY4MzNDMjMuNTI4NyAxMC40NzMyIDIyLjU0NzcgOS40OTIxOSAyMS4zMzc2IDkuNDkyMTlDMjAuMTI3NSA5LjQ5MjE5IDE5LjE0NjUgMTAuNDczMiAxOS4xNDY1IDExLjY4MzNDMTkuMTQ2NSAxMi44OTM0IDIwLjEyNzUgMTMuODc0NCAyMS4zMzc2IDEzLjg3NDRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K",this.supportedTransactionVersions=null,this._readyState=typeof window>"u"||typeof document>"u"?_.Unsupported:_.Loadable,this._connecting=!1,this._wallet=null,this._publicKey=null,this._params=e}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get connected(){var e;return!(null==(e=this._wallet)||!e.isLoggedIn)}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==_.Loadable)throw new j;let t,s,n,r;this._connecting=!0;try{t=(await i.e(2491).then(i.bind(i,2491))).default}catch(e){throw new R(null==e?void 0:e.message,e)}try{s=window.torus||new t}catch(e){throw new U(null==e?void 0:e.message,e)}if(!s.isInitialized)try{await s.init(this._params)}catch(e){throw new L(null==e?void 0:e.message,e)}try{n=await s.login()}catch(e){throw new B(null==e?void 0:e.message,e)}try{r=new p.P(n[0])}catch(e){throw new V(null==e?void 0:e.message,e)}this._wallet=s,this._publicKey=r,this.emit("connect",r)}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){this._wallet=null,this._publicKey=null;try{e.isLoggedIn&&await e.cleanUp()}catch(t){this.emit("error",new q(null==t?void 0:t.message,t))}}this.emit("disconnect")}async sendTransaction(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const n=this._wallet;if(!n)throw new H;try{const{signers:s}=i,r=(0,u.A)(i,N);e=await this.prepareTransaction(e,t,r),null!=s&&s.length&&e.partialSign(...s),r.preflightCommitment=r.preflightCommitment||t.commitment;const{signature:o}=await n.signAndSendTransaction(e,r);return o}catch(s){throw s instanceof D?s:new K(null==s?void 0:s.message,s)}}catch(n){throw this.emit("error",n),n}}async signTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signTransaction(e)||e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signAllTransactions(e)||e}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signMessage(e)}catch(t){throw new F(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}}function me(e){switch(e){case"processed":case"confirmed":case"finalized":case void 0:return e;case"recent":return"processed";case"single":case"singleGossip":return"confirmed";case"max":case"root":return"finalized";default:return}}var ye,ve;!function(e){e.Mainnet="solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",e.Devnet="solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",e.Deprecated_Mainnet="solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ",e.Deprecated_Devnet="solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"}(ye||(ye={})),function(e){e.signTransaction="solana_signTransaction",e.signMessage="solana_signMessage",e.signAndSendTransaction="solana_signAndSendTransaction",e.signAndSendAllTransactions="solana_signAndSendAllTransactions",e.signAllTransactions="solana_signAllTransactions"}(ve||(ve={}));const be="solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",Ie="solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",Ee="solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ",Ne="solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K";var Ae=Object.defineProperty,Ce=(e,t,i)=>((e,t,i)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let Se=class extends v.I{constructor(e){super(),this.opts=e,Ce(this,"protocol","wc"),Ce(this,"version",2)}};var Pe=Object.defineProperty,Te=(e,t,i)=>((e,t,i)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,t+"",i);let Me=class extends v.I{constructor(e,t){super(),this.core=e,this.logger=t,Te(this,"records",new Map)}},_e=class{constructor(e,t){this.logger=e,this.core=t}},Oe=class extends v.I{constructor(e,t){super(),this.relayer=e,this.logger=t}},xe=class extends v.I{constructor(e){super()}},ke=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},De=class extends v.I{constructor(e,t){super(),this.relayer=e,this.logger=t}},je=class extends v.I{constructor(e,t){super(),this.core=e,this.logger=t}},Re=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},Ue=class{constructor(e,t){this.projectId=e,this.logger=t}},Le=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};function ze(e){let{strict:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(!e||"string"!=typeof e)&&(t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith("0x"))}function qe(e){return ze(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}const Be="2.23.2";let Ve={getDocsUrl:e=>{let{docsBaseUrl:t,docsPath:i="",docsSlug:s}=e;return i?"".concat(null!==t&&void 0!==t?t:"https://viem.sh").concat(i).concat(s?"#".concat(s):""):void 0},version:"viem@".concat(Be)},He=class e extends Error{constructor(t){var i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;const r=(()=>{var t;return s.cause instanceof e?s.cause.details:null!=(t=s.cause)&&t.message?s.cause.message:s.details})(),o=s.cause instanceof e&&s.cause.docsPath||s.docsPath,a=null==(n=Ve.getDocsUrl)?void 0:n.call(Ve,(0,d.A)((0,d.A)({},s),{},{docsPath:o}));super([t||"An error occurred.","",...s.metaMessages?[...s.metaMessages,""]:[],...a?["Docs: ".concat(a)]:[],...r?["Details: ".concat(r)]:[],...Ve.version?["Version: ".concat(Ve.version)]:[]].join("\n"),s.cause?{cause:s.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=o,this.metaMessages=s.metaMessages,this.name=null!==(i=s.name)&&void 0!==i?i:this.name,this.shortMessage=t,this.version=Be}walk(e){return Ke(this,e)}};function Ke(e,t){return null!=t&&t(e)?e:e&&"object"==typeof e&&"cause"in e&&void 0!==e.cause?Ke(e.cause,t):t?null:e}let We=class extends He{constructor(e){let{size:t,targetSize:i,type:s}=e;super("".concat(s.charAt(0).toUpperCase()).concat(s.slice(1).toLowerCase()," size (").concat(t,") exceeds padding size (").concat(i,")."),{name:"SizeExceedsPaddingSizeError"})}};function Fe(e){let{dir:t,size:i=32}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e?function(e){let{dir:t,size:i=32}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===i)return e;const s=e.replace("0x","");if(s.length>2*i)throw new We({size:Math.ceil(s.length/2),targetSize:i,type:"hex"});return"0x".concat(s["right"===t?"padEnd":"padStart"](2*i,"0"))}(e,{dir:t,size:i}):function(e){let{dir:t,size:i=32}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===i)return e;if(e.length>i)throw new We({size:e.length,targetSize:i,type:"bytes"});const s=new Uint8Array(i);for(let n=0;n<i;n++){const r="right"===t;s[r?n:i-n-1]=e[r?n:e.length-n-1]}return s}(e,{dir:t,size:i})}let Ge=class extends He{constructor(e){let{max:t,min:i,signed:s,size:n,value:r}=e;super('Number "'.concat(r,'" is not in safe ').concat(n?"".concat(8*n,"-bit ").concat(s?"signed":"unsigned"," "):"","integer range ").concat(t?"(".concat(i," to ").concat(t,")"):"(above ".concat(i,")")),{name:"IntegerOutOfRangeError"})}},Ye=class extends He{constructor(e){let{givenSize:t,maxSize:i}=e;super("Size cannot exceed ".concat(i," bytes. Given size: ").concat(t," bytes."),{name:"SizeOverflowError"})}};function Qe(e,t){let{size:i}=t;if(qe(e)>i)throw new Ye({givenSize:qe(e),maxSize:i})}function Ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{signed:i}=t;t.size&&Qe(e,{size:t.size});const s=BigInt(e);if(!i)return s;const n=(e.length-2)/2;return s<=(1n<<8n*BigInt(n)-1n)-1n?s:s-BigInt("0x".concat("f".padStart(2*n,"f")))-1n}const Je=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Xe(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"number"==typeof e||"bigint"==typeof e?et(e,t):"string"==typeof e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=tt.encode(e);return $e(i,t)}(e,t):"boolean"==typeof e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i="0x".concat(Number(e));return"number"==typeof t.size?(Qe(i,{size:t.size}),Fe(i,{size:t.size})):i}(e,t):$e(e,t)}function $e(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="";for(let n=0;n<e.length;n++)i+=Je[e[n]];const s="0x".concat(i);return"number"==typeof t.size?(Qe(s,{size:t.size}),Fe(s,{dir:"right",size:t.size})):s}function et(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{signed:i,size:s}=t,n=BigInt(e);let r;s?r=i?(1n<<8n*BigInt(s)-1n)-1n:2n**(8n*BigInt(s))-1n:"number"==typeof e&&(r=BigInt(Number.MAX_SAFE_INTEGER));const o="bigint"==typeof r&&i?-r-1n:0;if(r&&n>r||n<o){const t="bigint"==typeof e?"n":"";throw new Ge({max:r?"".concat(r).concat(t):void 0,min:"".concat(o).concat(t),signed:i,size:s,value:"".concat(e).concat(t)})}const a="0x".concat((i&&n<0?(1n<<BigInt(8*s))+BigInt(n):n).toString(16));return s?Fe(a,{size:s}):a}const tt=new TextEncoder;const it=new TextEncoder;function st(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"number"==typeof e||"bigint"==typeof e?function(e,t){const i=et(e,t);return ot(i)}(e,t):"boolean"==typeof e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Uint8Array(1);return i[0]=Number(e),"number"==typeof t.size?(Qe(i,{size:t.size}),Fe(i,{size:t.size})):i}(e,t):ze(e)?ot(e,t):at(e,t)}const nt={zero:48,nine:57,A:65,F:70,a:97,f:102};function rt(e){return e>=nt.zero&&e<=nt.nine?e-nt.zero:e>=nt.A&&e<=nt.F?e-(nt.A-10):e>=nt.a&&e<=nt.f?e-(nt.a-10):void 0}function ot(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e;t.size&&(Qe(i,{size:t.size}),i=Fe(i,{dir:"right",size:t.size}));let s=i.slice(2);s.length%2&&(s="0".concat(s));const n=s.length/2,r=new Uint8Array(n);for(let o=0,a=0;o<n;o++){const e=rt(s.charCodeAt(a++)),t=rt(s.charCodeAt(a++));if(void 0===e||void 0===t)throw new He('Invalid byte sequence ("'.concat(s[a-2]).concat(s[a-1],'" in "').concat(s,'").'));r[o]=16*e+t}return r}function at(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=it.encode(e);return"number"==typeof t.size?(Qe(i,{size:t.size}),Fe(i,{dir:"right",size:t.size})):i}function ct(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function lt(e){if(!function(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}(e))throw new Error("Uint8Array expected");for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(i.length>0&&!i.includes(e.length))throw new Error("Uint8Array expected of length "+i+", got length="+e.length)}function ht(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ct(e.outputLen),ct(e.blockLen)}function dt(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ut(e,t){lt(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const pt=BigInt(2**32-1),gt=BigInt(32);function ft(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{h:Number(e&pt),l:Number(e>>gt&pt)}:{h:0|Number(e>>gt&pt),l:0|Number(e&pt)}}function wt(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let n=0;n<e.length;n++){const{h:r,l:o}=ft(e[n],t);[i[n],s[n]]=[r,o]}return[i,s]}const mt="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function yt(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function vt(e,t){return e<<32-t|e>>>t}const bt=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function It(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Et(e){for(let t=0;t<e.length;t++)e[t]=It(e[t])}function Nt(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),lt(e),e}function At(){let e=0;for(let i=0;i<arguments.length;i++){const t=i<0||arguments.length<=i?void 0:arguments[i];lt(t),e+=t.length}const t=new Uint8Array(e);for(let i=0,s=0;i<arguments.length;i++){const e=i<0||arguments.length<=i?void 0:arguments[i];t.set(e,s),s+=e.length}return t}let Ct=class{clone(){return this._cloneInto()}};function St(e){const t=t=>e().update(Nt(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}function Pt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(mt&&"function"==typeof mt.getRandomValues)return mt.getRandomValues(new Uint8Array(e));if(mt&&"function"==typeof mt.randomBytes)return mt.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}const Tt=[],Mt=[],_t=[],Ot=BigInt(0),xt=BigInt(1),kt=BigInt(2),Dt=BigInt(7),jt=BigInt(256),Rt=BigInt(113);for(let CD=0,SD=xt,PD=1,TD=0;CD<24;CD++){[PD,TD]=[TD,(2*PD+3*TD)%5],Tt.push(2*(5*TD+PD)),Mt.push((CD+1)*(CD+2)/2%64);let e=Ot;for(let t=0;t<7;t++)SD=(SD<<xt^(SD>>Dt)*Rt)%jt,SD&kt&&(e^=xt<<(xt<<BigInt(t))-xt);_t.push(e)}const[Ut,Lt]=wt(_t,!0),zt=(e,t,i)=>i>32?((e,t,i)=>t<<i-32|e>>>64-i)(e,t,i):((e,t,i)=>e<<i|t>>>32-i)(e,t,i),qt=(e,t,i)=>i>32?((e,t,i)=>e<<i-32|t>>>64-i)(e,t,i):((e,t,i)=>t<<i|e>>>32-i)(e,t,i);let Bt=class e extends Ct{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24;if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,ct(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}(this.state)}keccak(){bt||Et(this.state32),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;const i=new Uint32Array(10);for(let s=24-t;s<24;s++){for(let s=0;s<10;s++)i[s]=e[s]^e[s+10]^e[s+20]^e[s+30]^e[s+40];for(let s=0;s<10;s+=2){const t=(s+8)%10,n=(s+2)%10,r=i[n],o=i[n+1],a=zt(r,o,1)^i[t],c=qt(r,o,1)^i[t+1];for(let i=0;i<50;i+=10)e[s+i]^=a,e[s+i+1]^=c}let t=e[2],n=e[3];for(let i=0;i<24;i++){const s=Mt[i],r=zt(t,n,s),o=qt(t,n,s),a=Tt[i];t=e[a],n=e[a+1],e[a]=r,e[a+1]=o}for(let s=0;s<50;s+=10){for(let t=0;t<10;t++)i[t]=e[s+t];for(let t=0;t<10;t++)e[s+t]^=~i[(t+2)%10]&i[(t+4)%10]}e[0]^=Ut[s],e[1]^=Lt[s]}i.fill(0)}(this.state32,this.rounds),bt||Et(this.state32),this.posOut=0,this.pos=0}update(e){dt(this);const{blockLen:t,state:i}=this,s=(e=Nt(e)).length;for(let n=0;n<s;){const r=Math.min(t-this.pos,s-n);for(let t=0;t<r;t++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,128&t&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){dt(this,!1),lt(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const r=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+r),s),this.posOut+=r,s+=r}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ct(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ut(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:i,suffix:s,outputLen:n,rounds:r,enableXOF:o}=this;return t||(t=new e(i,s,n,o,r)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=r,t.suffix=s,t.outputLen=n,t.enableXOF=o,t.destroyed=this.destroyed,t}};const Vt=(e,t,i)=>St(()=>new Bt(t,e,i)),Ht=Vt(1,136,32);function Kt(e,t){const i=t||"hex",s=Ht(ze(e,{strict:!1})?st(e):e);return"bytes"===i?s:Xe(s)}const Wt=new class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const e=this.keys().next().value;e&&this.delete(e)}return this}}(8192);function Ft(e){const t=Kt("0x".concat(e.substring(4))).substring(26);return function(e,t){if(Wt.has("".concat(e,".").concat(t)))return Wt.get("".concat(e,".").concat(t));const i=e.substring(2).toLowerCase(),s=Kt(at(i),"bytes"),n=i.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&n[o]&&(n[o]=n[o].toUpperCase()),(15&s[o>>1])>=8&&n[o+1]&&(n[o+1]=n[o+1].toUpperCase());const r="0x".concat(n.join(""));return Wt.set("".concat(e,".").concat(t),r),r}("0x".concat(t))}async function Gt(e){let{hash:t,signature:s}=e;const n=ze(t)?t:Xe(t),{secp256k1:r}=await i.e(9519).then(i.bind(i,9519));return"0x".concat((()=>{if("object"==typeof s&&"r"in s&&"s"in s){const{r:e,s:t,v:i,yParity:n}=s,o=Yt(Number(null!==n&&void 0!==n?n:i));return new r.Signature(Ze(e),Ze(t)).addRecoveryBit(o)}const e=ze(s)?s:Xe(s),t=function(e){return Number(Ze(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}("0x".concat(e.slice(130))),i=Yt(t);return r.Signature.fromCompact(e.substring(2,130)).addRecoveryBit(i)})().recoverPublicKey(n.substring(2)).toHex(!1))}function Yt(e){if(0===e||1===e)return e;if(27===e)return 0;if(28===e)return 1;throw new Error("Invalid yParityOrV value")}var Qt=(0,g.D)();function Zt(e){const[t,i]=e.split(":");return{namespace:t,reference:i}}function Jt(e,t){return e.includes(":")?[e]:t.chains||[]}const Xt="react-native",$t="node",ei="browser",ti="unknown",ii="js";function si(){return typeof p.d.process<"u"&&typeof p.d.process.versions<"u"&&typeof p.d.process.versions.node<"u"}function ni(){return!(0,v.a)()&&!!(0,v.b)()&&"ReactNative"===navigator.product}function ri(){return!si()&&!!(0,v.b)()&&!!(0,v.a)()}function oi(){return ni()?Xt:si()?$t:ri()?ei:ti}function ai(){var e;try{return ni()&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Application)<"u"?null==(e=p.d.global.Application)?void 0:e.applicationId:void 0}catch(t){return}}function ci(){return(0,v.g)()||{name:"",description:"",url:"",icons:[""]}}function li(e,t,i){const s=function(){if(oi()===Xt&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Platform)<"u"){const{OS:e,Version:t}=p.d.global.Platform;return[e,t].join("-")}const e=(0,v.d)();if(null===e)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return"browser"===e.type?[t,e.name,e.version].join("-"):[t,e.version].join("-")}(),n=function(){var e;const t=oi();return t===ei?[t,(null==(e=(0,v.e)())?void 0:e.host)||"unknown"].join(":"):t}();return[[e,t].join("-"),[ii,i].join("-"),s,n].join("/")}function hi(e){let{protocol:t,version:i,relayUrl:s,sdkVersion:n,auth:r,projectId:o,useOnCloseEvent:a,bundleId:c,packageName:l}=e;const h=s.split("?"),d={auth:r,ua:li(t,i,n),projectId:o,useOnCloseEvent:a,packageName:l||void 0,bundleId:c||void 0},u=function(e,t){const i=new URLSearchParams(e);for(const s of Object.keys(t).sort())if(t.hasOwnProperty(s)){const e=t[s];void 0!==e&&i.set(s,e)}return i.toString()}(h[1]||"",d);return h[0]+"?"+u}function di(e,t){return e.filter(e=>t.includes(e)).length===e.length}function ui(e){return Object.fromEntries(e.entries())}function pi(e){return new Map(Object.entries(e))}function gi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.c.FIVE_MINUTES,t=arguments.length>1?arguments[1]:void 0;const i=v.c.toMiliseconds(e||v.c.FIVE_MINUTES);let s,n,r,o;return{resolve:e=>{r&&s&&(clearTimeout(r),s(e),o=Promise.resolve(e))},reject:e=>{r&&n&&(clearTimeout(r),n(e))},done:()=>new Promise((e,a)=>{if(o)return e(o);r=setTimeout(()=>{const e=new Error(t);o=Promise.reject(e),a(e)},i),s=e,n=a})}}function fi(e,t,i){return new Promise(async(s,n)=>{const r=setTimeout(()=>n(new Error(i)),t);try{s(await e)}catch(o){n(o)}clearTimeout(r)})}function wi(e,t){if("string"==typeof t&&t.startsWith("".concat(e,":")))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw new Error('Value must be "string" for expirer target type: topic');return"topic:".concat(t)}if("id"===e.toLowerCase()){if("number"!=typeof t)throw new Error('Value must be "number" for expirer target type: id');return"id:".concat(t)}throw new Error("Unknown expirer target type: ".concat(e))}function mi(e){const[t,i]=e.split(":"),s={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof i)s.topic=i;else{if("id"!==t||!Number.isInteger(Number(i)))throw new Error("Invalid target, expected id:number or topic:string, got ".concat(t,":").concat(i));s.id=Number(i)}return s}function yi(e,t){return v.c.fromMiliseconds(Date.now()+v.c.toMiliseconds(e))}function vi(e){return Date.now()>=v.c.toMiliseconds(e)}function bi(e,t){return"".concat(e).concat(t?":".concat(t):"")}function Ii(){return[...new Set([...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],...arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]])]}async function Ei(e){let{id:t,topic:i,wcDeepLink:s}=e;var n;try{if(!s)return;const e="string"==typeof s?JSON.parse(s):s,r=null==e?void 0:e.href;if("string"!=typeof r)return;const o=function(e,t,i){const s="requestId=".concat(t,"&sessionTopic=").concat(i);e.endsWith("/")&&(e=e.slice(0,-1));let n="".concat(e);if(e.startsWith("https://t.me")){const t=e.includes("?")?"&startapp=":"?startapp=";n="".concat(n).concat(t).concat(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=p.d.Buffer.from(e).toString("base64");return t?i.replace(/[=]/g,""):i}(s,!0))}else n="".concat(n,"/wc?").concat(s);return n}(r,t,i),a=oi();if(a===ei){if(null==(n=(0,v.a)())||!n.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function(e){let t="_self";!function(){try{return window.self!==window.top}catch(e){return!1}}()?(typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)||e.startsWith("https://")||e.startsWith("http://"))&&(t="_blank"):t="_top",window.open(e,t,"noreferrer noopener")}(o)}else a===Xt&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u"&&await p.d.global.Linking.openURL(o)}catch(r){console.error(r)}}function Ni(e,t){if(!e.includes(t))return null;const i=e.split(/([&,?,=])/),s=i.indexOf(t);return i[s+2]}function Ai(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function Ci(){return typeof p.d.process<"u"&&"true"===p.d.process.env.IS_VITEST}function Si(e){return p.d.Buffer.from(e,"base64").toString("utf-8")}function Pi(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Ti(e){if(!function(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}(e))throw new Error("Uint8Array expected");for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(i.length>0&&!i.includes(e.length))throw new Error("Uint8Array expected of length "+i+", got length="+e.length)}function Mi(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Pi(e.outputLen),Pi(e.blockLen)}function _i(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Oi(e,t){Ti(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const xi=BigInt(2**32-1),ki=BigInt(32);function Di(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{h:Number(e&xi),l:Number(e>>ki&xi)}:{h:0|Number(e>>ki&xi),l:0|Number(e&xi)}}const ji="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Ri(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Ui(e,t){return e<<32-t|e>>>t}const Li=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function zi(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function qi(e){for(let t=0;t<e.length;t++)e[t]=zi(e[t])}function Bi(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),Ti(e),e}let Vi=class{clone(){return this._cloneInto()}};function Hi(e){const t=t=>e().update(Bi(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}function Ki(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(ji&&"function"==typeof ji.getRandomValues)return ji.getRandomValues(new Uint8Array(e));if(ji&&"function"==typeof ji.randomBytes)return ji.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}const Wi=[],Fi=[],Gi=[],Yi=BigInt(0),Qi=BigInt(1),Zi=BigInt(2),Ji=BigInt(7),Xi=BigInt(256),$i=BigInt(113);for(let CD=0,SD=Qi,PD=1,TD=0;CD<24;CD++){[PD,TD]=[TD,(2*PD+3*TD)%5],Wi.push(2*(5*TD+PD)),Fi.push((CD+1)*(CD+2)/2%64);let e=Yi;for(let t=0;t<7;t++)SD=(SD<<Qi^(SD>>Ji)*$i)%Xi,SD&Zi&&(e^=Qi<<(Qi<<BigInt(t))-Qi);Gi.push(e)}const[es,ts]=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let n=0;n<e.length;n++){const{h:r,l:o}=Di(e[n],t);[i[n],s[n]]=[r,o]}return[i,s]}(Gi,!0),is=(e,t,i)=>i>32?((e,t,i)=>t<<i-32|e>>>64-i)(e,t,i):((e,t,i)=>e<<i|t>>>32-i)(e,t,i),ss=(e,t,i)=>i>32?((e,t,i)=>e<<i-32|t>>>64-i)(e,t,i):((e,t,i)=>t<<i|e>>>32-i)(e,t,i);let ns=class e extends Vi{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24;if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Pi(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}(this.state)}keccak(){Li||qi(this.state32),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;const i=new Uint32Array(10);for(let s=24-t;s<24;s++){for(let s=0;s<10;s++)i[s]=e[s]^e[s+10]^e[s+20]^e[s+30]^e[s+40];for(let s=0;s<10;s+=2){const t=(s+8)%10,n=(s+2)%10,r=i[n],o=i[n+1],a=is(r,o,1)^i[t],c=ss(r,o,1)^i[t+1];for(let i=0;i<50;i+=10)e[s+i]^=a,e[s+i+1]^=c}let t=e[2],n=e[3];for(let i=0;i<24;i++){const s=Fi[i],r=is(t,n,s),o=ss(t,n,s),a=Wi[i];t=e[a],n=e[a+1],e[a]=r,e[a+1]=o}for(let s=0;s<50;s+=10){for(let t=0;t<10;t++)i[t]=e[s+t];for(let t=0;t<10;t++)e[s+t]^=~i[(t+2)%10]&i[(t+4)%10]}e[0]^=es[s],e[1]^=ts[s]}i.fill(0)}(this.state32,this.rounds),Li||qi(this.state32),this.posOut=0,this.pos=0}update(e){_i(this);const{blockLen:t,state:i}=this,s=(e=Bi(e)).length;for(let n=0;n<s;){const r=Math.min(t-this.pos,s-n);for(let t=0;t<r;t++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,128&t&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){_i(this,!1),Ti(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const r=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+r),s),this.posOut+=r,s+=r}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Pi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Oi(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:i,suffix:s,outputLen:n,rounds:r,enableXOF:o}=this;return t||(t=new e(i,s,n,o,r)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=r,t.suffix=s,t.outputLen=n,t.enableXOF=o,t.destroyed=this.destroyed,t}};const rs=((e,t,i)=>Hi(()=>new ns(t,e,i)))(1,136,32),os="https://rpc.walletconnect.org/v1";function as(e){const t="\x19Ethereum Signed Message:\n".concat(e.length),i=(new TextEncoder).encode(t+e);return"0x"+p.d.Buffer.from(rs(i)).toString("hex")}async function cs(e,t,i,s,n,r){switch(i.t){case"eip191":return await async function(e,t,i){return(await async function(e){let{hash:t,signature:i}=e;return Ft(await Gt({hash:t,signature:i}))}({hash:as(t),signature:i})).toLowerCase()===e.toLowerCase()}(e,t,i.s);case"eip1271":return await async function(e,t,i,s,n,r){const o=Zt(s);if(!o.namespace||!o.reference)throw new Error("isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ".concat(s));try{const o="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",l=i.substring(2),h=o+as(t).substring(2)+a+c+l,d=await fetch("".concat(r||os,"/?chainId=").concat(s,"&projectId=").concat(n),{method:"POST",body:JSON.stringify({id:ls(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:h},"latest"]})}),{result:u}=await d.json();return!!u&&u.slice(0,o.length).toLowerCase()===o.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}(e,t,i.s,s,n,r);default:throw new Error("verifySignature failed: Attempted to verify CacaoSignature with unknown type: ".concat(i.t))}}function ls(){return Date.now()+Math.floor(1e3*Math.random())}var hs=Object.defineProperty,ds=Object.defineProperties,us=Object.getOwnPropertyDescriptors,ps=Object.getOwnPropertySymbols,gs=Object.prototype.hasOwnProperty,fs=Object.prototype.propertyIsEnumerable,ws=(e,t,i)=>t in e?hs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;const ms=e=>null==e?void 0:e.split(":"),ys=e=>{const t=e&&ms(e);if(t)return t[2]+":"+t[3]},vs=e=>{const t=e&&ms(e);if(t)return t.pop()};async function bs(e){const{cacao:t,projectId:i}=e,{s:s,p:n}=t,r=Is(n,n.iss),o=vs(n.iss);return await cs(o,r,s,ys(n.iss),i)}const Is=(e,t)=>{const i="".concat(e.domain," wants you to sign in with your Ethereum account:"),s=vs(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=e.statement||void 0;const r="URI: ".concat(e.aud||e.uri),o="Version: ".concat(e.version),a="Chain ID: ".concat((e=>{const t=e&&ms(e);if(t)return e.includes("did:pkh:")?t[3]:t[1]})(t)),c="Nonce: ".concat(e.nonce),l="Issued At: ".concat(e.iat),h=e.exp?"Expiration Time: ".concat(e.exp):void 0,d=e.nbf?"Not Before: ".concat(e.nbf):void 0,u=e.requestId?"Request ID: ".concat(e.requestId):void 0,p=e.resources?"Resources:".concat(e.resources.map(e=>"\n- ".concat(e)).join("")):void 0,g=_s(e.resources);if(g){n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;Es(t);const i="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(i))return e;const s=[];let n=0;Object.keys(t.att).forEach(e=>{const i=Object.keys(t.att[e]).map(e=>({ability:e.split("/")[0],action:e.split("/")[1]}));i.sort((e,t)=>e.action.localeCompare(t.action));const r={};i.forEach(e=>{r[e.ability]||(r[e.ability]=[]),r[e.ability].push(e.action)});const o=Object.keys(r).map(t=>(n++,"(".concat(n,") '").concat(t,"': '").concat(r[t].join("', '"),"' for '").concat(e,"'.")));s.push(o.join(", ").replace(".,","."))});const r=s.join(" "),o="".concat(i).concat(r);return"".concat(e?e+" ":"").concat(o)}(n,Cs(g))}return[i,s,"",n,"",r,o,a,c,l,h,d,u,p].filter(e=>null!=e).join("\n")};function Es(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(null==t||!t.length)throw new Error("No resources found in `att` property");t.forEach(t=>{const i=e.att[t];if(Array.isArray(i))throw new Error("Resource must be an object: ".concat(t));if("object"!=typeof i)throw new Error("Resource must be an object: ".concat(t));if(!Object.keys(i).length)throw new Error("Resource object is empty: ".concat(t));Object.keys(i).forEach(e=>{const t=i[e];if(!Array.isArray(t))throw new Error("Ability limits ".concat(e," must be an array of objects, found: ").concat(t));if(!t.length)throw new Error("Value of ".concat(e," is empty array, must be an array with objects"));t.forEach(t=>{if("object"!=typeof t)throw new Error("Ability limits (".concat(e,") must be an array of objects, found: ").concat(t))})})})}function Ns(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=(t=null==t?void 0:t.sort((e,t)=>e.localeCompare(t))).map(t=>({["".concat(e,"/").concat(t)]:[i]}));return Object.assign({},...s)}function As(e){return Es(e),"urn:recap:".concat(function(e){return p.d.Buffer.from(JSON.stringify(e)).toString("base64")}(e).replace(/=/g,""))}function Cs(e){const t=function(e){return JSON.parse(p.d.Buffer.from(e,"base64").toString("utf-8"))}(e.replace("urn:recap:",""));return Es(t),t}function Ss(e,t,i){const s=function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null==i||i.sort((e,t)=>e.localeCompare(t)),{att:{[e]:Ns(t,i,s)}}}(e,t,i);return As(s)}function Ps(e,t){const i=function(e,t){Es(e),Es(t);const i=Object.keys(e.att).concat(Object.keys(t.att)).sort((e,t)=>e.localeCompare(t)),s={att:{}};return i.forEach(i=>{var n,r;Object.keys((null==(n=e.att)?void 0:n[i])||{}).concat(Object.keys((null==(r=t.att)?void 0:r[i])||{})).sort((e,t)=>e.localeCompare(t)).forEach(n=>{var r,o;s.att[i]=((e,t)=>ds(e,us(t)))(((e,t)=>{for(var i in t||(t={}))gs.call(t,i)&&ws(e,i,t[i]);if(ps)for(var i of ps(t))fs.call(t,i)&&ws(e,i,t[i]);return e})({},s.att[i]),{[n]:(null==(r=e.att[i])?void 0:r[n])||(null==(o=t.att[i])?void 0:o[n])})})}),s}(Cs(e),Cs(t));return As(i)}function Ts(e){var t;const i=Cs(e);Es(i);const s=null==(t=i.att)?void 0:t.eip155;return s?Object.keys(s).map(e=>e.split("/")[1]):[]}function Ms(e){const t=Cs(e);Es(t);const i=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;null!=(t=null==e?void 0:e[0])&&t.chains&&i.push(e[0].chains)})}),[...new Set(i.flat())]}function _s(e){if(!e)return;const t=null==e?void 0:e[e.length-1];return function(e){return e&&e.includes("urn:recap:")}(t)?t:void 0}function Os(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function xs(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function ks(e){if(!xs(e))throw new Error("Uint8Array expected");for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(i.length>0&&!i.includes(e.length))throw new Error("Uint8Array expected of length "+i+", got length="+e.length)}function Ds(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function js(e){if("boolean"!=typeof e)throw new Error("boolean expected, not ".concat(e))}const Rs=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Us(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e);else{if(!xs(e))throw new Error("Uint8Array expected, got "+typeof e);e=qs(e)}return e}function Ls(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(i&&!function(e){return e.byteOffset%4===0}(t))throw new Error("invalid output, must be aligned");return t}function zs(e,t,i,s){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,s);const n=BigInt(32),r=BigInt(4294967295),o=Number(i>>n&r),a=Number(i&r);e.setUint32(t+4,o,s),e.setUint32(t+0,a,s)}function qs(e){return Uint8Array.from(e)}function Bs(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let s=0;s<t.length;s++)t[s].fill(0)}const Vs=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),Hs=Vs("expand 16-byte k"),Ks=Vs("expand 32-byte k"),Ws=Rs(Hs),Fs=Rs(Ks);function Gs(e,t){return e<<t|e>>>32-t}function Ys(e){return e.byteOffset%4===0}const Qs=2**32-1,Zs=new Uint32Array;const Js=(e,t)=>255&e[t++]|(255&e[t++])<<8;let Xs=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,ks(e=Us(e),32);const t=Js(e,0),i=Js(e,2),s=Js(e,4),n=Js(e,6),r=Js(e,8),o=Js(e,10),a=Js(e,12),c=Js(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|i<<3),this.r[2]=7939&(i>>>10|s<<6),this.r[3]=8191&(s>>>7|n<<9),this.r[4]=255&(n>>>4|r<<12),this.r[5]=r>>>1&8190,this.r[6]=8191&(r>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Js(e,16+2*l)}process(e,t){const i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?0:2048,{h:s,r:n}=this,r=n[0],o=n[1],a=n[2],c=n[3],l=n[4],h=n[5],d=n[6],u=n[7],p=n[8],g=n[9],f=Js(e,t+0),w=Js(e,t+2),m=Js(e,t+4),y=Js(e,t+6),v=Js(e,t+8),b=Js(e,t+10),I=Js(e,t+12),E=Js(e,t+14);let N=s[0]+(8191&f),A=s[1]+(8191&(f>>>13|w<<3)),C=s[2]+(8191&(w>>>10|m<<6)),S=s[3]+(8191&(m>>>7|y<<9)),P=s[4]+(8191&(y>>>4|v<<12)),T=s[5]+(v>>>1&8191),M=s[6]+(8191&(v>>>14|b<<2)),_=s[7]+(8191&(b>>>11|I<<5)),O=s[8]+(8191&(I>>>8|E<<8)),x=s[9]+(E>>>5|i),k=0,D=k+N*r+A*(5*g)+C*(5*p)+S*(5*u)+P*(5*d);k=D>>>13,D&=8191,D+=T*(5*h)+M*(5*l)+_*(5*c)+O*(5*a)+x*(5*o),k+=D>>>13,D&=8191;let j=k+N*o+A*r+C*(5*g)+S*(5*p)+P*(5*u);k=j>>>13,j&=8191,j+=T*(5*d)+M*(5*h)+_*(5*l)+O*(5*c)+x*(5*a),k+=j>>>13,j&=8191;let R=k+N*a+A*o+C*r+S*(5*g)+P*(5*p);k=R>>>13,R&=8191,R+=T*(5*u)+M*(5*d)+_*(5*h)+O*(5*l)+x*(5*c),k+=R>>>13,R&=8191;let U=k+N*c+A*a+C*o+S*r+P*(5*g);k=U>>>13,U&=8191,U+=T*(5*p)+M*(5*u)+_*(5*d)+O*(5*h)+x*(5*l),k+=U>>>13,U&=8191;let L=k+N*l+A*c+C*a+S*o+P*r;k=L>>>13,L&=8191,L+=T*(5*g)+M*(5*p)+_*(5*u)+O*(5*d)+x*(5*h),k+=L>>>13,L&=8191;let z=k+N*h+A*l+C*c+S*a+P*o;k=z>>>13,z&=8191,z+=T*r+M*(5*g)+_*(5*p)+O*(5*u)+x*(5*d),k+=z>>>13,z&=8191;let q=k+N*d+A*h+C*l+S*c+P*a;k=q>>>13,q&=8191,q+=T*o+M*r+_*(5*g)+O*(5*p)+x*(5*u),k+=q>>>13,q&=8191;let B=k+N*u+A*d+C*h+S*l+P*c;k=B>>>13,B&=8191,B+=T*a+M*o+_*r+O*(5*g)+x*(5*p),k+=B>>>13,B&=8191;let V=k+N*p+A*u+C*d+S*h+P*l;k=V>>>13,V&=8191,V+=T*c+M*a+_*o+O*r+x*(5*g),k+=V>>>13,V&=8191;let H=k+N*g+A*p+C*u+S*d+P*h;k=H>>>13,H&=8191,H+=T*l+M*c+_*a+O*o+x*r,k+=H>>>13,H&=8191,k=(k<<2)+k|0,k=k+D|0,D=8191&k,k>>>=13,j+=k,s[0]=D,s[1]=j,s[2]=R,s[3]=U,s[4]=L,s[5]=z,s[6]=q,s[7]=B,s[8]=V,s[9]=H}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=s,s=e[o]>>>13,e[o]&=8191;e[0]+=5*s,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+s,s=i[o]>>>13,i[o]&=8191;i[9]-=8192;let n=(1^s)-1;for(let o=0;o<10;o++)i[o]&=n;n=~n;for(let o=0;o<10;o++)e[o]=e[o]&n|i[o];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let r=e[0]+t[0];e[0]=65535&r;for(let o=1;o<8;o++)r=(e[o]+t[o]|0)+(r>>>16)|0,e[o]=65535&r;Bs(i)}update(e){Ds(this);const{buffer:t,blockLen:i}=this,s=(e=Us(e)).length;for(let n=0;n<s;){const r=Math.min(i-this.pos,s-n);if(r!==i)t.set(e.subarray(n,n+r),this.pos),this.pos+=r,n+=r,this.pos===i&&(this.process(t,0,!1),this.pos=0);else for(;i<=s-n;n+=i)this.process(e,n)}return this}destroy(){Bs(this.h,this.r,this.buffer,this.pad)}digestInto(e){Ds(this),function(e,t){ks(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let r=0;r<8;r++)e[n++]=i[r]>>>0,e[n++]=i[r]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}};const $s=function(e){const t=(t,i)=>e(i).update(Us(t)).digest(),i=e(new Uint8Array(32));return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=t=>e(t),t}(e=>new Xs(e));const en=function(e,t){const{allowShortKeys:i,extendNonceFn:s,counterLength:n,counterRight:r,rounds:o}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return Os(n),Os(o),js(r),js(i),function(t,a,c,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;ks(t),ks(a),ks(c);const d=c.length;if(void 0===l&&(l=new Uint8Array(d)),ks(l),Os(h),h<0||h>=Qs)throw new Error("arx: counter overflow");if(l.length<d)throw new Error("arx: output (".concat(l.length,") is shorter than data (").concat(d,")"));const u=[];let p,g,f=t.length;if(32===f)u.push(p=qs(t)),g=Fs;else{if(16!==f||!i)throw new Error("arx: invalid 32-byte key, got length=".concat(f));p=new Uint8Array(32),p.set(t),p.set(t,16),g=Ws,u.push(p)}Ys(a)||u.push(a=qs(a));const w=Rs(p);if(s){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");s(g,w,Rs(a.subarray(0,16)),w),a=a.subarray(16)}const m=16-n;if(m!==a.length)throw new Error("arx: nonce must be ".concat(m," or 16 bytes"));if(12!==m){const e=new Uint8Array(12);e.set(a,r?0:12-a.length),a=e,u.push(a)}const y=Rs(a);return function(e,t,i,s,n,r,o,a){const c=n.length,l=new Uint8Array(64),h=Rs(l),d=Ys(n)&&Ys(r),u=d?Rs(n):Zs,p=d?Rs(r):Zs;for(let g=0;g<c;o++){if(e(t,i,s,h,o,a),o>=Qs)throw new Error("arx: counter overflow");const f=Math.min(64,c-g);if(d&&64===f){const e=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let t,i=0;i<16;i++)t=e+i,p[t]=u[t]^h[i];g+=64;continue}for(let e,t=0;t<f;t++)e=g+t,r[e]=n[e]^l[t];g+=f}}(e,g,w,y,c,l,h,o),Bs(...u),l}}(function(e,t,i,s,n){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,o=e[0],a=e[1],c=e[2],l=e[3],h=t[0],d=t[1],u=t[2],p=t[3],g=t[4],f=t[5],w=t[6],m=t[7],y=n,v=i[0],b=i[1],I=i[2],E=o,N=a,A=c,C=l,S=h,P=d,T=u,M=p,_=g,O=f,x=w,k=m,D=y,j=v,R=b,U=I;for(let z=0;z<r;z+=2)E=E+S|0,D=Gs(D^E,16),_=_+D|0,S=Gs(S^_,12),E=E+S|0,D=Gs(D^E,8),_=_+D|0,S=Gs(S^_,7),N=N+P|0,j=Gs(j^N,16),O=O+j|0,P=Gs(P^O,12),N=N+P|0,j=Gs(j^N,8),O=O+j|0,P=Gs(P^O,7),A=A+T|0,R=Gs(R^A,16),x=x+R|0,T=Gs(T^x,12),A=A+T|0,R=Gs(R^A,8),x=x+R|0,T=Gs(T^x,7),C=C+M|0,U=Gs(U^C,16),k=k+U|0,M=Gs(M^k,12),C=C+M|0,U=Gs(U^C,8),k=k+U|0,M=Gs(M^k,7),E=E+P|0,U=Gs(U^E,16),x=x+U|0,P=Gs(P^x,12),E=E+P|0,U=Gs(U^E,8),x=x+U|0,P=Gs(P^x,7),N=N+T|0,D=Gs(D^N,16),k=k+D|0,T=Gs(T^k,12),N=N+T|0,D=Gs(D^N,8),k=k+D|0,T=Gs(T^k,7),A=A+M|0,j=Gs(j^A,16),_=_+j|0,M=Gs(M^_,12),A=A+M|0,j=Gs(j^A,8),_=_+j|0,M=Gs(M^_,7),C=C+S|0,R=Gs(R^C,16),O=O+R|0,S=Gs(S^O,12),C=C+S|0,R=Gs(R^C,8),O=O+R|0,S=Gs(S^O,7);let L=0;s[L++]=o+E|0,s[L++]=a+N|0,s[L++]=c+A|0,s[L++]=l+C|0,s[L++]=h+S|0,s[L++]=d+P|0,s[L++]=u+T|0,s[L++]=p+M|0,s[L++]=g+_|0,s[L++]=f+O|0,s[L++]=w+x|0,s[L++]=m+k|0,s[L++]=y+D|0,s[L++]=v+j|0,s[L++]=b+R|0,s[L++]=I+U|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),tn=new Uint8Array(16),sn=(e,t)=>{e.update(t);const i=t.length%16;i&&e.update(tn.subarray(i))},nn=new Uint8Array(32);function rn(e,t,i,s,n){const r=e(t,i,nn),o=$s.create(r);n&&sn(o,n),sn(o,s);const a=new Uint8Array(16),c=(e=>new DataView(e.buffer,e.byteOffset,e.byteLength))(a);zs(c,0,BigInt(n?n.length:0),!0),zs(c,8,BigInt(s.length),!0),o.update(a);const l=o.digest();return Bs(r,a),l}const on=((e,t)=>{function i(i){for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];if(ks(i),void 0!==e.nonceLength){const t=n[0];if(!t)throw new Error("nonce / iv required");e.varSizeNonce?ks(t):ks(t,e.nonceLength)}const o=e.tagLength;o&&void 0!==n[1]&&ks(n[1]);const a=t(i,...n),c=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");ks(t)}};let l=!1;return{encrypt(e,t){if(l)throw new Error("cannot encrypt() twice with same key + nonce");return l=!0,ks(e),c(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(ks(e),o&&e.length<o)throw new Error("invalid ciphertext length: smaller than tagLength="+o);return c(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(i,e),i})({blockSize:64,nonceLength:12,tagLength:16},(e=>(t,i,s)=>({encrypt(n,r){const o=n.length;(r=Ls(o+16,r,!1)).set(n);const a=r.subarray(0,-16);e(t,i,a,a,1);const c=rn(e,t,i,a,s);return r.set(c,o),Bs(c),r},decrypt(n,r){r=Ls(n.length-16,r,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=rn(e,t,i,o,s);if(!function(e,t){if(e.length!==t.length)return!1;let i=0;for(let s=0;s<e.length;s++)i|=e[s]^t[s];return 0===i}(a,c))throw new Error("invalid tag");return r.set(n.subarray(0,-16)),e(t,i,r,r,1),Bs(c),r}}))(en));let an=class extends Vi{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Mi(e);const i=Bi(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let r=0;r<n.length;r++)n[r]^=54;this.iHash.update(n),this.oHash=e.create();for(let r=0;r<n.length;r++)n[r]^=106;this.oHash.update(n),n.fill(0)}update(e){return _i(this),this.iHash.update(e),this}digestInto(e){_i(this),Ti(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:n,blockLen:r,outputLen:o}=this;return e.finished=s,e.destroyed=n,e.blockLen=r,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const cn=(e,t,i)=>new an(e,t).update(i).digest();cn.create=(e,t)=>new an(e,t);const ln=new Uint8Array([0]),hn=new Uint8Array;const dn=(e,t,i,s,n)=>function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;if(Mi(e),Pi(s),s>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(s/e.outputLen);void 0===i&&(i=hn);const r=new Uint8Array(n*e.outputLen),o=cn.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<n;l++)ln[0]=l+1,a.update(0===l?hn:c).update(i).update(ln).digestInto(c),r.set(c,e.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),ln.fill(0),r.slice(0,s)}(e,function(e,t,i){return Mi(e),void 0===i&&(i=new Uint8Array(e.outputLen)),cn(e,Bi(i),Bi(t))}(e,t,i),s,n);function un(e,t,i){return e&t^~e&i}function pn(e,t,i){return e&t^e&i^t&i}let gn=class extends Vi{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ri(this.buffer)}update(e){_i(this);const{view:t,buffer:i,blockLen:s}=this,n=(e=Bi(e)).length;for(let r=0;r<n;){const o=Math.min(s-this.pos,n-r);if(o===s){const t=Ri(e);for(;s<=n-r;r+=s)this.process(t,r);continue}i.set(e.subarray(r,r+o),this.pos),this.pos+=o,r+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){_i(this),Oi(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:r}=this;t[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>s-r&&(this.process(i,0),r=0);for(let h=r;h<s;h++)t[h]=0;(function(e,t,i,s){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,s);const n=BigInt(32),r=BigInt(4294967295),o=Number(i>>n&r),a=Number(i&r),c=s?4:0,l=s?0:4;e.setUint32(t+c,o,s),e.setUint32(t+l,a,s)})(i,s-8,BigInt(8*this.length),n),this.process(i,0);const o=Ri(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)o.setUint32(4*h,l[h],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:r,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=r,s%t&&e.buffer.set(i),e}};const fn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),wn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),mn=new Uint32Array(64);let yn=class extends gn{constructor(){super(64,32,8,!1),this.A=0|wn[0],this.B=0|wn[1],this.C=0|wn[2],this.D=0|wn[3],this.E=0|wn[4],this.F=0|wn[5],this.G=0|wn[6],this.H=0|wn[7]}get(){const{A:e,B:t,C:i,D:s,E:n,F:r,G:o,H:a}=this;return[e,t,i,s,n,r,o,a]}set(e,t,i,s,n,r,o,a){this.A=0|e,this.B=0|t,this.C=0|i,this.D=0|s,this.E=0|n,this.F=0|r,this.G=0|o,this.H=0|a}process(e,t){for(let h=0;h<16;h++,t+=4)mn[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const e=mn[h-15],t=mn[h-2],i=Ui(e,7)^Ui(e,18)^e>>>3,s=Ui(t,17)^Ui(t,19)^t>>>10;mn[h]=s+mn[h-7]+i+mn[h-16]|0}let{A:i,B:s,C:n,D:r,E:o,F:a,G:c,H:l}=this;for(let h=0;h<64;h++){const e=l+(Ui(o,6)^Ui(o,11)^Ui(o,25))+un(o,a,c)+fn[h]+mn[h]|0,t=(Ui(i,2)^Ui(i,13)^Ui(i,22))+pn(i,s,n)|0;l=c,c=a,a=o,o=r+e|0,r=n,n=s,s=i,i=e+t|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,r=r+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(i,s,n,r,o,a,c,l)}roundClean(){mn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const vn=Hi(()=>new yn),bn=BigInt(0);function In(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function En(e){if(!In(e))throw new Error("Uint8Array expected")}const Nn=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));const An=48,Cn=57,Sn=65,Pn=70,Tn=97,Mn=102;function _n(e){return e>=An&&e<=Cn?e-An:e>=Sn&&e<=Pn?e-(Sn-10):e>=Tn&&e<=Mn?e-(Tn-10):void 0}function On(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,i=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(i);for(let n=0,r=0;n<i;n++,r+=2){const t=_n(e.charCodeAt(r)),i=_n(e.charCodeAt(r+1));if(void 0===t||void 0===i){const t=e[r]+e[r+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+r)}s[n]=16*t+i}return s}function xn(e){return En(e),function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?bn:BigInt("0x"+e)}(function(e){En(e);let t="";for(let i=0;i<e.length;i++)t+=Nn[e[i]];return t}(Uint8Array.from(e).reverse()))}function kn(e,t){return function(e,t){return On(e.toString(16).padStart(2*t,"0"))}(e,t).reverse()}function Dn(e,t,i){let s;if("string"==typeof t)try{s=On(t)}catch(r){throw new Error(e+" must be hex string or Uint8Array, cause: "+r)}else{if(!In(t))throw new Error(e+" must be hex string or Uint8Array");s=Uint8Array.from(t)}const n=s.length;if("number"==typeof i&&n!==i)throw new Error(e+" of length "+i+" expected, got "+n);return s}const jn=e=>"bigint"==typeof e&&bn<=e;function Rn(e,t,i,s){if(!function(e,t,i){return jn(e)&&jn(t)&&jn(i)&&t<=e&&e<i}(t,i,s))throw new Error("expected valid "+e+": "+i+" <= n < "+s+", got "+t)}const Un={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||In(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};const Ln=BigInt(0),zn=BigInt(1);function qn(e,t){const i=e%t;return i>=Ln?i:t+i}function Bn(e,t,i){let s=e;for(;t-- >Ln;)s*=s,s%=i;return s}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Vn=BigInt(0),Hn=BigInt(1);function Kn(e){return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=(t,i,s)=>{const n=Un[i];if("function"!=typeof n)throw new Error("invalid validator function");const r=e[t];if((!s||void 0!==r)&&!n(r,e))throw new Error("param "+String(t)+" is invalid. Expected "+i+", got "+r)};for(const[n,r]of Object.entries(t))s(n,r,!1);for(const[n,r]of Object.entries(i))s(n,r,!0)}(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze((0,d.A)({},e))}const Wn=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const Fn=BigInt(1),Gn=BigInt(2),Yn=BigInt(3),Qn=BigInt(5);BigInt(8);const Zn=function(e){const t=Kn(e),{P:i}=t,s=e=>qn(e,i),n=t.montgomeryBits,r=Math.ceil(n/8),o=t.nByteLength,a=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>function(e,t,i){if(t<Ln)throw new Error("invalid exponent, negatives unsupported");if(i<=Ln)throw new Error("invalid modulus");if(i===zn)return Ln;let s=zn;for(;t>Ln;)t&zn&&(s=s*e%i),e=e*e%i,t>>=zn;return s}(e,i-BigInt(2),i));function l(e,t,i){const n=s(e*(t-i));return[t=s(t-n),i=s(i+n)]}const h=(t.a-BigInt(2))/BigInt(4);function d(e){return kn(s(e),r)}function u(e,t){const u=function(e){const t=Dn("u coordinate",e,r);return 32===o&&(t[31]&=127),xn(t)}(t),p=function(e){const t=Dn("scalar",e),i=t.length;if(i!==r&&i!==o)throw new Error("invalid scalar, expected "+r+" or "+o+" bytes, got "+i);return xn(a(t))}(e),g=function(e,t){Rn("u",e,Vn,i),Rn("scalar",t,Vn,i);const r=t,o=e;let a,d=Hn,u=Vn,p=e,g=Hn,f=Vn;for(let i=BigInt(n-1);i>=Vn;i--){const e=r>>i&Hn;f^=e,a=l(f,d,p),d=a[0],p=a[1],a=l(f,u,g),u=a[0],g=a[1],f=e;const t=d+u,n=s(t*t),c=d-u,w=s(c*c),m=n-w,y=p+g,v=s((p-g)*t),b=s(y*c),I=v+b,E=v-b;p=s(I*I),g=s(o*s(E*E)),d=s(n*w),u=s(m*(n+s(h*m)))}a=l(f,d,p),d=a[0],p=a[1],a=l(f,u,g),u=a[0],g=a[1];const w=c(u);return s(d*w)}(u,p);if(g===Vn)throw new Error("invalid private or public key received");return d(g)}const p=d(t.Gu);function g(e){return u(e,p)}return{scalarMult:u,scalarMultBase:g,getSharedSecret:(e,t)=>u(e,t),getPublicKey:e=>g(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:p}}({P:Wn,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=Wn,{pow_p_5_8:i,b2:s}=function(e){const t=BigInt(10),i=BigInt(20),s=BigInt(40),n=BigInt(80),r=Wn,o=e*e%r*e%r,a=Bn(o,Gn,r)*o%r,c=Bn(a,Fn,r)*e%r,l=Bn(c,Qn,r)*c%r,h=Bn(l,t,r)*l%r,d=Bn(h,i,r)*h%r,u=Bn(d,s,r)*d%r,p=Bn(u,n,r)*u%r,g=Bn(p,n,r)*u%r,f=Bn(g,t,r)*l%r;return{pow_p_5_8:Bn(f,Gn,r)*e%r,b2:o}}(e);return qn(Bn(i,Yn,t)*s,t)},adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e},randomBytes:Ki}),Jn="base10",Xn="base16",$n="base64pad",er="base64url",tr="utf8";function ir(){const e=Ki(32);return(0,v.t)(e,Xn)}function sr(e){const t=vn((0,v.f)(e,Xn));return(0,v.t)(t,Xn)}function nr(e){const t=vn((0,v.f)(e,tr));return(0,v.t)(t,Xn)}function rr(e){return(0,v.f)("".concat(e),Jn)}function or(e){return Number((0,v.t)(e,Jn))}function ar(e){const{encoding:t=$n}=e;if(2===or(e.type))return(0,v.t)((0,v.h)([e.type,e.sealed]),t);if(1===or(e.type)){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,v.t)((0,v.h)([e.type,e.senderPublicKey,e.iv,e.sealed]),t)}return(0,v.t)((0,v.h)([e.type,e.iv,e.sealed]),t)}function cr(e){const{encoded:t,encoding:i=$n}=e,s=(0,v.f)(t,i),n=s.slice(0,1);if(1===or(n)){const e=33,t=e+12,i=s.slice(1,e),r=s.slice(e,t);return{type:n,sealed:s.slice(t),iv:r,senderPublicKey:i}}if(2===or(n)){return{type:n,sealed:s.slice(1),iv:Ki(12)}}const r=s.slice(1,13);return{type:n,sealed:s.slice(13),iv:r}}function lr(e){const t=(null==e?void 0:e.type)||0;if(1===t){if(typeof(null==e?void 0:e.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(null==e?void 0:e.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:null==e?void 0:e.senderPublicKey,receiverPublicKey:null==e?void 0:e.receiverPublicKey}}function hr(e){return 1===e.type&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function dr(e){return 2===e.type}function ur(e,t){const[i,s,n]=e.split("."),r=function(e){return p.d.Buffer.from(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const i=t.length%4;return i>0&&(t+="=".repeat(4-i)),t}(e),"base64")}(n);if(64!==r.length)throw new Error("Invalid signature length");const o=r.slice(0,32).toString("hex"),a=r.slice(32,64).toString("hex"),c="".concat(i,".").concat(s),l=vn(c),h=function(e){return new Qt.ec("p256").keyFromPublic({x:p.d.Buffer.from(e.x,"base64").toString("hex"),y:p.d.Buffer.from(e.y,"base64").toString("hex")},"hex")}(t),d=(0,v.t)(l,Xn);if(!h.verify(d,{r:o,s:a}))throw new Error("Invalid signature");return(0,v.s)(e).payload}function pr(e){return(null==e?void 0:e.relay)||{protocol:"irn"}}function gr(e){const t=v.C[e];if(typeof t>"u")throw new Error("Relay Protocol not supported: ".concat(e));return t}function fr(e){const t={},i="relay"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-");return Object.keys(e).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),r=e[s];t[n]=r}}),t}function wr(e){if(!e.includes("wc:")){const t=Si(e);null!=t&&t.includes("wc:")&&(e=t)}const t=(e=(e=e.includes("wc://")?e.replace("wc://",""):e).includes("wc:")?e.replace("wc:",""):e).indexOf(":"),i=-1!==e.indexOf("?")?e.indexOf("?"):void 0,s=e.substring(0,t),n=e.substring(t+1,i).split("@"),r=typeof i<"u"?e.substring(i):"",o=new URLSearchParams(r),a={};o.forEach((e,t)=>{a[t]=e});const c="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:s,topic:mr(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:fr(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function mr(e){return e.startsWith("//")?e.substring(2):e}function yr(e){const t=new URLSearchParams,i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";const i={};return Object.keys(e).forEach(s=>{const n=s,r="relay"+t+n;e[n]&&(i[r]=e[n])}),i}(e.relay);Object.keys(i).sort().forEach(e=>{t.set(e,i[e])}),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));const s=t.toString();return"".concat(e.protocol,":").concat(e.topic,"@").concat(e.version,"?").concat(s)}function vr(e,t,i){return"".concat(e,"?wc_ev=").concat(i,"&topic=").concat(t)}function br(e){const t=[];return e.forEach(e=>{const[i,s]=e.split(":");t.push("".concat(i,":").concat(s))}),t}function Ir(e){return e.includes(":")}function Er(e){return Ir(e)?e.split(":")[0]:e}function Nr(e,t){const i=function(e){const t={};return null==e||e.forEach(e=>{var i;const[s,n]=e.split(":");t[s]||(t[s]={accounts:[],chains:[],events:[],methods:[]}),t[s].accounts.push(e),null==(i=t[s].chains)||i.push("".concat(s,":").concat(n))}),t}(t=t.map(e=>e.replace("did:pkh:","")));for(const[s,n]of Object.entries(i))n.methods?n.methods=Ii(n.methods,e):n.methods=e,n.events=["chainChanged","accountsChanged"];return i}const Ar={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Cr={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Sr(e,t){const{message:i,code:s}=Cr[e];return{message:t?"".concat(i," ").concat(t):i,code:s}}function Pr(e,t){const{message:i,code:s}=Ar[e];return{message:t?"".concat(i," ").concat(t):i,code:s}}function Tr(e,t){return!!Array.isArray(e)}function Mr(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function _r(e){return typeof e>"u"}function Or(e,t){return!(!t||!_r(e))||"string"==typeof e&&!!e.trim().length}function xr(e,t){return!(!t||!_r(e))||"number"==typeof e&&!isNaN(e)}function kr(e){return!(!Or(e,!1)||!e.includes(":"))&&2===e.split(":").length}function Dr(e){let t=!0;return Tr(e)?e.length&&(t=e.every(e=>Or(e,!1))):t=!1,t}function jr(e,t,i){let s=null;return Object.entries(e).forEach(e=>{let[n,r]=e;if(s)return;const o=function(e,t,i){let s=null;return Tr(t)&&t.length?t.forEach(e=>{s||kr(e)||(s=Pr("UNSUPPORTED_CHAINS","".concat(i,", chain ").concat(e,' should be a string and conform to "namespace:chainId" format')))}):kr(e)||(s=Pr("UNSUPPORTED_CHAINS","".concat(i,', chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }'))),s}(n,Jt(n,r),"".concat(t," ").concat(i));o&&(s=o)}),s}function Rr(e,t){let i=null;return Tr(e)?e.forEach(e=>{i||function(e){if(Or(e,!1)&&e.includes(":")){const t=e.split(":");if(3===t.length){const e=t[0]+":"+t[1];return!!t[2]&&kr(e)}}return!1}(e)||(i=Pr("UNSUPPORTED_ACCOUNTS","".concat(t,", account ").concat(e,' should be a string and conform to "namespace:chainId:address" format')))}):i=Pr("UNSUPPORTED_ACCOUNTS","".concat(t,', accounts should be an array of strings conforming to "namespace:chainId:address" format')),i}function Ur(e,t){let i=null;return Object.values(e).forEach(e=>{if(i)return;const s=function(e,t){let i=null;return Dr(null==e?void 0:e.methods)?Dr(null==e?void 0:e.events)||(i=Pr("UNSUPPORTED_EVENTS","".concat(t,", events should be an array of strings or empty array for no events"))):i=Pr("UNSUPPORTED_METHODS","".concat(t,", methods should be an array of strings or empty array for no methods")),i}(e,"".concat(t,", namespace"));s&&(i=s)}),i}function Lr(e,t){let i=null;if(e&&Mr(e)){const s=Ur(e,t);s&&(i=s);const n=function(e,t){let i=null;return Object.values(e).forEach(e=>{if(i)return;const s=Rr(null==e?void 0:e.accounts,"".concat(t," namespace"));s&&(i=s)}),i}(e,t);n&&(i=n)}else i=Sr("MISSING_OR_INVALID","".concat(t,", namespaces should be an object with data"));return i}function zr(e){return Or(e.protocol,!0)}function qr(e){return typeof e<"u"&&null!==typeof e}function Br(e,t){return!(!kr(t)||!function(e){const t=[];return Object.values(e).forEach(e=>{t.push(...br(e.accounts))}),t}(e).includes(t))}function Vr(e,t,i){return!!Or(i,!1)&&function(e,t){const i=[];return Object.values(e).forEach(e=>{br(e.accounts).includes(t)&&i.push(...e.methods)}),i}(e,t).includes(i)}function Hr(e,t,i){return!!Or(i,!1)&&function(e,t){const i=[];return Object.values(e).forEach(e=>{br(e.accounts).includes(t)&&i.push(...e.events)}),i}(e,t).includes(i)}function Kr(e,t,i){let s=null;const n=function(e){const t={};return Object.keys(e).forEach(i=>{var s;i.includes(":")?t[i]=e[i]:null==(s=e[i].chains)||s.forEach(s=>{t[s]={methods:e[i].methods,events:e[i].events}})}),t}(e),r=function(e){const t={};return Object.keys(e).forEach(i=>{if(i.includes(":"))t[i]=e[i];else{const s=br(e[i].accounts);null==s||s.forEach(s=>{t[s]={accounts:e[i].accounts.filter(e=>e.includes("".concat(s,":"))),methods:e[i].methods,events:e[i].events}})}}),t}(t),o=Object.keys(n),a=Object.keys(r),c=Wr(Object.keys(e)),l=Wr(Object.keys(t)),h=c.filter(e=>!l.includes(e));return h.length&&(s=Sr("NON_CONFORMING_NAMESPACES","".concat(i," namespaces keys don't satisfy requiredNamespaces.\n      Required: ").concat(h.toString(),"\n      Received: ").concat(Object.keys(t).toString()))),di(o,a)||(s=Sr("NON_CONFORMING_NAMESPACES","".concat(i," namespaces chains don't satisfy required namespaces.\n      Required: ").concat(o.toString(),"\n      Approved: ").concat(a.toString()))),Object.keys(t).forEach(e=>{if(!e.includes(":")||s)return;const n=br(t[e].accounts);n.includes(e)||(s=Sr("NON_CONFORMING_NAMESPACES","".concat(i," namespaces accounts don't satisfy namespace accounts for ").concat(e,"\n        Required: ").concat(e,"\n        Approved: ").concat(n.toString())))}),o.forEach(e=>{s||(di(n[e].methods,r[e].methods)?di(n[e].events,r[e].events)||(s=Sr("NON_CONFORMING_NAMESPACES","".concat(i," namespaces events don't satisfy namespace events for ").concat(e))):s=Sr("NON_CONFORMING_NAMESPACES","".concat(i," namespaces methods don't satisfy namespace methods for ").concat(e)))}),s}function Wr(e){return[...new Set(e.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Fr(){const e=oi();return new Promise(t=>{switch(e){case ei:t(ri()&&(null==navigator?void 0:navigator.onLine));break;case Xt:t(async function(){if(ni()&&typeof p.d.global<"u"&&null!=p.d.global&&p.d.global.NetInfo){const e=await(null==p.d.global?void 0:p.d.global.NetInfo.fetch());return null==e?void 0:e.isConnected}return!0}());break;default:t(!0)}})}function Gr(e){switch(oi()){case ei:!function(e){!ni()&&ri()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}(e);break;case Xt:!function(e){var t;ni()&&typeof p.d.global<"u"&&null!=p.d.global&&p.d.global.NetInfo&&(null==(t=p.d.global)||t.NetInfo.addEventListener(t=>e(null==t?void 0:t.isConnected)))}(e)}}const Yr={};let Qr=class{static get(e){return Yr[e]}static set(e,t){Yr[e]=t}static delete(e){delete Yr[e]}};var Zr={exports:{}};!function(e,t){var i="__lodash_hash_undefined__",s=9007199254740991,n="[object Arguments]",r="[object Array]",o="[object Boolean]",a="[object Date]",c="[object Error]",l="[object Function]",h="[object Map]",d="[object Number]",u="[object Object]",g="[object Promise]",f="[object RegExp]",w="[object Set]",m="[object String]",y="[object Symbol]",v="[object WeakMap]",b="[object ArrayBuffer]",I="[object DataView]",E=/^\[object .+?Constructor\]$/,N=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[n]=A[r]=A[b]=A[o]=A[I]=A[a]=A[c]=A[l]=A[h]=A[d]=A[u]=A[f]=A[w]=A[m]=A[v]=!1;var C="object"==typeof p.c&&p.c&&p.c.Object===Object&&p.c,S="object"==typeof self&&self&&self.Object===Object&&self,P=C||S||Function("return this")(),T=t&&!t.nodeType&&t,M=T&&e&&!e.nodeType&&e,_=M&&M.exports===T,O=_&&C.process,x=function(){try{return O&&O.binding&&O.binding("util")}catch(e){}}(),k=x&&x.isTypedArray;function D(e,t){for(var i=-1,s=null==e?0:e.length;++i<s;)if(t(e[i],i,e))return!0;return!1}function j(e,t){return e.has(t)}function R(e){var t=-1,i=Array(e.size);return e.forEach(function(e,s){i[++t]=[s,e]}),i}function U(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}var L,z,q=Array.prototype,B=Function.prototype,V=Object.prototype,H=P["__core-js_shared__"],K=B.toString,W=V.hasOwnProperty,F=function(){var e=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),G=V.toString,Y=RegExp("^"+K.call(W).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Q=_?P.Buffer:void 0,Z=P.Symbol,J=P.Uint8Array,X=V.propertyIsEnumerable,$=q.splice,ee=Z?Z.toStringTag:void 0,te=Object.getOwnPropertySymbols,ie=Q?Q.isBuffer:void 0,se=(L=Object.keys,z=Object,function(e){return L(z(e))}),ne=xe(P,"DataView"),re=xe(P,"Map"),oe=xe(P,"Promise"),ae=xe(P,"Set"),ce=xe(P,"WeakMap"),le=xe(Object,"create"),he=Re(ne),de=Re(re),ue=Re(oe),pe=Re(ae),ge=Re(ce),fe=Z?Z.prototype:void 0,we=fe?fe.valueOf:void 0;function me(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}function ye(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}function ve(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}function be(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new ve;++t<i;)this.add(e[t])}function Ie(e){var t=this.__data__=new ye(e);this.size=t.size}function Ee(e,t){var i=ze(e),s=!i&&Le(e),n=!i&&!s&&qe(e),r=!i&&!s&&!n&&We(e),o=i||s||n||r,a=o?function(e,t){for(var i=-1,s=Array(e);++i<e;)s[i]=t(i);return s}(e.length,String):[],c=a.length;for(var l in e)W.call(e,l)&&(!o||!("length"==l||n&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||je(l,c)))&&a.push(l);return a}function Ne(e,t){for(var i=e.length;i--;)if(Ue(e[i][0],t))return i;return-1}function Ae(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ee&&ee in Object(e)?function(e){var t=W.call(e,ee),i=e[ee];try{e[ee]=void 0;var s=!0}catch(r){}var n=G.call(e);return s&&(t?e[ee]=i:delete e[ee]),n}(e):function(e){return G.call(e)}(e)}function Ce(e){return Ke(e)&&Ae(e)==n}function Se(e,t,i,s,l){return e===t||(null==e||null==t||!Ke(e)&&!Ke(t)?e!==e&&t!==t:function(e,t,i,s,l,p){var g=ze(e),v=ze(t),E=g?r:De(e),N=v?r:De(t),A=(E=E==n?u:E)==u,C=(N=N==n?u:N)==u,S=E==N;if(S&&qe(e)){if(!qe(t))return!1;g=!0,A=!1}if(S&&!A)return p||(p=new Ie),g||We(e)?Me(e,t,i,s,l,p):function(e,t,i,s,n,r,l){switch(i){case I:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case b:return!(e.byteLength!=t.byteLength||!r(new J(e),new J(t)));case o:case a:case d:return Ue(+e,+t);case c:return e.name==t.name&&e.message==t.message;case f:case m:return e==t+"";case h:var u=R;case w:var p=1&s;if(u||(u=U),e.size!=t.size&&!p)return!1;var g=l.get(e);if(g)return g==t;s|=2,l.set(e,t);var v=Me(u(e),u(t),s,n,r,l);return l.delete(e),v;case y:if(we)return we.call(e)==we.call(t)}return!1}(e,t,E,i,s,l,p);if(!(1&i)){var P=A&&W.call(e,"__wrapped__"),T=C&&W.call(t,"__wrapped__");if(P||T){var M=P?e.value():e,_=T?t.value():t;return p||(p=new Ie),l(M,_,i,s,p)}}return!!S&&(p||(p=new Ie),function(e,t,i,s,n,r){var o=1&i,a=_e(e),c=a.length,l=_e(t),h=l.length;if(c!=h&&!o)return!1;for(var d=c;d--;){var u=a[d];if(!(o?u in t:W.call(t,u)))return!1}var p=r.get(e);if(p&&r.get(t))return p==t;var g=!0;r.set(e,t),r.set(t,e);for(var f=o;++d<c;){var w=e[u=a[d]],m=t[u];if(s)var y=o?s(m,w,u,t,e,r):s(w,m,u,e,t,r);if(!(void 0===y?w===m||n(w,m,i,s,r):y)){g=!1;break}f||(f="constructor"==u)}if(g&&!f){var v=e.constructor,b=t.constructor;v!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b)&&(g=!1)}return r.delete(e),r.delete(t),g}(e,t,i,s,l,p))}(e,t,i,s,Se,l))}function Pe(e){return!(!He(e)||function(e){return!!F&&F in e}(e))&&(Be(e)?Y:E).test(Re(e))}function Te(e){if(!function(e){var t=e&&e.constructor,i="function"==typeof t&&t.prototype||V;return e===i}(e))return se(e);var t=[];for(var i in Object(e))W.call(e,i)&&"constructor"!=i&&t.push(i);return t}function Me(e,t,i,s,n,r){var o=1&i,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=r.get(e);if(l&&r.get(t))return l==t;var h=-1,d=!0,u=2&i?new be:void 0;for(r.set(e,t),r.set(t,e);++h<a;){var p=e[h],g=t[h];if(s)var f=o?s(g,p,h,t,e,r):s(p,g,h,e,t,r);if(void 0!==f){if(f)continue;d=!1;break}if(u){if(!D(t,function(e,t){if(!j(u,t)&&(p===e||n(p,e,i,s,r)))return u.push(t)})){d=!1;break}}else if(p!==g&&!n(p,g,i,s,r)){d=!1;break}}return r.delete(e),r.delete(t),d}function _e(e){return function(e,t,i){var s=t(e);return ze(e)?s:function(e,t){for(var i=-1,s=t.length,n=e.length;++i<s;)e[n+i]=t[i];return e}(s,i(e))}(e,Fe,ke)}function Oe(e,t){var i=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?i["string"==typeof t?"string":"hash"]:i.map}function xe(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return Pe(i)?i:void 0}me.prototype.clear=function(){this.__data__=le?le(null):{},this.size=0},me.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},me.prototype.get=function(e){var t=this.__data__;if(le){var s=t[e];return s===i?void 0:s}return W.call(t,e)?t[e]:void 0},me.prototype.has=function(e){var t=this.__data__;return le?void 0!==t[e]:W.call(t,e)},me.prototype.set=function(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=le&&void 0===t?i:t,this},ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=function(e){var t=this.__data__,i=Ne(t,e);return!(i<0)&&(i==t.length-1?t.pop():$.call(t,i,1),--this.size,!0)},ye.prototype.get=function(e){var t=this.__data__,i=Ne(t,e);return i<0?void 0:t[i][1]},ye.prototype.has=function(e){return Ne(this.__data__,e)>-1},ye.prototype.set=function(e,t){var i=this.__data__,s=Ne(i,e);return s<0?(++this.size,i.push([e,t])):i[s][1]=t,this},ve.prototype.clear=function(){this.size=0,this.__data__={hash:new me,map:new(re||ye),string:new me}},ve.prototype.delete=function(e){var t=Oe(this,e).delete(e);return this.size-=t?1:0,t},ve.prototype.get=function(e){return Oe(this,e).get(e)},ve.prototype.has=function(e){return Oe(this,e).has(e)},ve.prototype.set=function(e,t){var i=Oe(this,e),s=i.size;return i.set(e,t),this.size+=i.size==s?0:1,this},be.prototype.add=be.prototype.push=function(e){return this.__data__.set(e,i),this},be.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.clear=function(){this.__data__=new ye,this.size=0},Ie.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},Ie.prototype.get=function(e){return this.__data__.get(e)},Ie.prototype.has=function(e){return this.__data__.has(e)},Ie.prototype.set=function(e,t){var i=this.__data__;if(i instanceof ye){var s=i.__data__;if(!re||s.length<199)return s.push([e,t]),this.size=++i.size,this;i=this.__data__=new ve(s)}return i.set(e,t),this.size=i.size,this};var ke=te?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,s=null==e?0:e.length,n=0,r=[];++i<s;){var o=e[i];t(o,i,e)&&(r[n++]=o)}return r}(te(e),function(t){return X.call(e,t)}))}:function(){return[]},De=Ae;function je(e,t){return!!(t=null!==t&&void 0!==t?t:s)&&("number"==typeof e||N.test(e))&&e>-1&&e%1==0&&e<t}function Re(e){if(null!=e){try{return K.call(e)}catch(t){}try{return e+""}catch(i){}}return""}function Ue(e,t){return e===t||e!==e&&t!==t}(ne&&De(new ne(new ArrayBuffer(1)))!=I||re&&De(new re)!=h||oe&&De(oe.resolve())!=g||ae&&De(new ae)!=w||ce&&De(new ce)!=v)&&(De=function(e){var t=Ae(e),i=t==u?e.constructor:void 0,s=i?Re(i):"";if(s)switch(s){case he:return I;case de:return h;case ue:return g;case pe:return w;case ge:return v}return t});var Le=Ce(function(){return arguments}())?Ce:function(e){return Ke(e)&&W.call(e,"callee")&&!X.call(e,"callee")},ze=Array.isArray;var qe=ie||function(){return!1};function Be(e){if(!He(e))return!1;var t=Ae(e);return t==l||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ve(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=s}function He(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ke(e){return null!=e&&"object"==typeof e}var We=k?function(e){return function(t){return e(t)}}(k):function(e){return Ke(e)&&Ve(e.length)&&!!A[Ae(e)]};function Fe(e){return function(e){return null!=e&&Ve(e.length)&&!Be(e)}(e)?Ee(e):Te(e)}e.exports=function(e,t){return Se(e,t)}}(Zr,Zr.exports);var Jr=Zr.exports;const Xr=(0,p.g)(Jr),$r="core",eo="".concat("wc","@2:").concat($r,":"),to="error",io={database:":memory:"},so="client_ed25519_seed",no=v.c.ONE_DAY,ro=v.c.SIX_HOURS,oo="wss://relay.walletconnect.org",ao="relayer_message",co="relayer_message_ack",lo="relayer_connect",ho="relayer_disconnect",uo="relayer_error",po="relayer_connection_stalled",go="relayer_publish",fo="payload",wo="connect",mo="disconnect",yo="error",vo="2.19.0",bo={link_mode:"link_mode",relay:"relay"},Io="WALLETCONNECT_LINK_MODE_APPS",Eo="subscription_created",No="subscription_deleted",Ao="subscription_sync",Co="subscription_resubscribed",So=1e3*v.c.FIVE_SECONDS,Po={wc_pairingDelete:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:v.c.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:v.c.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:0},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:0}}},To="pairing_create",Mo="pairing_expire",_o="pairing_delete",Oo="pairing_ping",xo="history_created",ko="history_updated",Do="history_deleted",jo="history_sync",Ro="expirer_created",Uo="expirer_deleted",Lo="expirer_expired",zo="expirer_sync",qo="https://verify.walletconnect.org",Bo=qo,Vo="".concat(Bo,"/v3"),Ho=["https://verify.walletconnect.com",qo],Ko="pairing_started",Wo="pairing_uri_validation_success",Fo="pairing_uri_not_expired",Go="store_new_pairing",Yo="subscribing_pairing_topic",Qo="subscribe_pairing_topic_success",Zo="existing_pairing",Jo="pairing_not_expired",Xo="emit_inactive_pairing",$o="emit_session_proposal",ea="no_internet_connection",ta="malformed_pairing_uri",ia="active_pairing_already_exists",sa="subscribe_pairing_topic_failure",na="pairing_expired",ra="proposal_listener_not_found",oa="session_approve_started",aa="session_namespaces_validation_success",ca="subscribing_session_topic",la="subscribe_session_topic_success",ha="publishing_session_approve",da="session_approve_publish_success",ua="store_session",pa="publishing_session_settle",ga="session_settle_publish_success",fa="no_internet_connection",wa="proposal_expired",ma="subscribe_session_topic_failure",ya="session_approve_publish_failure",va="session_settle_publish_failure",ba="session_approve_namespace_validation_failure",Ia="proposal_not_found",Ea="authenticated_session_approve_started",Na="create_authenticated_session_topic",Aa="cacaos_verified",Ca="store_authenticated_session",Sa="subscribing_authenticated_session_topic",Pa="subscribe_authenticated_session_topic_success",Ta="publishing_authenticated_session_approve",Ma="no_internet_connection",_a="invalid_cacao",Oa="subscribe_authenticated_session_topic_failure",xa="authenticated_session_approve_publish_failure",ka="authenticated_session_pending_request_not_found";var Da=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var n=0;n<e.length;n++){var r=e.charAt(n),o=r.charCodeAt(0);if(255!==i[o])throw new TypeError(r+" is ambiguous");i[o]=n}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var s=0,n=0;e[t]===c;)s++,t++;for(var r=(e.length-t)*l+1>>>0,o=new Uint8Array(r);e[t];){var h=i[e.charCodeAt(t)];if(255===h)return;for(var d=0,u=r-1;(0!==h||d<n)&&-1!==u;u--,d++)h+=a*o[u]>>>0,o[u]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,t++}if(" "!==e[t]){for(var p=r-n;p!==r&&0===o[p];)p++;for(var g=new Uint8Array(s+(r-p)),f=s;p!==r;)g[f++]=o[p++];return g}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var i=0,s=0,n=0,r=t.length;n!==r&&0===t[n];)n++,i++;for(var o=(r-n)*h+1>>>0,l=new Uint8Array(o);n!==r;){for(var d=t[n],u=0,p=o-1;(0!==d||u<s)&&-1!==p;p--,u++)d+=256*l[p]>>>0,l[p]=d%a>>>0,d=d/a>>>0;if(0!==d)throw new Error("Non-zero carry");s=u,n++}for(var g=o-s;g!==o&&0===l[g];)g++;for(var f=c.repeat(i);g<o;++g)f+=e.charAt(l[g]);return f},decodeUnsafe:d,decode:function(e){var i=d(e);if(i)return i;throw new Error("Non-".concat(t," character"))}}},ja=Da;const Ra=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};let Ua=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}},La=class{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return qa(this,e)}},za=class{constructor(e){this.decoders=e}or(e){return qa(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}};const qa=(e,t)=>new za((0,d.A)((0,d.A)({},e.decoders||{[e.prefix]:e}),t.decoders||{[t.prefix]:t}));let Ba=class{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Ua(e,t,i),this.decoder=new La(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Va=e=>{let{name:t,prefix:i,encode:s,decode:n}=e;return new Ba(t,i,s,n)},Ha=e=>{let{prefix:t,name:i,alphabet:s}=e;const{encode:n,decode:r}=ja(s,i);return Va({prefix:t,name:i,encode:n,decode:e=>Ra(r(e))})},Ka=e=>{let{name:t,prefix:i,bitsPerChar:s,alphabet:n}=e;return Va({prefix:i,name:t,encode:e=>((e,t,i)=>{const s="="===t[t.length-1],n=(1<<i)-1;let r="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>i;)o-=i,r+=t[n&a>>o];if(o&&(r+=t[n&a<<i-o]),s)for(;r.length*i&7;)r+="=";return r})(e,n,s),decode:e=>((e,t,i,s)=>{const n={};for(let h=0;h<t.length;++h)n[t[h]]=h;let r=e.length;for(;"="===e[r-1];)--r;const o=new Uint8Array(r*i/8|0);let a=0,c=0,l=0;for(let h=0;h<r;++h){const t=n[e[h]];if(void 0===t)throw new SyntaxError("Non-".concat(s," character"));c=c<<i|t,a+=i,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(e,n,s,t)})},Wa=Va({prefix:"\0",name:"identity",encode:e=>(e=>(new TextDecoder).decode(e))(e),decode:e=>(e=>(new TextEncoder).encode(e))(e)});var Fa=Object.freeze({__proto__:null,identity:Wa});const Ga=Ka({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ya=Object.freeze({__proto__:null,base2:Ga});const Qa=Ka({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Za=Object.freeze({__proto__:null,base8:Qa});const Ja=Ha({prefix:"9",name:"base10",alphabet:"0123456789"});var Xa=Object.freeze({__proto__:null,base10:Ja});const $a=Ka({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ec=Ka({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var tc=Object.freeze({__proto__:null,base16:$a,base16upper:ec});const ic=Ka({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),sc=Ka({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nc=Ka({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rc=Ka({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oc=Ka({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ac=Ka({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cc=Ka({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lc=Ka({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),hc=Ka({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dc=Object.freeze({__proto__:null,base32:ic,base32upper:sc,base32pad:nc,base32padupper:rc,base32hex:oc,base32hexupper:ac,base32hexpad:cc,base32hexpadupper:lc,base32z:hc});const uc=Ha({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),pc=Ha({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var gc=Object.freeze({__proto__:null,base36:uc,base36upper:pc});const fc=Ha({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),wc=Ha({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var mc=Object.freeze({__proto__:null,base58btc:fc,base58flickr:wc});const yc=Ka({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),vc=Ka({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),bc=Ka({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ic=Ka({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ec=Object.freeze({__proto__:null,base64:yc,base64pad:vc,base64url:bc,base64urlpad:Ic});const Nc=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),Ac=Nc.reduce((e,t,i)=>(e[i]=t,e),[]),Cc=Nc.reduce((e,t,i)=>(e[t.codePointAt(0)]=i,e),[]);const Sc=Va({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=Ac[t],"")},decode:function(e){const t=[];for(const i of e){const e=Cc[i.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(i));t.push(e)}return new Uint8Array(t)}});var Pc=Object.freeze({__proto__:null,base256emoji:Sc}),Tc=function e(t,i,s){i=i||[];for(var n=s=s||0;t>=Oc;)i[s++]=255&t|Mc,t/=128;for(;t&_c;)i[s++]=255&t|Mc,t>>>=7;return i[s]=0|t,e.bytes=s-n+1,i},Mc=128,_c=-128,Oc=Math.pow(2,31);var xc=function e(t,i){var s,n=0,r=0,o=i=i||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");s=t[o++],n+=r<28?(s&Dc)<<r:(s&Dc)*Math.pow(2,r),r+=7}while(s>=kc);return e.bytes=o-i,n},kc=128,Dc=127;var jc=Math.pow(2,7),Rc=Math.pow(2,14),Uc=Math.pow(2,21),Lc=Math.pow(2,28),zc=Math.pow(2,35),qc=Math.pow(2,42),Bc=Math.pow(2,49),Vc=Math.pow(2,56),Hc=Math.pow(2,63),Kc={encode:Tc,decode:xc,encodingLength:function(e){return e<jc?1:e<Rc?2:e<Uc?3:e<Lc?4:e<zc?5:e<qc?6:e<Bc?7:e<Vc?8:e<Hc?9:10}},Wc=Kc;const Fc=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Wc.encode(e,t,i),t},Gc=e=>Wc.encodingLength(e),Yc=(e,t)=>{const i=t.byteLength,s=Gc(e),n=s+Gc(i),r=new Uint8Array(n+i);return Fc(e,r,0),Fc(i,r,s),r.set(t,n),new Qc(e,i,t,r)};let Qc=class{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}};const Zc=e=>{let{name:t,code:i,encode:s}=e;return new Jc(t,i,s)};let Jc=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Yc(this.code,t):t.then(e=>Yc(this.code,e))}throw Error("Unknown type, must be binary type")}};const Xc=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),$c=Zc({name:"sha2-256",code:18,encode:Xc("SHA-256")}),el=Zc({name:"sha2-512",code:19,encode:Xc("SHA-512")});var tl=Object.freeze({__proto__:null,sha256:$c,sha512:el});const il=Ra,sl={code:0,name:"identity",encode:il,digest:e=>Yc(0,il(e))};var nl=Object.freeze({__proto__:null,identity:sl});new TextEncoder,new TextDecoder;const rl=(0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)({},Fa),Ya),Za),Xa),tc),dc),gc),mc),Ec),Pc);function ol(e,t,i,s){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:i},decoder:{decode:s}}}(0,d.A)((0,d.A)({},tl),nl);const al=ol("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>(new TextEncoder).encode(e.substring(1))),cl=ol("ascii","a",e=>{let t="a";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},e=>{const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}((e=e.substring(1)).length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}),ll=(0,d.A)({utf8:al,"utf-8":al,hex:rl.base16,latin1:cl,ascii:cl,binary:cl},rl);var hl=Object.defineProperty,dl=(e,t,i)=>((e,t,i)=>t in e?hl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let ul=class{constructor(e,t){this.core=e,this.logger=t,dl(this,"keychain",new Map),dl(this,"name","keychain"),dl(this,"version","0.3"),dl(this,"initialized",!1),dl(this,"storagePrefix",eo),dl(this,"init",async()=>{if(!this.initialized){const e=await this.getKeyChain();typeof e<"u"&&(this.keychain=e),this.initialized=!0}}),dl(this,"has",e=>(this.isInitialized(),this.keychain.has(e))),dl(this,"set",async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),dl(this,"get",e=>{this.isInitialized();const t=this.keychain.get(e);if(typeof t>"u"){const{message:t}=Sr("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw new Error(t)}return t}),dl(this,"del",async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=(0,v.E)(t,this.name)}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ui(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?pi(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}};var pl=Object.defineProperty,gl=(e,t,i)=>((e,t,i)=>t in e?pl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let fl=class{constructor(e,t,i){this.core=e,this.logger=t,gl(this,"name","crypto"),gl(this,"keychain"),gl(this,"randomSessionIdentifier",ir()),gl(this,"initialized",!1),gl(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),gl(this,"hasKeys",e=>(this.isInitialized(),this.keychain.has(e))),gl(this,"getClientId",async()=>{this.isInitialized();const e=await this.getClientSeed(),t=(0,v.P)(e);return(0,v.Q)(t.publicKey)}),gl(this,"generateKeyPair",()=>{this.isInitialized();const e=function(){const e=Zn.utils.randomPrivateKey(),t=Zn.getPublicKey(e);return{privateKey:(0,v.t)(e,Xn),publicKey:(0,v.t)(t,Xn)}}();return this.setPrivateKey(e.publicKey,e.privateKey)}),gl(this,"signJWT",async e=>{this.isInitialized();const t=await this.getClientSeed(),i=(0,v.P)(t),s=this.randomSessionIdentifier;return await(0,v.u)(s,e,no,i)}),gl(this,"generateSharedKey",(e,t,i)=>{this.isInitialized();const s=function(e,t){const i=Zn.getSharedSecret((0,v.f)(e,Xn),(0,v.f)(t,Xn)),s=dn(vn,i,void 0,void 0,32);return(0,v.t)(s,Xn)}(this.getPrivateKey(e),t);return this.setSymKey(s,i)}),gl(this,"setSymKey",async(e,t)=>{this.isInitialized();const i=t||sr(e);return await this.keychain.set(i,e),i}),gl(this,"deleteKeyPair",async e=>{this.isInitialized(),await this.keychain.del(e)}),gl(this,"deleteSymKey",async e=>{this.isInitialized(),await this.keychain.del(e)}),gl(this,"encode",async(e,t,i)=>{this.isInitialized();const s=lr(i),n=(0,v.v)(t);if(dr(s))return function(e,t){const i=rr(2),s=Ki(12);return ar({type:i,sealed:(0,v.f)(e,tr),iv:s,encoding:t})}(n,null==i?void 0:i.encoding);if(hr(s)){const t=s.senderPublicKey,i=s.receiverPublicKey;e=await this.generateSharedKey(t,i)}const r=this.getSymKey(e),{type:o,senderPublicKey:a}=s;return function(e){const t=rr(typeof e.type<"u"?e.type:0);if(1===or(t)&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof e.senderPublicKey<"u"?(0,v.f)(e.senderPublicKey,Xn):void 0,s=typeof e.iv<"u"?(0,v.f)(e.iv,Xn):Ki(12),n=(0,v.f)(e.symKey,Xn);return ar({type:t,sealed:on(n,s).encrypt((0,v.f)(e.message,tr)),iv:s,senderPublicKey:i,encoding:e.encoding})}({type:o,symKey:r,message:n,senderPublicKey:a,encoding:null==i?void 0:i.encoding})}),gl(this,"decode",async(e,t,i)=>{this.isInitialized();const s=function(e,t){const i=cr({encoded:e,encoding:null==t?void 0:t.encoding});return lr({type:or(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?(0,v.t)(i.senderPublicKey,Xn):void 0,receiverPublicKey:null==t?void 0:t.receiverPublicKey})}(t,i);if(dr(s)){const e=function(e,t){const{sealed:i}=cr({encoded:e,encoding:t});return(0,v.t)(i,tr)}(t,null==i?void 0:i.encoding);return(0,v.w)(e)}if(hr(s)){const t=s.receiverPublicKey,i=s.senderPublicKey;e=await this.generateSharedKey(t,i)}try{const s=function(e){const t=(0,v.f)(e.symKey,Xn),{sealed:i,iv:s}=cr(e),n=on(t,s).decrypt(i);if(null===n)throw new Error("Failed to decrypt");return(0,v.t)(n,tr)}({symKey:this.getSymKey(e),encoded:t,encoding:null==i?void 0:i.encoding});return(0,v.w)(s)}catch(n){this.logger.error("Failed to decode message from topic: '".concat(e,"', clientId: '").concat(await this.getClientId(),"'")),this.logger.error(n)}}),gl(this,"getPayloadType",function(e){return or(cr({encoded:e,encoding:arguments.length>1&&void 0!==arguments[1]?arguments[1]:$n}).type)}),gl(this,"getPayloadSenderPublicKey",function(e){const t=cr({encoded:e,encoding:arguments.length>1&&void 0!==arguments[1]?arguments[1]:$n});return t.senderPublicKey?(0,v.t)(t.senderPublicKey,Xn):void 0}),this.core=e,this.logger=(0,v.E)(t,this.name),this.keychain=i||new ul(this.core,this.logger)}get context(){return(0,v.y)(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(so)}catch(t){e=ir(),await this.keychain.set(so,e)}return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";const i=ll[t];if(!i)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?i.decoder.decode("".concat(i.prefix).concat(e)):globalThis.Buffer.from(e,"utf8")}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}};var wl=Object.defineProperty,ml=(e,t,i)=>((e,t,i)=>t in e?wl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let yl=class extends _e{constructor(e,t){super(e,t),this.logger=e,this.core=t,ml(this,"messages",new Map),ml(this,"name","messages"),ml(this,"version","0.3"),ml(this,"initialized",!1),ml(this,"storagePrefix",eo),ml(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const e=await this.getRelayerMessages();typeof e<"u"&&(this.messages=e),this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e)}finally{this.initialized=!0}}}),ml(this,"set",async(e,t)=>{this.isInitialized();const i=nr(t);let s=this.messages.get(e);return typeof s>"u"&&(s={}),typeof s[i]<"u"||(s[i]=t,this.messages.set(e,s),await this.persist()),i}),ml(this,"get",e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t}),ml(this,"has",(e,t)=>{this.isInitialized();return typeof this.get(e)[nr(t)]<"u"}),ml(this,"del",async e=>{this.isInitialized(),this.messages.delete(e),await this.persist()}),this.logger=(0,v.E)(e,this.name),this.core=t}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ui(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?pi(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}};var vl=Object.defineProperty,bl=Object.defineProperties,Il=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,Nl=Object.prototype.hasOwnProperty,Al=Object.prototype.propertyIsEnumerable,Cl=(e,t,i)=>t in e?vl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Sl=(e,t)=>{for(var i in t||(t={}))Nl.call(t,i)&&Cl(e,i,t[i]);if(El)for(var i of El(t))Al.call(t,i)&&Cl(e,i,t[i]);return e},Pl=(e,t)=>bl(e,Il(t)),Tl=(e,t,i)=>Cl(e,"symbol"!=typeof t?t+"":t,i);let Ml=class extends Oe{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Tl(this,"events",new g.e.EventEmitter),Tl(this,"name","publisher"),Tl(this,"queue",new Map),Tl(this,"publishTimeout",v.c.toMiliseconds(v.c.ONE_MINUTE)),Tl(this,"initialPublishTimeout",v.c.toMiliseconds(15*v.c.ONE_SECOND)),Tl(this,"needsTransportRestart",!1),Tl(this,"publish",async(e,t,i)=>{var s;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:i}});const n=(null==i?void 0:i.ttl)||ro,r=pr(i),o=(null==i?void 0:i.prompt)||!1,a=(null==i?void 0:i.tag)||0,c=(null==i?void 0:i.id)||(0,v.x)().toString(),l={topic:e,message:t,opts:{ttl:n,relay:r,prompt:o,tag:a,id:c,attestation:null==i?void 0:i.attestation,tvf:null==i?void 0:i.tvf}},h="Failed to publish payload, please try again. id:".concat(c," tag:").concat(a);try{const s=new Promise(async s=>{const r=e=>{let{id:t}=e;l.opts.id===t&&(this.removeRequestFromQueue(t),this.relayer.events.removeListener(go,r),s(l))};this.relayer.events.on(go,r);const h=fi(new Promise((s,r)=>{this.rpcPublish({topic:e,message:t,ttl:n,prompt:o,tag:a,id:c,attestation:null==i?void 0:i.attestation,tvf:null==i?void 0:i.tvf}).then(s).catch(e=>{this.logger.warn(e,null==e?void 0:e.message),r(e)})}),this.initialPublishTimeout,"Failed initial publish, retrying.... id:".concat(c," tag:").concat(a));try{await h,this.events.removeListener(go,r)}catch(d){this.queue.set(c,Pl(Sl({},l),{attempt:1})),this.logger.warn(d,null==d?void 0:d.message)}});this.logger.trace({type:"method",method:"publish",params:{id:c,topic:e,message:t,opts:i}}),await fi(s,this.publishTimeout,h)}catch(d){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(d),null!=(s=null==i?void 0:i.internal)&&s.throwOnFailedPublish)throw d}finally{this.queue.delete(c)}}),Tl(this,"on",(e,t)=>{this.events.on(e,t)}),Tl(this,"once",(e,t)=>{this.events.once(e,t)}),Tl(this,"off",(e,t)=>{this.events.off(e,t)}),Tl(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=(0,v.E)(t,this.name),this.registerEventListeners()}get context(){return(0,v.y)(this.logger)}async rpcPublish(e){var t,i,s,n;const{topic:r,message:o,ttl:a=ro,prompt:c,tag:l,id:h,attestation:d,tvf:u}=e,p={method:gr(pr().protocol).publish,params:Sl({topic:r,message:o,ttl:a,prompt:c,tag:l,attestation:d},u),id:h};_r(null==(t=p.params)?void 0:t.prompt)&&(null==(i=p.params)||delete i.prompt),_r(null==(s=p.params)?void 0:s.tag)&&(null==(n=p.params)||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(go,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,Pl(Sl({},e),{attempt:i}));const{topic:s,message:n,opts:r,attestation:o}=e;this.logger.warn({},"Publisher: queue->publishing: ".concat(e.opts.id,", tag: ").concat(e.opts.tag,", attempt: ").concat(i)),await this.rpcPublish(Pl(Sl({},e),{topic:s,message:n,ttl:r.ttl,prompt:r.prompt,tag:r.tag,id:r.id,attestation:o,tvf:r.tvf})),this.logger.warn({},"Publisher: queue->published: ".concat(e.opts.id))})}registerEventListeners(){this.relayer.core.heartbeat.on(v.r.pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(po);this.checkQueue()}),this.relayer.on(co,e=>{this.removeRequestFromQueue(e.id.toString())})}};var _l=Object.defineProperty,Ol=(e,t,i)=>((e,t,i)=>t in e?_l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let xl=class{constructor(){Ol(this,"map",new Map),Ol(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),Ol(this,"get",e=>this.map.get(e)||[]),Ol(this,"exists",(e,t)=>this.get(e).includes(t)),Ol(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(e=>e!==t);s.length?this.map.set(e,s):this.map.delete(e)}),Ol(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}};var kl=Object.defineProperty,Dl=Object.defineProperties,jl=Object.getOwnPropertyDescriptors,Rl=Object.getOwnPropertySymbols,Ul=Object.prototype.hasOwnProperty,Ll=Object.prototype.propertyIsEnumerable,zl=(e,t,i)=>t in e?kl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ql=(e,t)=>{for(var i in t||(t={}))Ul.call(t,i)&&zl(e,i,t[i]);if(Rl)for(var i of Rl(t))Ll.call(t,i)&&zl(e,i,t[i]);return e},Bl=(e,t)=>Dl(e,jl(t)),Vl=(e,t,i)=>zl(e,"symbol"!=typeof t?t+"":t,i);let Hl=class extends De{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Vl(this,"subscriptions",new Map),Vl(this,"topicMap",new xl),Vl(this,"events",new g.e.EventEmitter),Vl(this,"name","subscription"),Vl(this,"version","0.3"),Vl(this,"pending",new Map),Vl(this,"cached",[]),Vl(this,"initialized",!1),Vl(this,"pendingSubscriptionWatchLabel","pending_sub_watch_label"),Vl(this,"pollingInterval",20),Vl(this,"storagePrefix",eo),Vl(this,"subscribeTimeout",v.c.toMiliseconds(v.c.ONE_MINUTE)),Vl(this,"initialSubscribeTimeout",v.c.toMiliseconds(15*v.c.ONE_SECOND)),Vl(this,"clientId"),Vl(this,"batchSubscribeTopicsLimit",500),Vl(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Vl(this,"subscribe",async(e,t)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const i=pr(t),s={topic:e,relay:i,transportType:null==t?void 0:t.transportType};this.pending.set(e,s);const n=await this.rpcSubscribe(e,i,t);return"string"==typeof n&&(this.onSubscribe(n,s),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),n}catch(i){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(i),i}}),Vl(this,"unsubscribe",async(e,t)=>{this.isInitialized(),typeof(null==t?void 0:t.id)<"u"?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),Vl(this,"isSubscribed",async e=>{if(this.topics.includes(e))return!0;const t="".concat(this.pendingSubscriptionWatchLabel,"_").concat(e);return await new Promise((i,s)=>{const n=new v.c.Watch;n.start(t);const r=setInterval(()=>{(!this.pending.has(e)&&this.topics.includes(e)||this.cached.some(t=>t.topic===e))&&(clearInterval(r),n.stop(t),i(!0)),n.elapsed(t)>=So&&(clearInterval(r),n.stop(t),s(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)}),Vl(this,"on",(e,t)=>{this.events.on(e,t)}),Vl(this,"once",(e,t)=>{this.events.once(e,t)}),Vl(this,"off",(e,t)=>{this.events.off(e,t)}),Vl(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),Vl(this,"start",async()=>{await this.onConnect()}),Vl(this,"stop",async()=>{await this.onDisconnect()}),Vl(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Vl(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),Vl(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(v.r.pulse,async()=>{await this.checkPending()}),this.events.on(Eo,async e=>{const t=Eo;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(No,async e=>{const t=No;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}),this.relayer=e,this.logger=(0,v.E)(t,this.name),this.clientId=""}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch(s){}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async i=>await this.unsubscribeById(e,i,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=pr(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=Pr("USER_DISCONNECTED","".concat(this.name,", ").concat(e));await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s;(!i||(null==i?void 0:i.transportType)===bo.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:gr(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const r=null==(s=null==i?void 0:i.internal)?void 0:s.throwOnFailedPublish;try{const t=await this.getSubscriptionId(e);if((null==i?void 0:i.transportType)===bo.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(e=>this.logger.warn(e))},v.c.toMiliseconds(v.c.ONE_SECOND)),t;const s=new Promise(async t=>{const i=s=>{s.topic===e&&(this.events.removeListener(Eo,i),t(s.id))};this.events.on(Eo,i);try{const s=await fi(new Promise((e,t)=>{this.relayer.request(n).catch(e=>{this.logger.warn(e,null==e?void 0:e.message),t(e)}).then(e)}),this.initialSubscribeTimeout,"Subscribing to ".concat(e," failed, please try again"));this.events.removeListener(Eo,i),t(s)}catch(s){}}),o=await fi(s,this.subscribeTimeout,"Subscribing to ".concat(e," failed, please try again"));if(!o&&r)throw new Error("Subscribing to ".concat(e," failed, please try again"));return o?t:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(po),r)throw o}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t={method:gr(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{await await fi(new Promise(e=>{this.relayer.request(t).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch(i){this.relayer.events.emit(po)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t={method:gr(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};let i;this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{i=await await fi(new Promise((e,i)=>{this.relayer.request(t).catch(e=>{this.logger.warn(e),i(e)}).then(e)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch(s){this.relayer.events.emit(po)}return i}rpcUnsubscribe(e,t,i){const s={method:gr(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,Bl(ql({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,ql({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,ql({},t)),this.topicMap.set(t.topic,e),this.events.emit(Eo,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:t}=Sr("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw new Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(No,Bl(ql({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ao)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit(Co)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:e}=Sr("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error("".concat(this.name,": ").concat(JSON.stringify(this.values))),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored subscriptions for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug("Failed to Restore subscriptions for ".concat(this.name)),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>Bl(ql({},e),{id:await this.getSubscriptionId(e.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace("Fetching batch messages for ".concat(e.length," subscriptions"));const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await function(e){return new Promise(t=>setTimeout(t,e))}(v.c.toMiliseconds(v.c.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return nr(e+await this.getClientId())}};var Kl=Object.defineProperty,Wl=Object.getOwnPropertySymbols,Fl=Object.prototype.hasOwnProperty,Gl=Object.prototype.propertyIsEnumerable,Yl=(e,t,i)=>t in e?Kl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ql=(e,t)=>{for(var i in t||(t={}))Fl.call(t,i)&&Yl(e,i,t[i]);if(Wl)for(var i of Wl(t))Gl.call(t,i)&&Yl(e,i,t[i]);return e},Zl=(e,t,i)=>Yl(e,"symbol"!=typeof t?t+"":t,i);let Jl=class extends xe{constructor(e){super(e),Zl(this,"protocol","wc"),Zl(this,"version",2),Zl(this,"core"),Zl(this,"logger"),Zl(this,"events",new g.e.EventEmitter),Zl(this,"provider"),Zl(this,"messages"),Zl(this,"subscriber"),Zl(this,"publisher"),Zl(this,"name","relayer"),Zl(this,"transportExplicitlyClosed",!1),Zl(this,"initialized",!1),Zl(this,"connectionAttemptInProgress",!1),Zl(this,"relayUrl"),Zl(this,"projectId"),Zl(this,"packageName"),Zl(this,"bundleId"),Zl(this,"hasExperiencedNetworkDisruption",!1),Zl(this,"pingTimeout"),Zl(this,"heartBeatTimeout",v.c.toMiliseconds(v.c.THIRTY_SECONDS+v.c.FIVE_SECONDS)),Zl(this,"reconnectTimeout"),Zl(this,"connectPromise"),Zl(this,"reconnectInProgress",!1),Zl(this,"requestsInFlight",[]),Zl(this,"connectTimeout",v.c.toMiliseconds(15*v.c.ONE_SECOND)),Zl(this,"request",async e=>{var t,i;this.logger.debug("Publishing Request Payload");const s=e.id||(0,v.x)().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");const n="".concat(s,":").concat((null==(i=e.params)?void 0:i.tag)||"");this.requestsInFlight.push(n);const r=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==n),r}catch(n){throw this.logger.debug("Failed to Publish Request: ".concat(s)),n}}),Zl(this,"resetPingTimeout",()=>{if(si())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t,i;this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)||i.terminate()},this.heartBeatTimeout)}catch(e){this.logger.warn(e,null==e?void 0:e.message)}}),Zl(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),Zl(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \ud83d\udedc"),this.startPingTimeout(),this.events.emit(lo)}),Zl(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \ud83d\uded1"),this.requestsInFlight=[],this.onProviderDisconnect()}),Zl(this,"onProviderErrorHandler",e=>{this.logger.fatal("Fatal socket error: ".concat(e.message)),this.events.emit(uo,e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Zl(this,"registerProviderListeners",()=>{this.provider.on(fo,this.onPayloadHandler),this.provider.on(wo,this.onConnectHandler),this.provider.on(mo,this.onDisconnectHandler),this.provider.on(yo,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,v.E)(e.logger,this.name):(0,v.O)((0,v.k)({level:e.logger||"error"})),this.messages=new yl(this.logger,e.core),this.subscriber=new Hl(this,this.logger),this.publisher=new Ml(this,this.logger),this.relayUrl=(null==e?void 0:e.relayUrl)||oo,this.projectId=e.projectId,ni()&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Platform)<"u"&&"android"===(null==p.d.global?void 0:p.d.global.Platform.OS)?this.packageName=ai():ni()&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Platform)<"u"&&"ios"===(null==p.d.global?void 0:p.d.global.Platform.OS)&&(this.bundleId=ai()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,null==e?void 0:e.message)}}get context(){return(0,v.y)(this.logger)}get connected(){var e,t,i;return 1===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||!1}get connecting(){var e,t,i;return 0===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||void 0!==this.connectPromise||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:bo.relay})}async subscribe(e,t){var i,s,n;this.isInitialized(),(null==t||!t.transportType||"relay"===(null==t?void 0:t.transportType))&&await this.toEstablishConnection();const r=typeof(null==(i=null==t?void 0:t.internal)?void 0:i.throwOnFailedPublish)>"u"||(null==(s=null==t?void 0:t.internal)?void 0:s.throwOnFailedPublish);let o,a=(null==(n=this.subscriber.topicMap.get(e))?void 0:n[0])||"";const c=t=>{t.topic===e&&(this.subscriber.off(Eo,c),o())};return await Promise.all([new Promise(e=>{o=e,this.subscriber.on(Eo,c)}),new Promise(async(i,s)=>{a=await this.subscriber.subscribe(e,Ql({internal:{throwOnFailedPublish:r}},t)).catch(e=>{r&&s(e)})||a,i()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await fi(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(this.subscriber.hasAnyTopics){if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error("Couldn't establish socket connection to the relay server: ".concat(this.relayUrl))}else this.logger.warn("Starting WS connection skipped because the client has no topics to work with.")}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Fr())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(0===(null==e?void 0:e.length))return void this.logger.trace("Batch message events is empty. Ignoring...");const t=e.sort((e,t)=>e.publishedAt-t.publishedAt);this.logger.debug("Batch of ".concat(t.length," message events sorted"));for(const s of t)try{await this.onMessageEvent(s)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(null==i?void 0:i.message))}this.logger.trace("Batch of ".concat(t.length," message events processed"))}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const e={topic:i,expiry:yi(v.c.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,e)}this.events.emit(ao,e),await this.recordMessageEvent(e)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},"Connecting to ".concat(this.relayUrl,", attempt: ").concat(t,"...")),await this.createProvider(),await new Promise(async(e,t)=>{const i=()=>{t(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(mo,i),await fi(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,"Socket stalled when trying to connect to ".concat(this.relayUrl)).catch(e=>{t(e)}).finally(()=>{this.provider.off(mo,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,t)=>{const i=()=>{t(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(mo,i),await this.subscriber.start().then(e).catch(t).finally(()=>{this.provider.off(mo,i)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(i){await this.subscriber.stop();const e=i;this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},"Connected to ".concat(this.relayUrl," successfully on attempt: ").concat(t));break}await new Promise(e=>setTimeout(e,v.c.toMiliseconds(1*t))),t++}}startPingTimeout(){var e,t,i,s,n;if(si())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(n=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(r){this.logger.warn(r,null==r?void 0:r.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new v.o(new v.m(hi({sdkVersion:vo,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||0===i.length)return this.logger.warn("Ignoring invalid/empty message: ".concat(i)),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.warn("Ignoring message for non-subscribed topic ".concat(t)),!0;const s=this.messages.has(t,i);return s&&this.logger.warn("Ignoring duplicate message: ".concat(i)),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,v.n)(e)){if(!e.method.endsWith("_subscription"))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:r}=t.data,o={topic:i,message:s,publishedAt:n,transportType:bo.relay,attestation:r};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Ql({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else(0,v.p)(e)&&this.events.emit(co,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(ao,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=(0,v.q)(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(fo,this.onPayloadHandler),this.provider.off(wo,this.onConnectHandler),this.provider.off(mo,this.onDisconnectHandler),this.provider.off(yo,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Fr();Gr(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(e=>this.logger.error(e,null==e?void 0:e.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ho),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,null==e?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},v.c.toMiliseconds(.1)))))}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}};var Xl=Object.defineProperty,$l=Object.getOwnPropertySymbols,eh=Object.prototype.hasOwnProperty,th=Object.prototype.propertyIsEnumerable,ih=(e,t,i)=>t in e?Xl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,sh=(e,t)=>{for(var i in t||(t={}))eh.call(t,i)&&ih(e,i,t[i]);if($l)for(var i of $l(t))th.call(t,i)&&ih(e,i,t[i]);return e},nh=(e,t,i)=>ih(e,"symbol"!=typeof t?t+"":t,i);let rh=class extends ke{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:eo,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;super(e,t,i,s),this.core=e,this.logger=t,this.name=i,nh(this,"map",new Map),nh(this,"version","0.3"),nh(this,"cached",[]),nh(this,"initialized",!1),nh(this,"getKey"),nh(this,"storagePrefix",eo),nh(this,"recentlyDeleted",[]),nh(this,"recentlyDeletedLimit",200),nh(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>{this.getKey&&null!==e&&!_r(e)?this.map.set(this.getKey(e),e):function(e){var t;return null==(t=null==e?void 0:e.proposer)?void 0:t.publicKey}(e)?this.map.set(e.id,e):function(e){return null==e?void 0:e.topic}(e)&&this.map.set(e.topic,e)}),this.cached=[],this.initialized=!0)}),nh(this,"set",async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())}),nh(this,"get",e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e))),nh(this,"getAll",e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(i=>Xr(t[i],e[i]))):this.values)),nh(this,"update",async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});const i=sh(sh({},this.getData(e)),t);this.map.set(e,i),await this.persist()}),nh(this,"delete",async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=(0,v.E)(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:t}=Sr("MISSING_OR_INVALID","Record was recently deleted - ".concat(this.name,": ").concat(e));throw this.logger.error(t),new Error(t)}const{message:t}=Sr("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw this.logger.error(t),new Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:e}=Sr("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored value for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug("Failed to Restore value for ".concat(this.name)),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}};var oh=Object.defineProperty,ah=(e,t,i)=>((e,t,i)=>t in e?oh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let ch=class{constructor(e,t){this.core=e,this.logger=t,ah(this,"name","pairing"),ah(this,"version","0.3"),ah(this,"events",new g.E),ah(this,"pairings"),ah(this,"initialized",!1),ah(this,"storagePrefix",eo),ah(this,"ignoredPayloadTypes",[1]),ah(this,"registeredMethods",[]),ah(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ah(this,"register",e=>{let{methods:t}=e;this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...t])]}),ah(this,"create",async e=>{this.isInitialized();const t=ir(),i=await this.core.crypto.setSymKey(t),s=yi(v.c.FIVE_MINUTES),n={protocol:"irn"},r={topic:i,expiry:s,relay:n,active:!1,methods:null==e?void 0:e.methods},o=yr({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:t,relay:n,expiryTimestamp:s,methods:null==e?void 0:e.methods});return this.events.emit(To,r),this.core.expirer.set(i,s),await this.pairings.set(i,r),await this.core.relayer.subscribe(i,{transportType:null==e?void 0:e.transportType}),{topic:i,uri:o}}),ah(this,"pair",async e=>{this.isInitialized();const t=this.core.eventClient.createEvent({properties:{topic:null==e?void 0:e.uri,trace:[Ko]}});this.isValidPair(e,t);const{topic:i,symKey:s,relay:n,expiryTimestamp:r,methods:o}=wr(e.uri);let a;if(t.props.properties.topic=i,t.addTrace(Wo),t.addTrace(Fo),this.pairings.keys.includes(i)){if(a=this.pairings.get(i),t.addTrace(Zo),a.active)throw t.setError(ia),new Error("Pairing already exists: ".concat(i,". Please try again with a new connection URI."));t.addTrace(Jo)}const c=r||yi(v.c.FIVE_MINUTES),l={topic:i,relay:n,expiry:c,active:!1,methods:o};this.core.expirer.set(i,c),await this.pairings.set(i,l),t.addTrace(Go),e.activatePairing&&await this.activate({topic:i}),this.events.emit(To,l),t.addTrace(Xo),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(s,i),t.addTrace(Yo);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch(h){t.setError(ea)}try{await this.core.relayer.subscribe(i,{relay:n})}catch(d){throw t.setError(sa),d}return t.addTrace(Qo),l}),ah(this,"activate",async e=>{let{topic:t}=e;this.isInitialized();const i=yi(v.c.FIVE_MINUTES);this.core.expirer.set(t,i),await this.pairings.update(t,{active:!0,expiry:i})}),ah(this,"ping",async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:t}=e;if(this.pairings.keys.includes(t)){const e=await this.sendRequest(t,"wc_pairingPing",{}),{done:i,resolve:s,reject:n}=gi();this.events.once(bi("pairing_ping",e),e=>{let{error:t}=e;t?n(t):s()}),await i()}}),ah(this,"updateExpiry",async e=>{let{topic:t,expiry:i}=e;this.isInitialized(),await this.pairings.update(t,{expiry:i})}),ah(this,"updateMetadata",async e=>{let{topic:t,metadata:i}=e;this.isInitialized(),await this.pairings.update(t,{peerMetadata:i})}),ah(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ah(this,"disconnect",async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",Pr("USER_DISCONNECTED")),await this.deletePairing(t))}),ah(this,"formatUriFromPairing",e=>{this.isInitialized();const{topic:t,relay:i,expiry:s,methods:n}=e,r=this.core.crypto.keychain.get(t);return yr({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:r,relay:i,expiryTimestamp:s,methods:n})}),ah(this,"sendRequest",async(e,t,i)=>{const s=(0,v.l)(t,i),n=await this.core.crypto.encode(e,s),r=Po[t].req;return this.core.history.set(e,s),this.core.relayer.publish(e,n,r),s.id}),ah(this,"sendResult",async(e,t,i)=>{const s=(0,v.q)(e,i),n=await this.core.crypto.encode(t,s),r=(await this.core.history.get(t,e)).request.method,o=Po[r].res;await this.core.relayer.publish(t,n,o),await this.core.history.resolve(s)}),ah(this,"sendError",async(e,t,i)=>{const s=(0,v.z)(e,i),n=await this.core.crypto.encode(t,s),r=(await this.core.history.get(t,e)).request.method,o=Po[r]?Po[r].res:Po.unregistered_method.res;await this.core.relayer.publish(t,n,o),await this.core.history.resolve(s)}),ah(this,"deletePairing",async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,Pr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),ah(this,"cleanup",async()=>{const e=this.pairings.getAll().filter(e=>vi(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),ah(this,"onRelayEventRequest",e=>{const{topic:t,payload:i}=e;switch(i.method){case"wc_pairingPing":return this.onPairingPingRequest(t,i);case"wc_pairingDelete":return this.onPairingDeleteRequest(t,i);default:return this.onUnknownRpcMethodRequest(t,i)}}),ah(this,"onRelayEventResponse",async e=>{const{topic:t,payload:i}=e,s=(await this.core.history.get(t,i.id)).request.method;return"wc_pairingPing"===s?this.onPairingPingResponse(t,i):this.onUnknownRpcMethodResponse(s)}),ah(this,"onPairingPingRequest",async(e,t)=>{const{id:i}=t;try{this.isValidPing({topic:e}),await this.sendResult(i,e,!0),this.events.emit(Oo,{id:i,topic:e})}catch(s){await this.sendError(i,e,s),this.logger.error(s)}}),ah(this,"onPairingPingResponse",(e,t)=>{const{id:i}=t;setTimeout(()=>{(0,v.B)(t)?this.events.emit(bi("pairing_ping",i),{}):(0,v.D)(t)&&this.events.emit(bi("pairing_ping",i),{error:t.error})},500)}),ah(this,"onPairingDeleteRequest",async(e,t)=>{const{id:i}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(_o,{id:i,topic:e})}catch(s){await this.sendError(i,e,s),this.logger.error(s)}}),ah(this,"onUnknownRpcMethodRequest",async(e,t)=>{const{id:i,method:s}=t;try{if(this.registeredMethods.includes(s))return;const t=Pr("WC_METHOD_UNSUPPORTED",s);await this.sendError(i,e,t),this.logger.error(t)}catch(n){await this.sendError(i,e,n),this.logger.error(n)}}),ah(this,"onUnknownRpcMethodResponse",e=>{this.registeredMethods.includes(e)||this.logger.error(Pr("WC_METHOD_UNSUPPORTED",e))}),ah(this,"isValidPair",(e,t)=>{var i;if(!qr(e)){const{message:i}=Sr("MISSING_OR_INVALID","pair() params: ".concat(e));throw t.setError(ta),new Error(i)}if(!function(e){function t(e){try{return typeof new URL(e)<"u"}catch(t){return!1}}try{if(Or(e,!1))return!!t(e)||t(Si(e))}catch(i){}return!1}(e.uri)){const{message:i}=Sr("MISSING_OR_INVALID","pair() uri: ".concat(e.uri));throw t.setError(ta),new Error(i)}const s=wr(null==e?void 0:e.uri);if(null==(i=null==s?void 0:s.relay)||!i.protocol){const{message:e}=Sr("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(ta),new Error(e)}if(null==s||!s.symKey){const{message:e}=Sr("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(ta),new Error(e)}if(null!=s&&s.expiryTimestamp&&v.c.toMiliseconds(null==s?void 0:s.expiryTimestamp)<Date.now()){t.setError(na);const{message:e}=Sr("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(e)}}),ah(this,"isValidPing",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","ping() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)}),ah(this,"isValidDisconnect",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","disconnect() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)}),ah(this,"isValidPairingTopic",async e=>{if(!Or(e,!1)){const{message:t}=Sr("MISSING_OR_INVALID","pairing topic should be a string: ".concat(e));throw new Error(t)}if(!this.pairings.keys.includes(e)){const{message:t}=Sr("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(e));throw new Error(t)}if(vi(this.pairings.get(e).expiry)){await this.deletePairing(e);const{message:t}=Sr("EXPIRED","pairing topic: ".concat(e));throw new Error(t)}}),this.core=e,this.logger=(0,v.E)(t,this.name),this.pairings=new rh(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,v.y)(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ao,async e=>{const{topic:t,message:i,transportType:s}=e;if(!this.pairings.keys.includes(t)||s===bo.link_mode||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(t,i);try{(0,v.n)(n)?(this.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):(0,v.p)(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id))}catch(r){this.logger.error(r)}})}registerExpirerEvents(){this.core.expirer.on(Lo,async e=>{const{topic:t}=mi(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Mo,{topic:t}))})}};var lh=Object.defineProperty,hh=(e,t,i)=>((e,t,i)=>t in e?lh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let dh=class extends Me{constructor(e,t){super(e,t),this.core=e,this.logger=t,hh(this,"records",new Map),hh(this,"events",new g.e.EventEmitter),hh(this,"name","history"),hh(this,"version","0.3"),hh(this,"cached",[]),hh(this,"initialized",!1),hh(this,"storagePrefix",eo),hh(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),hh(this,"set",(e,t,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:i}),this.records.has(t.id))return;const s={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:i,expiry:yi(v.c.THIRTY_DAYS)};this.records.set(s.id,s),this.persist(),this.events.emit(xo,s)}),hh(this,"resolve",async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=(0,v.D)(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(ko,t))}),hh(this,"get",async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t))),hh(this,"delete",(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(i=>{if(i.topic===e){if(typeof t<"u"&&i.id!==t)return;this.records.delete(i.id),this.events.emit(Do,i)}}),this.persist()}),hh(this,"exists",async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e)),hh(this,"on",(e,t)=>{this.events.on(e,t)}),hh(this,"once",(e,t)=>{this.events.once(e,t)}),hh(this,"off",(e,t)=>{this.events.off(e,t)}),hh(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=(0,v.E)(t,this.name)}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:(0,v.l)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:t}=Sr("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw new Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(jo)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:e}=Sr("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e)}}registerEventListeners(){this.events.on(xo,e=>{const t=xo;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(ko,e=>{const t=ko;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Do,e=>{const t=Do;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(v.r.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{v.c.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info("Deleting expired history log: ".concat(t.id)),this.records.delete(t.id),this.events.emit(Do,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}};var uh=Object.defineProperty,ph=(e,t,i)=>((e,t,i)=>t in e?uh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let gh=class extends je{constructor(e,t){super(e,t),this.core=e,this.logger=t,ph(this,"expirations",new Map),ph(this,"events",new g.e.EventEmitter),ph(this,"name","expirer"),ph(this,"version","0.3"),ph(this,"cached",[]),ph(this,"initialized",!1),ph(this,"storagePrefix",eo),ph(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ph(this,"has",e=>{try{const t=this.formatTarget(e);return typeof this.getExpiration(t)<"u"}catch(t){return!1}}),ph(this,"set",(e,t)=>{this.isInitialized();const i=this.formatTarget(e),s={target:i,expiry:t};this.expirations.set(i,s),this.checkExpiry(i,s),this.events.emit(Ro,{target:i,expiration:s})}),ph(this,"get",e=>{this.isInitialized();const t=this.formatTarget(e);return this.getExpiration(t)}),ph(this,"del",e=>{if(this.isInitialized(),this.has(e)){const t=this.formatTarget(e),i=this.getExpiration(t);this.expirations.delete(t),this.events.emit(Uo,{target:t,expiration:i})}}),ph(this,"on",(e,t)=>{this.events.on(e,t)}),ph(this,"once",(e,t)=>{this.events.once(e,t)}),ph(this,"off",(e,t)=>{this.events.off(e,t)}),ph(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=(0,v.E)(t,this.name)}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return function(e){return wi("topic",e)}(e);if("number"==typeof e)return function(e){return wi("id",e)}(e);const{message:t}=Sr("UNKNOWN_TYPE","Target type: ".concat(typeof e));throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(zo)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:e}=Sr("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored expirations for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug("Failed to Restore expirations for ".concat(this.name)),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:t}=Sr("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw this.logger.warn(t),new Error(t)}return t}checkExpiry(e,t){const{expiry:i}=t;v.c.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Lo,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(v.r.pulse,()=>this.checkExpirations()),this.events.on(Ro,e=>{const t=Ro;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Lo,e=>{const t=Lo;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Uo,e=>{const t=Uo;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}};var fh=Object.defineProperty,wh=(e,t,i)=>((e,t,i)=>t in e?fh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let mh=class extends Re{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,wh(this,"name","verify-api"),wh(this,"abortController"),wh(this,"isDevEnv"),wh(this,"verifyUrlV3",Vo),wh(this,"storagePrefix",eo),wh(this,"version",2),wh(this,"publicKey"),wh(this,"fetchPromise"),wh(this,"init",async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&v.c.toMiliseconds(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),wh(this,"register",async e=>{if(!ri()||this.isDevEnv)return;const t=window.location.origin,{id:i,decryptedId:s}=e,n="".concat(this.verifyUrlV3,"/attestation?projectId=").concat(this.core.projectId,"&origin=").concat(t,"&id=").concat(i,"&decryptedId=").concat(s);try{const e=(0,v.a)(),t=this.startAbortTimer(5*v.c.ONE_SECOND),s=await new Promise((s,r)=>{const o=()=>{window.removeEventListener("message",c),e.body.removeChild(a),r("attestation aborted")};this.abortController.signal.addEventListener("abort",o);const a=e.createElement("iframe");a.src=n,a.style.display="none",a.addEventListener("error",o,{signal:this.abortController.signal});const c=n=>{if(n.data&&"string"==typeof n.data)try{const r=JSON.parse(n.data);if("verify_attestation"===r.type){if((0,v.s)(r.attestation).payload.id!==i)return;clearInterval(t),e.body.removeChild(a),this.abortController.signal.removeEventListener("abort",o),window.removeEventListener("message",c),s(null===r.attestation?"":r.attestation)}}catch(r){this.logger.warn(r)}};e.body.appendChild(a),window.addEventListener("message",c,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",s),s}catch(r){this.logger.warn(r)}return""}),wh(this,"resolve",async e=>{if(this.isDevEnv)return"";const{attestationId:t,hash:i,encryptedId:s}=e;if(""===t)return void this.logger.debug("resolve: attestationId is empty, skipping");if(t){if((0,v.s)(t).payload.id!==s)return;const e=await this.isValidJwtAttestation(t);if(e)return e.isVerified?e:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!i)return;const n=this.getVerifyUrl(null==e?void 0:e.verifyUrl);return this.fetchAttestation(i,n)}),wh(this,"fetchAttestation",async(e,t)=>{this.logger.debug("resolving attestation: ".concat(e," from url: ").concat(t));const i=this.startAbortTimer(5*v.c.ONE_SECOND),s=await fetch("".concat(t,"/attestation/").concat(e,"?v2Supported=true"),{signal:this.abortController.signal});return clearTimeout(i),200===s.status?await s.json():void 0}),wh(this,"getVerifyUrl",e=>{let t=e||Bo;return Ho.includes(t)||(this.logger.info("verify url: ".concat(t,", not included in trusted list, assigning default: ").concat(Bo)),t=Bo),t}),wh(this,"fetchPublicKey",async()=>{try{this.logger.debug("fetching public key from: ".concat(this.verifyUrlV3));const e=this.startAbortTimer(v.c.FIVE_SECONDS),t=await fetch("".concat(this.verifyUrlV3,"/public-key"),{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),wh(this,"persistPublicKey",async e=>{this.logger.debug("persisting public key to local storage",e),await this.store.setItem(this.storeKey,e),this.publicKey=e}),wh(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),wh(this,"isValidJwtAttestation",async e=>{const t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(s){this.logger.error(s),this.logger.warn("error validating attestation")}const i=await this.fetchAndPersistPublicKey();try{if(i)return this.validateAttestation(e,i)}catch(s){this.logger.error(s),this.logger.warn("error validating attestation")}}),wh(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),wh(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{const t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});const e=await this.fetchPromise;return this.fetchPromise=void 0,e}),wh(this,"validateAttestation",(e,t)=>{const i=ur(e,t.publicKey),s={hasExpired:v.c.toMiliseconds(i.exp)<Date.now(),payload:i};if(s.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:s.payload.origin,isScam:s.payload.isScam,isVerified:s.payload.isVerified}}),this.logger=(0,v.E)(t,this.name),this.abortController=new AbortController,this.isDevEnv=Ci(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,v.y)(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),v.c.toMiliseconds(e))}};var yh=Object.defineProperty,vh=(e,t,i)=>((e,t,i)=>t in e?yh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let bh=class extends Ue{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,vh(this,"context","echo"),vh(this,"registerDeviceToken",async e=>{const{clientId:t,token:i,notificationType:s,enableEncrypted:n=!1}=e,r="".concat("https://echo.walletconnect.com","/").concat(this.projectId,"/clients");await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:s,token:i,always_raw:n})})}),this.logger=(0,v.E)(t,this.context)}};var Ih=Object.defineProperty,Eh=Object.getOwnPropertySymbols,Nh=Object.prototype.hasOwnProperty,Ah=Object.prototype.propertyIsEnumerable,Ch=(e,t,i)=>t in e?Ih(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Sh=(e,t)=>{for(var i in t||(t={}))Nh.call(t,i)&&Ch(e,i,t[i]);if(Eh)for(var i of Eh(t))Ah.call(t,i)&&Ch(e,i,t[i]);return e},Ph=(e,t,i)=>Ch(e,"symbol"!=typeof t?t+"":t,i);let Th=class extends Le{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,t,i),this.core=e,this.logger=t,Ph(this,"context","event-client"),Ph(this,"storagePrefix",eo),Ph(this,"storageVersion",.1),Ph(this,"events",new Map),Ph(this,"shouldPersist",!1),Ph(this,"init",async()=>{if(!Ci())try{const e={eventId:Ai(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:li(this.core.relayer.protocol,this.core.relayer.version,vo)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),Ph(this,"createEvent",e=>{const{event:t="ERROR",type:i="",properties:{topic:s,trace:n}}=e,r=Ai(),o=this.core.projectId||"",a=Date.now(),c=Sh({eventId:r,timestamp:a,props:{event:t,type:i,properties:{topic:s,trace:n}},bundleId:o,domain:this.getAppDomain()},this.setMethods(r));return this.telemetryEnabled&&(this.events.set(r,c),this.shouldPersist=!0),c}),Ph(this,"getEvent",e=>{const{eventId:t,topic:i}=e;if(t)return this.events.get(t);const s=Array.from(this.events.values()).find(e=>e.props.properties.topic===i);return s?Sh(Sh({},s),this.setMethods(s.eventId)):void 0}),Ph(this,"deleteEvent",e=>{const{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),Ph(this,"setEventListeners",()=>{this.core.heartbeat.on(v.r.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{v.c.fromMiliseconds(Date.now())-v.c.fromMiliseconds(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),Ph(this,"setMethods",e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),Ph(this,"addTrace",(e,t)=>{const i=this.events.get(e);i&&(i.props.properties.trace.push(t),this.events.set(e,i),this.shouldPersist=!0)}),Ph(this,"setError",(e,t)=>{const i=this.events.get(e);i&&(i.props.type=t,i.timestamp=Date.now(),this.events.set(e,i),this.shouldPersist=!0)}),Ph(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ph(this,"restore",async()=>{try{const e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,Sh(Sh({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),Ph(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;const e=[];for(const[i,s]of this.events)s.props.type&&e.push(s);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(const t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(t){this.logger.warn(t)}}),Ph(this,"sendEvent",async e=>{const t=this.getAppDomain()?"":"&sp=desktop";return await fetch("".concat("https://pulse.walletconnect.org/batch","?projectId=").concat(this.core.projectId,"&st=events_sdk&sv=js-").concat(vo).concat(t),{method:"POST",body:JSON.stringify(e)})}),Ph(this,"getAppDomain",()=>ci().url),this.logger=(0,v.E)(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}};var Mh=Object.defineProperty,_h=Object.getOwnPropertySymbols,Oh=Object.prototype.hasOwnProperty,xh=Object.prototype.propertyIsEnumerable,kh=(e,t,i)=>t in e?Mh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Dh=(e,t)=>{for(var i in t||(t={}))Oh.call(t,i)&&kh(e,i,t[i]);if(_h)for(var i of _h(t))xh.call(t,i)&&kh(e,i,t[i]);return e},jh=(e,t,i)=>kh(e,"symbol"!=typeof t?t+"":t,i);const Rh=class e extends Se{constructor(e){var t;super(e),jh(this,"protocol","wc"),jh(this,"version",2),jh(this,"name",$r),jh(this,"relayUrl"),jh(this,"projectId"),jh(this,"customStoragePrefix"),jh(this,"events",new g.e.EventEmitter),jh(this,"logger"),jh(this,"heartbeat"),jh(this,"relayer"),jh(this,"crypto"),jh(this,"storage"),jh(this,"history"),jh(this,"expirer"),jh(this,"pairing"),jh(this,"verify"),jh(this,"echoClient"),jh(this,"linkModeSupportedApps"),jh(this,"eventClient"),jh(this,"initialized",!1),jh(this,"logChunkController"),jh(this,"on",(e,t)=>this.events.on(e,t)),jh(this,"once",(e,t)=>this.events.once(e,t)),jh(this,"off",(e,t)=>this.events.off(e,t)),jh(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),jh(this,"dispatchEnvelope",e=>{let{topic:t,message:i,sessionExists:s}=e;if(!t||!i)return;const n={topic:t,message:i,publishedAt:Date.now(),transportType:bo.link_mode};this.relayer.onLinkMessageEvent(n,{sessionExists:s})}),this.projectId=null==e?void 0:e.projectId,this.relayUrl=(null==e?void 0:e.relayUrl)||oo,this.customStoragePrefix=null!=e&&e.customStoragePrefix?":".concat(e.customStoragePrefix):"";const i=(0,v.k)({level:"string"==typeof(null==e?void 0:e.logger)&&e.logger?e.logger:to,name:$r}),{logger:s,chunkLoggerController:n}=(0,v.A)({opts:i,maxSizeInBytes:null==e?void 0:e.maxLogBlobSizeInBytes,loggerOverride:null==e?void 0:e.logger});this.logChunkController=n,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,v.E)(s,this.name),this.heartbeat=new v.i,this.crypto=new fl(this,this.logger,null==e?void 0:e.keychain),this.history=new dh(this,this.logger),this.expirer=new gh(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new v.j(Dh(Dh({},io),null==e?void 0:e.storageOptions)),this.relayer=new Jl({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new ch(this,this.logger),this.verify=new mh(this,this.logger,this.storage),this.echoClient=new bh(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Th(this,this.logger,null==e?void 0:e.telemetryEnabled)}static async init(t){const i=new e(t);await i.initialize();const s=await i.crypto.getClientId();return await i.storage.setItem("WALLETCONNECT_CLIENT_ID",s),i}get context(){return(0,v.y)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Io,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Io)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn("Core Initialization Failure at epoch ".concat(Date.now()),e),this.logger.error(e.message),e}}};var Uh=Object.defineProperty,Lh=(e,t,i)=>((e,t,i)=>t in e?Uh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let zh=class{constructor(e){this.opts=e,Lh(this,"protocol","wc"),Lh(this,"version",2)}},qh=class{constructor(e){this.client=e}};const Bh="client",Vh="".concat("wc","@").concat(2,":").concat(Bh,":"),Hh=Bh,Kh="error",Wh="WALLETCONNECT_DEEPLINK_CHOICE",Fh="Proposal expired",Gh=v.c.SEVEN_DAYS,Yh={wc_sessionPropose:{req:{ttl:v.c.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1104},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1106},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:v.c.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:v.c.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1112},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1114},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:v.c.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:v.c.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1119}}},Qh={min:v.c.FIVE_MINUTES,max:v.c.SEVEN_DAYS},Zh="IDLE",Jh="ACTIVE",Xh={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},$h=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],ed="".concat("wc","@",1.5,":").concat("auth",":"),td="".concat(ed,":PUB_KEY");var id=Object.defineProperty,sd=Object.defineProperties,nd=Object.getOwnPropertyDescriptors,rd=Object.getOwnPropertySymbols,od=Object.prototype.hasOwnProperty,ad=Object.prototype.propertyIsEnumerable,cd=(e,t,i)=>t in e?id(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ld=(e,t)=>{for(var i in t||(t={}))od.call(t,i)&&cd(e,i,t[i]);if(rd)for(var i of rd(t))ad.call(t,i)&&cd(e,i,t[i]);return e},hd=(e,t)=>sd(e,nd(t)),dd=(e,t,i)=>cd(e,"symbol"!=typeof t?t+"":t,i);let ud=class extends qh{constructor(e){var t;super(e),t=this,dd(this,"name","engine"),dd(this,"events",new g.E),dd(this,"initialized",!1),dd(this,"requestQueue",{state:Zh,queue:[]}),dd(this,"sessionRequestQueue",{state:Zh,queue:[]}),dd(this,"requestQueueDelay",v.c.ONE_SECOND),dd(this,"expectedPairingMethodMap",new Map),dd(this,"recentlyDeletedMap",new Map),dd(this,"recentlyDeletedLimit",200),dd(this,"relayMessageCache",[]),dd(this,"pendingSessions",new Map),dd(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Yh)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},v.c.toMiliseconds(this.requestQueueDelay)))}),dd(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const t=hd(ld({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t);const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:r,relays:o}=t;let a,c=i,l=!1;try{if(c){const e=this.client.core.pairing.pairings.get(c);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),l=e.active}}catch(b){throw this.client.logger.error("connect() -> pairing.get(".concat(c,") failed")),b}if(!c||!l){const{topic:e,uri:t}=await this.client.core.pairing.create();c=e,a=t}if(!c){const{message:e}=Sr("NO_MATCHING_KEY","connect() pairing topic: ".concat(c));throw new Error(e)}const h=await this.client.core.crypto.generateKeyPair(),d=Yh.wc_sessionPropose.req.ttl||v.c.FIVE_MINUTES,u=yi(d),p=hd(ld({requiredNamespaces:s,optionalNamespaces:n,relays:null!==o&&void 0!==o?o:[{protocol:"irn"}],proposer:{publicKey:h,metadata:this.client.metadata},expiryTimestamp:u,pairingTopic:c},r&&{sessionProperties:r}),{id:(0,v.F)()}),g=bi("session_connect",p.id),{reject:f,resolve:w,done:m}=gi(d,Fh),y=e=>{let{id:t}=e;t===p.id&&(this.client.events.off("proposal_expire",y),this.pendingSessions.delete(p.id),this.events.emit(g,{error:{message:Fh,code:0}}))};return this.client.events.on("proposal_expire",y),this.events.once(g,e=>{let{error:t,session:i}=e;this.client.events.off("proposal_expire",y),t?f(t):i&&w(i)}),await this.sendRequest({topic:c,method:"wc_sessionPropose",params:p,throwOnFailedPublish:!0,clientRpcId:p.id}),await this.setProposal(p.id,p),{uri:a,approval:m}}),dd(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(t){throw this.client.logger.error("pair() failed"),t}}),dd(this,"approve",async e=>{var t,i,s;const n=this.client.core.eventClient.createEvent({properties:{topic:null==(t=null==e?void 0:e.id)?void 0:t.toString(),trace:[oa]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(E){throw n.setError(fa),E}try{await this.isValidProposalId(null==e?void 0:e.id)}catch(E){throw this.client.logger.error("approve() -> proposal.get(".concat(null==e?void 0:e.id,") failed")),n.setError(Ia),E}try{await this.isValidApprove(e)}catch(E){throw this.client.logger.error("approve() -> isValidApprove() failed"),n.setError(ba),E}const{id:r,relayProtocol:o,namespaces:a,sessionProperties:c,sessionConfig:l}=e,h=this.client.proposal.get(r);this.client.core.eventClient.deleteEvent({eventId:n.eventId});const{pairingTopic:d,proposer:u,requiredNamespaces:p,optionalNamespaces:g}=h;let f=null==(i=this.client.core.eventClient)?void 0:i.getEvent({topic:d});f||(f=null==(s=this.client.core.eventClient)?void 0:s.createEvent({type:oa,properties:{topic:d,trace:[oa,aa]}}));const w=await this.client.core.crypto.generateKeyPair(),m=u.publicKey,y=await this.client.core.crypto.generateSharedKey(w,m),v=ld(ld({relay:{protocol:null!==o&&void 0!==o?o:"irn"},namespaces:a,controller:{publicKey:w,metadata:this.client.metadata},expiry:yi(Gh)},c&&{sessionProperties:c}),l&&{sessionConfig:l}),b=bo.relay;f.addTrace(ca);try{await this.client.core.relayer.subscribe(y,{transportType:b})}catch(E){throw f.setError(ma),E}f.addTrace(la);const I=hd(ld({},v),{topic:y,requiredNamespaces:p,optionalNamespaces:g,pairingTopic:d,acknowledged:!1,self:v.controller,peer:{publicKey:u.publicKey,metadata:u.metadata},controller:w,transportType:bo.relay});await this.client.session.set(y,I),f.addTrace(ua);try{f.addTrace(pa),await this.sendRequest({topic:y,method:"wc_sessionSettle",params:v,throwOnFailedPublish:!0}).catch(e=>{throw null==f||f.setError(va),e}),f.addTrace(ga),f.addTrace(ha),await this.sendResult({id:r,topic:d,result:{relay:{protocol:null!==o&&void 0!==o?o:"irn"},responderPublicKey:w},throwOnFailedPublish:!0}).catch(e=>{throw null==f||f.setError(ya),e}),f.addTrace(da)}catch(E){throw this.client.logger.error(E),this.client.session.delete(y,Pr("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(y),E}return this.client.core.eventClient.deleteEvent({eventId:f.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:u.metadata}),await this.client.proposal.delete(r,Pr("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(y,yi(Gh)),{topic:y,acknowledged:()=>Promise.resolve(this.client.session.get(y))}}),dd(this,"reject",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(n){throw this.client.logger.error("reject() -> isValidReject() failed"),n}const{id:t,reason:i}=e;let s;try{s=this.client.proposal.get(t).pairingTopic}catch(n){throw this.client.logger.error("reject() -> proposal.get(".concat(t,") failed")),n}s&&(await this.sendError({id:t,topic:s,error:i,rpcOpts:Yh.wc_sessionPropose.reject}),await this.client.proposal.delete(t,Pr("USER_DISCONNECTED")))}),dd(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:t,namespaces:i}=e,{done:s,resolve:n,reject:r}=gi(),o=(0,v.F)(),a=(0,v.x)().toString(),c=this.client.session.get(t).namespaces;return this.events.once(bi("session_update",o),e=>{let{error:t}=e;t?r(t):n()}),await this.client.session.update(t,{namespaces:i}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:a}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:c}),r(e)}),{acknowledged:s}}),dd(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(o){throw this.client.logger.error("extend() -> isValidExtend() failed"),o}const{topic:t}=e,i=(0,v.F)(),{done:s,resolve:n,reject:r}=gi();return this.events.once(bi("session_extend",i),e=>{let{error:t}=e;t?r(t):n()}),await this.setExpiry(t,yi(Gh)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(e=>{r(e)}),{acknowledged:s}}),dd(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(f){throw this.client.logger.error("request() -> isValidRequest() failed"),f}const{chainId:t,request:i,topic:s,expiry:n=Yh.wc_sessionRequest.req.ttl}=e,r=this.client.session.get(s);(null==r?void 0:r.transportType)===bo.relay&&await this.confirmOnlineStateOrThrow();const o=(0,v.F)(),a=(0,v.x)().toString(),{done:c,resolve:l,reject:h}=gi(n,"Request expired. Please try again.");this.events.once(bi("session_request",o),e=>{let{error:t,result:i}=e;t?h(t):l(i)});const d="wc_sessionRequest",u=this.getAppLinkIfEnabled(r.peer.metadata,r.transportType);if(u)return await this.sendRequest({clientRpcId:o,relayRpcId:a,topic:s,method:d,params:{request:hd(ld({},i),{expiryTimestamp:yi(n)}),chainId:t},expiry:n,throwOnFailedPublish:!0,appLink:u}).catch(e=>h(e)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:t,id:o}),await c();const p={request:hd(ld({},i),{expiryTimestamp:yi(n)}),chainId:t},g=this.shouldSetTVF(d,p);return await Promise.all([new Promise(async e=>{await this.sendRequest(ld({clientRpcId:o,relayRpcId:a,topic:s,method:d,params:p,expiry:n,throwOnFailedPublish:!0},g&&{tvf:this.getTVFParams(o,p)})).catch(e=>h(e)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:t,id:o}),e()}),new Promise(async e=>{var i;if(null==(i=r.sessionConfig)||!i.disableDeepLink){const e=await async function(e,i){let s="";try{if(ri()&&(s=localStorage.getItem(i),s))return s;s=await e.getItem(i)}catch(t){console.error(t)}return s}(this.client.core.storage,Wh);await Ei({id:o,topic:s,wcDeepLink:e})}e()}),c()]).then(e=>e[2])}),dd(this,"respond",async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:t,response:i}=e,{id:s}=i,n=this.client.session.get(t);n.transportType===bo.relay&&await this.confirmOnlineStateOrThrow();const r=this.getAppLinkIfEnabled(n.peer.metadata,n.transportType);(0,v.B)(i)?await this.sendResult({id:s,topic:t,result:i.result,throwOnFailedPublish:!0,appLink:r}):(0,v.D)(i)&&await this.sendError({id:s,topic:t,error:i.error,appLink:r}),this.cleanupAfterResponse(e)}),dd(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:t}=e;if(this.client.session.keys.includes(t)){const e=(0,v.F)(),i=(0,v.x)().toString(),{done:s,resolve:n,reject:r}=gi();this.events.once(bi("session_ping",e),e=>{let{error:t}=e;t?r(t):n()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:i}),s()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),dd(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);const{topic:t,event:i,chainId:s}=e,n=(0,v.x)().toString(),r=(0,v.F)();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:n,clientRpcId:r})}),dd(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);const{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:Pr("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else{if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:e}=Sr("MISMATCHED_TOPIC","Session or pairing topic not found: ".concat(t));throw new Error(e)}await this.client.core.pairing.disconnect({topic:t})}}),dd(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>function(e,t){const{requiredNamespaces:i}=t,s=Object.keys(e.namespaces),n=Object.keys(i);let r=!0;return!!di(n,s)&&(s.forEach(t=>{const{accounts:s,methods:n,events:o}=e.namespaces[t],a=br(s),c=i[t];(!di(Jt(t,c),a)||!di(c.methods,n)||!di(c.events,o))&&(r=!1)}),r)}(t,e)))),dd(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),dd(this,"authenticate",async(e,t)=>{var i;this.isInitialized(),this.isValidAuthenticate(e);const s=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(i=this.client.metadata.redirect)?void 0:i.linkMode),n=s?bo.link_mode:bo.relay;n===bo.relay&&await this.confirmOnlineStateOrThrow();const{chains:r,statement:o="",uri:a,domain:c,nonce:l,type:h,exp:d,nbf:u,methods:p=[],expiry:g}=e,f=[...e.resources||[]],{topic:w,uri:m}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:n});this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:m}});const y=await this.client.core.crypto.generateKeyPair(),b=sr(y);if(await Promise.all([this.client.auth.authKeys.set(td,{responseTopic:b,publicKey:y}),this.client.auth.pairingTopics.set(b,{topic:b,pairingTopic:w})]),await this.client.core.relayer.subscribe(b,{transportType:n}),this.client.logger.info("sending request to new pairing topic: ".concat(w)),p.length>0){const{namespace:e}=Zt(r[0]);let t=Ss(e,"request",p);_s(f)&&(t=Ps(t,f.pop())),f.push(t)}const I=g&&g>Yh.wc_sessionAuthenticate.req.ttl?g:Yh.wc_sessionAuthenticate.req.ttl,E={authPayload:{type:null!==h&&void 0!==h?h:"caip122",chains:r,statement:o,aud:a,domain:c,version:"1",nonce:l,iat:(new Date).toISOString(),exp:d,nbf:u,resources:f},requester:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:yi(I)},N={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:r,methods:[...new Set(["personal_sign",...p])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:w,proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:yi(Yh.wc_sessionPropose.req.ttl),id:(0,v.F)()},{done:A,resolve:C,reject:S}=gi(I,"Request expired"),P=(0,v.F)(),T=bi("session_connect",N.id),M=bi("session_request",P),_=async e=>{let{error:t,session:i}=e;this.events.off(M,O),t?S(t):i&&C({session:i})},O=async e=>{var i,s,r;if(await this.deletePendingAuthRequest(P,{message:"fulfilled",code:0}),e.error){const t=Pr("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(T,_),S(e.error.message))}await this.deleteProposal(N.id),this.events.off(T,_);const{cacaos:o,responder:a}=e.result,c=[],l=[];for(const t of o){await bs({cacao:t,projectId:this.client.core.projectId})||(this.client.logger.error(t,"Signature verification failed"),S(Pr("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:e}=t,i=_s(e.resources),s=[ys(e.iss)],n=vs(e.iss);if(i){const e=Ts(i),t=Ms(i);c.push(...e),s.push(...t)}for(const t of s)l.push("".concat(t,":").concat(n))}const h=await this.client.core.crypto.generateSharedKey(y,a.publicKey);let d;c.length>0&&(d={topic:h,acknowledged:!0,self:{publicKey:y,metadata:this.client.metadata},peer:a,controller:a.publicKey,expiry:yi(Gh),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:w,namespaces:Nr([...new Set(c)],[...new Set(l)]),transportType:n},await this.client.core.relayer.subscribe(h,{transportType:n}),await this.client.session.set(h,d),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:a.metadata}),d=this.client.session.get(h)),null!=(i=this.client.metadata.redirect)&&i.linkMode&&null!=(s=a.metadata.redirect)&&s.linkMode&&null!=(r=a.metadata.redirect)&&r.universal&&t&&(this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.session.update(h,{transportType:bo.link_mode})),C({auths:o,session:d})};let x;this.events.once(T,_),this.events.once(M,O);try{if(s){const e=(0,v.l)("wc_sessionAuthenticate",E,P);this.client.core.history.set(w,e);const i=await this.client.core.crypto.encode("",e,{type:2,encoding:er});x=vr(t,w,i)}else await Promise.all([this.sendRequest({topic:w,method:"wc_sessionAuthenticate",params:E,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:P}),this.sendRequest({topic:w,method:"wc_sessionPropose",params:N,expiry:Yh.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:N.id})])}catch(k){throw this.events.off(T,_),this.events.off(M,O),k}return await this.setProposal(N.id,N),await this.setAuthRequest(P,{request:hd(ld({},E),{verifyContext:{}}),pairingTopic:w,transportType:n}),{uri:null!==x&&void 0!==x?x:m,response:A}}),dd(this,"approveSessionAuthenticate",async e=>{const{id:t,auths:i}=e,s=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[Ea]}});try{this.isInitialized()}catch(g){throw s.setError(Ma),g}const n=this.getPendingAuthRequest(t);if(!n)throw s.setError(ka),new Error("Could not find pending auth request with id ".concat(t));const r=n.transportType||bo.relay;r===bo.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=sr(o),l={type:1,receiverPublicKey:o,senderPublicKey:a},h=[],d=[];for(const f of i){if(!await bs({cacao:f,projectId:this.client.core.projectId})){s.setError(_a);const e=Pr("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:t,topic:c,error:e,encodeOpts:l}),new Error(e.message)}s.addTrace(Aa);const{p:e}=f,i=_s(e.resources),n=[ys(e.iss)],r=vs(e.iss);if(i){const e=Ts(i),t=Ms(i);h.push(...e),n.push(...t)}for(const t of n)d.push("".concat(t,":").concat(r))}const u=await this.client.core.crypto.generateSharedKey(a,o);let p;if(s.addTrace(Na),(null==h?void 0:h.length)>0){p={topic:u,acknowledged:!0,self:{publicKey:a,metadata:this.client.metadata},peer:{publicKey:o,metadata:n.requester.metadata},controller:o,expiry:yi(Gh),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:n.pairingTopic,namespaces:Nr([...new Set(h)],[...new Set(d)]),transportType:r},s.addTrace(Sa);try{await this.client.core.relayer.subscribe(u,{transportType:r})}catch(g){throw s.setError(Oa),g}s.addTrace(Pa),await this.client.session.set(u,p),s.addTrace(Ca),await this.client.core.pairing.updateMetadata({topic:n.pairingTopic,metadata:n.requester.metadata})}s.addTrace(Ta);try{await this.sendResult({topic:c,id:t,result:{cacaos:i,responder:{publicKey:a,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(n.requester.metadata,r)})}catch(g){throw s.setError(xa),g}return await this.client.auth.requests.delete(t,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:n.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:p}}),dd(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();const{id:t,reason:i}=e,s=this.getPendingAuthRequest(t);if(!s)throw new Error("Could not find pending auth request with id ".concat(t));s.transportType===bo.relay&&await this.confirmOnlineStateOrThrow();const n=s.requester.publicKey,r=await this.client.core.crypto.generateKeyPair(),o=sr(n),a={type:1,receiverPublicKey:n,senderPublicKey:r};await this.sendError({id:t,topic:o,error:i,encodeOpts:a,rpcOpts:Yh.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.client.proposal.delete(t,Pr("USER_DISCONNECTED"))}),dd(this,"formatAuthMessage",e=>{this.isInitialized();const{request:t,iss:i}=e;return Is(t,i)}),dd(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{const e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),dd(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{const t=this.client.core.pairing.pairings.get(e.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(i=>{var s,n;return(null==(s=i.peerMetadata)?void 0:s.url)&&(null==(n=i.peerMetadata)?void 0:n.url)===e.peer.metadata.url&&i.topic&&i.topic!==t.topic});if(0===i.length)return;this.client.logger.info("Cleaning up ".concat(i.length," duplicate pairing(s)")),await Promise.all(i.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(t){this.client.logger.error(t)}}),dd(this,"deleteSession",async e=>{var t;const{topic:i,expirerHasDeleted:s=!1,emitEvent:n=!0,id:r=0}=e,{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,Pr("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Wh).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===i&&this.deletePendingSessionRequest(e.id,Pr("USER_DISCONNECTED"))}),i===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=Zh),n&&this.client.events.emit("session_delete",{id:r,topic:i})}),dd(this,"deleteProposal",async(e,t)=>{if(t)try{const t=this.client.proposal.get(e),i=this.client.core.eventClient.getEvent({topic:t.pairingTopic});null==i||i.setError(wa)}catch(i){}await Promise.all([this.client.proposal.delete(e,Pr("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),dd(this,"deletePendingSessionRequest",async function(e,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];await Promise.all([t.client.pendingRequest.delete(e,i),s?Promise.resolve():t.client.core.expirer.del(e)]),t.addToRecentlyDeleted(e,"request"),t.sessionRequestQueue.queue=t.sessionRequestQueue.queue.filter(t=>t.id!==e),s&&(t.sessionRequestQueue.state=Zh,t.client.events.emit("session_request_expire",{id:e}))}),dd(this,"deletePendingAuthRequest",async function(e,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];await Promise.all([t.client.auth.requests.delete(e,i),s?Promise.resolve():t.client.core.expirer.del(e)])}),dd(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),dd(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,yi(Yh.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),dd(this,"setAuthRequest",async(e,t)=>{const{request:i,pairingTopic:s,transportType:n=bo.relay}=t;this.client.core.expirer.set(e,i.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:e,pairingTopic:s,verifyContext:i.verifyContext,transportType:n})}),dd(this,"setPendingSessionRequest",async e=>{const{id:t,topic:i,params:s,verifyContext:n}=e,r=s.request.expiryTimestamp||yi(Yh.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,r),await this.client.pendingRequest.set(t,{id:t,topic:i,params:s,verifyContext:n})}),dd(this,"sendRequest",async e=>{const{topic:t,method:i,params:s,expiry:n,relayRpcId:r,clientRpcId:o,throwOnFailedPublish:a,appLink:c,tvf:l}=e,h=(0,v.l)(i,s,o);let d;const u=!!c;try{const e=u?er:$n;d=await this.client.core.crypto.encode(t,h,{encoding:e})}catch(w){throw await this.cleanup(),this.client.logger.error("sendRequest() -> core.crypto.encode() for topic ".concat(t," failed")),w}let g;if($h.includes(i)){const e=nr(JSON.stringify(h)),t=nr(d);g=await this.client.core.verify.register({id:t,decryptedId:e})}const f=Yh[i].req;if(f.attestation=g,n&&(f.ttl=n),r&&(f.id=r),this.client.core.history.set(t,h),u){const e=vr(c,t,d);await p.d.global.Linking.openURL(e,this.client.name)}else{const e=Yh[i].req;n&&(e.ttl=n),r&&(e.id=r),e.tvf=hd(ld({},l),{correlationId:h.id}),a?(e.internal=hd(ld({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,d,e)):this.client.core.relayer.publish(t,d,e).catch(e=>this.client.logger.error(e))}return h.id}),dd(this,"sendResult",async e=>{const{id:t,topic:i,result:s,throwOnFailedPublish:n,encodeOpts:r,appLink:o}=e,a=(0,v.q)(t,s);let c;const l=o&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u";try{const e=l?er:$n;c=await this.client.core.crypto.encode(i,a,hd(ld({},r||{}),{encoding:e}))}catch(u){throw await this.cleanup(),this.client.logger.error("sendResult() -> core.crypto.encode() for topic ".concat(i," failed")),u}let h,d;try{h=await this.client.core.history.get(i,t);const e=h.request;try{this.shouldSetTVF(e.method,e.params)&&(d=this.getTVFParams(t,e.params,s))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(u){throw this.client.logger.error("sendResult() -> history.get(".concat(i,", ").concat(t,") failed")),u}if(l){const e=vr(o,i,c);await p.d.global.Linking.openURL(e,this.client.name)}else{const e=h.request.method,s=Yh[e].res;s.tvf=hd(ld({},d),{correlationId:t}),n?(s.internal=hd(ld({},s.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,c,s)):this.client.core.relayer.publish(i,c,s).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(a)}),dd(this,"sendError",async e=>{const{id:t,topic:i,error:s,encodeOpts:n,rpcOpts:r,appLink:o}=e,a=(0,v.z)(t,s);let c;const l=o&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u";try{const e=l?er:$n;c=await this.client.core.crypto.encode(i,a,hd(ld({},n||{}),{encoding:e}))}catch(d){throw await this.cleanup(),this.client.logger.error("sendError() -> core.crypto.encode() for topic ".concat(i," failed")),d}let h;try{h=await this.client.core.history.get(i,t)}catch(d){throw this.client.logger.error("sendError() -> history.get(".concat(i,", ").concat(t,") failed")),d}if(l){const e=vr(o,i,c);await p.d.global.Linking.openURL(e,this.client.name)}else{const e=h.request.method,t=r||Yh[e].res;this.client.core.relayer.publish(i,c,t)}await this.client.core.history.resolve(a)}),dd(this,"cleanup",async()=>{const e=[],t=[];this.client.session.getAll().forEach(t=>{let i=!1;vi(t.expiry)&&(i=!0),this.client.core.crypto.keychain.has(t.topic)||(i=!0),i&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{vi(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),dd(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),dd(this,"processRequestsQueue",async()=>{if(this.requestQueue.state!==Jh){for(this.client.logger.info("Request queue starting with ".concat(this.requestQueue.queue.length," requests"));this.requestQueue.queue.length>0;){this.requestQueue.state=Jh;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=Zh}else this.client.logger.info("Request queue already active, skipping...")}),dd(this,"processRequest",async e=>{const{topic:t,payload:i,attestation:s,transportType:n,encryptedId:r}=e,o=i.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:o}))switch(o){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:i,attestation:s,encryptedId:r});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,i);case"wc_sessionPing":return await this.onSessionPingRequest(t,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:i,attestation:s,encryptedId:r,transportType:n});case"wc_sessionEvent":return await this.onSessionEventRequest(t,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:i,attestation:s,encryptedId:r,transportType:n});default:return this.client.logger.info("Unsupported request method ".concat(o))}}),dd(this,"onRelayEventResponse",async e=>{const{topic:t,payload:i,transportType:s}=e,n=(await this.client.core.history.get(t,i.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(t,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(t,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,i);case"wc_sessionExtend":return this.onSessionExtendResponse(t,i);case"wc_sessionPing":return this.onSessionPingResponse(t,i);case"wc_sessionRequest":return this.onSessionRequestResponse(t,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,i);default:return this.client.logger.info("Unsupported response method ".concat(n))}}),dd(this,"onRelayEventUnknownPayload",e=>{const{topic:t}=e,{message:i}=Sr("MISSING_OR_INVALID","Decoded payload on topic ".concat(t," is not identifiable as a JSON-RPC request or a response."));throw new Error(i)}),dd(this,"shouldIgnorePairingRequest",e=>{const{topic:t,requestMethod:i}=e,s=this.expectedPairingMethodMap.get(t);return!(!s||s.includes(i))&&!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),dd(this,"onSessionProposeRequest",async e=>{const{topic:t,payload:i,attestation:s,encryptedId:n}=e,{params:r,id:o}=i;try{const e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),null==e||e.setError(ra)),this.isValidConnect(ld({},i.params));const a=r.expiryTimestamp||yi(Yh.wc_sessionPropose.req.ttl),c=ld({id:o,pairingTopic:t,expiryTimestamp:a},r);await this.setProposal(o,c);const l=await this.getVerifyContext({attestationId:s,hash:nr(JSON.stringify(i)),encryptedId:n,metadata:c.proposer.metadata});null==e||e.addTrace($o),this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:l})}catch(a){await this.sendError({id:o,topic:t,error:a,rpcOpts:Yh.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),dd(this,"onSessionProposeResponse",async(e,t,i)=>{const{id:s}=t;if((0,v.B)(t)){const{result:n}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});const r=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:r});const o=r.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:o});const a=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:a});const c=await this.client.core.crypto.generateSharedKey(o,a);this.pendingSessions.set(s,{sessionTopic:c,pairingTopic:e,proposalId:s,publicKey:o});const l=await this.client.core.relayer.subscribe(c,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:e})}else if((0,v.D)(t)){await this.client.proposal.delete(s,Pr("USER_DISCONNECTED"));const e=bi("session_connect",s);if(0===this.events.listenerCount(e))throw new Error("emitting ".concat(e," without any listeners, 954"));this.events.emit(e,{error:t.error})}}),dd(this,"onSessionSettleRequest",async(e,t)=>{const{id:i,params:s}=t;try{this.isValidSessionSettleRequest(s);const{relay:i,controller:n,expiry:r,namespaces:o,sessionProperties:a,sessionConfig:c}=t.params,l=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!l)return this.client.logger.error("Pending session not found for topic ".concat(e));const h=this.client.proposal.get(l.proposalId),d=hd(ld(ld({topic:e,relay:i,expiry:r,namespaces:o,acknowledged:!0,pairingTopic:l.pairingTopic,requiredNamespaces:h.requiredNamespaces,optionalNamespaces:h.optionalNamespaces,controller:n.publicKey,self:{publicKey:l.publicKey,metadata:this.client.metadata},peer:{publicKey:n.publicKey,metadata:n.metadata}},a&&{sessionProperties:a}),c&&{sessionConfig:c}),{transportType:bo.relay});await this.client.session.set(d.topic,d),await this.setExpiry(d.topic,d.expiry),await this.client.core.pairing.updateMetadata({topic:l.pairingTopic,metadata:d.peer.metadata}),this.client.events.emit("session_connect",{session:d}),this.events.emit(bi("session_connect",l.proposalId),{session:d}),this.pendingSessions.delete(l.proposalId),this.deleteProposal(l.proposalId,!1),this.cleanupDuplicatePairings(d),await this.sendResult({id:t.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(n){await this.sendError({id:i,topic:e,error:n}),this.client.logger.error(n)}}),dd(this,"onSessionSettleResponse",async(e,t)=>{const{id:i}=t;(0,v.B)(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(bi("session_approve",i),{})):(0,v.D)(t)&&(await this.client.session.delete(e,Pr("USER_DISCONNECTED")),this.events.emit(bi("session_approve",i),{error:t.error}))}),dd(this,"onSessionUpdateRequest",async(e,t)=>{const{params:i,id:s}=t;try{const t="".concat(e,"_session_update"),r=Qr.get(t);if(r&&this.isRequestOutOfSync(r,s))return this.client.logger.warn("Discarding out of sync request - ".concat(s)),void this.sendError({id:s,topic:e,error:Pr("INVALID_UPDATE_REQUEST")});this.isValidUpdate(ld({topic:e},i));try{Qr.set(t,s),await this.client.session.update(e,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0})}catch(n){throw Qr.delete(t),n}this.client.events.emit("session_update",{id:s,topic:e,params:i})}catch(r){await this.sendError({id:s,topic:e,error:r}),this.client.logger.error(r)}}),dd(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),dd(this,"onSessionUpdateResponse",(e,t)=>{const{id:i}=t,s=bi("session_update",i);if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners"));(0,v.B)(t)?this.events.emit(bi("session_update",i),{}):(0,v.D)(t)&&this.events.emit(bi("session_update",i),{error:t.error})}),dd(this,"onSessionExtendRequest",async(e,t)=>{const{id:i}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,yi(Gh)),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:e})}catch(s){await this.sendError({id:i,topic:e,error:s}),this.client.logger.error(s)}}),dd(this,"onSessionExtendResponse",(e,t)=>{const{id:i}=t,s=bi("session_extend",i);if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners"));(0,v.B)(t)?this.events.emit(bi("session_extend",i),{}):(0,v.D)(t)&&this.events.emit(bi("session_extend",i),{error:t.error})}),dd(this,"onSessionPingRequest",async(e,t)=>{const{id:i}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:e})}catch(s){await this.sendError({id:i,topic:e,error:s}),this.client.logger.error(s)}}),dd(this,"onSessionPingResponse",(e,t)=>{const{id:i}=t,s=bi("session_ping",i);if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners"));setTimeout(()=>{(0,v.B)(t)?this.events.emit(bi("session_ping",i),{}):(0,v.D)(t)&&this.events.emit(bi("session_ping",i),{error:t.error})},500)}),dd(this,"onSessionDeleteRequest",async(e,t)=>{const{id:i}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise(t=>{this.client.core.relayer.once(go,async()=>{t(await this.deleteSession({topic:e,id:i}))})}),this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:Pr("USER_DISCONNECTED")})]).catch(e=>this.client.logger.error(e))}catch(s){this.client.logger.error(s)}}),dd(this,"onSessionRequest",async e=>{var t,i,s;const{topic:n,payload:r,attestation:o,encryptedId:a,transportType:c}=e,{id:l,params:h}=r;try{await this.isValidRequest(ld({topic:n},h));const e=this.client.session.get(n),r={id:l,topic:n,params:h,verifyContext:await this.getVerifyContext({attestationId:o,hash:nr(JSON.stringify((0,v.l)("wc_sessionRequest",h,l))),encryptedId:a,metadata:e.peer.metadata,transportType:c})};await this.setPendingSessionRequest(r),c===bo.link_mode&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(i=e.peer.metadata.redirect)?void 0:i.universal),null!=(s=this.client.signConfig)&&s.disableRequestQueue?this.emitSessionRequest(r):(this.addSessionRequestToSessionRequestQueue(r),this.processSessionRequestQueue())}catch(d){await this.sendError({id:l,topic:n,error:d}),this.client.logger.error(d)}}),dd(this,"onSessionRequestResponse",(e,t)=>{const{id:i}=t,s=bi("session_request",i);if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners"));(0,v.B)(t)?this.events.emit(bi("session_request",i),{result:t.result}):(0,v.D)(t)&&this.events.emit(bi("session_request",i),{error:t.error})}),dd(this,"onSessionEventRequest",async(e,t)=>{const{id:i,params:s}=t;try{const t="".concat(e,"_session_event_").concat(s.event.name),n=Qr.get(t);if(n&&this.isRequestOutOfSync(n,i))return void this.client.logger.info("Discarding out of sync request - ".concat(i));this.isValidEmit(ld({topic:e},s)),this.client.events.emit("session_event",{id:i,topic:e,params:s}),Qr.set(t,i)}catch(n){await this.sendError({id:i,topic:e,error:n}),this.client.logger.error(n)}}),dd(this,"onSessionAuthenticateResponse",(e,t)=>{const{id:i}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),(0,v.B)(t)?this.events.emit(bi("session_request",i),{result:t.result}):(0,v.D)(t)&&this.events.emit(bi("session_request",i),{error:t.error})}),dd(this,"onSessionAuthenticateRequest",async e=>{var t;const{topic:i,payload:s,attestation:n,encryptedId:r,transportType:o}=e;try{const{requester:e,authPayload:a,expiryTimestamp:c}=s.params,l=await this.getVerifyContext({attestationId:n,hash:nr(JSON.stringify(s)),encryptedId:r,metadata:e.metadata,transportType:o}),h={requester:e,pairingTopic:i,id:s.id,authPayload:a,verifyContext:l,expiryTimestamp:c};await this.setAuthRequest(s.id,{request:h,pairingTopic:i,transportType:o}),o===bo.link_mode&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:l})}catch(a){this.client.logger.error(a);const e=s.params.requester.publicKey,t=await this.client.core.crypto.generateKeyPair(),n=this.getAppLinkIfEnabled(s.params.requester.metadata,o),r={type:1,receiverPublicKey:e,senderPublicKey:t};await this.sendError({id:s.id,topic:i,error:a,encodeOpts:r,rpcOpts:Yh.wc_sessionAuthenticate.autoReject,appLink:n})}}),dd(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),dd(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Zh,this.processSessionRequestQueue()},v.c.toMiliseconds(this.requestQueueDelay))}),dd(this,"cleanupPendingSentRequestsForTopic",e=>{let{topic:t,error:i}=e;const s=this.client.core.history.pending;s.length>0&&s.filter(e=>e.topic===t&&"wc_sessionRequest"===e.request.method).forEach(e=>{const t=bi("session_request",e.request.id);if(0===this.events.listenerCount(t))throw new Error("emitting ".concat(t," without any listeners"));this.events.emit(bi("session_request",e.request.id),{error:i})})}),dd(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Jh)return void this.client.logger.info("session request queue is already active.");const e=this.sessionRequestQueue.queue[0];if(e)try{this.sessionRequestQueue.state=Jh,this.emitSessionRequest(e)}catch(t){this.client.logger.error(t)}else this.client.logger.info("session request queue is empty.")}),dd(this,"emitSessionRequest",e=>{this.client.events.emit("session_request",e)}),dd(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;const t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:(0,v.l)("wc_sessionPropose",{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties},t.id)})}),dd(this,"isValidConnect",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","connect() params: ".concat(JSON.stringify(e)));throw new Error(t)}const{pairingTopic:t,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:n,relays:r}=e;if(_r(t)||await this.isValidPairingTopic(t),!function(e){let t=!1;return e?e&&Tr(e)&&e.length&&e.forEach(e=>{t=zr(e)}):t=!0,t}(r)){const{message:e}=Sr("MISSING_OR_INVALID","connect() relays: ".concat(r));throw new Error(e)}!_r(i)&&0!==Mr(i)&&this.validateNamespaces(i,"requiredNamespaces"),!_r(s)&&0!==Mr(s)&&this.validateNamespaces(s,"optionalNamespaces"),_r(n)||this.validateSessionProps(n,"sessionProperties")}),dd(this,"validateNamespaces",(e,t)=>{const i=function(e,t,i){let s=null;if(e&&Mr(e)){const n=Ur(e,t);n&&(s=n);const r=jr(e,t,i);r&&(s=r)}else s=Sr("MISSING_OR_INVALID","".concat(t,", ").concat(i," should be an object with data"));return s}(e,"connect()",t);if(i)throw new Error(i.message)}),dd(this,"isValidApprove",async e=>{if(!qr(e))throw new Error(Sr("MISSING_OR_INVALID","approve() params: ".concat(e)).message);const{id:t,namespaces:i,relayProtocol:s,sessionProperties:n}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);const r=this.client.proposal.get(t),o=Lr(i,"approve()");if(o)throw new Error(o.message);const a=Kr(r.requiredNamespaces,i,"approve()");if(a)throw new Error(a.message);if(!Or(s,!0)){const{message:e}=Sr("MISSING_OR_INVALID","approve() relayProtocol: ".concat(s));throw new Error(e)}_r(n)||this.validateSessionProps(n,"sessionProperties")}),dd(this,"isValidReject",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","reject() params: ".concat(e));throw new Error(t)}const{id:t,reason:i}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!function(e){return!(!e||"object"!=typeof e||!e.code||!xr(e.code,!1)||!e.message||!Or(e.message,!1))}(i)){const{message:e}=Sr("MISSING_OR_INVALID","reject() reason: ".concat(JSON.stringify(i)));throw new Error(e)}}),dd(this,"isValidSessionSettleRequest",e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","onSessionSettleRequest() params: ".concat(e));throw new Error(t)}const{relay:t,controller:i,namespaces:s,expiry:n}=e;if(!zr(t)){const{message:e}=Sr("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(e)}const r=function(e,t){let i=null;return Or(null==e?void 0:e.publicKey,!1)||(i=Sr("MISSING_OR_INVALID","".concat(t," controller public key should be a string"))),i}(i,"onSessionSettleRequest()");if(r)throw new Error(r.message);const o=Lr(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);if(vi(n)){const{message:e}=Sr("EXPIRED","onSessionSettleRequest()");throw new Error(e)}}),dd(this,"isValidUpdate",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","update() params: ".concat(e));throw new Error(t)}const{topic:t,namespaces:i}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const s=this.client.session.get(t),n=Lr(i,"update()");if(n)throw new Error(n.message);const r=Kr(s.requiredNamespaces,i,"update()");if(r)throw new Error(r.message)}),dd(this,"isValidExtend",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","extend() params: ".concat(e));throw new Error(t)}const{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),dd(this,"isValidRequest",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","request() params: ".concat(e));throw new Error(t)}const{topic:t,request:i,chainId:s,expiry:n}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const{namespaces:r}=this.client.session.get(t);if(!Br(r,s)){const{message:e}=Sr("MISSING_OR_INVALID","request() chainId: ".concat(s));throw new Error(e)}if(!function(e){return!(_r(e)||!Or(e.method,!1))}(i)){const{message:e}=Sr("MISSING_OR_INVALID","request() ".concat(JSON.stringify(i)));throw new Error(e)}if(!Vr(r,s,i.method)){const{message:e}=Sr("MISSING_OR_INVALID","request() method: ".concat(i.method));throw new Error(e)}if(n&&!function(e,t){return xr(e,!1)&&e<=t.max&&e>=t.min}(n,Qh)){const{message:e}=Sr("MISSING_OR_INVALID","request() expiry: ".concat(n,". Expiry must be a number (in seconds) between ").concat(Qh.min," and ").concat(Qh.max));throw new Error(e)}}),dd(this,"isValidRespond",async e=>{var t;if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","respond() params: ".concat(e));throw new Error(t)}const{topic:i,response:s}=e;try{await this.isValidSessionTopic(i)}catch(n){throw null!=(t=null==e?void 0:e.response)&&t.id&&this.cleanupAfterResponse(e),n}if(!function(e){return!(_r(e)||_r(e.result)&&_r(e.error)||!xr(e.id,!1)||!Or(e.jsonrpc,!1))}(s)){const{message:e}=Sr("MISSING_OR_INVALID","respond() response: ".concat(JSON.stringify(s)));throw new Error(e)}}),dd(this,"isValidPing",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","ping() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),dd(this,"isValidEmit",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","emit() params: ".concat(e));throw new Error(t)}const{topic:t,event:i,chainId:s}=e;await this.isValidSessionTopic(t);const{namespaces:n}=this.client.session.get(t);if(!Br(n,s)){const{message:e}=Sr("MISSING_OR_INVALID","emit() chainId: ".concat(s));throw new Error(e)}if(!function(e){return!(_r(e)||!Or(e.name,!1))}(i)){const{message:e}=Sr("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(i)));throw new Error(e)}if(!Hr(n,s,i.name)){const{message:e}=Sr("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(i)));throw new Error(e)}}),dd(this,"isValidDisconnect",async e=>{if(!qr(e)){const{message:t}=Sr("MISSING_OR_INVALID","disconnect() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),dd(this,"isValidAuthenticate",e=>{const{chains:t,uri:i,domain:s,nonce:n}=e;if(!Array.isArray(t)||0===t.length)throw new Error("chains is required and must be a non-empty array");if(!Or(i,!1))throw new Error("uri is required parameter");if(!Or(s,!1))throw new Error("domain is required parameter");if(!Or(n,!1))throw new Error("nonce is required parameter");if([...new Set(t.map(e=>Zt(e).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:r}=Zt(t[0]);if("eip155"!==r)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),dd(this,"getVerifyContext",async e=>{const{attestationId:t,hash:i,encryptedId:s,metadata:n,transportType:r}=e,o={verified:{verifyUrl:n.verifyUrl||Bo,validation:"UNKNOWN",origin:n.url||""}};try{if(r===bo.link_mode){const e=this.getAppLinkIfEnabled(n,r);return o.verified.validation=e&&new URL(e).origin===new URL(n.url).origin?"VALID":"INVALID",o}const e=await this.client.core.verify.resolve({attestationId:t,hash:i,encryptedId:s,verifyUrl:n.verifyUrl});e&&(o.verified.origin=e.origin,o.verified.isScam=e.isScam,o.verified.validation=e.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug("Verify context: ".concat(JSON.stringify(o))),o}),dd(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach(e=>{if(!Or(e,!1)){const{message:i}=Sr("MISSING_OR_INVALID","".concat(t," must be in Record<string, string> format. Received: ").concat(JSON.stringify(e)));throw new Error(i)}})}),dd(this,"getPendingAuthRequest",e=>{const t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),dd(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0;const t=this.recentlyDeletedLimit/2;for(const i of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(i)}}}),dd(this,"checkRecentlyDeleted",e=>{const t=this.recentlyDeletedMap.get(e);if(t){const{message:i}=Sr("MISSING_OR_INVALID","Record was recently deleted - ".concat(t,": ").concat(e));throw new Error(i)}}),dd(this,"isLinkModeEnabled",(e,t)=>{var i,s,n,r,o,a,c,l,h;return!(!e||t!==bo.link_mode)&&(!0===(null==(s=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:s.linkMode)&&void 0!==(null==(r=null==(n=this.client.metadata)?void 0:n.redirect)?void 0:r.universal)&&""!==(null==(a=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:a.universal)&&void 0!==(null==(c=null==e?void 0:e.redirect)?void 0:c.universal)&&""!==(null==(l=null==e?void 0:e.redirect)?void 0:l.universal)&&!0===(null==(h=null==e?void 0:e.redirect)?void 0:h.linkMode)&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u")}),dd(this,"getAppLinkIfEnabled",(e,t)=>{var i;return this.isLinkModeEnabled(e,t)?null==(i=null==e?void 0:e.redirect)?void 0:i.universal:void 0}),dd(this,"handleLinkModeMessage",e=>{let{url:t}=e;if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const i=Ni(t,"topic")||"",s=decodeURIComponent(Ni(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:bo.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),dd(this,"registerLinkModeListeners",async()=>{var e;if(Ci()||ni()&&null!=(e=this.client.metadata.redirect)&&e.linkMode){const e=null==p.d.global?void 0:p.d.global.Linking;if(typeof e<"u"){e.addEventListener("url",this.handleLinkModeMessage,this.client.name);const t=await e.getInitialURL();t&&setTimeout(()=>{this.handleLinkModeMessage({url:t})},50)}}}),dd(this,"shouldSetTVF",(e,t)=>{if(!t||"wc_sessionRequest"!==e)return!1;const{request:i}=t;return Object.keys(Xh).includes(i.method)}),dd(this,"getTVFParams",(e,t,i)=>{var s,n;try{const r=t.request.method,o=this.extractTxHashesFromResult(r,i);return hd(ld({correlationId:e,rpcMethods:[r],chainId:t.chainId},this.isValidContractData(t.request.params)&&{contractAddresses:[null==(n=null==(s=t.request.params)?void 0:s[0])?void 0:n.to]}),{txHashes:o})}catch(r){this.client.logger.warn("Error getting TVF params",r)}return{}}),dd(this,"isValidContractData",e=>{var t;if(!e)return!1;try{const i=(null==e?void 0:e.data)||(null==(t=null==e?void 0:e[0])?void 0:t.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return!!/^[0-9a-fA-F]*$/.test(s)&&s.length%2===0}catch(i){}return!1}),dd(this,"extractTxHashesFromResult",(e,t)=>{try{if("string"==typeof t)return[t];const i=t[Xh[e].key];if(Tr(i))return i;if("string"==typeof i)return[i]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}isInitialized(){if(!this.initialized){const{message:e}=Sr("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ao,e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):this.onRelayMessage(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:s,transportType:n}=e,{publicKey:r}=this.client.auth.authKeys.keys.includes(td)?this.client.auth.authKeys.get(td):{publicKey:void 0},o=await this.client.core.crypto.decode(t,i,{receiverPublicKey:r,encoding:n===bo.link_mode?er:$n});try{(0,v.n)(o)?(this.client.core.history.set(t,o),this.onRelayEventRequest({topic:t,payload:o,attestation:s,transportType:n,encryptedId:nr(i)})):(0,v.p)(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:t,payload:o,transportType:n}),this.client.core.history.delete(t,o.id)):this.onRelayEventUnknownPayload({topic:t,payload:o,transportType:n})}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Lo,async e=>{const{topic:t,id:i}=mi(e.target);return i&&this.client.pendingRequest.keys.includes(i)?await this.deletePendingSessionRequest(i,Sr("EXPIRED"),!0):i&&this.client.auth.requests.keys.includes(i)?await this.deletePendingAuthRequest(i,Sr("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i})))})}registerPairingEvents(){this.client.core.pairing.events.on(To,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(_o,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Or(e,!1)){const{message:t}=Sr("MISSING_OR_INVALID","pairing topic should be a string: ".concat(e));throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=Sr("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(e));throw new Error(t)}if(vi(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=Sr("EXPIRED","pairing topic: ".concat(e));throw new Error(t)}}async isValidSessionTopic(e){if(!Or(e,!1)){const{message:t}=Sr("MISSING_OR_INVALID","session topic should be a string: ".concat(e));throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=Sr("NO_MATCHING_KEY","session topic doesn't exist: ".concat(e));throw new Error(t)}if(vi(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=Sr("EXPIRED","session topic: ".concat(e));throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=Sr("MISSING_OR_INVALID","session topic does not exist in keychain: ".concat(e));throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else{if(!this.client.core.pairing.pairings.keys.includes(e)){if(Or(e,!1)){const{message:t}=Sr("NO_MATCHING_KEY","session or pairing topic doesn't exist: ".concat(e));throw new Error(t)}{const{message:t}=Sr("MISSING_OR_INVALID","session or pairing topic should be a string: ".concat(e));throw new Error(t)}}this.isValidPairingTopic(e)}}async isValidProposalId(e){if(!function(e){return"number"==typeof e}(e)){const{message:t}=Sr("MISSING_OR_INVALID","proposal id should be a number: ".concat(e));throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=Sr("NO_MATCHING_KEY","proposal id doesn't exist: ".concat(e));throw new Error(t)}if(vi(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=Sr("EXPIRED","proposal id: ".concat(e));throw new Error(t)}}},pd=class extends rh{constructor(e,t){super(e,t,"proposal",Vh),this.core=e,this.logger=t}},gd=class extends rh{constructor(e,t){super(e,t,"session",Vh),this.core=e,this.logger=t}},fd=class extends rh{constructor(e,t){super(e,t,"request",Vh,e=>e.id),this.core=e,this.logger=t}},wd=class extends rh{constructor(e,t){super(e,t,"authKeys",ed,()=>td),this.core=e,this.logger=t}},md=class extends rh{constructor(e,t){super(e,t,"pairingTopics",ed),this.core=e,this.logger=t}},yd=class extends rh{constructor(e,t){super(e,t,"requests",ed,e=>e.id),this.core=e,this.logger=t}};var vd=Object.defineProperty,bd=(e,t,i)=>((e,t,i)=>t in e?vd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let Id=class{constructor(e,t){this.core=e,this.logger=t,bd(this,"authKeys"),bd(this,"pairingTopics"),bd(this,"requests"),this.authKeys=new wd(this.core,this.logger),this.pairingTopics=new md(this.core,this.logger),this.requests=new yd(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}};var Ed=Object.defineProperty,Nd=(e,t,i)=>((e,t,i)=>t in e?Ed(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let Ad=class e extends zh{constructor(e){super(e),Nd(this,"protocol","wc"),Nd(this,"version",2),Nd(this,"name",Hh),Nd(this,"metadata"),Nd(this,"core"),Nd(this,"logger"),Nd(this,"events",new g.e.EventEmitter),Nd(this,"engine"),Nd(this,"session"),Nd(this,"proposal"),Nd(this,"pendingRequest"),Nd(this,"auth"),Nd(this,"signConfig"),Nd(this,"on",(e,t)=>this.events.on(e,t)),Nd(this,"once",(e,t)=>this.events.once(e,t)),Nd(this,"off",(e,t)=>this.events.off(e,t)),Nd(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),Nd(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),Nd(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"update",async e=>{try{return await this.engine.update(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"request",async e=>{try{return await this.engine.request(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"find",e=>{try{return this.engine.find(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),Nd(this,"authenticate",async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(i){throw this.logger.error(i.message),i}}),Nd(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}}),Nd(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}}),this.name=(null==e?void 0:e.name)||Hh,this.metadata=(null==e?void 0:e.metadata)||ci(),this.signConfig=null==e?void 0:e.signConfig;const t=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:(0,v.O)((0,v.k)({level:(null==e?void 0:e.logger)||Kh}));this.core=(null==e?void 0:e.core)||new Rh(e),this.logger=(0,v.E)(t,this.name),this.session=new gd(this.core,this.logger),this.proposal=new pd(this.core,this.logger),this.pendingRequest=new fd(this.core,this.logger),this.engine=new ud(this),this.auth=new Id(this.core,this.logger)}static async init(t){const i=new e(t);return await i.initialize(),i}get context(){return(0,v.y)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},v.c.toMiliseconds(v.c.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Cd="error",Sd="".concat("wc","@2:").concat("universal_provider",":"),Pd="https://rpc.walletconnect.org/v1/",Td="generic",Md="".concat(Pd,"bundler"),_d="default_chain_changed";var Od=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof p.d.global<"u"?p.d.global:typeof self<"u"?self:{};var xd=function(){this.__data__=[],this.size=0};var kd=function(e,t){return e===t||e!==e&&t!==t},Dd=kd;var jd=function(e,t){for(var i=e.length;i--;)if(Dd(e[i][0],t))return i;return-1},Rd=jd,Ud=Array.prototype.splice;var Ld=function(e){var t=this.__data__,i=Rd(t,e);return!(i<0)&&(i==t.length-1?t.pop():Ud.call(t,i,1),--this.size,!0)},zd=jd;var qd=function(e){var t=this.__data__,i=zd(t,e);return i<0?void 0:t[i][1]},Bd=jd;var Vd=function(e){return Bd(this.__data__,e)>-1},Hd=jd;var Kd=function(e,t){var i=this.__data__,s=Hd(i,e);return s<0?(++this.size,i.push([e,t])):i[s][1]=t,this},Wd=xd,Fd=Ld,Gd=qd,Yd=Vd,Qd=Kd;function Zd(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}Zd.prototype.clear=Wd,Zd.prototype.delete=Fd,Zd.prototype.get=Gd,Zd.prototype.has=Yd,Zd.prototype.set=Qd;var Jd=Zd,Xd=Jd;var $d=function(){this.__data__=new Xd,this.size=0};var eu=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i};var tu=function(e){return this.__data__.get(e)};var iu=function(e){return this.__data__.has(e)},su="object"==typeof Od&&Od&&Od.Object===Object&&Od,nu=su,ru="object"==typeof self&&self&&self.Object===Object&&self,ou=nu||ru||Function("return this")(),au=ou.Symbol,cu=au,lu=Object.prototype,hu=lu.hasOwnProperty,du=lu.toString,uu=cu?cu.toStringTag:void 0;var pu=function(e){var t=hu.call(e,uu),i=e[uu];try{e[uu]=void 0;var s=!0}catch(r){}var n=du.call(e);return s&&(t?e[uu]=i:delete e[uu]),n},gu=Object.prototype.toString;var fu=function(e){return gu.call(e)},wu=pu,mu=fu,yu=au?au.toStringTag:void 0;var vu=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":yu&&yu in Object(e)?wu(e):mu(e)};var bu=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Iu=vu,Eu=bu;var Nu=function(e){if(!Eu(e))return!1;var t=Iu(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Au=ou["__core-js_shared__"],Cu=function(){var e=/[^.]+$/.exec(Au&&Au.keys&&Au.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var Su=function(e){return!!Cu&&Cu in e},Pu=Function.prototype.toString;var Tu=function(e){if(null!=e){try{return Pu.call(e)}catch(t){}try{return e+""}catch(i){}}return""},Mu=Nu,_u=Su,Ou=bu,xu=Tu,ku=/^\[object .+?Constructor\]$/,Du=Function.prototype,ju=Object.prototype,Ru=Du.toString,Uu=ju.hasOwnProperty,Lu=RegExp("^"+Ru.call(Uu).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var zu=function(e){return!(!Ou(e)||_u(e))&&(Mu(e)?Lu:ku).test(xu(e))};var qu=function(e,t){return null==e?void 0:e[t]},Bu=zu,Vu=qu;var Hu=function(e,t){var i=Vu(e,t);return Bu(i)?i:void 0},Ku=Hu(ou,"Map"),Wu=Hu(Object,"create"),Fu=Wu;var Gu=function(){this.__data__=Fu?Fu(null):{},this.size=0};var Yu=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Qu=Wu,Zu=Object.prototype.hasOwnProperty;var Ju=function(e){var t=this.__data__;if(Qu){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return Zu.call(t,e)?t[e]:void 0},Xu=Wu,$u=Object.prototype.hasOwnProperty;var ep=function(e){var t=this.__data__;return Xu?void 0!==t[e]:$u.call(t,e)},tp=Wu;var ip=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=tp&&void 0===t?"__lodash_hash_undefined__":t,this},sp=Gu,np=Yu,rp=Ju,op=ep,ap=ip;function cp(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}cp.prototype.clear=sp,cp.prototype.delete=np,cp.prototype.get=rp,cp.prototype.has=op,cp.prototype.set=ap;var lp=cp,hp=Jd,dp=Ku;var up=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e},pp=up;var gp=function(e,t){var i=e.__data__;return pp(t)?i["string"==typeof t?"string":"hash"]:i.map},fp=gp;var wp=function(e){var t=fp(this,e).delete(e);return this.size-=t?1:0,t},mp=gp;var yp=function(e){return mp(this,e).get(e)},vp=gp;var bp=function(e){return vp(this,e).has(e)},Ip=gp;var Ep=function(e,t){var i=Ip(this,e),s=i.size;return i.set(e,t),this.size+=i.size==s?0:1,this},Np=function(){this.size=0,this.__data__={hash:new lp,map:new(dp||hp),string:new lp}},Ap=wp,Cp=yp,Sp=bp,Pp=Ep;function Tp(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var s=e[t];this.set(s[0],s[1])}}Tp.prototype.clear=Np,Tp.prototype.delete=Ap,Tp.prototype.get=Cp,Tp.prototype.has=Sp,Tp.prototype.set=Pp;var Mp=Jd,_p=Ku,Op=Tp;var xp=function(e,t){var i=this.__data__;if(i instanceof Mp){var s=i.__data__;if(!_p||s.length<199)return s.push([e,t]),this.size=++i.size,this;i=this.__data__=new Op(s)}return i.set(e,t),this.size=i.size,this},kp=Jd,Dp=$d,jp=eu,Rp=tu,Up=iu,Lp=xp;function zp(e){var t=this.__data__=new kp(e);this.size=t.size}zp.prototype.clear=Dp,zp.prototype.delete=jp,zp.prototype.get=Rp,zp.prototype.has=Up,zp.prototype.set=Lp;var qp=zp,Bp=Hu,Vp=function(){try{var e=Bp(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),Hp=Vp,Kp=Hp;var Wp=function(e,t,i){"__proto__"==t&&Kp?Kp(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i},Fp=Wp,Gp=kd;var Yp=function(e,t,i){(void 0!==i&&!Gp(e[t],i)||void 0===i&&!(t in e))&&Fp(e,t,i)};var Qp=function(e){return function(t,i,s){for(var n=-1,r=Object(t),o=s(t),a=o.length;a--;){var c=o[e?a:++n];if(!1===i(r[c],c,r))break}return t}},Zp=Qp(),Jp={exports:{}};!function(e,t){var i=ou,s=t&&!t.nodeType&&t,n=s&&e&&!e.nodeType&&e,r=n&&n.exports===s?i.Buffer:void 0,o=r?r.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var i=e.length,s=o?o(i):new e.constructor(i);return e.copy(s),s}}(Jp,Jp.exports);var Xp=ou.Uint8Array;var $p=function(e){var t=new e.constructor(e.byteLength);return new Xp(t).set(new Xp(e)),t},eg=$p;var tg=function(e,t){var i=t?eg(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)};var ig=function(e,t){var i=-1,s=e.length;for(t||(t=Array(s));++i<s;)t[i]=e[i];return t},sg=bu,ng=Object.create,rg=function(){function e(){}return function(t){if(!sg(t))return{};if(ng)return ng(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),og=rg;var ag=function(e,t){return function(i){return e(t(i))}},cg=ag(Object.getPrototypeOf,Object),lg=Object.prototype;var hg=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||lg)},dg=og,ug=cg,pg=hg;var gg=function(e){return"function"!=typeof e.constructor||pg(e)?{}:dg(ug(e))};var fg=function(e){return null!=e&&"object"==typeof e},wg=vu,mg=fg;var yg=function(e){return mg(e)&&"[object Arguments]"==wg(e)},vg=yg,bg=fg,Ig=Object.prototype,Eg=Ig.hasOwnProperty,Ng=Ig.propertyIsEnumerable,Ag=vg(function(){return arguments}())?vg:function(e){return bg(e)&&Eg.call(e,"callee")&&!Ng.call(e,"callee")},Cg=Ag,Sg=Array.isArray;var Pg=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Tg=Nu,Mg=Pg;var _g=function(e){return null!=e&&Mg(e.length)&&!Tg(e)},Og=_g,xg=fg;var kg=function(e){return xg(e)&&Og(e)},Dg={exports:{}};var jg=function(){return!1};!function(e,t){var i=ou,s=jg,n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,o=r&&r.exports===n?i.Buffer:void 0,a=(o?o.isBuffer:void 0)||s;e.exports=a}(Dg,Dg.exports);var Rg=vu,Ug=cg,Lg=fg,zg=Function.prototype,qg=Object.prototype,Bg=zg.toString,Vg=qg.hasOwnProperty,Hg=Bg.call(Object);var Kg=function(e){if(!Lg(e)||"[object Object]"!=Rg(e))return!1;var t=Ug(e);if(null===t)return!0;var i=Vg.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Bg.call(i)==Hg},Wg=vu,Fg=Pg,Gg=fg,Yg={};Yg["[object Float32Array]"]=Yg["[object Float64Array]"]=Yg["[object Int8Array]"]=Yg["[object Int16Array]"]=Yg["[object Int32Array]"]=Yg["[object Uint8Array]"]=Yg["[object Uint8ClampedArray]"]=Yg["[object Uint16Array]"]=Yg["[object Uint32Array]"]=!0,Yg["[object Arguments]"]=Yg["[object Array]"]=Yg["[object ArrayBuffer]"]=Yg["[object Boolean]"]=Yg["[object DataView]"]=Yg["[object Date]"]=Yg["[object Error]"]=Yg["[object Function]"]=Yg["[object Map]"]=Yg["[object Number]"]=Yg["[object Object]"]=Yg["[object RegExp]"]=Yg["[object Set]"]=Yg["[object String]"]=Yg["[object WeakMap]"]=!1;var Qg=function(e){return Gg(e)&&Fg(e.length)&&!!Yg[Wg(e)]};var Zg=function(e){return function(t){return e(t)}},Jg={exports:{}};!function(e,t){var i=su,s=t&&!t.nodeType&&t,n=s&&e&&!e.nodeType&&e,r=n&&n.exports===s&&i.process,o=function(){try{return n&&n.require&&n.require("util").types||r&&r.binding&&r.binding("util")}catch(e){}}();e.exports=o}(Jg,Jg.exports);var Xg=Qg,$g=Zg,ef=Jg.exports,tf=ef&&ef.isTypedArray,sf=tf?$g(tf):Xg;var nf=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},rf=Wp,of=kd,af=Object.prototype.hasOwnProperty;var cf=function(e,t,i){var s=e[t];(!af.call(e,t)||!of(s,i)||void 0===i&&!(t in e))&&rf(e,t,i)},lf=cf,hf=Wp;var df=function(e,t,i,s){var n=!i;i||(i={});for(var r=-1,o=t.length;++r<o;){var a=t[r],c=s?s(i[a],e[a],a,i,e):void 0;void 0===c&&(c=e[a]),n?hf(i,a,c):lf(i,a,c)}return i};var uf=function(e,t){for(var i=-1,s=Array(e);++i<e;)s[i]=t(i);return s},pf=/^(?:0|[1-9]\d*)$/;var gf=function(e,t){var i=typeof e;return!!(t=null!==t&&void 0!==t?t:9007199254740991)&&("number"==i||"symbol"!=i&&pf.test(e))&&e>-1&&e%1==0&&e<t},ff=uf,wf=Cg,mf=Sg,yf=Dg.exports,vf=gf,bf=sf,If=Object.prototype.hasOwnProperty;var Ef=function(e,t){var i=mf(e),s=!i&&wf(e),n=!i&&!s&&yf(e),r=!i&&!s&&!n&&bf(e),o=i||s||n||r,a=o?ff(e.length,String):[],c=a.length;for(var l in e)(t||If.call(e,l))&&(!o||!("length"==l||n&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||vf(l,c)))&&a.push(l);return a};var Nf=function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t},Af=bu,Cf=hg,Sf=Nf,Pf=Object.prototype.hasOwnProperty;var Tf=function(e){if(!Af(e))return Sf(e);var t=Cf(e),i=[];for(var s in e)"constructor"==s&&(t||!Pf.call(e,s))||i.push(s);return i},Mf=Ef,_f=Tf,Of=_g;var xf=function(e){return Of(e)?Mf(e,!0):_f(e)},kf=df,Df=xf;var jf=function(e){return kf(e,Df(e))},Rf=Yp,Uf=Jp.exports,Lf=tg,zf=ig,qf=gg,Bf=Cg,Vf=Sg,Hf=kg,Kf=Dg.exports,Wf=Nu,Ff=bu,Gf=Kg,Yf=sf,Qf=nf,Zf=jf;var Jf=function(e,t,i,s,n,r,o){var a=Qf(e,i),c=Qf(t,i),l=o.get(c);if(l)Rf(e,i,l);else{var h=r?r(a,c,i+"",e,t,o):void 0,d=void 0===h;if(d){var u=Vf(c),p=!u&&Kf(c),g=!u&&!p&&Yf(c);h=c,u||p||g?Vf(a)?h=a:Hf(a)?h=zf(a):p?(d=!1,h=Uf(c,!0)):g?(d=!1,h=Lf(c,!0)):h=[]:Gf(c)||Bf(c)?(h=a,Bf(a)?h=Zf(a):(!Ff(a)||Wf(a))&&(h=qf(c))):d=!1}d&&(o.set(c,h),n(h,c,s,r,o),o.delete(c)),Rf(e,i,h)}},Xf=qp,$f=Yp,ew=Zp,tw=Jf,iw=bu,sw=xf,nw=nf;var rw=function e(t,i,s,n,r){t!==i&&ew(i,function(o,a){if(r||(r=new Xf),iw(o))tw(t,i,a,s,e,n,r);else{var c=n?n(nw(t,a),o,a+"",t,i,r):void 0;void 0===c&&(c=o),$f(t,a,c)}},sw)};var ow=function(e){return e};var aw=function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)},cw=aw,lw=Math.max;var hw=function(e,t,i){return t=lw(void 0===t?e.length-1:t,0),function(){for(var s=arguments,n=-1,r=lw(s.length-t,0),o=Array(r);++n<r;)o[n]=s[t+n];n=-1;for(var a=Array(t+1);++n<t;)a[n]=s[n];return a[t]=i(o),cw(e,this,a)}};var dw=function(e){return function(){return e}},uw=dw,pw=Hp,gw=pw?function(e,t){return pw(e,"toString",{configurable:!0,enumerable:!1,value:uw(t),writable:!0})}:ow,fw=gw,ww=Date.now;var mw=function(e){var t=0,i=0;return function(){var s=ww(),n=16-(s-i);if(i=s,n>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}},yw=mw(fw),vw=ow,bw=hw,Iw=yw;var Ew=function(e,t){return Iw(bw(e,t,vw),e+"")},Nw=kd,Aw=_g,Cw=gf,Sw=bu;var Pw=function(e,t,i){if(!Sw(i))return!1;var s=typeof t;return!!("number"==s?Aw(i)&&Cw(t,i.length):"string"==s&&t in i)&&Nw(i[t],e)},Tw=Ew,Mw=Pw;var _w=function(e){return Tw(function(t,i){var s=-1,n=i.length,r=n>1?i[n-1]:void 0,o=n>2?i[2]:void 0;for(r=e.length>3&&"function"==typeof r?(n--,r):void 0,o&&Mw(i[0],i[1],o)&&(r=n<3?void 0:r,n=1),t=Object(t);++s<n;){var a=i[s];a&&e(t,a,s,r)}return t})},Ow=rw,xw=_w(function(e,t,i){Ow(e,t,i)}),kw=xw,Dw=Object.defineProperty,jw=Object.defineProperties,Rw=Object.getOwnPropertyDescriptors,Uw=Object.getOwnPropertySymbols,Lw=Object.prototype.hasOwnProperty,zw=Object.prototype.propertyIsEnumerable,qw=(e,t,i)=>t in e?Dw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Bw=(e,t)=>{for(var i in t||(t={}))Lw.call(t,i)&&qw(e,i,t[i]);if(Uw)for(var i of Uw(t))zw.call(t,i)&&qw(e,i,t[i]);return e},Vw=(e,t)=>jw(e,Rw(t));function Hw(e,t,i){var s;const n=Zt(e);return(null==(s=t.rpcMap)?void 0:s[n.reference])||"".concat(Pd,"?chainId=").concat(n.namespace,":").concat(n.reference,"&projectId=").concat(i)}function Kw(e){return e.includes(":")?e.split(":")[1]:e}function Ww(e){return e.map(e=>"".concat(e.split(":")[0],":").concat(e.split(":")[1]))}function Fw(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const t=Gw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),i=Gw(e);return kw(t,i)}function Gw(e){var t,i,s,n;const r={};if(!Mr(e))return r;for(const[o,a]of Object.entries(e)){const e=Ir(o)?[o]:a.chains,c=a.methods||[],l=a.events||[],h=a.rpcMap||{},d=Er(o);r[d]=Vw(Bw(Bw({},r[d]),a),{chains:Ii(e,null==(t=r[d])?void 0:t.chains),methods:Ii(c,null==(i=r[d])?void 0:i.methods),events:Ii(l,null==(s=r[d])?void 0:s.events),rpcMap:Bw(Bw({},h),null==(n=r[d])?void 0:n.rpcMap)})}return r}function Yw(e){return e.includes(":")?e.split(":")[2]:e}function Qw(e){const t={};for(const[i,s]of Object.entries(e)){const e=s.methods||[],n=s.events||[],r=s.accounts||[],o=Ir(i)?[i]:s.chains?s.chains:Ww(s.accounts);t[i]={chains:o,methods:e,events:n,accounts:r}}return t}function Zw(e){return"number"==typeof e?e:e.includes("0x")?parseInt(e,16):(e=e.includes(":")?e.split(":")[1]:e,isNaN(Number(e))?e:Number(e))}const Jw={},Xw=e=>Jw[e],$w=(e,t)=>{Jw[e]=t};var em=Object.defineProperty,tm=(e,t,i)=>((e,t,i)=>t in e?em(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class im{constructor(e){tm(this,"name","polkadot"),tm(this,"client"),tm(this,"httpProviders"),tm(this,"events"),tm(this,"namespace"),tm(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(e))}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Kw(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}}var sm=Object.defineProperty,nm=Object.defineProperties,rm=Object.getOwnPropertyDescriptors,om=Object.getOwnPropertySymbols,am=Object.prototype.hasOwnProperty,cm=Object.prototype.propertyIsEnumerable,lm=(e,t,i)=>t in e?sm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,hm=(e,t)=>{for(var i in t||(t={}))am.call(t,i)&&lm(e,i,t[i]);if(om)for(var i of om(t))cm.call(t,i)&&lm(e,i,t[i]);return e},dm=(e,t)=>nm(e,rm(t)),um=(e,t,i)=>lm(e,"symbol"!=typeof t?t+"":t,i);class pm{constructor(e){um(this,"name","eip155"),um(this,"client"),um(this,"chainId"),um(this,"namespace"),um(this,"httpProviders"),um(this,"events"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(_d,"".concat(this.name,":").concat(e))}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||Hw("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(Kw(t));e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}async handleSwitchChain(e){var t,i;let s=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:"0x".concat(s);const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain("".concat(n));else{if(!this.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error("Failed to switch to chain 'eip155:".concat(n,"'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method."));await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:null==(i=this.namespace.chains)?void 0:i[0]}),this.setDefaultChain("".concat(n))}return null}isChainApproved(e){return this.namespace.chains.includes("".concat(this.name,":").concat(e))}async getCapabilities(e){var t,i,s;const n=null==(i=null==(t=e.request)?void 0:t.params)?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const r=this.client.session.get(e.topic),o=(null==(s=null==r?void 0:r.sessionProperties)?void 0:s.capabilities)||{};if(null!=o&&o[n])return null==o?void 0:o[n];const a=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:dm(hm({},r.sessionProperties||{}),{capabilities:dm(hm({},o||{}),{[n]:a})})})}catch(c){console.warn("Failed to update session with capabilities",c)}return a}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),n=null==(t=s.sessionProperties)?void 0:t.bundler_name;if(n){const t=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(t,e)}catch(o){console.warn("Failed to fetch call status from bundler",o,t)}}const r=null==(i=s.sessionProperties)?void 0:i.bundler_url;if(r)try{return await this.getUserOperationReceipt(r,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,r)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,v.l)("eth_getUserOperationReceipt",[null==(i=t.request.params)?void 0:i[0]]))});if(!n.ok)throw new Error("Failed to fetch user operation receipt - ".concat(n.status));return await n.json()}getBundlerUrl(e,t){return"".concat(Md,"?projectId=").concat(this.client.core.projectId,"&chainId=").concat(e,"&bundler=").concat(t)}}var gm=Object.defineProperty,fm=(e,t,i)=>((e,t,i)=>t in e?gm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class wm{constructor(e){fm(this,"name","solana"),fm(this,"client"),fm(this,"httpProviders"),fm(this,"events"),fm(this,"namespace"),fm(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Kw(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}}var mm=Object.defineProperty,ym=(e,t,i)=>((e,t,i)=>t in e?mm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class vm{constructor(e){ym(this,"name","cosmos"),ym(this,"client"),ym(this,"httpProviders"),ym(this,"events"),ym(this,"namespace"),ym(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Kw(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}}var bm=Object.defineProperty,Im=(e,t,i)=>((e,t,i)=>t in e?bm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Em{constructor(e){Im(this,"name","algorand"),Im(this,"client"),Im(this,"httpProviders"),Im(this,"events"),Im(this,"namespace"),Im(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||Hw("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,i)}this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(this.chainId))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new v.o(new v.G(i,Xw("disableProviderPing")))}}var Nm=Object.defineProperty,Am=(e,t,i)=>((e,t,i)=>t in e?Nm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Cm{constructor(e){Am(this,"name","cip34"),Am(this,"client"),Am(this,"httpProviders"),Am(this,"events"),Am(this,"namespace"),Am(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=Kw(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}}var Sm=Object.defineProperty,Pm=(e,t,i)=>((e,t,i)=>t in e?Sm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Tm{constructor(e){Pm(this,"name","elrond"),Pm(this,"client"),Pm(this,"httpProviders"),Pm(this,"events"),Pm(this,"namespace"),Pm(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Kw(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}}var Mm=Object.defineProperty,_m=(e,t,i)=>((e,t,i)=>t in e?Mm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Om{constructor(e){_m(this,"name","multiversx"),_m(this,"client"),_m(this,"httpProviders"),_m(this,"events"),_m(this,"namespace"),_m(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=Kw(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}}var xm=Object.defineProperty,km=(e,t,i)=>((e,t,i)=>t in e?xm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Dm{constructor(e){km(this,"name","near"),km(this,"client"),km(this,"httpProviders"),km(this,"events"),km(this,"namespace"),km(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Hw("".concat(this.name,":").concat(e),this.namespace);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,i)}this.events.emit(_d,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace);return typeof i>"u"?void 0:new v.o(new v.G(i,Xw("disableProviderPing")))}}var jm=Object.defineProperty,Rm=(e,t,i)=>((e,t,i)=>t in e?jm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Um{constructor(e){Rm(this,"name","tezos"),Rm(this,"client"),Rm(this,"httpProviders"),Rm(this,"events"),Rm(this,"namespace"),Rm(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||Hw("".concat(this.name,":").concat(e),this.namespace);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,i)}this.events.emit(_d,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace);return typeof i>"u"?void 0:new v.o(new v.G(i))}}var Lm=Object.defineProperty,zm=(e,t,i)=>((e,t,i)=>t in e?Lm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class qm{constructor(e){zm(this,"name",Td),zm(this,"client"),zm(this,"httpProviders"),zm(this,"events"),zm(this,"namespace"),zm(this,"chainId"),this.namespace=e.namespace,this.events=Xw("events"),this.client=Xw("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(_d,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(e=>{const t=Zt(e);i["".concat(t.namespace,":").concat(t.reference)]=this.createHttpProvider(e)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||Hw(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,Xw("disableProviderPing")))}}var Bm=Object.defineProperty,Vm=Object.defineProperties,Hm=Object.getOwnPropertyDescriptors,Km=Object.getOwnPropertySymbols,Wm=Object.prototype.hasOwnProperty,Fm=Object.prototype.propertyIsEnumerable,Gm=(e,t,i)=>t in e?Bm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Ym=(e,t)=>{for(var i in t||(t={}))Wm.call(t,i)&&Gm(e,i,t[i]);if(Km)for(var i of Km(t))Fm.call(t,i)&&Gm(e,i,t[i]);return e},Qm=(e,t)=>Vm(e,Hm(t)),Zm=(e,t,i)=>Gm(e,"symbol"!=typeof t?t+"":t,i);class Jm{constructor(e){Zm(this,"client"),Zm(this,"namespaces"),Zm(this,"optionalNamespaces"),Zm(this,"sessionProperties"),Zm(this,"events",new g.E),Zm(this,"rpcProviders",{}),Zm(this,"session"),Zm(this,"providerOpts"),Zm(this,"logger"),Zm(this,"uri"),Zm(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:(0,v.O)((0,v.k)({level:(null==e?void 0:e.logger)||Cd})),this.disableProviderPing=(null==e?void 0:e.disableProviderPing)||!1}static async init(e){const t=new Jm(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Ym({},e),chainId:"".concat(s,":").concat(n),topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=(new Date).getTime();this.request(e,i,s).then(e=>t(null,(0,v.q)(n,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:Pr("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const e=Qw(this.session.namespaces);this.namespaces=Fw(this.namespaces,e),this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=Qw(s.namespaces);return this.namespaces=Fw(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===Td?n.setDefaultChain("".concat(i,":").concat(s),t):n.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(Tr(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info("Inactive pairings cleared: ".concat(t.length))}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Ad.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Cd,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(e=>Er(e)))];$w("client",this.client),$w("events",this.events),$w("disableProviderPing",this.disableProviderPing),e.forEach(e=>{if(!this.session)return;const t=function(e,t){const i=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!i.length)return[];const s=[];return i.forEach(e=>{const i=t.namespaces[e].accounts;s.push(...i)}),s}(e,this.session),i=Ww(t),s=Fw(this.namespaces,this.optionalNamespaces),n=Qm(Ym({},s[e]),{accounts:t,chains:i});switch(e){case"eip155":this.rpcProviders[e]=new pm({namespace:n});break;case"algorand":this.rpcProviders[e]=new Em({namespace:n});break;case"solana":this.rpcProviders[e]=new wm({namespace:n});break;case"cosmos":this.rpcProviders[e]=new vm({namespace:n});break;case"polkadot":this.rpcProviders[e]=new im({namespace:n});break;case"cip34":this.rpcProviders[e]=new Cm({namespace:n});break;case"elrond":this.rpcProviders[e]=new Tm({namespace:n});break;case"multiversx":this.rpcProviders[e]=new Om({namespace:n});break;case"near":this.rpcProviders[e]=new Dm({namespace:n});break;case"tezos":this.rpcProviders[e]=new Um({namespace:n});break;default:this.rpcProviders[Td]?this.rpcProviders[Td].updateNamespace(n):this.rpcProviders[Td]=new qm({namespace:n})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;if("accountsChanged"===i.name){const e=i.data;e&&Tr(e)&&this.events.emit("accountsChanged",e.map(Yw))}else if("chainChanged"===i.name){const e=t.chainId,i=t.event.data,s=Er(e),n=Zw(e)!==Zw(i)?"".concat(s,":").concat(Zw(i)):e;this.onChainChanged(n)}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",e=>{let{topic:t,params:i}=e;var s;const{namespaces:n}=i,r=null==(s=this.client)?void 0:s.session.get(t);this.session=Qm(Ym({},r),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:i})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Qm(Ym({},Pr("USER_DISCONNECTED")),{data:e.topic}))}),this.on(_d,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Td]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.persist("namespaces",t),this.persist("optionalNamespaces",i)}validateChain(e){const[t,i]=(null==e?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(e=>Er(e)).includes(t))throw new Error("Namespace '".concat(t,"' is not configured. Please call connect() first with namespace config."));if(t&&i)return[t,i];const s=Er(Object.keys(this.namespaces)[0]);return[s,this.rpcProviders[s].getDefaultChain()]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(t||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces["".concat(i,":").concat(s)]?this.namespaces["".concat(i,":").concat(s)].defaultChain=s:this.namespaces["".concat(i,":").concat(s)]={defaultChain:s},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",s))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem("".concat(Sd,"/").concat(e),t)}async getFromStore(e){return await this.client.core.storage.getItem("".concat(Sd,"/").concat(e))}}const Xm=Jm,$m={caipNetworkIdToNumber:e=>e?Number(e.split(":")[1]):void 0,parseEvmChainId(e){return"string"==typeof e?this.caipNetworkIdToNumber(e):e},getNetworksByNamespace:(e,t)=>(null==e?void 0:e.filter(e=>e.chainNamespace===t))||[],getFirstNetworkByNamespace(e,t){return this.getNetworksByNamespace(e,t)[0]}},ey={bigNumber:e=>e?new b.B(e):new b.B(0),multiply(e,t){if(void 0===e||void 0===t)return new b.B(0);const i=new b.B(e),s=new b.B(t);return i.times(s)},formatNumberToLocalString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return void 0===e?"0.00":"number"==typeof e?e.toLocaleString("en-US",{maximumFractionDigits:t,minimumFractionDigits:t}):parseFloat(e).toLocaleString("en-US",{maximumFractionDigits:t,minimumFractionDigits:t})},parseLocalStringToNumber:e=>void 0===e?0:parseFloat(e.replace(/,/g,""))},ty=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],iy=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],sy={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"ID_AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],HTTP_STATUS_CODES:{SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network"},ny=e=>sy.USDT_CONTRACT_ADDRESSES.includes(e)?iy:ty,ry={validateCaipAddress(e){var t;if(3!==(null==(t=e.split(":"))?void 0:t.length))throw new Error("Invalid CAIP Address");return e},parseCaipAddress(e){const t=e.split(":");if(3!==t.length)throw new Error("Invalid CAIP-10 address: ".concat(e));const[i,s,n]=t;if(!i||!s||!n)throw new Error("Invalid CAIP-10 address: ".concat(e));return{chainNamespace:i,chainId:s,address:n}},parseCaipNetworkId(e){const t=e.split(":");if(2!==t.length)throw new Error("Invalid CAIP-2 network id: ".concat(e));const[i,s]=t;if(!i||!s)throw new Error("Invalid CAIP-2 network id: ".concat(e));return{chainNamespace:i,chainId:s}}},oy="@appkit/active_caip_network_id",ay="@appkit/connected_social",cy="@appkit-wallet/SOCIAL_USERNAME",ly="@appkit/recent_wallets",hy="WALLETCONNECT_DEEPLINK_CHOICE",dy="@appkit/active_namespace",uy="@appkit/connected_namespaces",py="@appkit/connection_status",gy="@appkit/social_provider",fy="@appkit/native_balance_cache",wy="@appkit/portfolio_cache",my="@appkit/ens_cache",yy="@appkit/identity_cache";function vy(e){if(!e)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return"@appkit/".concat(e,":connected_connector_id")}const by={setItem(e,t){Iy()&&void 0!==t&&localStorage.setItem(e,t)},getItem(e){if(Iy())return localStorage.getItem(e)||void 0},removeItem(e){Iy()&&localStorage.removeItem(e)},clear(){Iy()&&localStorage.clear()}};function Iy(){return typeof window<"u"&&typeof localStorage<"u"}function Ey(e,t){return"light"===t?{"--w3m-accent":(null==e?void 0:e["--w3m-accent"])||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":(null==e?void 0:e["--w3m-accent"])||"hsla(230, 100%, 67%, 1)","--w3m-background":"#121313"}}const Ny=(typeof p.d.process<"u"&&typeof p.d.process.env<"u"?p.d.process.env.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",Ay={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,FIVE_SEC_MS:5e3,THREE_SEC_MS:3e3,ONE_SEC_MS:1e3,SECURE_SITE:Ny,SECURE_SITE_DASHBOARD:"".concat(Ny,"/dashboard"),SECURE_SITE_FAVICON:"".concat(Ny,"/images/favicon.png"),RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],WC_COINBASE_PAY_SDK_CHAINS:["ethereum","arbitrum","polygon","berachain","avalanche-c-chain","optimism","celo","base"],WC_COINBASE_PAY_SDK_FALLBACK_CHAIN:"ethereum",WC_COINBASE_PAY_SDK_CHAIN_NAME_MAP:{Ethereum:"ethereum","Arbitrum One":"arbitrum",Polygon:"polygon",Berachain:"berachain",Avalanche:"avalanche-c-chain","OP Mainnet":"optimism",Celo:"celo",Base:"base"},WC_COINBASE_ONRAMP_APP_ID:"bf18c88d-495a-463b-b249-0b9d3656cf5e",SWAP_SUGGESTED_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP"],SWAP_POPULAR_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP","METAL","DAI","CHAMP","WOLF","SALE","BAL","BUSD","MUST","BTCpx","ROUTE","HEX","WELT","amDAI","VSQ","VISION","AURUM","pSP","SNX","VC","LINK","CHP","amUSDT","SPHERE","FOX","GIDDY","GFC","OMEN","OX_OLD","DE","WNT"],BALANCE_SUPPORTED_CHAINS:["eip155","solana"],SWAP_SUPPORTED_NETWORKS:["eip155:1","eip155:42161","eip155:10","eip155:324","eip155:8453","eip155:56","eip155:137","eip155:100","eip155:43114","eip155:250","eip155:8217","eip155:1313161554"],NAMES_SUPPORTED_CHAIN_NAMESPACES:["eip155"],ONRAMP_SUPPORTED_CHAIN_NAMESPACES:["eip155","solana"],ACTIVITY_ENABLED_CHAIN_NAMESPACES:["eip155","solana"],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in a new browser tab"},DEFAULT_FEATURES:{swaps:!0,onramp:!0,receive:!0,send:!0,email:!0,emailShowWallets:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],history:!0,analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0},DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",BITCOIN:"bitcoin"}},Cy={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5},isCacheExpired:(e,t)=>Date.now()-e>t,getActiveNetworkProps(){const e=Cy.getActiveNamespace(),t=Cy.getActiveCaipNetworkId(),i=t?t.split(":")[1]:void 0;return{namespace:e,caipNetworkId:t,chainId:i?isNaN(Number(i))?i:Number(i):void 0}},setWalletConnectDeepLink(e){let{name:t,href:i}=e;try{by.setItem(hy,JSON.stringify({href:i,name:t}))}catch(s){console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const e=by.getItem(hy);if(e)return JSON.parse(e)}catch(e){console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{by.removeItem(hy)}catch(e){console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(e){try{by.setItem(dy,e)}catch(t){console.info("Unable to set active namespace")}},setActiveCaipNetworkId(e){try{by.setItem(oy,e),Cy.setActiveNamespace(e.split(":")[0])}catch(t){console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return by.getItem(oy)}catch(e){return void console.info("Unable to get active caip network id")}},deleteActiveCaipNetworkId(){try{by.removeItem(oy)}catch(e){console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(e){try{const t=vy(e);by.removeItem(t)}catch(t){console.info("Unable to delete connected connector id")}},setAppKitRecent(e){try{const t=Cy.getRecentWallets();t.find(t=>t.id===e.id)||(t.unshift(e),t.length>2&&t.pop(),by.setItem(ly,JSON.stringify(t)))}catch(t){console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const e=by.getItem(ly);return e?JSON.parse(e):[]}catch(e){console.info("Unable to get AppKit recent")}return[]},setConnectedConnectorId(e,t){try{const i=vy(e);by.setItem(i,t)}catch(i){console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return by.getItem(dy)}catch(e){console.info("Unable to get active namespace")}},getConnectedConnectorId(e){if(e)try{const t=vy(e);return by.getItem(t)}catch(t){console.info("Unable to get connected connector id in namespace ",e)}},setConnectedSocialProvider(e){try{by.setItem(ay,e)}catch(t){console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return by.getItem(ay)}catch(e){console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{by.removeItem(ay)}catch(e){console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return by.getItem(cy)}catch(e){console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var e;const t=by.getItem(oy);return null==(e=null==t?void 0:t.split(":"))?void 0:e[1]},setConnectionStatus(e){try{by.setItem(py,e)}catch(t){console.info("Unable to set connection status")}},getConnectionStatus(){try{return by.getItem(py)}catch(e){return}},getConnectedNamespaces(){try{const e=by.getItem(uy);return null!=e&&e.length?e.split(","):[]}catch(e){return[]}},setConnectedNamespaces(e){try{const t=Array.from(new Set(e));by.setItem(uy,t.join(","))}catch(t){console.info("Unable to set namespaces in storage")}},addConnectedNamespace(e){try{const t=Cy.getConnectedNamespaces();t.includes(e)||(t.push(e),Cy.setConnectedNamespaces(t))}catch(t){console.info("Unable to add connected namespace")}},removeConnectedNamespace(e){try{const t=Cy.getConnectedNamespaces(),i=t.indexOf(e);i>-1&&(t.splice(i,1),Cy.setConnectedNamespaces(t))}catch(t){console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return by.getItem(gy)}catch(e){return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(e){try{by.setItem(gy,e)}catch(t){console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{by.removeItem(gy)}catch(e){console.info("Unable to remove telegram social provider")}},getBalanceCache(){let e={};try{const t=by.getItem(wy);e=t?JSON.parse(t):{}}catch(t){console.info("Unable to get balance cache")}return e},removeAddressFromBalanceCache(e){try{const t=Cy.getBalanceCache();by.setItem(wy,JSON.stringify((0,d.A)((0,d.A)({},t),{},{[e]:void 0})))}catch(t){console.info("Unable to remove address from balance cache",e)}},getBalanceCacheForCaipAddress(e){try{const t=Cy.getBalanceCache()[e];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.portfolio))return t.balance;Cy.removeAddressFromBalanceCache(e)}catch(t){console.info("Unable to get balance cache for address",e)}},updateBalanceCache(e){try{const t=Cy.getBalanceCache();t[e.caipAddress]=e,by.setItem(wy,JSON.stringify(t))}catch(t){console.info("Unable to update balance cache",e)}},getNativeBalanceCache(){let e={};try{const t=by.getItem(fy);e=t?JSON.parse(t):{}}catch(t){console.info("Unable to get balance cache")}return e},removeAddressFromNativeBalanceCache(e){try{const t=Cy.getBalanceCache();by.setItem(fy,JSON.stringify((0,d.A)((0,d.A)({},t),{},{[e]:void 0})))}catch(t){console.info("Unable to remove address from balance cache",e)}},getNativeBalanceCacheForCaipAddress(e){try{const t=Cy.getNativeBalanceCache()[e];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.nativeBalance))return t;console.info("Discarding cache for address",e),Cy.removeAddressFromBalanceCache(e)}catch(t){console.info("Unable to get balance cache for address",e)}},updateNativeBalanceCache(e){try{const t=Cy.getNativeBalanceCache();t[e.caipAddress]=e,by.setItem(fy,JSON.stringify(t))}catch(t){console.info("Unable to update balance cache",e)}},getEnsCache(){let e={};try{const t=by.getItem(my);e=t?JSON.parse(t):{}}catch(t){console.info("Unable to get ens name cache")}return e},getEnsFromCacheForAddress(e){try{const t=Cy.getEnsCache()[e];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.ens))return t.ens;Cy.removeEnsFromCache(e)}catch(t){console.info("Unable to get ens name from cache",e)}},updateEnsCache(e){try{const t=Cy.getEnsCache();t[e.address]=e,by.setItem(my,JSON.stringify(t))}catch(t){console.info("Unable to update ens name cache",e)}},removeEnsFromCache(e){try{const t=Cy.getEnsCache();by.setItem(my,JSON.stringify((0,d.A)((0,d.A)({},t),{},{[e]:void 0})))}catch(t){console.info("Unable to remove ens name from cache",e)}},getIdentityCache(){let e={};try{const t=by.getItem(yy);e=t?JSON.parse(t):{}}catch(t){console.info("Unable to get identity cache")}return e},getIdentityFromCacheForAddress(e){try{const t=Cy.getIdentityCache()[e];if(t&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.identity))return t.identity;Cy.removeIdentityFromCache(e)}catch(t){console.info("Unable to get identity from cache",e)}},updateIdentityCache(e){try{const t=Cy.getIdentityCache();t[e.address]={identity:e.identity,timestamp:e.timestamp},by.setItem(yy,JSON.stringify(t))}catch(t){console.info("Unable to update identity cache",e)}},removeIdentityFromCache(e){try{const t=Cy.getIdentityCache();by.setItem(yy,JSON.stringify((0,d.A)((0,d.A)({},t),{},{[e]:void 0})))}catch(t){console.info("Unable to remove identity from cache",e)}},clearAddressCache(){try{by.removeItem(wy),by.removeItem(fy),by.removeItem(my),by.removeItem(yy)}catch(e){console.info("Unable to clear address cache")}}},Sy={isMobile(){var e;return!!this.isClient()&&!!(null!=(e=null==window?void 0:window.matchMedia("(pointer:coarse)"))&&e.matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/.test(navigator.userAgent))},checkCaipNetwork(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null==e?void 0:e.caipNetworkId.toLocaleLowerCase().includes(t.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const e=null==window?void 0:window.navigator.userAgent.toLowerCase();return Sy.isMobile()&&e.includes("android")},isIos(){if(!this.isMobile())return!1;const e=null==window?void 0:window.navigator.userAgent.toLowerCase();return e.includes("iphone")||e.includes("ipad")},isSafari(){return!!this.isClient()&&(null==window?void 0:window.navigator.userAgent.toLowerCase()).includes("safari")},isClient:()=>typeof window<"u",isPairingExpired:e=>!e||e-Date.now()<=Ay.TEN_SEC_MS,isAllowedRetry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ay.ONE_SEC_MS;return Date.now()-e>=t},copyToClopboard(e){navigator.clipboard.writeText(e)},isIframe(){try{return(null==window?void 0:window.self)!==(null==window?void 0:window.top)}catch(e){return!1}},getPairingExpiry:()=>Date.now()+Ay.FOUR_MINUTES_MS,getNetworkId:e=>null==e?void 0:e.split(":")[1],getPlainAddress:e=>null==e?void 0:e.split(":")[2],wait:async e=>new Promise(t=>{setTimeout(t,e)}),debounce(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];t&&clearTimeout(t),t=setTimeout(function(){e(...n)},i)}},isHttpUrl:e=>e.startsWith("http://")||e.startsWith("https://"),formatNativeUrl(e,t){if(Sy.isHttpUrl(e))return this.formatUniversalUrl(e,t);let i=e;i.includes("://")||(i=e.replaceAll("/","").replaceAll(":",""),i="".concat(i,"://")),i.endsWith("/")||(i="".concat(i,"/")),this.isTelegram()&&this.isAndroid()&&(t=encodeURIComponent(t));const s=encodeURIComponent(t);return{redirect:"".concat(i,"wc?uri=").concat(s),href:i}},formatUniversalUrl(e,t){if(!Sy.isHttpUrl(e))return this.formatNativeUrl(e,t);let i=e;i.endsWith("/")||(i="".concat(i,"/"));const s=encodeURIComponent(t);return{redirect:"".concat(i,"wc?uri=").concat(s),href:i}},getOpenTargetForPlatform(e){return"popupWindow"===e?e:this.isTelegram()?Cy.getTelegramSocialProvider()?"_top":"_blank":e},openHref(e,t,i){null==window||window.open(e,this.getOpenTargetForPlatform(t),i||"noreferrer noopener")},returnOpenHref(e,t,i){return null==window?void 0:window.open(e,this.getOpenTargetForPlatform(t),i||"noreferrer noopener")},isTelegram:()=>typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto),async preloadImage(e){const t=new Promise((t,i)=>{const s=new Image;s.onload=t,s.onerror=i,s.crossOrigin="anonymous",s.src=e});return Promise.race([t,Sy.wait(2e3)])},formatBalance(e,t){let i="0.000";if("string"==typeof e){const t=Number(e);if(t){const e=Math.floor(1e3*t)/1e3;e&&(i=e.toString())}}return"".concat(i).concat(t?" ".concat(t):"")},formatBalance2(e,t){var i;let s;if("0"===e)s="0";else if("string"==typeof e){const t=Number(e);t&&(s=null==(i=t.toString().match(/^-?[0-9]+(?:\.[0-9]{0,3})?/))?void 0:i[0])}return{value:null!==s&&void 0!==s?s:"0",rest:"0"===s?"000":"",symbol:t}},getApiUrl:()=>sy.W3M_API_URL,getBlockchainApiUrl:()=>sy.BLOCKCHAIN_API_RPC_URL,getAnalyticsUrl:()=>sy.PULSE_API_URL,getUUID:()=>null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),parseError(e){var t,i;return"string"==typeof e?e:"string"==typeof(null==(i=null==(t=null==e?void 0:e.issues)?void 0:t[0])?void 0:i.message)?e.issues[0].message:e instanceof Error?e.message:"Unknown error"},sortRequestedNetworks(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i={};return t&&e&&(e.forEach((e,t)=>{i[e]=t}),t.sort((e,t)=>{const s=i[e.id],n=i[t.id];return void 0!==s&&void 0!==n?s-n:void 0!==s?-1:void 0!==n?1:0})),t},calculateBalance(e){let t=0;for(const s of e){var i;t+=null!==(i=s.value)&&void 0!==i?i:0}return t},formatTokenBalance(e){const t=e.toFixed(2),[i,s]=t.split(".");return{dollars:i,pennies:s}},isAddress(e){switch(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"eip155"){case"eip155":return!!/^(?:0x)?[0-9a-f]{40}$/i.test(e)&&!(!/^(?:0x)?[0-9a-f]{40}$/i.test(e)&&!/^(?:0x)?[0-9A-F]{40}$/i.test(e));case"solana":return/[1-9A-HJ-NP-Za-km-z\u017F\u212A]{32,44}$/i.test(e);default:return!1}},uniqueBy(e,t){const i=new Set;return e.filter(e=>{const s=e[t];return!i.has(s)&&(i.add(s),!0)})},generateSdkVersion(e,t,i){const s=0===e.length?Ay.ADAPTER_TYPES.UNIVERSAL:e.map(e=>e.adapterType).join(",");return"".concat(t,"-").concat(s,"-").concat(i)},createAccount:(e,t,i,s,n)=>({namespace:e,address:t,type:i,publicKey:s,path:n}),isCaipAddress(e){if("string"!=typeof e)return!1;const t=e.split(":"),i=t[0];return 3===t.filter(Boolean).length&&i in sy.CHAIN_NAME_MAP},isMac(){const e=null==window?void 0:window.navigator.userAgent.toLowerCase();return e.includes("macintosh")&&!e.includes("safari")},formatTelegramSocialLoginUrl(e){const t="--".concat(encodeURIComponent(null==window?void 0:window.location.href)),i="state=";if("auth.magic.link"===new URL(e).host){const s="provider_authorization_url=",n=e.substring(e.indexOf(s)+s.length),r=this.injectIntoUrl(decodeURIComponent(n),i,t);return e.replace(n,encodeURIComponent(r))}return this.injectIntoUrl(e,i,t)},injectIntoUrl(e,t,i){const s=e.indexOf(t);if(-1===s)throw new Error("".concat(t," parameter not found in the URL: ").concat(e));const n=e.indexOf("&",s),r=t.length,o=-1!==n?n:e.length;return e.substring(0,s+r)+(e.substring(s+r,o)+i)+e.substring(n)}};async function Py(){const e=await fetch(...arguments);if(!e.ok)throw new Error("HTTP status code: ".concat(e.status),{cause:e});return e}class Ty{constructor(e){let{baseUrl:t,clientId:i}=e;this.baseUrl=t,this.clientId=i}async get(e){let{headers:t,signal:i,cache:s}=e,n=(0,u.A)(e,A);const r=this.createUrl(n);return(await Py(r,{method:"GET",headers:t,signal:i,cache:s})).json()}async getBlob(e){let{headers:t,signal:i}=e,s=(0,u.A)(e,C);const n=this.createUrl(s);return(await Py(n,{method:"GET",headers:t,signal:i})).blob()}async post(e){let{body:t,headers:i,signal:s}=e,n=(0,u.A)(e,S);const r=this.createUrl(n);return(await Py(r,{method:"POST",headers:i,body:t?JSON.stringify(t):void 0,signal:s})).json()}async put(e){let{body:t,headers:i,signal:s}=e,n=(0,u.A)(e,P);const r=this.createUrl(n);return(await Py(r,{method:"PUT",headers:i,body:t?JSON.stringify(t):void 0,signal:s})).json()}async delete(e){let{body:t,headers:i,signal:s}=e,n=(0,u.A)(e,T);const r=this.createUrl(n);return(await Py(r,{method:"DELETE",headers:i,body:t?JSON.stringify(t):void 0,signal:s})).json()}createUrl(e){let{path:t,params:i}=e;const s=new URL(t,this.baseUrl);return i&&Object.entries(i).forEach(e=>{let[t,i]=e;i&&s.searchParams.append(t,i)}),this.clientId&&s.searchParams.append("clientId",this.clientId),s}}const My={handleSolanaDeeplinkRedirect(e){if(Bv.state.activeChain===sy.CHAIN.SOLANA){const t=window.location.href,i=encodeURIComponent(t);if("Phantom"===e&&!("phantom"in window)){const e=t.startsWith("https")?"https":"http",s=t.split("/")[2],n=encodeURIComponent("".concat(e,"://").concat(s));window.location.href="https://phantom.app/ul/browse/".concat(i,"?ref=").concat(n)}"Coinbase Wallet"===e&&!("coinbaseSolana"in window)&&(window.location.href="https://go.cb-w.com/dapp?cb_url=".concat(i))}}},_y=(0,b.p)({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),Oy={state:_y,subscribeNetworkImages:e=>(0,b.s)(_y.networkImages,()=>e(_y.networkImages)),subscribeKey:(e,t)=>(0,b.a)(_y,e,t),subscribe:e=>(0,b.s)(_y,()=>e(_y)),setWalletImage(e,t){_y.walletImages[e]=t},setNetworkImage(e,t){_y.networkImages[e]=t},setChainImage(e,t){_y.chainImages[e]=t},setConnectorImage(e,t){_y.connectorImages=(0,d.A)((0,d.A)({},_y.connectorImages),{},{[e]:t})},setTokenImage(e,t){_y.tokenImages[e]=t},setCurrencyImage(e,t){_y.currencyImages[e]=t}},xy={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00"},ky=(0,b.p)({networkImagePromises:{}}),Dy={async fetchWalletImage(e){if(e)return await Yy._fetchWalletImage(e),this.getWalletImageById(e)},async fetchNetworkImage(e){if(!e)return;return this.getNetworkImageById(e)||(ky.networkImagePromises[e]||(ky.networkImagePromises[e]=Yy._fetchNetworkImage(e)),await ky.networkImagePromises[e],this.getNetworkImageById(e))},getWalletImageById(e){if(e)return Oy.state.walletImages[e]},getWalletImage:e=>null!=e&&e.image_url?null==e?void 0:e.image_url:null!=e&&e.image_id?Oy.state.walletImages[e.image_id]:void 0,getNetworkImage(e){var t,i,s;return null!=(t=null==e?void 0:e.assets)&&t.imageUrl?null==(i=null==e?void 0:e.assets)?void 0:i.imageUrl:null!=(s=null==e?void 0:e.assets)&&s.imageId?Oy.state.networkImages[e.assets.imageId]:void 0},getNetworkImageById(e){if(e)return Oy.state.networkImages[e]},getConnectorImage:e=>null!=e&&e.imageUrl?e.imageUrl:null!=e&&e.imageId?Oy.state.connectorImages[e.imageId]:void 0,getChainImage:e=>Oy.state.networkImages[xy[e]]},jy={getFeatureValue(e,t){const i=null==t?void 0:t[e];return void 0===i?Ay.DEFAULT_FEATURES[e]:i},filterSocialsByPlatform(e){if(!e||!e.length)return e;if(Sy.isTelegram()){if(Sy.isIos())return e.filter(e=>"google"!==e);if(Sy.isMac())return e.filter(e=>"x"!==e);if(Sy.isAndroid())return e.filter(e=>!["facebook","x"].includes(e))}return e}},Ry=(0,b.p)({features:Ay.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:Ay.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0}),Uy={state:Ry,subscribeKey:(e,t)=>(0,b.a)(Ry,e,t),setOptions(e){Object.assign(Ry,e)},setFeatures(e){if(!e)return;Ry.features||(Ry.features=Ay.DEFAULT_FEATURES);const t=(0,d.A)((0,d.A)({},Ry.features),e);Ry.features=t,Ry.features.socials&&(Ry.features.socials=jy.filterSocialsByPlatform(Ry.features.socials))},setProjectId(e){Ry.projectId=e},setCustomRpcUrls(e){Ry.customRpcUrls=e},setAllWallets(e){Ry.allWallets=e},setIncludeWalletIds(e){Ry.includeWalletIds=e},setExcludeWalletIds(e){Ry.excludeWalletIds=e},setFeaturedWalletIds(e){Ry.featuredWalletIds=e},setTokens(e){Ry.tokens=e},setTermsConditionsUrl(e){Ry.termsConditionsUrl=e},setPrivacyPolicyUrl(e){Ry.privacyPolicyUrl=e},setCustomWallets(e){Ry.customWallets=e},setIsSiweEnabled(e){Ry.isSiweEnabled=e},setIsUniversalProvider(e){Ry.isUniversalProvider=e},setSdkVersion(e){Ry.sdkVersion=e},setMetadata(e){Ry.metadata=e},setDisableAppend(e){Ry.disableAppend=e},setEIP6963Enabled(e){Ry.enableEIP6963=e},setDebug(e){Ry.debug=e},setEnableWalletConnect(e){Ry.enableWalletConnect=e},setEnableWalletGuide(e){Ry.enableWalletGuide=e},setEnableAuthLogger(e){Ry.enableAuthLogger=e},setEnableWallets(e){Ry.enableWallets=e},setHasMultipleAddresses(e){Ry.hasMultipleAddresses=e},setSIWX(e){Ry.siwx=e},setConnectMethodsOrder(e){Ry.features=(0,d.A)((0,d.A)({},Ry.features),{},{connectMethodsOrder:e})},setWalletFeaturesOrder(e){Ry.features=(0,d.A)((0,d.A)({},Ry.features),{},{walletFeaturesOrder:e})},setSocialsOrder(e){Ry.features=(0,d.A)((0,d.A)({},Ry.features),{},{socials:e})},setCollapseWallets(e){Ry.features=(0,d.A)((0,d.A)({},Ry.features),{},{collapseWallets:e})},setEnableEmbedded(e){Ry.enableEmbedded=e},setAllowUnsupportedChain(e){Ry.allowUnsupportedChain=e},setManualWCControl(e){Ry.manualWCControl=e},setEnableNetworkSwitch(e){Ry.enableNetworkSwitch=e},setDefaultAccountTypes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(e).forEach(e=>{let[t,i]=e;i&&(Ry.defaultAccountTypes[t]=i)})},setUniversalProviderConfigOverride(e){Ry.universalProviderConfigOverride=e},getUniversalProviderConfigOverride:()=>Ry.universalProviderConfigOverride,getSnapshot:()=>(0,b.b)(Ry)},Ly=(0,b.p)({message:"",variant:"info",open:!1}),zy={state:Ly,subscribeKey:(e,t)=>(0,b.a)(Ly,e,t),open(e,t){const{debug:i}=Uy.state,{shortMessage:s,longMessage:n}=e;i&&(Ly.message=s,Ly.variant=t,Ly.open=!0),n&&console.error("function"==typeof n?n():n)},close(){Ly.open=!1,Ly.message="",Ly.variant="info"}},qy=Sy.getAnalyticsUrl(),By=new Ty({baseUrl:qy,clientId:null}),Vy=["MODAL_CREATED"],Hy=(0,b.p)({timestamp:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"}}),Ky={state:Hy,subscribe:e=>(0,b.s)(Hy,()=>e(Hy)),getSdkProperties(){const{projectId:e,sdkType:t,sdkVersion:i}=Uy.state;return{projectId:e,st:t,sv:i||"html-wagmi-4.2.2"}},async _sendAnalyticsEvent(e){try{const t=Gv.state.address;if(Vy.includes(e.data.event)||typeof window>"u")return;await By.post({path:"/e",params:Ky.getSdkProperties(),body:{eventId:Sy.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:e.timestamp,props:(0,d.A)((0,d.A)({},e.data),{},{address:t})}}),Hy.reportedErrors.FORBIDDEN=!1}catch(t){t instanceof Error&&t.cause instanceof Response&&t.cause.status===sy.HTTP_STATUS_CODES.FORBIDDEN&&!Hy.reportedErrors.FORBIDDEN&&(zy.open({shortMessage:"Invalid App Configuration",longMessage:"Origin ".concat(Iy()?window.origin:"uknown"," not found on Allowlist - update configuration on cloud.reown.com")},"error"),Hy.reportedErrors.FORBIDDEN=!0)}},sendEvent(e){var t;Hy.timestamp=Date.now(),Hy.data=e,null!=(t=Uy.state.features)&&t.analytics&&Ky._sendAnalyticsEvent(Hy)}},Wy=Sy.getApiUrl(),Fy=new Ty({baseUrl:Wy,clientId:null}),Gy=(0,b.p)({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1}),Yy={state:Gy,subscribeKey:(e,t)=>(0,b.a)(Gy,e,t),_getSdkProperties(){const{projectId:e,sdkType:t,sdkVersion:i}=Uy.state;return{projectId:e,st:t||"appkit",sv:i||"html-wagmi-4.2.2"}},_filterOutExtensions:e=>Uy.state.isUniversalProvider?e.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):e,async _fetchWalletImage(e){const t="".concat(Fy.baseUrl,"/getWalletImage/").concat(e),i=await Fy.getBlob({path:t,params:Yy._getSdkProperties()});Oy.setWalletImage(e,URL.createObjectURL(i))},async _fetchNetworkImage(e){const t="".concat(Fy.baseUrl,"/public/getAssetImage/").concat(e),i=await Fy.getBlob({path:t,params:Yy._getSdkProperties()});Oy.setNetworkImage(e,URL.createObjectURL(i))},async _fetchConnectorImage(e){const t="".concat(Fy.baseUrl,"/public/getAssetImage/").concat(e),i=await Fy.getBlob({path:t,params:Yy._getSdkProperties()});Oy.setConnectorImage(e,URL.createObjectURL(i))},async _fetchCurrencyImage(e){const t="".concat(Fy.baseUrl,"/public/getCurrencyImage/").concat(e),i=await Fy.getBlob({path:t,params:Yy._getSdkProperties()});Oy.setCurrencyImage(e,URL.createObjectURL(i))},async _fetchTokenImage(e){const t="".concat(Fy.baseUrl,"/public/getTokenImage/").concat(e),i=await Fy.getBlob({path:t,params:Yy._getSdkProperties()});Oy.setTokenImage(e,URL.createObjectURL(i))},async fetchNetworkImages(){const e=Bv.getAllRequestedCaipNetworks(),t=null==e?void 0:e.map(e=>{let{assets:t}=e;return null==t?void 0:t.imageId}).filter(Boolean).filter(e=>!Dy.getNetworkImageById(e));t&&await Promise.allSettled(t.map(e=>Yy._fetchNetworkImage(e)))},async fetchConnectorImages(){const{connectors:e}=tv.state,t=e.map(e=>{let{imageId:t}=e;return t}).filter(Boolean);await Promise.allSettled(t.map(e=>Yy._fetchConnectorImage(e)))},async fetchCurrencyImages(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];await Promise.allSettled(e.map(e=>Yy._fetchCurrencyImage(e)))},async fetchTokenImages(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];await Promise.allSettled(e.map(e=>Yy._fetchTokenImage(e)))},async fetchFeaturedWallets(){const{featuredWalletIds:e}=Uy.state;if(null!=e&&e.length){const{data:t}=await Fy.get({path:"/getWallets",params:(0,d.A)((0,d.A)({},Yy._getSdkProperties()),{},{page:"1",entries:null!=e&&e.length?String(e.length):"4",include:null==e?void 0:e.join(",")})});t.sort((t,i)=>e.indexOf(t.id)-e.indexOf(i.id));const i=t.map(e=>e.image_id).filter(Boolean);await Promise.allSettled(i.map(e=>Yy._fetchWalletImage(e))),Gy.featured=t,Gy.allFeatured=t}},async fetchRecommendedWallets(){try{Gy.isFetchingRecommendedWallets=!0;const{includeWalletIds:e,excludeWalletIds:t,featuredWalletIds:i}=Uy.state,s=[...null!==t&&void 0!==t?t:[],...null!==i&&void 0!==i?i:[]].filter(Boolean),n=Bv.getRequestedCaipNetworkIds().join(","),{data:r,count:o}=await Fy.get({path:"/getWallets",params:(0,d.A)((0,d.A)({},Yy._getSdkProperties()),{},{page:"1",chains:n,entries:"4",include:null==e?void 0:e.join(","),exclude:null==s?void 0:s.join(",")})}),a=Cy.getRecentWallets(),c=r.map(e=>e.image_id).filter(Boolean),l=a.map(e=>e.image_id).filter(Boolean);await Promise.allSettled([...c,...l].map(e=>Yy._fetchWalletImage(e))),Gy.recommended=r,Gy.allRecommended=r,Gy.count=null!==o&&void 0!==o?o:0}catch(e){}finally{Gy.isFetchingRecommendedWallets=!1}},async fetchWallets(e){let{page:t}=e;const{includeWalletIds:i,excludeWalletIds:s,featuredWalletIds:n}=Uy.state,r=Bv.getRequestedCaipNetworkIds().join(","),o=[...Gy.recommended.map(e=>{let{id:t}=e;return t}),...null!==s&&void 0!==s?s:[],...null!==n&&void 0!==n?n:[]].filter(Boolean),{data:a,count:c}=await Fy.get({path:"/getWallets",params:(0,d.A)((0,d.A)({},Yy._getSdkProperties()),{},{page:String(t),entries:"40",chains:r,include:null==i?void 0:i.join(","),exclude:o.join(",")})}),l=a.slice(0,20).map(e=>e.image_id).filter(Boolean);await Promise.allSettled(l.map(e=>Yy._fetchWalletImage(e))),Gy.wallets=Sy.uniqueBy([...Gy.wallets,...Yy._filterOutExtensions(a)],"id"),Gy.count=c>Gy.count?c:Gy.count,Gy.page=t},async initializeExcludedWallets(e){let{ids:t}=e;const i=Bv.getRequestedCaipNetworkIds().join(","),{data:s}=await Fy.get({path:"/getWallets",params:(0,d.A)((0,d.A)({},Yy._getSdkProperties()),{},{page:"1",entries:String(t.length),chains:i,include:null==t?void 0:t.join(",")})});s&&s.forEach(e=>{null!=e&&e.rdns&&Gy.excludedWallets.push({rdns:e.rdns,name:e.name})})},async searchWallet(e){let{search:t,badge:i}=e;const{includeWalletIds:s,excludeWalletIds:n}=Uy.state;Gy.search=[];const r=Bv.getRequestedCaipNetworkIds().join(","),{data:o}=await Fy.get({path:"/getWallets",params:(0,d.A)((0,d.A)({},Yy._getSdkProperties()),{},{page:"1",entries:"100",search:null==t?void 0:t.trim(),badge_type:i,chains:r,include:null==s?void 0:s.join(","),exclude:null==n?void 0:n.join(",")})});Ky.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:null!==i&&void 0!==i?i:"",search:null!==t&&void 0!==t?t:""}});const a=o.map(e=>e.image_id).filter(Boolean);await Promise.allSettled([...a.map(e=>Yy._fetchWalletImage(e)),Sy.wait(300)]),Gy.search=Yy._filterOutExtensions(o)},initPromise:(e,t)=>Gy.promises[e]||(Gy.promises[e]=t()),prefetch(){let{fetchConnectorImages:e=!0,fetchFeaturedWallets:t=!0,fetchRecommendedWallets:i=!0,fetchNetworkImages:s=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=[e&&Yy.initPromise("connectorImages",Yy.fetchConnectorImages),t&&Yy.initPromise("featuredWallets",Yy.fetchFeaturedWallets),i&&Yy.initPromise("recommendedWallets",Yy.fetchRecommendedWallets),s&&Yy.initPromise("networkImages",Yy.fetchNetworkImages)].filter(Boolean);return Promise.allSettled(n)},prefetchAnalyticsConfig(){var e;null!=(e=Uy.state.features)&&e.analytics&&Yy.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:e}=await Fy.get({path:"/getAnalyticsConfig",params:Yy._getSdkProperties()});Uy.setFeatures({analytics:e})}catch(e){Uy.setFeatures({analytics:!1})}},setFilterByNamespace(e){if(!e)return Gy.featured=Gy.allFeatured,void(Gy.recommended=Gy.allRecommended);const t=Bv.getRequestedCaipNetworkIds().join(",");Gy.featured=Gy.allFeatured.filter(e=>{var i;return null==(i=e.chains)?void 0:i.some(e=>t.includes(e))}),Gy.recommended=Gy.allRecommended.filter(e=>{var i;return null==(i=e.chains)?void 0:i.some(e=>t.includes(e))})}},Qy=(0,b.p)({view:"Connect",history:["Connect"],transactionStack:[]}),Zy={state:Qy,subscribeKey:(e,t)=>(0,b.a)(Qy,e,t),pushTransactionStack(e){Qy.transactionStack.push(e)},popTransactionStack(e){var t,i;const s=Qy.transactionStack.pop();if(s)if(e)this.goBack(),null==(t=null==s?void 0:s.onCancel)||t.call(s);else{if(s.goBack)this.goBack();else if(s.replace){const e=Qy.history.indexOf("ConnectingSiwe");e>0?this.goBackToIndex(e-1):(Qv.close(),Qy.history=[])}else s.view&&this.reset(s.view);null==(i=null==s?void 0:s.onSuccess)||i.call(s)}},push(e,t){e!==Qy.view&&(Qy.view=e,Qy.history.push(e),Qy.data=t)},reset(e,t){Qy.view=e,Qy.history=[e],Qy.data=t},replace(e,t){Qy.history.at(-1)===e||(Qy.view=e,Qy.history[Qy.history.length-1]=e,Qy.data=t)},goBack(){var e;const t=!Bv.state.activeCaipAddress&&"ConnectingFarcaster"===this.state.view;if(Qy.history.length>1&&!Qy.history.includes("UnsupportedChain")){Qy.history.pop();const[e]=Qy.history.slice(-1);e&&(Qy.view=e)}else Qv.close();null!=(e=Qy.data)&&e.wallet&&(Qy.data.wallet=void 0),setTimeout(()=>{var e,i,s;if(t){Gv.setFarcasterUrl(void 0,Bv.state.activeChain);const t=tv.getAuthConnector();null==(e=null==t?void 0:t.provider)||e.reload();const n=(0,b.b)(Uy.state);null==(s=null==(i=null==t?void 0:t.provider)?void 0:i.syncDappData)||s.call(i,{metadata:n.metadata,sdkVersion:n.sdkVersion,projectId:n.projectId,sdkType:n.sdkType})}},100)},goBackToIndex(e){if(Qy.history.length>1){Qy.history=Qy.history.slice(0,e+1);const[t]=Qy.history.slice(-1);t&&(Qy.view=t)}}},Jy=(0,b.p)({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),Xy={state:Jy,subscribe:e=>(0,b.s)(Jy,()=>e(Jy)),setThemeMode(e){Jy.themeMode=e;try{const t=tv.getAuthConnector();if(t){const i=Xy.getSnapshot().themeVariables;t.provider.syncTheme({themeMode:e,themeVariables:i,w3mThemeVariables:Ey(i,e)})}}catch(t){console.info("Unable to sync theme to auth connector")}},setThemeVariables(e){Jy.themeVariables=(0,d.A)((0,d.A)({},Jy.themeVariables),e);try{const e=tv.getAuthConnector();if(e){const t=Xy.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:t,w3mThemeVariables:Ey(Jy.themeVariables,Jy.themeMode)})}}catch(t){console.info("Unable to sync theme to auth connector")}},getSnapshot:()=>(0,b.b)(Jy)},$y={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0},ev=(0,b.p)({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:(0,d.A)({},$y)}),tv={state:ev,subscribe:e=>(0,b.s)(ev,()=>{e(ev)}),subscribeKey:(e,t)=>(0,b.a)(ev,e,t),initialize(e){e.forEach(e=>{const t=Cy.getConnectedConnectorId(e);t&&this.setConnectorId(t,e)})},setActiveConnector(e){e&&(ev.activeConnector=(0,b.r)(e))},setConnectors(e){e.filter(e=>!ev.allConnectors.some(t=>t.id===e.id&&this.getConnectorName(t.name)===this.getConnectorName(e.name)&&t.chain===e.chain)).forEach(e=>{"MULTI_CHAIN"!==e.type&&ev.allConnectors.push((0,b.r)(e))}),ev.connectors=this.mergeMultiChainConnectors(ev.allConnectors)},removeAdapter(e){ev.allConnectors=ev.allConnectors.filter(t=>t.chain!==e),ev.connectors=this.mergeMultiChainConnectors(ev.allConnectors)},mergeMultiChainConnectors(e){const t=this.generateConnectorMapByName(e),i=[];return t.forEach(e=>{const t=e[0],s=(null==t?void 0:t.id)===sy.CONNECTOR_ID.AUTH;e.length>1&&t?i.push({name:t.name,imageUrl:t.imageUrl,imageId:t.imageId,connectors:[...e],type:s?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(null==t?void 0:t.id)||""}):t&&i.push(t)}),i},generateConnectorMapByName(e){const t=new Map;return e.forEach(e=>{const{name:i}=e,s=this.getConnectorName(i);if(!s)return;const n=t.get(s)||[];n.find(t=>t.chain===e.chain)||n.push(e),t.set(s,n)}),t},getConnectorName:e=>e&&({"Trust Wallet":"Trust"}[e]||e),getUniqueConnectorsByName(e){const t=[];return e.forEach(e=>{t.find(t=>t.chain===e.chain)||t.push(e)}),t},addConnector(e){var t,i,s;if(e.id===sy.CONNECTOR_ID.AUTH){const n=e,r=(0,b.b)(Uy.state),o=Xy.getSnapshot().themeMode,a=Xy.getSnapshot().themeVariables;null==(i=null==(t=null==n?void 0:n.provider)?void 0:t.syncDappData)||i.call(t,{metadata:r.metadata,sdkVersion:r.sdkVersion,projectId:r.projectId,sdkType:r.sdkType}),null==(s=null==n?void 0:n.provider)||s.syncTheme({themeMode:o,themeVariables:a,w3mThemeVariables:Ey(a,o)}),this.setConnectors([e])}else this.setConnectors([e])},getAuthConnector(e){var t;const i=e||Bv.state.activeChain,s=ev.connectors.find(e=>e.id===sy.CONNECTOR_ID.AUTH);if(s)return null!=(t=null==s?void 0:s.connectors)&&t.length?s.connectors.find(e=>e.chain===i):s},getAnnouncedConnectorRdns:()=>ev.connectors.filter(e=>"ANNOUNCED"===e.type).map(e=>{var t;return null==(t=e.info)?void 0:t.rdns}),getConnectorById:e=>ev.allConnectors.find(t=>t.id===e),getConnector:(e,t)=>ev.allConnectors.filter(e=>e.chain===Bv.state.activeChain).find(i=>{var s;return i.explorerId===e||(null==(s=i.info)?void 0:s.rdns)===t}),syncIfAuthConnector(e){var t,i;if("ID_AUTH"!==e.id)return;const s=e,n=(0,b.b)(Uy.state),r=Xy.getSnapshot().themeMode,o=Xy.getSnapshot().themeVariables;null==(i=null==(t=null==s?void 0:s.provider)?void 0:t.syncDappData)||i.call(t,{metadata:n.metadata,sdkVersion:n.sdkVersion,sdkType:n.sdkType,projectId:n.projectId}),s.provider.syncTheme({themeMode:r,themeVariables:o,w3mThemeVariables:Ey(o,r)})},getConnectorsByNamespace(e){const t=ev.allConnectors.filter(t=>t.chain===e);return this.mergeMultiChainConnectors(t)},selectWalletConnector(e){const t=tv.getConnector(e.id,e.rdns);Bv.state.activeChain===sy.CHAIN.SOLANA&&My.handleSolanaDeeplinkRedirect((null==t?void 0:t.name)||e.name||""),t?Zy.push("ConnectingExternal",{connector:t}):Zy.push("ConnectingWalletConnect",{wallet:e})},getConnectors(e){return e?this.getConnectorsByNamespace(e):this.mergeMultiChainConnectors(ev.allConnectors)},setFilterByNamespace(e){ev.filterByNamespace=e,ev.connectors=this.getConnectors(e),Yy.setFilterByNamespace(e)},setConnectorId(e,t){e&&(ev.activeConnectorIds=(0,d.A)((0,d.A)({},ev.activeConnectorIds),{},{[t]:e}),Cy.setConnectedConnectorId(t,e))},removeConnectorId(e){ev.activeConnectorIds=(0,d.A)((0,d.A)({},ev.activeConnectorIds),{},{[e]:void 0}),Cy.deleteConnectedConnectorId(e)},getConnectorId(e){if(e)return ev.activeConnectorIds[e]},isConnected:e=>e?!!ev.activeConnectorIds[e]:Object.values(ev.activeConnectorIds).some(e=>!!e),resetConnectorIds(){ev.activeConnectorIds=(0,d.A)({},$y)}};function iv(e,t){return tv.getConnectorId(e)===t}var sv=Object.defineProperty,nv=(e,t,i)=>((e,t,i)=>t in e?sv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class rv extends v.I{constructor(e){super(),this.opts=e,nv(this,"protocol","wc"),nv(this,"version",2)}}var ov=Object.defineProperty,av=(e,t,i)=>((e,t,i)=>t in e?ov(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,t+"",i);let cv=class extends v.I{constructor(e,t){super(),this.core=e,this.logger=t,av(this,"records",new Map)}},lv=class{constructor(e,t){this.logger=e,this.core=t}};class hv extends v.I{constructor(e,t){super(),this.relayer=e,this.logger=t}}let dv=class extends v.I{constructor(e){super()}},uv=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}},pv=class extends v.I{constructor(e,t){super(),this.relayer=e,this.logger=t}},gv=class extends v.I{constructor(e,t){super(),this.core=e,this.logger=t}},fv=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},wv=class{constructor(e,t){this.projectId=e,this.logger=t}},mv=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}};var yv=Object.defineProperty,vv=(e,t,i)=>((e,t,i)=>t in e?yv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let bv=class{constructor(e){this.opts=e,vv(this,"protocol","wc"),vv(this,"version",2)}},Iv=class{constructor(e){this.client=e}};typeof p.d.process<"u"&&typeof p.d.process.env<"u"&&p.d.process.env.NEXT_PUBLIC_SECURE_SITE_SDK_URL,typeof p.d.process<"u"&&typeof p.d.process.env<"u"&&p.d.process.env.NEXT_PUBLIC_DEFAULT_LOG_LEVEL,typeof p.d.process<"u"&&typeof p.d.process.env<"u"&&p.d.process.env.NEXT_PUBLIC_SECURE_SITE_SDK_VERSION;const Ev={EOA:"eoa",SMART_ACCOUNT:"smartAccount"},Nv=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),Av=(0,b.p)((0,d.A)({},Nv)),Cv={state:Av,subscribeKey:(e,t)=>(0,b.a)(Av,e,t),showLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._showMessage((0,d.A)({message:e,variant:"loading"},t))},showSuccess(e){this._showMessage({message:e,variant:"success"})},showSvg(e,t){this._showMessage({message:e,svg:t})},showError(e){const t=Sy.parseError(e);this._showMessage({message:t,variant:"error"})},hide(){Av.message=Nv.message,Av.variant=Nv.variant,Av.svg=Nv.svg,Av.open=Nv.open,Av.autoClose=Nv.autoClose},_showMessage(e){let{message:t,svg:i,variant:s="success",autoClose:n=Nv.autoClose}=e;Av.open?(Av.open=!1,setTimeout(()=>{Av.message=t,Av.variant=s,Av.svg=i,Av.open=!0,Av.autoClose=n},150)):(Av.message=t,Av.variant=s,Av.svg=i,Av.open=!0,Av.autoClose=n)}},Sv={getSIWX:()=>Uy.state.siwx,async initializeIfEnabled(){var e;const t=Uy.state.siwx,i=Bv.getActiveCaipAddress();if(!t||!i)return;const[s,n,r]=i.split(":");if(Bv.checkIfSupportedNetwork(s))try{if((await t.getSessions("".concat(s,":").concat(n),r)).length)return;await Qv.open({view:"SIWXSignMessage"})}catch(o){console.error("SIWXUtil:initializeIfEnabled",o),Ky.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties()}),await(null==(e=Ov._getClient())?void 0:e.disconnect().catch(console.error)),Zy.reset("Connect"),Cv.showError("A problem occurred while trying initialize authentication")}},async requestSignMessage(){const e=Uy.state.siwx,t=Sy.getPlainAddress(Bv.getActiveCaipAddress()),i=Bv.getActiveCaipNetwork(),s=Ov._getClient();if(!e)throw new Error("SIWX is not enabled");if(!t)throw new Error("No ActiveCaipAddress found");if(!i)throw new Error("No ActiveCaipNetwork or client found");if(!s)throw new Error("No ConnectionController client found");try{const n=await e.createMessage({chainId:i.caipNetworkId,accountAddress:t}),r=n.toString();tv.getConnectorId(i.chainNamespace)===sy.CONNECTOR_ID.AUTH&&Zy.pushTransactionStack({view:null,goBack:!1,replace:!0});const o=await s.signMessage(r);await e.addSession({data:n,message:r,signature:o}),Qv.close(),Ky.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(n){const e=this.getSIWXEventProperties();(!Qv.state.open||"ApproveTransaction"===Zy.state.view)&&await Qv.open({view:"SIWXSignMessage"}),e.isSmartAccount?Cv.showError("This application might not support Smart Accounts"):Cv.showError("Signature declined"),Ky.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:e}),console.error("SWIXUtil:requestSignMessage",n)}},async cancelSignMessage(){var e;try{const t=this.getSIWX();(null==(e=null==t?void 0:t.getRequired)?void 0:e.call(t))?await Ov.disconnect():Qv.close(),Zy.reset("Connect"),Ky.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(t){console.error("SIWXUtil:cancelSignMessage",t)}},async getSessions(){const e=Uy.state.siwx,t=Sy.getPlainAddress(Bv.getActiveCaipAddress()),i=Bv.getActiveCaipNetwork();return e&&t&&i?e.getSessions(i.caipNetworkId,t):[]},async isSIWXCloseDisabled(){var e;const t=this.getSIWX();if(t){const i="ApproveTransaction"===Zy.state.view,s="SIWXSignMessage"===Zy.state.view;if(i||s)return(null==(e=t.getRequired)?void 0:e.call(t))&&0===(await this.getSessions()).length}return!1},async universalProviderAuthenticate(e){let{universalProvider:t,chains:i,methods:s}=e;var n,r,o;const a=Sv.getSIWX(),c=new Set(i.map(e=>e.split(":")[0]));if(!a||1!==c.size||!c.has("eip155"))return!1;const l=await a.createMessage({chainId:(null==(n=Bv.getActiveCaipNetwork())?void 0:n.caipNetworkId)||"",accountAddress:""}),h=await t.authenticate({nonce:l.nonce,domain:l.domain,uri:l.uri,exp:l.expirationTime,iat:l.issuedAt,nbf:l.notBefore,requestId:l.requestId,version:l.version,resources:l.resources,statement:l.statement,chainId:l.chainId,methods:s,chains:[l.chainId,...i.filter(e=>e!==l.chainId)]});if(Cv.showLoading("Authenticating...",{autoClose:!1}),Gv.setConnectedWalletInfo((0,d.A)((0,d.A)({},h.session.peer.metadata),{},{name:h.session.peer.metadata.name,icon:null==(r=h.session.peer.metadata.icons)?void 0:r[0],type:"WALLET_CONNECT"}),Array.from(c)[0]),null!=(o=null==h?void 0:h.auths)&&o.length){const e=h.auths.map(e=>{const i=t.client.formatAuthMessage({request:e.p,iss:e.p.iss});return{data:(0,d.A)((0,d.A)({},e.p),{},{accountAddress:e.p.iss.split(":").slice(-1).join(""),chainId:e.p.iss.split(":").slice(2,4).join(":"),uri:e.p.aud,version:e.p.version||l.version,expirationTime:e.p.exp,issuedAt:e.p.iat,notBefore:e.p.nbf}),message:i,signature:e.s.s,cacao:e}});try{await a.setSessions(e),Ky.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:Sv.getSIWXEventProperties()})}catch(u){throw console.error("SIWX:universalProviderAuth - failed to set sessions",u),Ky.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:Sv.getSIWXEventProperties()}),await t.disconnect().catch(console.error),u}finally{Cv.hide()}}return!0},getSIWXEventProperties(){var e;return{network:(null==(e=Bv.state.activeCaipNetwork)?void 0:e.caipNetworkId)||"",isSmartAccount:Gv.state.preferredAccountType===Ev.SMART_ACCOUNT}},async clearSessions(){const e=this.getSIWX();e&&await e.setSessions([])}},Pv=(0,b.p)({transactions:[],coinbaseTransactions:{},transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),Tv={state:Pv,subscribe:e=>(0,b.s)(Pv,()=>e(Pv)),setLastNetworkInView(e){Pv.lastNetworkInView=e},async fetchTransactions(e,t){var i;if(!e)throw new Error("Transactions can't be fetched without an accountAddress");Pv.loading=!0;try{const s=await Wv.fetchTransactions({account:e,cursor:Pv.next,onramp:t,cache:"coinbase"===t?"no-cache":void 0,chainId:null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId}),n=this.filterSpamTransactions(s.data),r=this.filterByConnectedChain(n),o=[...Pv.transactions,...r];Pv.loading=!1,"coinbase"===t?Pv.coinbaseTransactions=this.groupTransactionsByYearAndMonth(Pv.coinbaseTransactions,s.data):(Pv.transactions=o,Pv.transactionsByYear=this.groupTransactionsByYearAndMonth(Pv.transactionsByYear,r)),Pv.empty=0===o.length,Pv.next=s.next?s.next:void 0}catch(s){Ky.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:e,projectId:Uy.state.projectId,cursor:Pv.next,isSmartAccount:Gv.state.preferredAccountType===Ev.SMART_ACCOUNT}}),Cv.showError("Failed to fetch transactions"),Pv.loading=!1,Pv.empty=!0,Pv.next=void 0}},groupTransactionsByYearAndMonth(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach(t=>{var i,s;const n=new Date(t.metadata.minedAt).getFullYear(),r=new Date(t.metadata.minedAt).getMonth(),o=null!==(i=e[n])&&void 0!==i?i:{},a=(null!==(s=o[r])&&void 0!==s?s:[]).filter(e=>e.id!==t.id);e[n]=(0,d.A)((0,d.A)({},o),{},{[r]:[...a,t].sort((e,t)=>new Date(t.metadata.minedAt).getTime()-new Date(e.metadata.minedAt).getTime())})}),e},filterSpamTransactions:e=>e.filter(e=>!e.transfers.every(e=>{var t;return!0===(null==(t=e.nft_info)?void 0:t.flags.is_spam)})),filterByConnectedChain(e){var t;const i=null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId;return e.filter(e=>e.metadata.chain===i)},clearCursor(){Pv.next=void 0},resetTransactions(){Pv.transactions=[],Pv.transactionsByYear={},Pv.lastNetworkInView=void 0,Pv.loading=!1,Pv.empty=!1,Pv.next=void 0}},Mv=(0,b.p)({wcError:!1,buffering:!1,status:"disconnected"});let _v;const Ov={state:Mv,subscribeKey:(e,t)=>(0,b.a)(Mv,e,t),_getClient:()=>Mv._client,setClient(e){Mv._client=(0,b.r)(e)},async connectWalletConnect(){var e,t,i,s;if(Sy.isTelegram()||Sy.isSafari()&&Sy.isIos()){if(_v)return await _v,void(_v=void 0);if(!Sy.isPairingExpired(null==Mv?void 0:Mv.wcPairingExpiry)){const e=Mv.wcUri;return void(Mv.wcUri=e)}_v=null==(t=null==(e=this._getClient())?void 0:e.connectWalletConnect)?void 0:t.call(e).catch(()=>{}),this.state.status="connecting",await _v,_v=void 0,Mv.wcPairingExpiry=void 0,this.state.status="connected"}else await(null==(s=null==(i=this._getClient())?void 0:i.connectWalletConnect)?void 0:s.call(i))},async connectExternal(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var s,n;await(null==(n=null==(s=this._getClient())?void 0:s.connectExternal)?void 0:n.call(s,e)),i&&Bv.setActiveNamespace(t)},async reconnectExternal(e){var t,i;await(null==(i=null==(t=this._getClient())?void 0:t.reconnectExternal)?void 0:i.call(t,e));const s=e.chain||Bv.state.activeChain;s&&tv.setConnectorId(e.id,s)},async setPreferredAccountType(e){var t;Qv.setLoading(!0,Bv.state.activeChain);const i=tv.getAuthConnector();i&&(await(null==i?void 0:i.provider.setPreferredAccount(e)),await this.reconnectExternal(i),Qv.setLoading(!1,Bv.state.activeChain),Ky.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:e,network:(null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId)||""}}))},async signMessage(e){var t;return null==(t=this._getClient())?void 0:t.signMessage(e)},parseUnits(e,t){var i;return null==(i=this._getClient())?void 0:i.parseUnits(e,t)},formatUnits(e,t){var i;return null==(i=this._getClient())?void 0:i.formatUnits(e,t)},async sendTransaction(e){var t;return null==(t=this._getClient())?void 0:t.sendTransaction(e)},async getCapabilities(e){var t;return null==(t=this._getClient())?void 0:t.getCapabilities(e)},async grantPermissions(e){var t;return null==(t=this._getClient())?void 0:t.grantPermissions(e)},async walletGetAssets(e){var t,i;return null!==(t=null==(i=this._getClient())?void 0:i.walletGetAssets(e))&&void 0!==t?t:{}},async estimateGas(e){var t;return null==(t=this._getClient())?void 0:t.estimateGas(e)},async writeContract(e){var t;return null==(t=this._getClient())?void 0:t.writeContract(e)},async getEnsAddress(e){var t;return null==(t=this._getClient())?void 0:t.getEnsAddress(e)},async getEnsAvatar(e){var t;return null==(t=this._getClient())?void 0:t.getEnsAvatar(e)},checkInstalled(e){var t,i;return(null==(i=null==(t=this._getClient())?void 0:t.checkInstalled)?void 0:i.call(t,e))||!1},resetWcConnection(){Mv.wcUri=void 0,Mv.wcPairingExpiry=void 0,Mv.wcLinking=void 0,Mv.recentWallet=void 0,Mv.status="disconnected",Tv.resetTransactions(),Cy.deleteWalletConnectDeepLink()},resetUri(){Mv.wcUri=void 0,Mv.wcPairingExpiry=void 0},finalizeWcConnection(){var e,t;const{wcLinking:i,recentWallet:s}=Ov.state;i&&Cy.setWalletConnectDeepLink(i),s&&Cy.setAppKitRecent(s),Ky.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:i?"mobile":"qrcode",name:(null==(t=null==(e=Zy.state.data)?void 0:e.wallet)?void 0:t.name)||"Unknown"}})},setWcBasic(e){Mv.wcBasic=e},setUri(e){Mv.wcUri=e,Mv.wcPairingExpiry=Sy.getPairingExpiry()},setWcLinking(e){Mv.wcLinking=e},setWcError(e){Mv.wcError=e,Mv.buffering=!1},setRecentWallet(e){Mv.recentWallet=e},setBuffering(e){Mv.buffering=e},setStatus(e){Mv.status=e},async disconnect(e){try{Qv.setLoading(!0,e),await Sv.clearSessions(),await Bv.disconnect(e),Qv.setLoading(!1,e),tv.setFilterByNamespace(void 0)}catch(t){throw new Error("Failed to disconnect")}}},xv=(0,b.p)({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1}),kv={state:xv,subscribe:e=>(0,b.s)(xv,()=>e(xv)),set(e){Object.assign(xv,(0,d.A)((0,d.A)({},xv),e))}},Dv={createBalance(e,t){const i={name:e.metadata.name||"",symbol:e.metadata.symbol||"",decimals:e.metadata.decimals||0,value:e.metadata.value||0,price:e.metadata.price||0,iconUrl:e.metadata.iconUrl||""};return{name:i.name,symbol:i.symbol,chainId:t,address:"native"===e.address?void 0:this.convertAddressToCAIP10Address(e.address,t),value:i.value,price:i.price,quantity:{decimals:i.decimals.toString(),numeric:this.convertHexToBalance({hex:e.balance,decimals:i.decimals})},iconUrl:i.iconUrl}},convertHexToBalance(e){let{hex:t,decimals:i}=e;return(0,I.f)(BigInt(t),i)},convertAddressToCAIP10Address:(e,t)=>"".concat(t,":").concat(e),createCAIP2ChainId:(e,t)=>"".concat(t,":").concat(parseInt(e,16)),getChainIdHexFromCAIP2ChainId(e){const t=e.split(":");if(t.length<2||!t[1])return"0x0";const i=t[1],s=parseInt(i,10);return isNaN(s)?"0x0":"0x".concat(s.toString(16))},isWalletGetAssetsResponse(e){return"object"==typeof e&&null!==e&&Object.values(e).every(e=>Array.isArray(e)&&e.every(e=>this.isValidAsset(e)))},isValidAsset:e=>"object"==typeof e&&null!==e&&"string"==typeof e.address&&"string"==typeof e.balance&&("ERC20"===e.type||"NATIVE"===e.type)&&"object"==typeof e.metadata&&null!==e.metadata&&"string"==typeof e.metadata.name&&"string"==typeof e.metadata.symbol&&"number"==typeof e.metadata.decimals&&"number"==typeof e.metadata.price&&"string"==typeof e.metadata.iconUrl},jv={async getMyTokensWithBalance(e){const t=Gv.state.address,i=Bv.state.activeCaipNetwork;if(!t||!i)return[];if("eip155"===i.chainNamespace){const e=await this.getEIP155Balances(t,i);if(e)return this.filterLowQualityTokens(e)}const s=await Wv.getBalance(t,i.caipNetworkId,e);return this.filterLowQualityTokens(s.balances)},async getEIP155Balances(e,t){var i,s;try{const n=Dv.getChainIdHexFromCAIP2ChainId(t.caipNetworkId),r=await Ov.getCapabilities(e);if(null==(s=null==(i=null==r?void 0:r[n])?void 0:i.assetDiscovery)||!s.supported)return null;const o=await Ov.walletGetAssets({account:e,chainFilter:[n]});return Dv.isWalletGetAssetsResponse(o)?(o[n]||[]).map(e=>Dv.createBalance(e,t.caipNetworkId)):null}catch(n){return null}},filterLowQualityTokens:e=>e.filter(e=>"0"!==e.quantity.decimals),mapBalancesToSwapTokens:e=>(null==e?void 0:e.map(e=>(0,d.A)((0,d.A)({},e),{},{address:null!=e&&e.address?e.address:Bv.getActiveNetworkTokenAddress(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]},Rv=(0,b.p)({tokenBalances:[],loading:!1}),Uv={state:Rv,subscribe:e=>(0,b.s)(Rv,()=>e(Rv)),subscribeKey:(e,t)=>(0,b.a)(Rv,e,t),setToken(e){e&&(Rv.token=(0,b.r)(e))},setTokenAmount(e){Rv.sendTokenAmount=e},setReceiverAddress(e){Rv.receiverAddress=e},setReceiverProfileImageUrl(e){Rv.receiverProfileImageUrl=e},setReceiverProfileName(e){Rv.receiverProfileName=e},setGasPrice(e){Rv.gasPrice=e},setGasPriceInUsd(e){Rv.gasPriceInUSD=e},setNetworkBalanceInUsd(e){Rv.networkBalanceInUSD=e},setLoading(e){Rv.loading=e},sendToken(){var e;switch(null==(e=Bv.state.activeCaipNetwork)?void 0:e.chainNamespace){case"eip155":return void this.sendEvmToken();case"solana":return void this.sendSolanaToken();default:throw new Error("Unsupported chain")}},sendEvmToken(){var e,t,i,s,n;null!=(e=this.state.token)&&e.address&&this.state.sendTokenAmount&&this.state.receiverAddress?(Ky.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:Gv.state.preferredAccountType===Ev.SMART_ACCOUNT,token:this.state.token.address,amount:this.state.sendTokenAmount,network:(null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId)||""}}),this.sendERC20Token({receiverAddress:this.state.receiverAddress,tokenAddress:this.state.token.address,sendTokenAmount:this.state.sendTokenAmount,decimals:this.state.token.quantity.decimals})):this.state.receiverAddress&&this.state.sendTokenAmount&&this.state.gasPrice&&null!=(i=this.state.token)&&i.quantity.decimals&&(Ky.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:Gv.state.preferredAccountType===Ev.SMART_ACCOUNT,token:null==(s=this.state.token)?void 0:s.symbol,amount:this.state.sendTokenAmount,network:(null==(n=Bv.state.activeCaipNetwork)?void 0:n.caipNetworkId)||""}}),this.sendNativeToken({receiverAddress:this.state.receiverAddress,sendTokenAmount:this.state.sendTokenAmount,gasPrice:this.state.gasPrice,decimals:this.state.token.quantity.decimals}))},async fetchTokenBalance(e){var t,i;Rv.loading=!0;const s=null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId,n=null==(i=Bv.state.activeCaipNetwork)?void 0:i.chainNamespace,r=Bv.state.activeCaipAddress,o=r?Sy.getPlainAddress(r):void 0;if(Rv.lastRetry&&!Sy.isAllowedRetry(Rv.lastRetry,30*Ay.ONE_SEC_MS))return Rv.loading=!1,[];try{if(o&&s&&n){const e=await jv.getMyTokensWithBalance();return Rv.tokenBalances=e,Rv.lastRetry=void 0,e}}catch(a){Rv.lastRetry=Date.now(),null==e||e(a),Cv.showError("Token Balance Unavailable")}finally{Rv.loading=!1}return[]},fetchNetworkBalance(){if(0===Rv.tokenBalances.length)return;const e=jv.mapBalancesToSwapTokens(Rv.tokenBalances);if(!e)return;const t=e.find(e=>e.address===Bv.getActiveNetworkTokenAddress());t&&(Rv.networkBalanceInUSD=t?ey.multiply(t.quantity.numeric,t.price).toString():"0")},isInsufficientNetworkTokenForGas(e,t){const i=t||"0";return!!ey.bigNumber(e).eq(0)||ey.bigNumber(ey.bigNumber(i)).gt(e)},hasInsufficientGasFunds(){let e=!0;return Gv.state.preferredAccountType===Ev.SMART_ACCOUNT?e=!1:Rv.networkBalanceInUSD&&(e=this.isInsufficientNetworkTokenForGas(Rv.networkBalanceInUSD,Rv.gasPriceInUSD)),e},async sendNativeToken(e){var t,i,s,n;Zy.pushTransactionStack({view:"Account",goBack:!1});const r=e.receiverAddress,o=Gv.state.address,a=Ov.parseUnits(e.sendTokenAmount.toString(),Number(e.decimals));try{await Ov.sendTransaction({chainNamespace:"eip155",to:r,address:o,data:"0x",value:null!==a&&void 0!==a?a:BigInt(0),gasPrice:e.gasPrice}),Cv.showSuccess("Transaction started"),Ky.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Gv.state.preferredAccountType===Ev.SMART_ACCOUNT,token:(null==(t=this.state.token)?void 0:t.symbol)||"",amount:e.sendTokenAmount,network:(null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId)||""}}),this.resetSend()}catch(c){console.error("SendController:sendERC20Token - failed to send native token",c);const t=c instanceof Error?c.message:"Unknown error";Ky.sendEvent({type:"track",event:"SEND_ERROR",properties:{message:t,isSmartAccount:Gv.state.preferredAccountType===Ev.SMART_ACCOUNT,token:(null==(s=this.state.token)?void 0:s.symbol)||"",amount:e.sendTokenAmount,network:(null==(n=Bv.state.activeCaipNetwork)?void 0:n.caipNetworkId)||""}}),Cv.showError("Something went wrong")}},async sendERC20Token(e){var t,i;Zy.pushTransactionStack({view:"Account",goBack:!1});const s=Ov.parseUnits(e.sendTokenAmount.toString(),Number(e.decimals));try{if(Gv.state.address&&e.sendTokenAmount&&e.receiverAddress&&e.tokenAddress){const t=Sy.getPlainAddress(e.tokenAddress);await Ov.writeContract({fromAddress:Gv.state.address,tokenAddress:t,args:[e.receiverAddress,null!==s&&void 0!==s?s:BigInt(0)],method:"transfer",abi:ny(t),chainNamespace:"eip155"}),Cv.showSuccess("Transaction started"),this.resetSend()}}catch(n){console.error("SendController:sendERC20Token - failed to send erc20 token",n);const s=n instanceof Error?n.message:"Unknown error";Ky.sendEvent({type:"track",event:"SEND_ERROR",properties:{message:s,isSmartAccount:Gv.state.preferredAccountType===Ev.SMART_ACCOUNT,token:(null==(t=this.state.token)?void 0:t.symbol)||"",amount:e.sendTokenAmount,network:(null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId)||""}}),Cv.showError("Something went wrong")}},sendSolanaToken(){this.state.sendTokenAmount&&this.state.receiverAddress?(Zy.pushTransactionStack({view:"Account",goBack:!1}),Ov.sendTransaction({chainNamespace:"solana",to:this.state.receiverAddress,value:this.state.sendTokenAmount}).then(()=>{this.resetSend(),Gv.fetchTokenBalance()}).catch(e=>{Cv.showError("Failed to send transaction. Please try again."),console.error("SendController:sendToken - failed to send solana transaction",e)})):Cv.showError("Please enter a valid amount and receiver address")},resetSend(){Rv.token=void 0,Rv.sendTokenAmount=void 0,Rv.receiverAddress=void 0,Rv.receiverProfileImageUrl=void 0,Rv.receiverProfileName=void 0,Rv.loading=!1,Rv.tokenBalances=[]}},Lv={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[],user:void 0},zv={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},qv=(0,b.p)({chains:(0,b.c)(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{networkControllerClient:void 0,connectionControllerClient:void 0},isSwitchingNamespace:!1}),Bv={state:qv,subscribe:e=>(0,b.s)(qv,()=>{e(qv)}),subscribeKey:(e,t)=>(0,b.a)(qv,e,t),subscribeChainProp(e,t,i){let s;return(0,b.s)(qv.chains,()=>{var n;const r=i||qv.activeChain;if(r){const i=null==(n=qv.chains.get(r))?void 0:n[e];s!==i&&(s=i,t(i))}})},initialize(e,t,i){var s;const{chainId:n,namespace:r}=Cy.getActiveNetworkProps(),o=null==t?void 0:t.find(e=>e.id.toString()===(null==n?void 0:n.toString())),a=e.find(e=>(null==e?void 0:e.namespace)===r)||(null==e?void 0:e[0]),c=new Set([...null!==(s=null==t?void 0:t.map(e=>e.chainNamespace))&&void 0!==s?s:[]]);(0===(null==e?void 0:e.length)||!a)&&(qv.noAdapters=!0),qv.noAdapters||(qv.activeChain=null==a?void 0:a.namespace,qv.activeCaipNetwork=o,this.setChainNetworkData(null==a?void 0:a.namespace,{caipNetwork:o}),qv.activeChain&&kv.set({activeChain:null==a?void 0:a.namespace})),c.forEach(e=>{const s=null==t?void 0:t.filter(t=>t.chainNamespace===e);Bv.state.chains.set(e,(0,d.A)({namespace:e,networkState:(0,b.p)((0,d.A)((0,d.A)({},zv),{},{caipNetwork:null==s?void 0:s[0]})),accountState:(0,b.p)(Lv),caipNetworks:null!==s&&void 0!==s?s:[]},i)),this.setRequestedCaipNetworks(null!==s&&void 0!==s?s:[],e)})},removeAdapter(e){var t,i;if(qv.activeChain===e){const s=Array.from(qv.chains.entries()).find(t=>{let[i]=t;return i!==e});if(s){const e=null==(i=null==(t=s[1])?void 0:t.caipNetworks)?void 0:i[0];e&&this.setActiveCaipNetwork(e)}}qv.chains.delete(e)},addAdapter(e,t,i){var s;let{networkControllerClient:n,connectionControllerClient:r}=t;qv.chains.set(e.namespace,{namespace:e.namespace,networkState:(0,d.A)((0,d.A)({},zv),{},{caipNetwork:i[0]}),accountState:Lv,caipNetworks:i,connectionControllerClient:r,networkControllerClient:n}),this.setRequestedCaipNetworks(null!==(s=null==i?void 0:i.filter(t=>t.chainNamespace===e.namespace))&&void 0!==s?s:[],e.namespace)},addNetwork(e){var t;const i=qv.chains.get(e.chainNamespace);if(i){const s=[...i.caipNetworks||[]];null!=(t=i.caipNetworks)&&t.find(t=>t.id===e.id)||s.push(e),qv.chains.set(e.chainNamespace,(0,d.A)((0,d.A)({},i),{},{caipNetworks:s})),this.setRequestedCaipNetworks(s,e.chainNamespace)}},removeNetwork(e,t){var i,s,n;const r=qv.chains.get(e);if(r){const o=(null==(i=qv.activeCaipNetwork)?void 0:i.id)===t,a=[...(null==(s=r.caipNetworks)?void 0:s.filter(e=>e.id!==t))||[]];o&&null!=(n=null==r?void 0:r.caipNetworks)&&n[0]&&this.setActiveCaipNetwork(r.caipNetworks[0]),qv.chains.set(e,(0,d.A)((0,d.A)({},r),{},{caipNetworks:a})),this.setRequestedCaipNetworks(a||[],e)}},setAdapterNetworkState(e,t){const i=qv.chains.get(e);i&&(i.networkState=(0,d.A)((0,d.A)({},i.networkState||zv),t),qv.chains.set(e,i))},setChainAccountData(e,t){if(!e)throw new Error("Chain is required to update chain account data");const i=qv.chains.get(e);if(i){const s=(0,d.A)((0,d.A)({},i.accountState||Lv),t);qv.chains.set(e,(0,d.A)((0,d.A)({},i),{},{accountState:s})),(1===qv.chains.size||qv.activeChain===e)&&(t.caipAddress&&(qv.activeCaipAddress=t.caipAddress),Gv.replaceState(s))}},setChainNetworkData(e,t){if(!e)return;const i=qv.chains.get(e);if(i){const s=(0,d.A)((0,d.A)({},i.networkState||zv),t);qv.chains.set(e,(0,d.A)((0,d.A)({},i),{},{networkState:s}))}},setAccountProp(e,t,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.setChainAccountData(i,{[e]:t},s),"status"===e&&"disconnected"===t&&i&&tv.removeConnectorId(i)},setActiveNamespace(e){var t,i;qv.activeChain=e;const s=e?qv.chains.get(e):void 0,n=null==(t=null==s?void 0:s.networkState)?void 0:t.caipNetwork;null!=n&&n.id&&e&&(qv.activeCaipAddress=null==(i=null==s?void 0:s.accountState)?void 0:i.caipAddress,qv.activeCaipNetwork=n,this.setChainNetworkData(e,{caipNetwork:n}),Cy.setActiveCaipNetworkId(null==n?void 0:n.caipNetworkId),kv.set({activeChain:e,selectedNetworkId:null==n?void 0:n.caipNetworkId}))},setActiveCaipNetwork(e){var t,i,s;if(!e)return;qv.activeChain!==e.chainNamespace&&this.setIsSwitchingNamespace(!0);const n=qv.chains.get(e.chainNamespace);qv.activeChain=e.chainNamespace,qv.activeCaipNetwork=e,this.setChainNetworkData(e.chainNamespace,{caipNetwork:e}),null!=(t=null==n?void 0:n.accountState)&&t.address?qv.activeCaipAddress="".concat(e.chainNamespace,":").concat(e.id,":").concat(null==(i=null==n?void 0:n.accountState)?void 0:i.address):qv.activeCaipAddress=void 0,this.setAccountProp("caipAddress",qv.activeCaipAddress,e.chainNamespace),n&&Gv.replaceState(n.accountState),Uv.resetSend(),kv.set({activeChain:qv.activeChain,selectedNetworkId:null==(s=qv.activeCaipNetwork)?void 0:s.caipNetworkId}),Cy.setActiveCaipNetworkId(e.caipNetworkId),!this.checkIfSupportedNetwork(e.chainNamespace)&&Uy.state.enableNetworkSwitch&&!Uy.state.allowUnsupportedChain&&!Ov.state.wcBasic&&this.showUnsupportedChainUI()},addCaipNetwork(e){var t;if(!e)return;const i=qv.chains.get(e.chainNamespace);i&&(null==(t=null==i?void 0:i.caipNetworks)||t.push(e))},async switchActiveNamespace(e){var t;if(!e)return;const i=e!==Bv.state.activeChain,s=null==(t=Bv.getNetworkData(e))?void 0:t.caipNetwork,n=Bv.getCaipNetworkByNamespace(e,null==s?void 0:s.id);i&&n&&await Bv.switchActiveNetwork(n)},async switchActiveNetwork(e){var t;const i=Bv.state.chains.get(Bv.state.activeChain);(null==(t=null==i?void 0:i.caipNetworks)||!t.some(e=>{var t;return e.id===(null==(t=qv.activeCaipNetwork)?void 0:t.id)}))&&Zy.goBack();const s=this.getNetworkControllerClient(e.chainNamespace);s&&(await s.switchCaipNetwork(e),Ky.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:e.caipNetworkId}}))},getNetworkControllerClient(e){const t=e||qv.activeChain,i=qv.chains.get(t);if(!i)throw new Error("Chain adapter not found");if(!i.networkControllerClient)throw new Error("NetworkController client not set");return i.networkControllerClient},getConnectionControllerClient(e){const t=e||qv.activeChain;if(!t)throw new Error("Chain is required to get connection controller client");const i=qv.chains.get(t);if(null==i||!i.connectionControllerClient)throw new Error("ConnectionController client not set");return i.connectionControllerClient},getAccountProp(e,t){var i;let s=qv.activeChain;if(t&&(s=t),!s)return;const n=null==(i=qv.chains.get(s))?void 0:i.accountState;return n?n[e]:void 0},getNetworkProp(e,t){var i;const s=null==(i=qv.chains.get(t))?void 0:i.networkState;if(s)return s[e]},getRequestedCaipNetworks(e){const t=qv.chains.get(e),{approvedCaipNetworkIds:i=[],requestedCaipNetworks:s=[]}=(null==t?void 0:t.networkState)||{};return Sy.sortRequestedNetworks(i,s)},getAllRequestedCaipNetworks(){const e=[];return qv.chains.forEach(t=>{const i=this.getRequestedCaipNetworks(t.namespace);e.push(...i)}),e},setRequestedCaipNetworks(e,t){this.setAdapterNetworkState(t,{requestedCaipNetworks:e})},getAllApprovedCaipNetworkIds(){const e=[];return qv.chains.forEach(t=>{const i=this.getApprovedCaipNetworkIds(t.namespace);e.push(...i)}),e},getActiveCaipNetwork:()=>qv.activeCaipNetwork,getActiveCaipAddress:()=>qv.activeCaipAddress,getApprovedCaipNetworkIds(e){var t;const i=qv.chains.get(e);return(null==(t=null==i?void 0:i.networkState)?void 0:t.approvedCaipNetworkIds)||[]},async setApprovedCaipNetworksData(e){const t=this.getNetworkControllerClient(),i=await(null==t?void 0:t.getApprovedCaipNetworksData());this.setAdapterNetworkState(e,{approvedCaipNetworkIds:null==i?void 0:i.approvedCaipNetworkIds,supportsAllNetworks:null==i?void 0:i.supportsAllNetworks})},checkIfSupportedNetwork(e,t){const i=t||qv.activeCaipNetwork,s=this.getRequestedCaipNetworks(e);return!s.length||(null==s?void 0:s.some(e=>e.id===(null==i?void 0:i.id)))},checkIfSupportedChainId(e){if(!qv.activeChain)return!0;const t=this.getRequestedCaipNetworks(qv.activeChain);return null==t?void 0:t.some(t=>t.id===e)},setSmartAccountEnabledNetworks(e,t){this.setAdapterNetworkState(t,{smartAccountEnabledNetworks:e})},checkIfSmartAccountEnabled(){var e;const t=$m.caipNetworkIdToNumber(null==(e=qv.activeCaipNetwork)?void 0:e.caipNetworkId),i=qv.activeChain;if(!i||!t)return!1;const s=this.getNetworkProp("smartAccountEnabledNetworks",i);return!(null==s||!s.includes(Number(t)))},getActiveNetworkTokenAddress(){var e,t;const i=(null==(e=qv.activeCaipNetwork)?void 0:e.chainNamespace)||"eip155",s=(null==(t=qv.activeCaipNetwork)?void 0:t.id)||1,n=Ay.NATIVE_TOKEN_ADDRESS[i];return"".concat(i,":").concat(s,":").concat(n)},showUnsupportedChainUI(){Qv.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const e=qv.activeCaipNetwork;return!(null==e||!e.chainNamespace||!Ay.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(e.chainNamespace))},resetNetwork(e){this.setAdapterNetworkState(e,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]})},resetAccount(e){const t=e;if(!t)throw new Error("Chain is required to set account prop");qv.activeCaipAddress=void 0,this.setChainAccountData(t,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountType:void 0,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,allAccounts:[],user:void 0,status:"disconnected"}),tv.removeConnectorId(t)},async disconnect(e){const t=function(e){const t=Array.from(Bv.state.chains.keys());let i=[];return e?(i.push([e,Bv.state.chains.get(e)]),iv(e,sy.CONNECTOR_ID.WALLET_CONNECT)?t.forEach(t=>{t!==e&&iv(t,sy.CONNECTOR_ID.WALLET_CONNECT)&&i.push([t,Bv.state.chains.get(t)])}):iv(e,sy.CONNECTOR_ID.AUTH)&&t.forEach(t=>{t!==e&&iv(t,sy.CONNECTOR_ID.AUTH)&&i.push([t,Bv.state.chains.get(t)])})):i=Array.from(Bv.state.chains.entries()),i}(e);try{Uv.resetSend();const i=await Promise.allSettled(t.map(async e=>{let[t,i]=e;var s;try{const{caipAddress:e}=this.getAccountData(t)||{};e&&null!=(s=i.connectionControllerClient)&&s.disconnect&&await i.connectionControllerClient.disconnect(t),this.resetAccount(t),this.resetNetwork(t)}catch(n){throw new Error("Failed to disconnect chain ".concat(t,": ").concat(n.message))}}));Ov.resetWcConnection();const s=i.filter(e=>"rejected"===e.status);if(s.length>0)throw new Error(s.map(e=>e.reason.message).join(", "));Cy.deleteConnectedSocialProvider(),e?tv.removeConnectorId(e):tv.resetConnectorIds(),Ky.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:e||"all"}})}catch(i){console.error(i.message||"Failed to disconnect chains"),Ky.sendEvent({type:"track",event:"DISCONNECT_ERROR",properties:{message:i.message||"Failed to disconnect chains"}})}},setIsSwitchingNamespace(e){qv.isSwitchingNamespace=e},getFirstCaipNetworkSupportsAuthConnector(){var e,t;const i=[];let s;if(qv.chains.forEach(e=>{sy.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(t=>t===e.namespace)&&e.namespace&&i.push(e.namespace)}),i.length>0){const n=i[0];return s=n?null==(t=null==(e=qv.chains.get(n))?void 0:e.caipNetworks)?void 0:t[0]:void 0,s}},getAccountData(e){var t;return e?null==(t=Bv.state.chains.get(e))?void 0:t.accountState:Gv.state},getNetworkData(e){var t;const i=e||qv.activeChain;if(i)return null==(t=Bv.state.chains.get(i))?void 0:t.networkState},getCaipNetworkByNamespace(e,t){var i,s,n;if(!e)return;const r=Bv.state.chains.get(e);return(null==(i=null==r?void 0:r.caipNetworks)?void 0:i.find(e=>e.id===t))||(null==(s=null==r?void 0:r.networkState)?void 0:s.caipNetwork)||(null==(n=null==r?void 0:r.caipNetworks)?void 0:n[0])},getRequestedCaipNetworkIds(){const e=tv.state.filterByNamespace;return(e?[qv.chains.get(e)]:Array.from(qv.chains.values())).flatMap(e=>(null==e?void 0:e.caipNetworks)||[]).map(e=>e.caipNetworkId)}},Vv={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},Hv=Sy.getBlockchainApiUrl(),Kv=(0,b.p)({clientId:null,api:new Ty({baseUrl:Hv,clientId:null}),supportedChains:{http:[],ws:[]}}),Wv={state:Kv,async get(e){const{st:t,sv:i}=Wv.getSdkProperties(),s=Uy.state.projectId,n=(0,d.A)((0,d.A)({},e.params||{}),{},{st:t,sv:i,projectId:s});return Kv.api.get((0,d.A)((0,d.A)({},e),{},{params:n}))},getSdkProperties(){const{sdkType:e,sdkVersion:t}=Uy.state;return{st:e||"unknown",sv:t||"unknown"}},async isNetworkSupported(e){if(!e)return!1;try{Kv.supportedChains.http.length||await Wv.getSupportedNetworks()}catch(t){return!1}return Kv.supportedChains.http.includes(e)},async getSupportedNetworks(){const e=await Wv.get({path:"v1/supported-chains"});return Kv.supportedChains=e,e},async fetchIdentity(e){let{address:t,caipNetworkId:i}=e;if(!await Wv.isNetworkSupported(i))return{avatar:"",name:""};const s=Cy.getIdentityFromCacheForAddress(t);if(s)return s;const n=await Wv.get({path:"/v1/identity/".concat(t),params:{sender:Bv.state.activeCaipAddress?Sy.getPlainAddress(Bv.state.activeCaipAddress):void 0}});return Cy.updateIdentityCache({address:t,identity:n,timestamp:Date.now()}),n},async fetchTransactions(e){let{account:t,cursor:i,onramp:s,signal:n,cache:r,chainId:o}=e;var a;return await Wv.isNetworkSupported(null==(a=Bv.state.activeCaipNetwork)?void 0:a.caipNetworkId)?Wv.get({path:"/v1/account/".concat(t,"/history"),params:{cursor:i,onramp:s,chainId:o},signal:n,cache:r}):{data:[],next:void 0}},async fetchSwapQuote(e){let{amount:t,userAddress:i,from:s,to:n,gasPrice:r}=e;var o;return await Wv.isNetworkSupported(null==(o=Bv.state.activeCaipNetwork)?void 0:o.caipNetworkId)?Wv.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:i,from:s,to:n,gasPrice:r}}):{quotes:[]}},async fetchSwapTokens(e){let{chainId:t}=e;var i;return await Wv.isNetworkSupported(null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId)?Wv.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async fetchTokenPrice(e){let{addresses:t}=e;var i;return await Wv.isNetworkSupported(null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId)?Kv.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:Uy.state.projectId},headers:{"Content-Type":"application/json"}}):{fungibles:[]}},async fetchSwapAllowance(e){let{tokenAddress:t,userAddress:i}=e;var s;return await Wv.isNetworkSupported(null==(s=Bv.state.activeCaipNetwork)?void 0:s.caipNetworkId)?Wv.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:i},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice(e){let{chainId:t}=e;var i;const{st:s,sv:n}=Wv.getSdkProperties();if(!await Wv.isNetworkSupported(null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId))throw new Error("Network not supported for Gas Price");return Wv.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:s,sv:n}})},async generateSwapCalldata(e){let{amount:t,from:i,to:s,userAddress:n,disableEstimate:r}=e;var o;if(!await Wv.isNetworkSupported(null==(o=Bv.state.activeCaipNetwork)?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return Kv.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:Ay.CONVERT_SLIPPAGE_TOLERANCE},projectId:Uy.state.projectId,from:i,to:s,userAddress:n,disableEstimate:r}})},async generateApproveCalldata(e){let{from:t,to:i,userAddress:s}=e;var n;const{st:r,sv:o}=Wv.getSdkProperties();if(!await Wv.isNetworkSupported(null==(n=Bv.state.activeCaipNetwork)?void 0:n.caipNetworkId))throw new Error("Network not supported for Swaps");return Wv.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:s,from:t,to:i,st:r,sv:o}})},async getBalance(e,t,i){var s;const{st:n,sv:r}=Wv.getSdkProperties();if(!await Wv.isNetworkSupported(null==(s=Bv.state.activeCaipNetwork)?void 0:s.caipNetworkId))return Cv.showError("Token Balance Unavailable"),{balances:[]};const o="".concat(t,":").concat(e),a=Cy.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await Wv.get({path:"/v1/account/".concat(e,"/balance"),params:{currency:"usd",chainId:t,forceUpdate:i,st:n,sv:r}});return Cy.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(e){var t;return await Wv.isNetworkSupported(null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId)?Wv.get({path:"/v1/profile/account/".concat(e),params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName(e){let{address:t}=e;var i;return await Wv.isNetworkSupported(null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId)?Wv.get({path:"/v1/profile/reverse/".concat(t),params:{sender:Gv.state.address,apiVersion:"2"}}):[]},async getEnsNameSuggestions(e){var t;return await Wv.isNetworkSupported(null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId)?Wv.get({path:"/v1/profile/suggestions/".concat(e),params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName(e){let{coinType:t,address:i,message:s,signature:n}=e;var r;return await Wv.isNetworkSupported(null==(r=Bv.state.activeCaipNetwork)?void 0:r.caipNetworkId)?Kv.api.post({path:"/v1/profile/account",body:{coin_type:t,address:i,message:s,signature:n},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL(e){let{destinationWallets:t,partnerUserId:i,defaultNetwork:s,purchaseAmount:n,paymentAmount:r}=e;var o;return await Wv.isNetworkSupported(null==(o=Bv.state.activeCaipNetwork)?void 0:o.caipNetworkId)?(await Kv.api.post({path:"/v1/generators/onrampurl",params:{projectId:Uy.state.projectId},body:{destinationWallets:t,defaultNetwork:s,partnerUserId:i,defaultExperience:"buy",presetCryptoAmount:n,presetFiatAmount:r}})).url:""},async getOnrampOptions(){var e;if(!await Wv.isNetworkSupported(null==(e=Bv.state.activeCaipNetwork)?void 0:e.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await Wv.get({path:"/v1/onramp/options"})}catch(t){return Vv}},async getOnrampQuote(e){let{purchaseCurrency:t,paymentCurrency:i,amount:s,network:n}=e;var r;try{return await Wv.isNetworkSupported(null==(r=Bv.state.activeCaipNetwork)?void 0:r.caipNetworkId)?await Kv.api.post({path:"/v1/onramp/quote",params:{projectId:Uy.state.projectId},body:{purchaseCurrency:t,paymentCurrency:i,amount:s,network:n}}):null}catch(o){return{coinbaseFee:{amount:s,currency:i.id},networkFee:{amount:s,currency:i.id},paymentSubtotal:{amount:s,currency:i.id},paymentTotal:{amount:s,currency:i.id},purchaseAmount:{amount:s,currency:i.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(e){var t;return await Wv.isNetworkSupported(null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId)?Wv.get({path:"/v1/sessions/".concat(e)}):[]},async revokeSmartSession(e,t,i){var s;return await Wv.isNetworkSupported(null==(s=Bv.state.activeCaipNetwork)?void 0:s.caipNetworkId)?Kv.api.post({path:"/v1/sessions/".concat(e,"/revoke"),params:{projectId:Uy.state.projectId},body:{pci:t,signature:i}}):{success:!1}},setClientId(e){Kv.clientId=e,Kv.api=new Ty({baseUrl:Hv,clientId:e})}},Fv=(0,b.p)({currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,allAccounts:[]}),Gv={state:Fv,replaceState(e){e&&Object.assign(Fv,(0,b.r)(e))},subscribe:e=>Bv.subscribeChainProp("accountState",t=>{if(t)return e(t)}),subscribeKey(e,t,i){let s;return Bv.subscribeChainProp("accountState",i=>{if(i){const n=i[e];s!==n&&(s=n,t(n))}},i)},setStatus(e,t){Bv.setAccountProp("status",e,t)},getCaipAddress:e=>Bv.getAccountProp("caipAddress",e),setCaipAddress(e,t){const i=e?Sy.getPlainAddress(e):void 0;t===Bv.state.activeChain&&(Bv.state.activeCaipAddress=e),Bv.setAccountProp("caipAddress",e,t),Bv.setAccountProp("address",i,t)},setBalance(e,t,i){Bv.setAccountProp("balance",e,i),Bv.setAccountProp("balanceSymbol",t,i)},setProfileName(e,t){Bv.setAccountProp("profileName",e,t)},setProfileImage(e,t){Bv.setAccountProp("profileImage",e,t)},setUser(e,t){Bv.setAccountProp("user",e,t)},setAddressExplorerUrl(e,t){Bv.setAccountProp("addressExplorerUrl",e,t)},setSmartAccountDeployed(e,t){Bv.setAccountProp("smartAccountDeployed",e,t)},setCurrentTab(e){Bv.setAccountProp("currentTab",e,Bv.state.activeChain)},setTokenBalance(e,t){e&&Bv.setAccountProp("tokenBalance",e,t)},setShouldUpdateToAddress(e,t){Bv.setAccountProp("shouldUpdateToAddress",e,t)},setAllAccounts(e,t){Bv.setAccountProp("allAccounts",e,t)},addAddressLabel(e,t,i){const s=Bv.getAccountProp("addressLabels",i)||new Map;s.set(e,t),Bv.setAccountProp("addressLabels",s,i)},removeAddressLabel(e,t){const i=Bv.getAccountProp("addressLabels",t)||new Map;i.delete(e),Bv.setAccountProp("addressLabels",i,t)},setConnectedWalletInfo(e,t){Bv.setAccountProp("connectedWalletInfo",e,t,!1)},setPreferredAccountType(e,t){Bv.setAccountProp("preferredAccountType",e,t)},setSocialProvider(e,t){e&&Bv.setAccountProp("socialProvider",e,t)},setSocialWindow(e,t){Bv.setAccountProp("socialWindow",e?(0,b.r)(e):void 0,t)},setFarcasterUrl(e,t){Bv.setAccountProp("farcasterUrl",e,t)},async fetchTokenBalance(e){var t,i;Fv.balanceLoading=!0;const s=null==(t=Bv.state.activeCaipNetwork)?void 0:t.caipNetworkId,n=null==(i=Bv.state.activeCaipNetwork)?void 0:i.chainNamespace,r=Bv.state.activeCaipAddress,o=r?Sy.getPlainAddress(r):void 0;if(Fv.lastRetry&&!Sy.isAllowedRetry(Fv.lastRetry,30*Ay.ONE_SEC_MS))return Fv.balanceLoading=!1,[];try{if(o&&s&&n){const e=(await Wv.getBalance(o,s)).balances.filter(e=>"0"!==e.quantity.decimals);return this.setTokenBalance(e,n),Fv.lastRetry=void 0,Fv.balanceLoading=!1,e}}catch(a){Fv.lastRetry=Date.now(),null==e||e(a),Cv.showError("Token Balance Unavailable")}finally{Fv.balanceLoading=!1}return[]},resetAccount(e){Bv.resetAccount(e)}},Yv=(0,b.p)({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),Qv={state:Yv,subscribe:e=>(0,b.s)(Yv,()=>e(Yv)),subscribeKey:(e,t)=>(0,b.a)(Yv,e,t),async open(e){var t;const i="connected"===Gv.state.status;Ov.state.wcBasic?Yy.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1}):await Yy.prefetch({fetchConnectorImages:!i,fetchFeaturedWallets:!i,fetchRecommendedWallets:!i}),null!=e&&e.namespace?(await Bv.switchActiveNamespace(e.namespace),Qv.setLoading(!0,e.namespace)):Qv.setLoading(!0),tv.setFilterByNamespace(null==e?void 0:e.namespace);const s=null==(t=Bv.getAccountData(null==e?void 0:e.namespace))?void 0:t.caipAddress;Bv.state.noAdapters&&!s?Sy.isMobile()?Zy.reset("AllWallets"):Zy.reset("ConnectingWalletConnectBasic"):null!=e&&e.view?Zy.reset(e.view):s?Zy.reset("Account"):Zy.reset("Connect"),Yv.open=!0,kv.set({open:!0}),Ky.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!s}})},close(){const e=Uy.state.enableEmbedded,t=!!Bv.state.activeCaipAddress;Yv.open&&Ky.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:t}}),Yv.open=!1,Qv.clearLoading(),e?t?Zy.replace("Account"):Zy.push("Connect"):kv.set({open:!1}),Ov.resetUri()},setLoading(e,t){t&&Yv.loadingNamespaceMap.set(t,e),Yv.loading=e,kv.set({loading:e})},clearLoading(){Yv.loadingNamespaceMap.clear(),Yv.loading=!1},shake(){Yv.shake||(Yv.shake=!0,setTimeout(()=>{Yv.shake=!1},500))}},Zv=2147483648,Jv={convertEVMChainIdToCoinType(e){if(e>=Zv)throw new Error("Invalid chainId");return(Zv|e)>>>0}},Xv=(0,b.p)({suggestions:[],loading:!1}),$v={state:Xv,subscribe:e=>(0,b.s)(Xv,()=>e(Xv)),subscribeKey:(e,t)=>(0,b.a)(Xv,e,t),async resolveName(e){var t,i;try{return await Wv.lookupEnsName(e)}catch(s){throw new Error((null==(i=null==(t=null==s?void 0:s.reasons)?void 0:t[0])?void 0:i.description)||"Error resolving name")}},async isNameRegistered(e){try{return await Wv.lookupEnsName(e),!0}catch(t){return!1}},async getSuggestions(e){try{Xv.loading=!0,Xv.suggestions=[];const t=await Wv.getEnsNameSuggestions(e);return Xv.suggestions=t.suggestions.map(e=>(0,d.A)((0,d.A)({},e),{},{name:e.name}))||[],Xv.suggestions}catch(t){const e=this.parseEnsApiError(t,"Error fetching name suggestions");throw new Error(e)}finally{Xv.loading=!1}},async getNamesForAddress(e){try{if(!Bv.state.activeCaipNetwork)return[];const t=Cy.getEnsFromCacheForAddress(e);if(t)return t;const i=await Wv.reverseLookupEnsName({address:e});return Cy.updateEnsCache({address:e,ens:i,timestamp:Date.now()}),i}catch(t){const e=this.parseEnsApiError(t,"Error fetching names for address");throw new Error(e)}},async registerName(e){const t=Bv.state.activeCaipNetwork;if(!t)throw new Error("Network not found");const i=Gv.state.address,s=tv.getAuthConnector();if(!i||!s)throw new Error("Address or auth connector not found");Xv.loading=!0;try{const s=JSON.stringify({name:e,attributes:{},timestamp:Math.floor(Date.now()/1e3)});Zy.pushTransactionStack({view:"RegisterAccountNameSuccess",goBack:!1,replace:!0,onCancel(){Xv.loading=!1}});const n=await Ov.signMessage(s),r=t.id;if(!r)throw new Error("Network not found");const o=Jv.convertEVMChainIdToCoinType(Number(r));await Wv.registerEnsName({coinType:o,address:i,signature:n,message:s}),Gv.setProfileName(e,t.chainNamespace),Zy.replace("RegisterAccountNameSuccess")}catch(n){const t=this.parseEnsApiError(n,"Error registering name ".concat(e));throw Zy.replace("RegisterAccountName"),new Error(t)}finally{Xv.loading=!1}},validateName:e=>/^[\x2D0-9A-Za-z]{4,}$/.test(e),parseEnsApiError(e,t){var i,s;return(null==(s=null==(i=null==e?void 0:e.reasons)?void 0:i[0])?void 0:s.description)||t}};function eb(e){let{strict:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(!e||"string"!=typeof e)&&(t?/^0x[0-9a-fA-F]*$/.test(e):e.startsWith("0x"))}function tb(e){return eb(e,{strict:!1})?Math.ceil((e.length-2)/2):e.length}const ib="2.23.2";let sb={getDocsUrl:e=>{let{docsBaseUrl:t,docsPath:i="",docsSlug:s}=e;return i?"".concat(null!==t&&void 0!==t?t:"https://viem.sh").concat(i).concat(s?"#".concat(s):""):void 0},version:"viem@".concat(ib)};class nb extends Error{constructor(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s;const n=(()=>{var e;return i.cause instanceof nb?i.cause.details:null!=(e=i.cause)&&e.message?i.cause.message:i.details})(),r=i.cause instanceof nb&&i.cause.docsPath||i.docsPath,o=null==(s=sb.getDocsUrl)?void 0:s.call(sb,(0,d.A)((0,d.A)({},i),{},{docsPath:r}));super([e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...o?["Docs: ".concat(o)]:[],...n?["Details: ".concat(n)]:[],...sb.version?["Version: ".concat(sb.version)]:[]].join("\n"),i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=r,this.metaMessages=i.metaMessages,this.name=null!==(t=i.name)&&void 0!==t?t:this.name,this.shortMessage=e,this.version=ib}walk(e){return rb(this,e)}}function rb(e,t){return null!=t&&t(e)?e:e&&"object"==typeof e&&"cause"in e&&void 0!==e.cause?rb(e.cause,t):t?null:e}class ob extends nb{constructor(e){let{size:t,targetSize:i,type:s}=e;super("".concat(s.charAt(0).toUpperCase()).concat(s.slice(1).toLowerCase()," size (").concat(t,") exceeds padding size (").concat(i,")."),{name:"SizeExceedsPaddingSizeError"})}}function ab(e){let{dir:t,size:i=32}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e?function(e){let{dir:t,size:i=32}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===i)return e;const s=e.replace("0x","");if(s.length>2*i)throw new ob({size:Math.ceil(s.length/2),targetSize:i,type:"hex"});return"0x".concat(s["right"===t?"padEnd":"padStart"](2*i,"0"))}(e,{dir:t,size:i}):function(e){let{dir:t,size:i=32}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null===i)return e;if(e.length>i)throw new ob({size:e.length,targetSize:i,type:"bytes"});const s=new Uint8Array(i);for(let n=0;n<i;n++){const r="right"===t;s[r?n:i-n-1]=e[r?n:e.length-n-1]}return s}(e,{dir:t,size:i})}class cb extends nb{constructor(e){let{max:t,min:i,signed:s,size:n,value:r}=e;super('Number "'.concat(r,'" is not in safe ').concat(n?"".concat(8*n,"-bit ").concat(s?"signed":"unsigned"," "):"","integer range ").concat(t?"(".concat(i," to ").concat(t,")"):"(above ".concat(i,")")),{name:"IntegerOutOfRangeError"})}}class lb extends nb{constructor(e){let{givenSize:t,maxSize:i}=e;super("Size cannot exceed ".concat(i," bytes. Given size: ").concat(t," bytes."),{name:"SizeOverflowError"})}}function hb(e,t){let{size:i}=t;if(tb(e)>i)throw new lb({givenSize:tb(e),maxSize:i})}function db(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{signed:i}=t;t.size&&hb(e,{size:t.size});const s=BigInt(e);if(!i)return s;const n=(e.length-2)/2;return s<=(1n<<8n*BigInt(n)-1n)-1n?s:s-BigInt("0x".concat("f".padStart(2*n,"f")))-1n}const ub=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function pb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"number"==typeof e||"bigint"==typeof e?fb(e,t):"string"==typeof e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=wb.encode(e);return gb(i,t)}(e,t):"boolean"==typeof e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i="0x".concat(Number(e));return"number"==typeof t.size?(hb(i,{size:t.size}),ab(i,{size:t.size})):i}(e,t):gb(e,t)}function gb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="";for(let n=0;n<e.length;n++)i+=ub[e[n]];const s="0x".concat(i);return"number"==typeof t.size?(hb(s,{size:t.size}),ab(s,{dir:"right",size:t.size})):s}function fb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{signed:i,size:s}=t,n=BigInt(e);let r;s?r=i?(1n<<8n*BigInt(s)-1n)-1n:2n**(8n*BigInt(s))-1n:"number"==typeof e&&(r=BigInt(Number.MAX_SAFE_INTEGER));const o="bigint"==typeof r&&i?-r-1n:0;if(r&&n>r||n<o){const t="bigint"==typeof e?"n":"";throw new cb({max:r?"".concat(r).concat(t):void 0,min:"".concat(o).concat(t),signed:i,size:s,value:"".concat(e).concat(t)})}const a="0x".concat((i&&n<0?(1n<<BigInt(8*s))+BigInt(n):n).toString(16));return s?ab(a,{size:s}):a}const wb=new TextEncoder;const mb=new TextEncoder;function yb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"number"==typeof e||"bigint"==typeof e?function(e,t){const i=fb(e,t);return Ib(i)}(e,t):"boolean"==typeof e?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new Uint8Array(1);return i[0]=Number(e),"number"==typeof t.size?(hb(i,{size:t.size}),ab(i,{size:t.size})):i}(e,t):eb(e)?Ib(e,t):Eb(e,t)}const vb={zero:48,nine:57,A:65,F:70,a:97,f:102};function bb(e){return e>=vb.zero&&e<=vb.nine?e-vb.zero:e>=vb.A&&e<=vb.F?e-(vb.A-10):e>=vb.a&&e<=vb.f?e-(vb.a-10):void 0}function Ib(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e;t.size&&(hb(i,{size:t.size}),i=ab(i,{dir:"right",size:t.size}));let s=i.slice(2);s.length%2&&(s="0".concat(s));const n=s.length/2,r=new Uint8Array(n);for(let o=0,a=0;o<n;o++){const e=bb(s.charCodeAt(a++)),t=bb(s.charCodeAt(a++));if(void 0===e||void 0===t)throw new nb('Invalid byte sequence ("'.concat(s[a-2]).concat(s[a-1],'" in "').concat(s,'").'));r[o]=16*e+t}return r}function Eb(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=mb.encode(e);return"number"==typeof t.size?(hb(i,{size:t.size}),ab(i,{dir:"right",size:t.size})):i}function Nb(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Ab(e){if(!function(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}(e))throw new Error("Uint8Array expected");for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(i.length>0&&!i.includes(e.length))throw new Error("Uint8Array expected of length "+i+", got length="+e.length)}function Cb(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Nb(e.outputLen),Nb(e.blockLen)}function Sb(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Pb(e,t){Ab(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Tb=BigInt(2**32-1),Mb=BigInt(32);function _b(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{h:Number(e&Tb),l:Number(e>>Mb&Tb)}:{h:0|Number(e>>Mb&Tb),l:0|Number(e&Tb)}}function Ob(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let n=0;n<e.length;n++){const{h:r,l:o}=_b(e[n],t);[i[n],s[n]]=[r,o]}return[i,s]}const xb="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function kb(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Db(e,t){return e<<32-t|e>>>t}const jb=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Rb(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function Ub(e){for(let t=0;t<e.length;t++)e[t]=Rb(e[t])}function Lb(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),Ab(e),e}function zb(){let e=0;for(let i=0;i<arguments.length;i++){const t=i<0||arguments.length<=i?void 0:arguments[i];Ab(t),e+=t.length}const t=new Uint8Array(e);for(let i=0,s=0;i<arguments.length;i++){const e=i<0||arguments.length<=i?void 0:arguments[i];t.set(e,s),s+=e.length}return t}class qb{clone(){return this._cloneInto()}}function Bb(e){const t=t=>e().update(Lb(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}function Vb(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(xb&&"function"==typeof xb.getRandomValues)return xb.getRandomValues(new Uint8Array(e));if(xb&&"function"==typeof xb.randomBytes)return xb.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}const Hb=[],Kb=[],Wb=[],Fb=BigInt(0),Gb=BigInt(1),Yb=BigInt(2),Qb=BigInt(7),Zb=BigInt(256),Jb=BigInt(113);for(let CD=0,SD=Gb,PD=1,TD=0;CD<24;CD++){[PD,TD]=[TD,(2*PD+3*TD)%5],Hb.push(2*(5*TD+PD)),Kb.push((CD+1)*(CD+2)/2%64);let e=Fb;for(let t=0;t<7;t++)SD=(SD<<Gb^(SD>>Qb)*Jb)%Zb,SD&Yb&&(e^=Gb<<(Gb<<BigInt(t))-Gb);Wb.push(e)}const[Xb,$b]=Ob(Wb,!0),eI=(e,t,i)=>i>32?((e,t,i)=>t<<i-32|e>>>64-i)(e,t,i):((e,t,i)=>e<<i|t>>>32-i)(e,t,i),tI=(e,t,i)=>i>32?((e,t,i)=>e<<i-32|t>>>64-i)(e,t,i):((e,t,i)=>t<<i|e>>>32-i)(e,t,i);class iI extends qb{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24;if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Nb(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}(this.state)}keccak(){jb||Ub(this.state32),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;const i=new Uint32Array(10);for(let s=24-t;s<24;s++){for(let s=0;s<10;s++)i[s]=e[s]^e[s+10]^e[s+20]^e[s+30]^e[s+40];for(let s=0;s<10;s+=2){const t=(s+8)%10,n=(s+2)%10,r=i[n],o=i[n+1],a=eI(r,o,1)^i[t],c=tI(r,o,1)^i[t+1];for(let i=0;i<50;i+=10)e[s+i]^=a,e[s+i+1]^=c}let t=e[2],n=e[3];for(let i=0;i<24;i++){const s=Kb[i],r=eI(t,n,s),o=tI(t,n,s),a=Hb[i];t=e[a],n=e[a+1],e[a]=r,e[a+1]=o}for(let s=0;s<50;s+=10){for(let t=0;t<10;t++)i[t]=e[s+t];for(let t=0;t<10;t++)e[s+t]^=~i[(t+2)%10]&i[(t+4)%10]}e[0]^=Xb[s],e[1]^=$b[s]}i.fill(0)}(this.state32,this.rounds),jb||Ub(this.state32),this.posOut=0,this.pos=0}update(e){Sb(this);const{blockLen:t,state:i}=this,s=(e=Lb(e)).length;for(let n=0;n<s;){const r=Math.min(t-this.pos,s-n);for(let t=0;t<r;t++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,128&t&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Sb(this,!1),Ab(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const r=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+r),s),this.posOut+=r,s+=r}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Nb(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Pb(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:i,outputLen:s,rounds:n,enableXOF:r}=this;return e||(e=new iI(t,i,s,r,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=r,e.destroyed=this.destroyed,e}}const sI=(e,t,i)=>Bb(()=>new iI(t,e,i)),nI=sI(1,136,32);function rI(e,t){const i=t||"hex",s=nI(eb(e,{strict:!1})?yb(e):e);return"bytes"===i?s:pb(s)}class oI extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const e=this.keys().next().value;e&&this.delete(e)}return this}}const aI=new oI(8192);function cI(e){const t=rI("0x".concat(e.substring(4))).substring(26);return function(e,t){if(aI.has("".concat(e,".").concat(t)))return aI.get("".concat(e,".").concat(t));const i=e.substring(2).toLowerCase(),s=rI(Eb(i),"bytes"),n=i.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&n[o]&&(n[o]=n[o].toUpperCase()),(15&s[o>>1])>=8&&n[o+1]&&(n[o+1]=n[o+1].toUpperCase());const r="0x".concat(n.join(""));return aI.set("".concat(e,".").concat(t),r),r}("0x".concat(t))}async function lI(e){let{hash:t,signature:s}=e;const n=eb(t)?t:pb(t),{secp256k1:r}=await i.e(9536).then(i.bind(i,9536));return"0x".concat((()=>{if("object"==typeof s&&"r"in s&&"s"in s){const{r:e,s:t,v:i,yParity:n}=s,o=hI(Number(null!==n&&void 0!==n?n:i));return new r.Signature(db(e),db(t)).addRecoveryBit(o)}const e=eb(s)?s:pb(s),t=function(e){return Number(db(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}("0x".concat(e.slice(130))),i=hI(t);return r.Signature.fromCompact(e.substring(2,130)).addRecoveryBit(i)})().recoverPublicKey(n.substring(2)).toHex(!1))}function hI(e){if(0===e||1===e)return e;if(27===e)return 0;if(28===e)return 1;throw new Error("Invalid yParityOrV value")}const dI=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let a=0;a<t.length;a++)t[a]=255;for(let a=0;a<e.length;a++){const i=e.charAt(a),s=i.charCodeAt(0);if(255!==t[s])throw new TypeError(i+" is ambiguous");t[s]=a}const i=e.length,s=e.charAt(0),n=Math.log(i)/Math.log(256),r=Math.log(256)/Math.log(i);function o(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let r=0,o=0,a=0;for(;e[r]===s;)o++,r++;const c=(e.length-r)*n+1>>>0,l=new Uint8Array(c);for(;r<e.length;){const s=e.charCodeAt(r);if(s>255)return;let n=t[s];if(255===n)return;let o=0;for(let e=c-1;(0!==n||o<a)&&-1!==e;e--,o++)n+=i*l[e]>>>0,l[e]=n%256>>>0,n=n/256>>>0;if(0!==n)throw new Error("Non-zero carry");a=o,r++}let h=c-a;for(;h!==c&&0===l[h];)h++;const d=new Uint8Array(o+(c-h));let u=o;for(;h!==c;)d[u++]=l[h++];return d}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let n=0,o=0,a=0;const c=t.length;for(;a!==c&&0===t[a];)a++,n++;const l=(c-a)*r+1>>>0,h=new Uint8Array(l);for(;a!==c;){let e=t[a],s=0;for(let t=l-1;(0!==e||s<o)&&-1!==t;t--,s++)e+=256*h[t]>>>0,h[t]=e%i>>>0,e=e/i>>>0;if(0!==e)throw new Error("Non-zero carry");o=s,a++}let d=l-o;for(;d!==l&&0===h[d];)d++;let u=s.repeat(n);for(;d<l;++d)u+=e.charAt(h[d]);return u},decodeUnsafe:o,decode:function(e){const t=o(e);if(t)return t;throw new Error("Non-base"+i+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function uI(e){const[t,i]=e.split(":");return{namespace:t,reference:i}}function pI(e,t){return e.includes(":")?[e]:t.chains||[]}const gI="react-native",fI="node",wI="browser",mI="unknown",yI="js";function vI(){return typeof p.d.process<"u"&&typeof p.d.process.versions<"u"&&typeof p.d.process.versions.node<"u"}function bI(){return!(0,v.a)()&&!!(0,v.b)()&&"ReactNative"===navigator.product}function II(){return!vI()&&!!(0,v.b)()&&!!(0,v.a)()}function EI(){return bI()?gI:vI()?fI:II()?wI:mI}function NI(){var e;try{return bI()&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Application)<"u"?null==(e=p.d.global.Application)?void 0:e.applicationId:void 0}catch(t){return}}function AI(){return(0,v.g)()||{name:"",description:"",url:"",icons:[""]}}function CI(e,t,i){const s=function(){if(EI()===gI&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Platform)<"u"){const{OS:e,Version:t}=p.d.global.Platform;return[e,t].join("-")}const e=(0,v.d)();if(null===e)return"unknown";const t=e.os?e.os.replace(" ","").toLowerCase():"unknown";return"browser"===e.type?[t,e.name,e.version].join("-"):[t,e.version].join("-")}(),n=function(){var e;const t=EI();return t===wI?[t,(null==(e=(0,v.e)())?void 0:e.host)||"unknown"].join(":"):t}();return[[e,t].join("-"),[yI,i].join("-"),s,n].join("/")}function SI(e){let{protocol:t,version:i,relayUrl:s,sdkVersion:n,auth:r,projectId:o,useOnCloseEvent:a,bundleId:c,packageName:l}=e;const h=s.split("?"),d={auth:r,ua:CI(t,i,n),projectId:o,useOnCloseEvent:a,packageName:l||void 0,bundleId:c||void 0},u=function(e,t){const i=new URLSearchParams(e);for(const s of Object.keys(t).sort())if(t.hasOwnProperty(s)){const e=t[s];void 0!==e&&i.set(s,e)}return i.toString()}(h[1]||"",d);return h[0]+"?"+u}function PI(e,t){return e.filter(e=>t.includes(e)).length===e.length}function TI(e){return Object.fromEntries(e.entries())}function MI(e){return new Map(Object.entries(e))}function _I(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.c.FIVE_MINUTES,t=arguments.length>1?arguments[1]:void 0;const i=v.c.toMiliseconds(e||v.c.FIVE_MINUTES);let s,n,r,o;return{resolve:e=>{r&&s&&(clearTimeout(r),s(e),o=Promise.resolve(e))},reject:e=>{r&&n&&(clearTimeout(r),n(e))},done:()=>new Promise((e,a)=>{if(o)return e(o);r=setTimeout(()=>{const e=new Error(t);o=Promise.reject(e),a(e)},i),s=e,n=a})}}function OI(e,t,i){return new Promise(async(s,n)=>{const r=setTimeout(()=>n(new Error(i)),t);try{s(await e)}catch(o){n(o)}clearTimeout(r)})}function xI(e,t){if("string"==typeof t&&t.startsWith("".concat(e,":")))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw new Error('Value must be "string" for expirer target type: topic');return"topic:".concat(t)}if("id"===e.toLowerCase()){if("number"!=typeof t)throw new Error('Value must be "number" for expirer target type: id');return"id:".concat(t)}throw new Error("Unknown expirer target type: ".concat(e))}function kI(e){const[t,i]=e.split(":"),s={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof i)s.topic=i;else{if("id"!==t||!Number.isInteger(Number(i)))throw new Error("Invalid target, expected id:number or topic:string, got ".concat(t,":").concat(i));s.id=Number(i)}return s}function DI(e,t){return v.c.fromMiliseconds(Date.now()+v.c.toMiliseconds(e))}function jI(e){return Date.now()>=v.c.toMiliseconds(e)}function RI(e,t){return"".concat(e).concat(t?":".concat(t):"")}function UI(){return[...new Set([...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],...arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]])]}async function LI(e){let{id:t,topic:i,wcDeepLink:s}=e;var n;try{if(!s)return;const e="string"==typeof s?JSON.parse(s):s,r=null==e?void 0:e.href;if("string"!=typeof r)return;const o=function(e,t,i){const s="requestId=".concat(t,"&sessionTopic=").concat(i);e.endsWith("/")&&(e=e.slice(0,-1));let n="".concat(e);if(e.startsWith("https://t.me")){const t=e.includes("?")?"&startapp=":"?startapp=";n="".concat(n).concat(t).concat(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=p.d.Buffer.from(e).toString("base64");return t?i.replace(/[=]/g,""):i}(s,!0))}else n="".concat(n,"/wc?").concat(s);return n}(r,t,i),a=EI();if(a===wI){if(null==(n=(0,v.a)())||!n.hasFocus())return void console.warn("Document does not have focus, skipping deeplink.");!function(e){let t="_self";!function(){try{return window.self!==window.top}catch(e){return!1}}()?(typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)||e.startsWith("https://")||e.startsWith("http://"))&&(t="_blank"):t="_top",window.open(e,t,"noreferrer noopener")}(o)}else a===gI&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u"&&await p.d.global.Linking.openURL(o)}catch(r){console.error(r)}}function zI(e,t){if(!e.includes(t))return null;const i=e.split(/([&,?,=])/),s=i.indexOf(t);return i[s+2]}function qI(){return typeof crypto<"u"&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function BI(){return typeof p.d.process<"u"&&"true"===p.d.process.env.IS_VITEST}function VI(e){return p.d.Buffer.from(e,"base64").toString("utf-8")}function HI(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function KI(e){if(!function(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}(e))throw new Error("Uint8Array expected");for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(i.length>0&&!i.includes(e.length))throw new Error("Uint8Array expected of length "+i+", got length="+e.length)}function WI(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");HI(e.outputLen),HI(e.blockLen)}function FI(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function GI(e,t){KI(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const YI=BigInt(2**32-1),QI=BigInt(32);function ZI(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{h:Number(e&YI),l:Number(e>>QI&YI)}:{h:0|Number(e>>QI&YI),l:0|Number(e&YI)}}const JI="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function XI(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function $I(e,t){return e<<32-t|e>>>t}const eE=68===new Uint8Array(new Uint32Array([287454020]).buffer)[0];function tE(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function iE(e){for(let t=0;t<e.length;t++)e[t]=tE(e[t])}function sE(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),KI(e),e}let nE=class{clone(){return this._cloneInto()}};function rE(e){const t=t=>e().update(sE(t)).digest(),i=e();return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=()=>e(),t}function oE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(JI&&"function"==typeof JI.getRandomValues)return JI.getRandomValues(new Uint8Array(e));if(JI&&"function"==typeof JI.randomBytes)return JI.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}const aE=[],cE=[],lE=[],hE=BigInt(0),dE=BigInt(1),uE=BigInt(2),pE=BigInt(7),gE=BigInt(256),fE=BigInt(113);for(let CD=0,SD=dE,PD=1,TD=0;CD<24;CD++){[PD,TD]=[TD,(2*PD+3*TD)%5],aE.push(2*(5*TD+PD)),cE.push((CD+1)*(CD+2)/2%64);let e=hE;for(let t=0;t<7;t++)SD=(SD<<dE^(SD>>pE)*fE)%gE,SD&uE&&(e^=dE<<(dE<<BigInt(t))-dE);lE.push(e)}const[wE,mE]=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=new Uint32Array(e.length),s=new Uint32Array(e.length);for(let n=0;n<e.length;n++){const{h:r,l:o}=ZI(e[n],t);[i[n],s[n]]=[r,o]}return[i,s]}(lE,!0),yE=(e,t,i)=>i>32?((e,t,i)=>t<<i-32|e>>>64-i)(e,t,i):((e,t,i)=>e<<i|t>>>32-i)(e,t,i),vE=(e,t,i)=>i>32?((e,t,i)=>e<<i-32|t>>>64-i)(e,t,i):((e,t,i)=>t<<i|e>>>32-i)(e,t,i);let bE=class e extends nE{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24;if(super(),this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=s,this.rounds=n,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,HI(i),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}(this.state)}keccak(){eE||iE(this.state32),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;const i=new Uint32Array(10);for(let s=24-t;s<24;s++){for(let s=0;s<10;s++)i[s]=e[s]^e[s+10]^e[s+20]^e[s+30]^e[s+40];for(let s=0;s<10;s+=2){const t=(s+8)%10,n=(s+2)%10,r=i[n],o=i[n+1],a=yE(r,o,1)^i[t],c=vE(r,o,1)^i[t+1];for(let i=0;i<50;i+=10)e[s+i]^=a,e[s+i+1]^=c}let t=e[2],n=e[3];for(let i=0;i<24;i++){const s=cE[i],r=yE(t,n,s),o=vE(t,n,s),a=aE[i];t=e[a],n=e[a+1],e[a]=r,e[a+1]=o}for(let s=0;s<50;s+=10){for(let t=0;t<10;t++)i[t]=e[s+t];for(let t=0;t<10;t++)e[s+t]^=~i[(t+2)%10]&i[(t+4)%10]}e[0]^=wE[s],e[1]^=mE[s]}i.fill(0)}(this.state32,this.rounds),eE||iE(this.state32),this.posOut=0,this.pos=0}update(e){FI(this);const{blockLen:t,state:i}=this,s=(e=sE(e)).length;for(let n=0;n<s;){const r=Math.min(t-this.pos,s-n);for(let t=0;t<r;t++)i[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:i,blockLen:s}=this;e[i]^=t,128&t&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){FI(this,!1),KI(e),this.finish();const t=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const r=Math.min(i-this.posOut,n-s);e.set(t.subarray(this.posOut,this.posOut+r),s),this.posOut+=r,s+=r}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return HI(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(GI(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:i,suffix:s,outputLen:n,rounds:r,enableXOF:o}=this;return t||(t=new e(i,s,n,o,r)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=r,t.suffix=s,t.outputLen=n,t.enableXOF=o,t.destroyed=this.destroyed,t}};const IE=((e,t,i)=>rE(()=>new bE(t,e,i)))(1,136,32),EE="https://rpc.walletconnect.org/v1";function NE(e){const t="\x19Ethereum Signed Message:\n".concat(e.length),i=(new TextEncoder).encode(t+e);return"0x"+p.d.Buffer.from(IE(i)).toString("hex")}async function AE(e,t,i,s,n,r){switch(i.t){case"eip191":return await async function(e,t,i){return(await async function(e){let{hash:t,signature:i}=e;return cI(await lI({hash:t,signature:i}))}({hash:NE(t),signature:i})).toLowerCase()===e.toLowerCase()}(e,t,i.s);case"eip1271":return await async function(e,t,i,s,n,r){const o=uI(s);if(!o.namespace||!o.reference)throw new Error("isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ".concat(s));try{const o="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",c="0000000000000000000000000000000000000000000000000000000000000041",l=i.substring(2),h=o+NE(t).substring(2)+a+c+l,d=await fetch("".concat(r||EE,"/?chainId=").concat(s,"&projectId=").concat(n),{method:"POST",body:JSON.stringify({id:CE(),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:h},"latest"]})}),{result:u}=await d.json();return!!u&&u.slice(0,o.length).toLowerCase()===o.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}(e,t,i.s,s,n,r);default:throw new Error("verifySignature failed: Attempted to verify CacaoSignature with unknown type: ".concat(i.t))}}function CE(){return Date.now()+Math.floor(1e3*Math.random())}var SE=Object.defineProperty,PE=Object.defineProperties,TE=Object.getOwnPropertyDescriptors,ME=Object.getOwnPropertySymbols,_E=Object.prototype.hasOwnProperty,OE=Object.prototype.propertyIsEnumerable,xE=(e,t,i)=>t in e?SE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;const kE=e=>null==e?void 0:e.split(":"),DE=e=>{const t=e&&kE(e);if(t)return t[2]+":"+t[3]},jE=e=>{const t=e&&kE(e);if(t)return t.pop()};async function RE(e){const{cacao:t,projectId:i}=e,{s:s,p:n}=t,r=UE(n,n.iss),o=jE(n.iss);return await AE(o,r,s,DE(n.iss),i)}const UE=(e,t)=>{const i="".concat(e.domain," wants you to sign in with your Ethereum account:"),s=jE(t);if(!e.aud&&!e.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=e.statement||void 0;const r="URI: ".concat(e.aud||e.uri),o="Version: ".concat(e.version),a="Chain ID: ".concat((e=>{const t=e&&kE(e);if(t)return e.includes("did:pkh:")?t[3]:t[1]})(t)),c="Nonce: ".concat(e.nonce),l="Issued At: ".concat(e.iat),h=e.exp?"Expiration Time: ".concat(e.exp):void 0,d=e.nbf?"Not Before: ".concat(e.nbf):void 0,u=e.requestId?"Request ID: ".concat(e.requestId):void 0,p=e.resources?"Resources:".concat(e.resources.map(e=>"\n- ".concat(e)).join("")):void 0,g=FE(e.resources);if(g){n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;LE(t);const i="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(i))return e;const s=[];let n=0;Object.keys(t.att).forEach(e=>{const i=Object.keys(t.att[e]).map(e=>({ability:e.split("/")[0],action:e.split("/")[1]}));i.sort((e,t)=>e.action.localeCompare(t.action));const r={};i.forEach(e=>{r[e.ability]||(r[e.ability]=[]),r[e.ability].push(e.action)});const o=Object.keys(r).map(t=>(n++,"(".concat(n,") '").concat(t,"': '").concat(r[t].join("', '"),"' for '").concat(e,"'.")));s.push(o.join(", ").replace(".,","."))});const r=s.join(" "),o="".concat(i).concat(r);return"".concat(e?e+" ":"").concat(o)}(n,BE(g))}return[i,s,"",n,"",r,o,a,c,l,h,d,u,p].filter(e=>null!=e).join("\n")};function LE(e){if(!e)throw new Error("No recap provided, value is undefined");if(!e.att)throw new Error("No `att` property found");const t=Object.keys(e.att);if(null==t||!t.length)throw new Error("No resources found in `att` property");t.forEach(t=>{const i=e.att[t];if(Array.isArray(i))throw new Error("Resource must be an object: ".concat(t));if("object"!=typeof i)throw new Error("Resource must be an object: ".concat(t));if(!Object.keys(i).length)throw new Error("Resource object is empty: ".concat(t));Object.keys(i).forEach(e=>{const t=i[e];if(!Array.isArray(t))throw new Error("Ability limits ".concat(e," must be an array of objects, found: ").concat(t));if(!t.length)throw new Error("Value of ".concat(e," is empty array, must be an array with objects"));t.forEach(t=>{if("object"!=typeof t)throw new Error("Ability limits (".concat(e,") must be an array of objects, found: ").concat(t))})})})}function zE(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=(t=null==t?void 0:t.sort((e,t)=>e.localeCompare(t))).map(t=>({["".concat(e,"/").concat(t)]:[i]}));return Object.assign({},...s)}function qE(e){return LE(e),"urn:recap:".concat(function(e){return p.d.Buffer.from(JSON.stringify(e)).toString("base64")}(e).replace(/=/g,""))}function BE(e){const t=function(e){return JSON.parse(p.d.Buffer.from(e,"base64").toString("utf-8"))}(e.replace("urn:recap:",""));return LE(t),t}function VE(e,t,i){const s=function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return null==i||i.sort((e,t)=>e.localeCompare(t)),{att:{[e]:zE(t,i,s)}}}(e,t,i);return qE(s)}function HE(e,t){const i=function(e,t){LE(e),LE(t);const i=Object.keys(e.att).concat(Object.keys(t.att)).sort((e,t)=>e.localeCompare(t)),s={att:{}};return i.forEach(i=>{var n,r;Object.keys((null==(n=e.att)?void 0:n[i])||{}).concat(Object.keys((null==(r=t.att)?void 0:r[i])||{})).sort((e,t)=>e.localeCompare(t)).forEach(n=>{var r,o;s.att[i]=((e,t)=>PE(e,TE(t)))(((e,t)=>{for(var i in t||(t={}))_E.call(t,i)&&xE(e,i,t[i]);if(ME)for(var i of ME(t))OE.call(t,i)&&xE(e,i,t[i]);return e})({},s.att[i]),{[n]:(null==(r=e.att[i])?void 0:r[n])||(null==(o=t.att[i])?void 0:o[n])})})}),s}(BE(e),BE(t));return qE(i)}function KE(e){var t;const i=BE(e);LE(i);const s=null==(t=i.att)?void 0:t.eip155;return s?Object.keys(s).map(e=>e.split("/")[1]):[]}function WE(e){const t=BE(e);LE(t);const i=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;null!=(t=null==e?void 0:e[0])&&t.chains&&i.push(e[0].chains)})}),[...new Set(i.flat())]}function FE(e){if(!e)return;const t=null==e?void 0:e[e.length-1];return function(e){return e&&e.includes("urn:recap:")}(t)?t:void 0}function GE(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function YE(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function QE(e){if(!YE(e))throw new Error("Uint8Array expected");for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(i.length>0&&!i.includes(e.length))throw new Error("Uint8Array expected of length "+i+", got length="+e.length)}function ZE(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function JE(e){if("boolean"!=typeof e)throw new Error("boolean expected, not ".concat(e))}const XE=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function $E(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e);else{if(!YE(e))throw new Error("Uint8Array expected, got "+typeof e);e=iN(e)}return e}function eN(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(i&&!function(e){return e.byteOffset%4===0}(t))throw new Error("invalid output, must be aligned");return t}function tN(e,t,i,s){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,s);const n=BigInt(32),r=BigInt(4294967295),o=Number(i>>n&r),a=Number(i&r);e.setUint32(t+4,o,s),e.setUint32(t+0,a,s)}function iN(e){return Uint8Array.from(e)}function sN(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let s=0;s<t.length;s++)t[s].fill(0)}const nN=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),rN=nN("expand 16-byte k"),oN=nN("expand 32-byte k"),aN=XE(rN),cN=XE(oN);function lN(e,t){return e<<t|e>>>32-t}function hN(e){return e.byteOffset%4===0}const dN=2**32-1,uN=new Uint32Array;const pN=(e,t)=>255&e[t++]|(255&e[t++])<<8;let gN=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,QE(e=$E(e),32);const t=pN(e,0),i=pN(e,2),s=pN(e,4),n=pN(e,6),r=pN(e,8),o=pN(e,10),a=pN(e,12),c=pN(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|i<<3),this.r[2]=7939&(i>>>10|s<<6),this.r[3]=8191&(s>>>7|n<<9),this.r[4]=255&(n>>>4|r<<12),this.r[5]=r>>>1&8190,this.r[6]=8191&(r>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let l=0;l<8;l++)this.pad[l]=pN(e,16+2*l)}process(e,t){const i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?0:2048,{h:s,r:n}=this,r=n[0],o=n[1],a=n[2],c=n[3],l=n[4],h=n[5],d=n[6],u=n[7],p=n[8],g=n[9],f=pN(e,t+0),w=pN(e,t+2),m=pN(e,t+4),y=pN(e,t+6),v=pN(e,t+8),b=pN(e,t+10),I=pN(e,t+12),E=pN(e,t+14);let N=s[0]+(8191&f),A=s[1]+(8191&(f>>>13|w<<3)),C=s[2]+(8191&(w>>>10|m<<6)),S=s[3]+(8191&(m>>>7|y<<9)),P=s[4]+(8191&(y>>>4|v<<12)),T=s[5]+(v>>>1&8191),M=s[6]+(8191&(v>>>14|b<<2)),_=s[7]+(8191&(b>>>11|I<<5)),O=s[8]+(8191&(I>>>8|E<<8)),x=s[9]+(E>>>5|i),k=0,D=k+N*r+A*(5*g)+C*(5*p)+S*(5*u)+P*(5*d);k=D>>>13,D&=8191,D+=T*(5*h)+M*(5*l)+_*(5*c)+O*(5*a)+x*(5*o),k+=D>>>13,D&=8191;let j=k+N*o+A*r+C*(5*g)+S*(5*p)+P*(5*u);k=j>>>13,j&=8191,j+=T*(5*d)+M*(5*h)+_*(5*l)+O*(5*c)+x*(5*a),k+=j>>>13,j&=8191;let R=k+N*a+A*o+C*r+S*(5*g)+P*(5*p);k=R>>>13,R&=8191,R+=T*(5*u)+M*(5*d)+_*(5*h)+O*(5*l)+x*(5*c),k+=R>>>13,R&=8191;let U=k+N*c+A*a+C*o+S*r+P*(5*g);k=U>>>13,U&=8191,U+=T*(5*p)+M*(5*u)+_*(5*d)+O*(5*h)+x*(5*l),k+=U>>>13,U&=8191;let L=k+N*l+A*c+C*a+S*o+P*r;k=L>>>13,L&=8191,L+=T*(5*g)+M*(5*p)+_*(5*u)+O*(5*d)+x*(5*h),k+=L>>>13,L&=8191;let z=k+N*h+A*l+C*c+S*a+P*o;k=z>>>13,z&=8191,z+=T*r+M*(5*g)+_*(5*p)+O*(5*u)+x*(5*d),k+=z>>>13,z&=8191;let q=k+N*d+A*h+C*l+S*c+P*a;k=q>>>13,q&=8191,q+=T*o+M*r+_*(5*g)+O*(5*p)+x*(5*u),k+=q>>>13,q&=8191;let B=k+N*u+A*d+C*h+S*l+P*c;k=B>>>13,B&=8191,B+=T*a+M*o+_*r+O*(5*g)+x*(5*p),k+=B>>>13,B&=8191;let V=k+N*p+A*u+C*d+S*h+P*l;k=V>>>13,V&=8191,V+=T*c+M*a+_*o+O*r+x*(5*g),k+=V>>>13,V&=8191;let H=k+N*g+A*p+C*u+S*d+P*h;k=H>>>13,H&=8191,H+=T*l+M*c+_*a+O*o+x*r,k+=H>>>13,H&=8191,k=(k<<2)+k|0,k=k+D|0,D=8191&k,k>>>=13,j+=k,s[0]=D,s[1]=j,s[2]=R,s[3]=U,s[4]=L,s[5]=z,s[6]=q,s[7]=B,s[8]=V,s[9]=H}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let o=2;o<10;o++)e[o]+=s,s=e[o]>>>13,e[o]&=8191;e[0]+=5*s,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let o=1;o<10;o++)i[o]=e[o]+s,s=i[o]>>>13,i[o]&=8191;i[9]-=8192;let n=(1^s)-1;for(let o=0;o<10;o++)i[o]&=n;n=~n;for(let o=0;o<10;o++)e[o]=e[o]&n|i[o];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let r=e[0]+t[0];e[0]=65535&r;for(let o=1;o<8;o++)r=(e[o]+t[o]|0)+(r>>>16)|0,e[o]=65535&r;sN(i)}update(e){ZE(this);const{buffer:t,blockLen:i}=this,s=(e=$E(e)).length;for(let n=0;n<s;){const r=Math.min(i-this.pos,s-n);if(r!==i)t.set(e.subarray(n,n+r),this.pos),this.pos+=r,n+=r,this.pos===i&&(this.process(t,0,!1),this.pos=0);else for(;i<=s-n;n+=i)this.process(e,n)}return this}destroy(){sN(this.h,this.r,this.buffer,this.pad)}digestInto(e){ZE(this),function(e,t){QE(e);const i=t.outputLen;if(e.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let r=0;r<8;r++)e[n++]=i[r]>>>0,e[n++]=i[r]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}};const fN=function(e){const t=(t,i)=>e(i).update($E(t)).digest(),i=e(new Uint8Array(32));return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=t=>e(t),t}(e=>new gN(e));const wN=function(e,t){const{allowShortKeys:i,extendNonceFn:s,counterLength:n,counterRight:r,rounds:o}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return GE(n),GE(o),JE(r),JE(i),function(t,a,c,l){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;QE(t),QE(a),QE(c);const d=c.length;if(void 0===l&&(l=new Uint8Array(d)),QE(l),GE(h),h<0||h>=dN)throw new Error("arx: counter overflow");if(l.length<d)throw new Error("arx: output (".concat(l.length,") is shorter than data (").concat(d,")"));const u=[];let p,g,f=t.length;if(32===f)u.push(p=iN(t)),g=cN;else{if(16!==f||!i)throw new Error("arx: invalid 32-byte key, got length=".concat(f));p=new Uint8Array(32),p.set(t),p.set(t,16),g=aN,u.push(p)}hN(a)||u.push(a=iN(a));const w=XE(p);if(s){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");s(g,w,XE(a.subarray(0,16)),w),a=a.subarray(16)}const m=16-n;if(m!==a.length)throw new Error("arx: nonce must be ".concat(m," or 16 bytes"));if(12!==m){const e=new Uint8Array(12);e.set(a,r?0:12-a.length),a=e,u.push(a)}const y=XE(a);return function(e,t,i,s,n,r,o,a){const c=n.length,l=new Uint8Array(64),h=XE(l),d=hN(n)&&hN(r),u=d?XE(n):uN,p=d?XE(r):uN;for(let g=0;g<c;o++){if(e(t,i,s,h,o,a),o>=dN)throw new Error("arx: counter overflow");const f=Math.min(64,c-g);if(d&&64===f){const e=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let t,i=0;i<16;i++)t=e+i,p[t]=u[t]^h[i];g+=64;continue}for(let e,t=0;t<f;t++)e=g+t,r[e]=n[e]^l[t];g+=f}}(e,g,w,y,c,l,h,o),sN(...u),l}}(function(e,t,i,s,n){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,o=e[0],a=e[1],c=e[2],l=e[3],h=t[0],d=t[1],u=t[2],p=t[3],g=t[4],f=t[5],w=t[6],m=t[7],y=n,v=i[0],b=i[1],I=i[2],E=o,N=a,A=c,C=l,S=h,P=d,T=u,M=p,_=g,O=f,x=w,k=m,D=y,j=v,R=b,U=I;for(let z=0;z<r;z+=2)E=E+S|0,D=lN(D^E,16),_=_+D|0,S=lN(S^_,12),E=E+S|0,D=lN(D^E,8),_=_+D|0,S=lN(S^_,7),N=N+P|0,j=lN(j^N,16),O=O+j|0,P=lN(P^O,12),N=N+P|0,j=lN(j^N,8),O=O+j|0,P=lN(P^O,7),A=A+T|0,R=lN(R^A,16),x=x+R|0,T=lN(T^x,12),A=A+T|0,R=lN(R^A,8),x=x+R|0,T=lN(T^x,7),C=C+M|0,U=lN(U^C,16),k=k+U|0,M=lN(M^k,12),C=C+M|0,U=lN(U^C,8),k=k+U|0,M=lN(M^k,7),E=E+P|0,U=lN(U^E,16),x=x+U|0,P=lN(P^x,12),E=E+P|0,U=lN(U^E,8),x=x+U|0,P=lN(P^x,7),N=N+T|0,D=lN(D^N,16),k=k+D|0,T=lN(T^k,12),N=N+T|0,D=lN(D^N,8),k=k+D|0,T=lN(T^k,7),A=A+M|0,j=lN(j^A,16),_=_+j|0,M=lN(M^_,12),A=A+M|0,j=lN(j^A,8),_=_+j|0,M=lN(M^_,7),C=C+S|0,R=lN(R^C,16),O=O+R|0,S=lN(S^O,12),C=C+S|0,R=lN(R^C,8),O=O+R|0,S=lN(S^O,7);let L=0;s[L++]=o+E|0,s[L++]=a+N|0,s[L++]=c+A|0,s[L++]=l+C|0,s[L++]=h+S|0,s[L++]=d+P|0,s[L++]=u+T|0,s[L++]=p+M|0,s[L++]=g+_|0,s[L++]=f+O|0,s[L++]=w+x|0,s[L++]=m+k|0,s[L++]=y+D|0,s[L++]=v+j|0,s[L++]=b+R|0,s[L++]=I+U|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),mN=new Uint8Array(16),yN=(e,t)=>{e.update(t);const i=t.length%16;i&&e.update(mN.subarray(i))},vN=new Uint8Array(32);function bN(e,t,i,s,n){const r=e(t,i,vN),o=fN.create(r);n&&yN(o,n),yN(o,s);const a=new Uint8Array(16),c=(e=>new DataView(e.buffer,e.byteOffset,e.byteLength))(a);tN(c,0,BigInt(n?n.length:0),!0),tN(c,8,BigInt(s.length),!0),o.update(a);const l=o.digest();return sN(r,a),l}const IN=((e,t)=>{function i(i){for(var s=arguments.length,n=new Array(s>1?s-1:0),r=1;r<s;r++)n[r-1]=arguments[r];if(QE(i),void 0!==e.nonceLength){const t=n[0];if(!t)throw new Error("nonce / iv required");e.varSizeNonce?QE(t):QE(t,e.nonceLength)}const o=e.tagLength;o&&void 0!==n[1]&&QE(n[1]);const a=t(i,...n),c=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");QE(t)}};let l=!1;return{encrypt(e,t){if(l)throw new Error("cannot encrypt() twice with same key + nonce");return l=!0,QE(e),c(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(QE(e),o&&e.length<o)throw new Error("invalid ciphertext length: smaller than tagLength="+o);return c(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(i,e),i})({blockSize:64,nonceLength:12,tagLength:16},(e=>(t,i,s)=>({encrypt(n,r){const o=n.length;(r=eN(o+16,r,!1)).set(n);const a=r.subarray(0,-16);e(t,i,a,a,1);const c=bN(e,t,i,a,s);return r.set(c,o),sN(c),r},decrypt(n,r){r=eN(n.length-16,r,!1);const o=n.subarray(0,-16),a=n.subarray(-16),c=bN(e,t,i,o,s);if(!function(e,t){if(e.length!==t.length)return!1;let i=0;for(let s=0;s<e.length;s++)i|=e[s]^t[s];return 0===i}(a,c))throw new Error("invalid tag");return r.set(n.subarray(0,-16)),e(t,i,r,r,1),sN(c),r}}))(wN));let EN=class extends nE{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,WI(e);const i=sE(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let r=0;r<n.length;r++)n[r]^=54;this.iHash.update(n),this.oHash=e.create();for(let r=0;r<n.length;r++)n[r]^=106;this.oHash.update(n),n.fill(0)}update(e){return FI(this),this.iHash.update(e),this}digestInto(e){FI(this),KI(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:s,destroyed:n,blockLen:r,outputLen:o}=this;return e.finished=s,e.destroyed=n,e.blockLen=r,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const NN=(e,t,i)=>new EN(e,t).update(i).digest();NN.create=(e,t)=>new EN(e,t);const AN=new Uint8Array([0]),CN=new Uint8Array;const SN=(e,t,i,s,n)=>function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;if(WI(e),HI(s),s>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(s/e.outputLen);void 0===i&&(i=CN);const r=new Uint8Array(n*e.outputLen),o=NN.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<n;l++)AN[0]=l+1,a.update(0===l?CN:c).update(i).update(AN).digestInto(c),r.set(c,e.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),AN.fill(0),r.slice(0,s)}(e,function(e,t,i){return WI(e),void 0===i&&(i=new Uint8Array(e.outputLen)),NN(e,sE(i),sE(t))}(e,t,i),s,n);function PN(e,t,i){return e&t^~e&i}function TN(e,t,i){return e&t^e&i^t&i}class MN extends nE{constructor(e,t,i,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=XI(this.buffer)}update(e){FI(this);const{view:t,buffer:i,blockLen:s}=this,n=(e=sE(e)).length;for(let r=0;r<n;){const o=Math.min(s-this.pos,n-r);if(o===s){const t=XI(e);for(;s<=n-r;r+=s)this.process(t,r);continue}i.set(e.subarray(r,r+o),this.pos),this.pos+=o,r+=o,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){FI(this),GI(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:s,isLE:n}=this;let{pos:r}=this;t[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>s-r&&(this.process(i,0),r=0);for(let h=r;h<s;h++)t[h]=0;(function(e,t,i,s){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,i,s);const n=BigInt(32),r=BigInt(4294967295),o=Number(i>>n&r),a=Number(i&r),c=s?4:0,l=s?0:4;e.setUint32(t+c,o,s),e.setUint32(t+l,a,s)})(i,s-8,BigInt(8*this.length),n),this.process(i,0);const o=XI(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)o.setUint32(4*h,l[h],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:s,finished:n,destroyed:r,pos:o}=this;return e.length=s,e.pos=o,e.finished=n,e.destroyed=r,s%t&&e.buffer.set(i),e}}const _N=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ON=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),xN=new Uint32Array(64);let kN=class extends MN{constructor(){super(64,32,8,!1),this.A=0|ON[0],this.B=0|ON[1],this.C=0|ON[2],this.D=0|ON[3],this.E=0|ON[4],this.F=0|ON[5],this.G=0|ON[6],this.H=0|ON[7]}get(){const{A:e,B:t,C:i,D:s,E:n,F:r,G:o,H:a}=this;return[e,t,i,s,n,r,o,a]}set(e,t,i,s,n,r,o,a){this.A=0|e,this.B=0|t,this.C=0|i,this.D=0|s,this.E=0|n,this.F=0|r,this.G=0|o,this.H=0|a}process(e,t){for(let h=0;h<16;h++,t+=4)xN[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const e=xN[h-15],t=xN[h-2],i=$I(e,7)^$I(e,18)^e>>>3,s=$I(t,17)^$I(t,19)^t>>>10;xN[h]=s+xN[h-7]+i+xN[h-16]|0}let{A:i,B:s,C:n,D:r,E:o,F:a,G:c,H:l}=this;for(let h=0;h<64;h++){const e=l+($I(o,6)^$I(o,11)^$I(o,25))+PN(o,a,c)+_N[h]+xN[h]|0,t=($I(i,2)^$I(i,13)^$I(i,22))+TN(i,s,n)|0;l=c,c=a,a=o,o=r+e|0,r=n,n=s,s=i,i=e+t|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,r=r+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(i,s,n,r,o,a,c,l)}roundClean(){xN.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const DN=rE(()=>new kN),jN=BigInt(0);function RN(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function UN(e){if(!RN(e))throw new Error("Uint8Array expected")}const LN=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));const zN=48,qN=57,BN=65,VN=70,HN=97,KN=102;function WN(e){return e>=zN&&e<=qN?e-zN:e>=BN&&e<=VN?e-(BN-10):e>=HN&&e<=KN?e-(HN-10):void 0}function FN(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,i=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const s=new Uint8Array(i);for(let n=0,r=0;n<i;n++,r+=2){const t=WN(e.charCodeAt(r)),i=WN(e.charCodeAt(r+1));if(void 0===t||void 0===i){const t=e[r]+e[r+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+r)}s[n]=16*t+i}return s}function GN(e){return UN(e),function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?jN:BigInt("0x"+e)}(function(e){UN(e);let t="";for(let i=0;i<e.length;i++)t+=LN[e[i]];return t}(Uint8Array.from(e).reverse()))}function YN(e,t){return function(e,t){return FN(e.toString(16).padStart(2*t,"0"))}(e,t).reverse()}function QN(e,t,i){let s;if("string"==typeof t)try{s=FN(t)}catch(r){throw new Error(e+" must be hex string or Uint8Array, cause: "+r)}else{if(!RN(t))throw new Error(e+" must be hex string or Uint8Array");s=Uint8Array.from(t)}const n=s.length;if("number"==typeof i&&n!==i)throw new Error(e+" of length "+i+" expected, got "+n);return s}const ZN=e=>"bigint"==typeof e&&jN<=e;function JN(e,t,i,s){if(!function(e,t,i){return ZN(e)&&ZN(t)&&ZN(i)&&t<=e&&e<i}(t,i,s))throw new Error("expected valid "+e+": "+i+" <= n < "+s+", got "+t)}const XN={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||RN(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};const $N=BigInt(0),eA=BigInt(1);function tA(e,t){const i=e%t;return i>=$N?i:t+i}function iA(e,t,i){let s=e;for(;t-- >$N;)s*=s,s%=i;return s}BigInt(0),BigInt(1),BigInt(0),BigInt(1),BigInt(2),BigInt(8);const sA=BigInt(0),nA=BigInt(1);function rA(e){return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=(t,i,s)=>{const n=XN[i];if("function"!=typeof n)throw new Error("invalid validator function");const r=e[t];if((!s||void 0!==r)&&!n(r,e))throw new Error("param "+String(t)+" is invalid. Expected "+i+", got "+r)};for(const[n,r]of Object.entries(t))s(n,r,!1);for(const[n,r]of Object.entries(i))s(n,r,!0)}(e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze((0,d.A)({},e))}const oA=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949");BigInt(0);const aA=BigInt(1),cA=BigInt(2),lA=BigInt(3),hA=BigInt(5);BigInt(8);const dA=function(e){const t=rA(e),{P:i}=t,s=e=>tA(e,i),n=t.montgomeryBits,r=Math.ceil(n/8),o=t.nByteLength,a=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>function(e,t,i){if(t<$N)throw new Error("invalid exponent, negatives unsupported");if(i<=$N)throw new Error("invalid modulus");if(i===eA)return $N;let s=eA;for(;t>$N;)t&eA&&(s=s*e%i),e=e*e%i,t>>=eA;return s}(e,i-BigInt(2),i));function l(e,t,i){const n=s(e*(t-i));return[t=s(t-n),i=s(i+n)]}const h=(t.a-BigInt(2))/BigInt(4);function d(e){return YN(s(e),r)}function u(e,t){const u=function(e){const t=QN("u coordinate",e,r);return 32===o&&(t[31]&=127),GN(t)}(t),p=function(e){const t=QN("scalar",e),i=t.length;if(i!==r&&i!==o)throw new Error("invalid scalar, expected "+r+" or "+o+" bytes, got "+i);return GN(a(t))}(e),g=function(e,t){JN("u",e,sA,i),JN("scalar",t,sA,i);const r=t,o=e;let a,d=nA,u=sA,p=e,g=nA,f=sA;for(let i=BigInt(n-1);i>=sA;i--){const e=r>>i&nA;f^=e,a=l(f,d,p),d=a[0],p=a[1],a=l(f,u,g),u=a[0],g=a[1],f=e;const t=d+u,n=s(t*t),c=d-u,w=s(c*c),m=n-w,y=p+g,v=s((p-g)*t),b=s(y*c),I=v+b,E=v-b;p=s(I*I),g=s(o*s(E*E)),d=s(n*w),u=s(m*(n+s(h*m)))}a=l(f,d,p),d=a[0],p=a[1],a=l(f,u,g),u=a[0],g=a[1];const w=c(u);return s(d*w)}(u,p);if(g===sA)throw new Error("invalid private or public key received");return d(g)}const p=d(t.Gu);function g(e){return u(e,p)}return{scalarMult:u,scalarMultBase:g,getSharedSecret:(e,t)=>u(e,t),getPublicKey:e=>g(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:p}}({P:oA,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=oA,{pow_p_5_8:i,b2:s}=function(e){const t=BigInt(10),i=BigInt(20),s=BigInt(40),n=BigInt(80),r=oA,o=e*e%r*e%r,a=iA(o,cA,r)*o%r,c=iA(a,aA,r)*e%r,l=iA(c,hA,r)*c%r,h=iA(l,t,r)*l%r,d=iA(h,i,r)*h%r,u=iA(d,s,r)*d%r,p=iA(u,n,r)*u%r,g=iA(p,n,r)*u%r,f=iA(g,t,r)*l%r;return{pow_p_5_8:iA(f,cA,r)*e%r,b2:o}}(e);return tA(iA(i,lA,t)*s,t)},adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e},randomBytes:oE}),uA="base10",pA="base16",gA="base64pad",fA="base64url",wA="utf8";function mA(){const e=oE(32);return(0,v.t)(e,pA)}function yA(e){const t=DN((0,v.f)(e,pA));return(0,v.t)(t,pA)}function vA(e){const t=DN((0,v.f)(e,wA));return(0,v.t)(t,pA)}function bA(e){return(0,v.f)("".concat(e),uA)}function IA(e){return Number((0,v.t)(e,uA))}function EA(e){const{encoding:t=gA}=e;if(2===IA(e.type))return(0,v.t)((0,v.h)([e.type,e.sealed]),t);if(1===IA(e.type)){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return(0,v.t)((0,v.h)([e.type,e.senderPublicKey,e.iv,e.sealed]),t)}return(0,v.t)((0,v.h)([e.type,e.iv,e.sealed]),t)}function NA(e){const{encoded:t,encoding:i=gA}=e,s=(0,v.f)(t,i),n=s.slice(0,1);if(1===IA(n)){const e=33,t=e+12,i=s.slice(1,e),r=s.slice(e,t);return{type:n,sealed:s.slice(t),iv:r,senderPublicKey:i}}if(2===IA(n)){return{type:n,sealed:s.slice(1),iv:oE(12)}}const r=s.slice(1,13);return{type:n,sealed:s.slice(13),iv:r}}function AA(e){const t=(null==e?void 0:e.type)||0;if(1===t){if(typeof(null==e?void 0:e.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(null==e?void 0:e.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:null==e?void 0:e.senderPublicKey,receiverPublicKey:null==e?void 0:e.receiverPublicKey}}function CA(e){return 1===e.type&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function SA(e){return 2===e.type}function PA(e,t){const[i,s,n]=e.split("."),r=function(e){return p.d.Buffer.from(function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const i=t.length%4;return i>0&&(t+="=".repeat(4-i)),t}(e),"base64")}(n);if(64!==r.length)throw new Error("Invalid signature length");const o=r.slice(0,32).toString("hex"),a=r.slice(32,64).toString("hex"),c="".concat(i,".").concat(s),l=DN(c),h=function(e){return new Qt.ec("p256").keyFromPublic({x:p.d.Buffer.from(e.x,"base64").toString("hex"),y:p.d.Buffer.from(e.y,"base64").toString("hex")},"hex")}(t),d=(0,v.t)(l,pA);if(!h.verify(d,{r:o,s:a}))throw new Error("Invalid signature");return(0,v.s)(e).payload}function TA(e){return(null==e?void 0:e.relay)||{protocol:"irn"}}function MA(e){const t=v.C[e];if(typeof t>"u")throw new Error("Relay Protocol not supported: ".concat(e));return t}function _A(e){const t={},i="relay"+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-");return Object.keys(e).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),r=e[s];t[n]=r}}),t}function OA(e){if(!e.includes("wc:")){const t=VI(e);null!=t&&t.includes("wc:")&&(e=t)}const t=(e=(e=e.includes("wc://")?e.replace("wc://",""):e).includes("wc:")?e.replace("wc:",""):e).indexOf(":"),i=-1!==e.indexOf("?")?e.indexOf("?"):void 0,s=e.substring(0,t),n=e.substring(t+1,i).split("@"),r=typeof i<"u"?e.substring(i):"",o=new URLSearchParams(r),a={};o.forEach((e,t)=>{a[t]=e});const c="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:s,topic:xA(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:_A(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function xA(e){return e.startsWith("//")?e.substring(2):e}function kA(e){const t=new URLSearchParams,i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";const i={};return Object.keys(e).forEach(s=>{const n=s,r="relay"+t+n;e[n]&&(i[r]=e[n])}),i}(e.relay);Object.keys(i).sort().forEach(e=>{t.set(e,i[e])}),t.set("symKey",e.symKey),e.expiryTimestamp&&t.set("expiryTimestamp",e.expiryTimestamp.toString()),e.methods&&t.set("methods",e.methods.join(","));const s=t.toString();return"".concat(e.protocol,":").concat(e.topic,"@").concat(e.version,"?").concat(s)}function DA(e,t,i){return"".concat(e,"?wc_ev=").concat(i,"&topic=").concat(t)}function jA(e){const t=[];return e.forEach(e=>{const[i,s]=e.split(":");t.push("".concat(i,":").concat(s))}),t}function RA(e){return e.includes(":")}function UA(e){return RA(e)?e.split(":")[0]:e}function LA(e,t){const i=function(e){const t={};return null==e||e.forEach(e=>{var i;const[s,n]=e.split(":");t[s]||(t[s]={accounts:[],chains:[],events:[],methods:[]}),t[s].accounts.push(e),null==(i=t[s].chains)||i.push("".concat(s,":").concat(n))}),t}(t=t.map(e=>e.replace("did:pkh:","")));for(const[s,n]of Object.entries(i))n.methods?n.methods=UI(n.methods,e):n.methods=e,n.events=["chainChanged","accountsChanged"];return i}const zA={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},qA={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function BA(e,t){const{message:i,code:s}=qA[e];return{message:t?"".concat(i," ").concat(t):i,code:s}}function VA(e,t){const{message:i,code:s}=zA[e];return{message:t?"".concat(i," ").concat(t):i,code:s}}function HA(e,t){return!!Array.isArray(e)}function KA(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function WA(e){return typeof e>"u"}function FA(e,t){return!(!t||!WA(e))||"string"==typeof e&&!!e.trim().length}function GA(e,t){return!(!t||!WA(e))||"number"==typeof e&&!isNaN(e)}function YA(e){return!(!FA(e,!1)||!e.includes(":"))&&2===e.split(":").length}function QA(e){let t=!0;return HA(e)?e.length&&(t=e.every(e=>FA(e,!1))):t=!1,t}function ZA(e,t,i){let s=null;return Object.entries(e).forEach(e=>{let[n,r]=e;if(s)return;const o=function(e,t,i){let s=null;return HA(t)&&t.length?t.forEach(e=>{s||YA(e)||(s=VA("UNSUPPORTED_CHAINS","".concat(i,", chain ").concat(e,' should be a string and conform to "namespace:chainId" format')))}):YA(e)||(s=VA("UNSUPPORTED_CHAINS","".concat(i,', chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }'))),s}(n,pI(n,r),"".concat(t," ").concat(i));o&&(s=o)}),s}function JA(e,t){let i=null;return HA(e)?e.forEach(e=>{i||function(e){if(FA(e,!1)&&e.includes(":")){const t=e.split(":");if(3===t.length){const e=t[0]+":"+t[1];return!!t[2]&&YA(e)}}return!1}(e)||(i=VA("UNSUPPORTED_ACCOUNTS","".concat(t,", account ").concat(e,' should be a string and conform to "namespace:chainId:address" format')))}):i=VA("UNSUPPORTED_ACCOUNTS","".concat(t,', accounts should be an array of strings conforming to "namespace:chainId:address" format')),i}function XA(e,t){let i=null;return Object.values(e).forEach(e=>{if(i)return;const s=function(e,t){let i=null;return QA(null==e?void 0:e.methods)?QA(null==e?void 0:e.events)||(i=VA("UNSUPPORTED_EVENTS","".concat(t,", events should be an array of strings or empty array for no events"))):i=VA("UNSUPPORTED_METHODS","".concat(t,", methods should be an array of strings or empty array for no methods")),i}(e,"".concat(t,", namespace"));s&&(i=s)}),i}function $A(e,t){let i=null;if(e&&KA(e)){const s=XA(e,t);s&&(i=s);const n=function(e,t){let i=null;return Object.values(e).forEach(e=>{if(i)return;const s=JA(null==e?void 0:e.accounts,"".concat(t," namespace"));s&&(i=s)}),i}(e,t);n&&(i=n)}else i=BA("MISSING_OR_INVALID","".concat(t,", namespaces should be an object with data"));return i}function eC(e){return FA(e.protocol,!0)}function tC(e){return typeof e<"u"&&null!==typeof e}function iC(e,t){return!(!YA(t)||!function(e){const t=[];return Object.values(e).forEach(e=>{t.push(...jA(e.accounts))}),t}(e).includes(t))}function sC(e,t,i){return!!FA(i,!1)&&function(e,t){const i=[];return Object.values(e).forEach(e=>{jA(e.accounts).includes(t)&&i.push(...e.methods)}),i}(e,t).includes(i)}function nC(e,t,i){return!!FA(i,!1)&&function(e,t){const i=[];return Object.values(e).forEach(e=>{jA(e.accounts).includes(t)&&i.push(...e.events)}),i}(e,t).includes(i)}function rC(e,t,i){let s=null;const n=function(e){const t={};return Object.keys(e).forEach(i=>{var s;i.includes(":")?t[i]=e[i]:null==(s=e[i].chains)||s.forEach(s=>{t[s]={methods:e[i].methods,events:e[i].events}})}),t}(e),r=function(e){const t={};return Object.keys(e).forEach(i=>{if(i.includes(":"))t[i]=e[i];else{const s=jA(e[i].accounts);null==s||s.forEach(s=>{t[s]={accounts:e[i].accounts.filter(e=>e.includes("".concat(s,":"))),methods:e[i].methods,events:e[i].events}})}}),t}(t),o=Object.keys(n),a=Object.keys(r),c=oC(Object.keys(e)),l=oC(Object.keys(t)),h=c.filter(e=>!l.includes(e));return h.length&&(s=BA("NON_CONFORMING_NAMESPACES","".concat(i," namespaces keys don't satisfy requiredNamespaces.\n      Required: ").concat(h.toString(),"\n      Received: ").concat(Object.keys(t).toString()))),PI(o,a)||(s=BA("NON_CONFORMING_NAMESPACES","".concat(i," namespaces chains don't satisfy required namespaces.\n      Required: ").concat(o.toString(),"\n      Approved: ").concat(a.toString()))),Object.keys(t).forEach(e=>{if(!e.includes(":")||s)return;const n=jA(t[e].accounts);n.includes(e)||(s=BA("NON_CONFORMING_NAMESPACES","".concat(i," namespaces accounts don't satisfy namespace accounts for ").concat(e,"\n        Required: ").concat(e,"\n        Approved: ").concat(n.toString())))}),o.forEach(e=>{s||(PI(n[e].methods,r[e].methods)?PI(n[e].events,r[e].events)||(s=BA("NON_CONFORMING_NAMESPACES","".concat(i," namespaces events don't satisfy namespace events for ").concat(e))):s=BA("NON_CONFORMING_NAMESPACES","".concat(i," namespaces methods don't satisfy namespace methods for ").concat(e)))}),s}function oC(e){return[...new Set(e.map(e=>e.includes(":")?e.split(":")[0]:e))]}function aC(){const e=EI();return new Promise(t=>{switch(e){case wI:t(II()&&(null==navigator?void 0:navigator.onLine));break;case gI:t(async function(){if(bI()&&typeof p.d.global<"u"&&null!=p.d.global&&p.d.global.NetInfo){const e=await(null==p.d.global?void 0:p.d.global.NetInfo.fetch());return null==e?void 0:e.isConnected}return!0}());break;default:t(!0)}})}function cC(e){switch(EI()){case wI:!function(e){!bI()&&II()&&(window.addEventListener("online",()=>e(!0)),window.addEventListener("offline",()=>e(!1)))}(e);break;case gI:!function(e){var t;bI()&&typeof p.d.global<"u"&&null!=p.d.global&&p.d.global.NetInfo&&(null==(t=p.d.global)||t.NetInfo.addEventListener(t=>e(null==t?void 0:t.isConnected)))}(e)}}const lC={};class hC{static get(e){return lC[e]}static set(e,t){lC[e]=t}static delete(e){delete lC[e]}}const dC="core",uC="".concat("wc","@2:").concat(dC,":"),pC="error",gC={database:":memory:"},fC="client_ed25519_seed",wC=v.c.ONE_DAY,mC=v.c.SIX_HOURS,yC="wss://relay.walletconnect.org",vC="relayer_message",bC="relayer_message_ack",IC="relayer_connect",EC="relayer_disconnect",NC="relayer_error",AC="relayer_connection_stalled",CC="relayer_publish",SC="payload",PC="connect",TC="disconnect",MC="error",_C="2.19.1",OC={link_mode:"link_mode",relay:"relay"},xC="inbound",kC="outbound",DC="WALLETCONNECT_LINK_MODE_APPS",jC="subscription_created",RC="subscription_deleted",UC="subscription_sync",LC="subscription_resubscribed",zC={wc_pairingDelete:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:v.c.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:v.c.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:0},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:0}}},qC="pairing_create",BC="pairing_expire",VC="pairing_delete",HC="pairing_ping",KC="history_created",WC="history_updated",FC="history_deleted",GC="history_sync",YC="expirer_created",QC="expirer_deleted",ZC="expirer_expired",JC="expirer_sync",XC="https://verify.walletconnect.org",$C=XC,eS="".concat($C,"/v3"),tS=["https://verify.walletconnect.com",XC],iS="pairing_started",sS="pairing_uri_validation_success",nS="pairing_uri_not_expired",rS="store_new_pairing",oS="subscribing_pairing_topic",aS="subscribe_pairing_topic_success",cS="existing_pairing",lS="pairing_not_expired",hS="emit_inactive_pairing",dS="emit_session_proposal",uS="no_internet_connection",pS="malformed_pairing_uri",gS="active_pairing_already_exists",fS="subscribe_pairing_topic_failure",wS="pairing_expired",mS="proposal_listener_not_found",yS="session_approve_started",vS="session_namespaces_validation_success",bS="subscribing_session_topic",IS="subscribe_session_topic_success",ES="publishing_session_approve",NS="session_approve_publish_success",AS="store_session",CS="publishing_session_settle",SS="session_settle_publish_success",PS="no_internet_connection",TS="proposal_expired",MS="subscribe_session_topic_failure",_S="session_approve_publish_failure",OS="session_settle_publish_failure",xS="session_approve_namespace_validation_failure",kS="proposal_not_found",DS="authenticated_session_approve_started",jS="create_authenticated_session_topic",RS="cacaos_verified",US="store_authenticated_session",LS="subscribing_authenticated_session_topic",zS="subscribe_authenticated_session_topic_success",qS="publishing_authenticated_session_approve",BS="no_internet_connection",VS="invalid_cacao",HS="subscribe_authenticated_session_topic_failure",KS="authenticated_session_approve_publish_failure",WS="authenticated_session_pending_request_not_found";var FS=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),s=0;s<i.length;s++)i[s]=255;for(var n=0;n<e.length;n++){var r=e.charAt(n),o=r.charCodeAt(0);if(255!==i[o])throw new TypeError(r+" is ambiguous");i[o]=n}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function d(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var s=0,n=0;e[t]===c;)s++,t++;for(var r=(e.length-t)*l+1>>>0,o=new Uint8Array(r);e[t];){var h=i[e.charCodeAt(t)];if(255===h)return;for(var d=0,u=r-1;(0!==h||d<n)&&-1!==u;u--,d++)h+=a*o[u]>>>0,o[u]=h%256>>>0,h=h/256>>>0;if(0!==h)throw new Error("Non-zero carry");n=d,t++}if(" "!==e[t]){for(var p=r-n;p!==r&&0===o[p];)p++;for(var g=new Uint8Array(s+(r-p)),f=s;p!==r;)g[f++]=o[p++];return g}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var i=0,s=0,n=0,r=t.length;n!==r&&0===t[n];)n++,i++;for(var o=(r-n)*h+1>>>0,l=new Uint8Array(o);n!==r;){for(var d=t[n],u=0,p=o-1;(0!==d||u<s)&&-1!==p;p--,u++)d+=256*l[p]>>>0,l[p]=d%a>>>0,d=d/a>>>0;if(0!==d)throw new Error("Non-zero carry");s=u,n++}for(var g=o-s;g!==o&&0===l[g];)g++;for(var f=c.repeat(i);g<o;++g)f+=e.charAt(l[g]);return f},decodeUnsafe:d,decode:function(e){var i=d(e);if(i)return i;throw new Error("Non-".concat(t," character"))}}},GS=FS;const YS=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")};class QS{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class ZS{constructor(e,t,i){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return XS(this,e)}}class JS{constructor(e){this.decoders=e}or(e){return XS(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const XS=(e,t)=>new JS((0,d.A)((0,d.A)({},e.decoders||{[e.prefix]:e}),t.decoders||{[t.prefix]:t}));class $S{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new QS(e,t,i),this.decoder=new ZS(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const eP=e=>{let{name:t,prefix:i,encode:s,decode:n}=e;return new $S(t,i,s,n)},tP=e=>{let{prefix:t,name:i,alphabet:s}=e;const{encode:n,decode:r}=GS(s,i);return eP({prefix:t,name:i,encode:n,decode:e=>YS(r(e))})},iP=e=>{let{name:t,prefix:i,bitsPerChar:s,alphabet:n}=e;return eP({prefix:i,name:t,encode:e=>((e,t,i)=>{const s="="===t[t.length-1],n=(1<<i)-1;let r="",o=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],o+=8;o>i;)o-=i,r+=t[n&a>>o];if(o&&(r+=t[n&a<<i-o]),s)for(;r.length*i&7;)r+="=";return r})(e,n,s),decode:e=>((e,t,i,s)=>{const n={};for(let h=0;h<t.length;++h)n[t[h]]=h;let r=e.length;for(;"="===e[r-1];)--r;const o=new Uint8Array(r*i/8|0);let a=0,c=0,l=0;for(let h=0;h<r;++h){const t=n[e[h]];if(void 0===t)throw new SyntaxError("Non-".concat(s," character"));c=c<<i|t,a+=i,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o})(e,n,s,t)})},sP=eP({prefix:"\0",name:"identity",encode:e=>(e=>(new TextDecoder).decode(e))(e),decode:e=>(e=>(new TextEncoder).encode(e))(e)});var nP=Object.freeze({__proto__:null,identity:sP});const rP=iP({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var oP=Object.freeze({__proto__:null,base2:rP});const aP=iP({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var cP=Object.freeze({__proto__:null,base8:aP});const lP=tP({prefix:"9",name:"base10",alphabet:"0123456789"});var hP=Object.freeze({__proto__:null,base10:lP});const dP=iP({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uP=iP({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var pP=Object.freeze({__proto__:null,base16:dP,base16upper:uP});const gP=iP({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),fP=iP({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),wP=iP({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mP=iP({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yP=iP({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vP=iP({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bP=iP({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),IP=iP({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),EP=iP({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var NP=Object.freeze({__proto__:null,base32:gP,base32upper:fP,base32pad:wP,base32padupper:mP,base32hex:yP,base32hexupper:vP,base32hexpad:bP,base32hexpadupper:IP,base32z:EP});const AP=tP({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),CP=tP({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var SP=Object.freeze({__proto__:null,base36:AP,base36upper:CP});const PP=tP({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),TP=tP({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var MP=Object.freeze({__proto__:null,base58btc:PP,base58flickr:TP});const _P=iP({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),OP=iP({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xP=iP({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),kP=iP({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var DP=Object.freeze({__proto__:null,base64:_P,base64pad:OP,base64url:xP,base64urlpad:kP});const jP=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),RP=jP.reduce((e,t,i)=>(e[i]=t,e),[]),UP=jP.reduce((e,t,i)=>(e[t.codePointAt(0)]=i,e),[]);const LP=eP({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=RP[t],"")},decode:function(e){const t=[];for(const i of e){const e=UP[i.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(i));t.push(e)}return new Uint8Array(t)}});var zP=Object.freeze({__proto__:null,base256emoji:LP}),qP=function e(t,i,s){i=i||[];for(var n=s=s||0;t>=HP;)i[s++]=255&t|BP,t/=128;for(;t&VP;)i[s++]=255&t|BP,t>>>=7;return i[s]=0|t,e.bytes=s-n+1,i},BP=128,VP=-128,HP=Math.pow(2,31);var KP=function e(t,i){var s,n=0,r=0,o=i=i||0,a=t.length;do{if(o>=a)throw e.bytes=0,new RangeError("Could not decode varint");s=t[o++],n+=r<28?(s&FP)<<r:(s&FP)*Math.pow(2,r),r+=7}while(s>=WP);return e.bytes=o-i,n},WP=128,FP=127;var GP=Math.pow(2,7),YP=Math.pow(2,14),QP=Math.pow(2,21),ZP=Math.pow(2,28),JP=Math.pow(2,35),XP=Math.pow(2,42),$P=Math.pow(2,49),eT=Math.pow(2,56),tT=Math.pow(2,63),iT={encode:qP,decode:KP,encodingLength:function(e){return e<GP?1:e<YP?2:e<QP?3:e<ZP?4:e<JP?5:e<XP?6:e<$P?7:e<eT?8:e<tT?9:10}},sT=iT;const nT=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return sT.encode(e,t,i),t},rT=e=>sT.encodingLength(e),oT=(e,t)=>{const i=t.byteLength,s=rT(e),n=s+rT(i),r=new Uint8Array(n+i);return nT(e,r,0),nT(i,r,s),r.set(t,n),new aT(e,i,t,r)};class aT{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const cT=e=>{let{name:t,code:i,encode:s}=e;return new lT(t,i,s)};class lT{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?oT(this.code,t):t.then(e=>oT(this.code,e))}throw Error("Unknown type, must be binary type")}}const hT=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),dT=cT({name:"sha2-256",code:18,encode:hT("SHA-256")}),uT=cT({name:"sha2-512",code:19,encode:hT("SHA-512")});var pT=Object.freeze({__proto__:null,sha256:dT,sha512:uT});const gT=YS,fT={code:0,name:"identity",encode:gT,digest:e=>oT(0,gT(e))};var wT=Object.freeze({__proto__:null,identity:fT});new TextEncoder,new TextDecoder;const mT=(0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)((0,d.A)({},nP),oP),cP),hP),pP),NP),SP),MP),DP),zP);function yT(e,t,i,s){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:i},decoder:{decode:s}}}(0,d.A)((0,d.A)({},pT),wT);const vT=yT("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>(new TextEncoder).encode(e.substring(1))),bT=yT("ascii","a",e=>{let t="a";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},e=>{const t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}((e=e.substring(1)).length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}),IT=(0,d.A)({utf8:vT,"utf-8":vT,hex:mT.base16,latin1:bT,ascii:bT,binary:bT},mT);var ET=Object.defineProperty,NT=(e,t,i)=>((e,t,i)=>t in e?ET(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class AT{constructor(e,t){this.core=e,this.logger=t,NT(this,"keychain",new Map),NT(this,"name","keychain"),NT(this,"version","0.3"),NT(this,"initialized",!1),NT(this,"storagePrefix",uC),NT(this,"init",async()=>{if(!this.initialized){const e=await this.getKeyChain();typeof e<"u"&&(this.keychain=e),this.initialized=!0}}),NT(this,"has",e=>(this.isInitialized(),this.keychain.has(e))),NT(this,"set",async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),NT(this,"get",e=>{this.isInitialized();const t=this.keychain.get(e);if(typeof t>"u"){const{message:t}=BA("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw new Error(t)}return t}),NT(this,"del",async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=(0,v.E)(t,this.name)}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,TI(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?MI(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}}var CT=Object.defineProperty,ST=(e,t,i)=>((e,t,i)=>t in e?CT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class PT{constructor(e,t,i){this.core=e,this.logger=t,ST(this,"name","crypto"),ST(this,"keychain"),ST(this,"randomSessionIdentifier",mA()),ST(this,"initialized",!1),ST(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ST(this,"hasKeys",e=>(this.isInitialized(),this.keychain.has(e))),ST(this,"getClientId",async()=>{this.isInitialized();const e=await this.getClientSeed(),t=(0,v.P)(e);return(0,v.Q)(t.publicKey)}),ST(this,"generateKeyPair",()=>{this.isInitialized();const e=function(){const e=dA.utils.randomPrivateKey(),t=dA.getPublicKey(e);return{privateKey:(0,v.t)(e,pA),publicKey:(0,v.t)(t,pA)}}();return this.setPrivateKey(e.publicKey,e.privateKey)}),ST(this,"signJWT",async e=>{this.isInitialized();const t=await this.getClientSeed(),i=(0,v.P)(t),s=this.randomSessionIdentifier;return await(0,v.u)(s,e,wC,i)}),ST(this,"generateSharedKey",(e,t,i)=>{this.isInitialized();const s=function(e,t){const i=dA.getSharedSecret((0,v.f)(e,pA),(0,v.f)(t,pA)),s=SN(DN,i,void 0,void 0,32);return(0,v.t)(s,pA)}(this.getPrivateKey(e),t);return this.setSymKey(s,i)}),ST(this,"setSymKey",async(e,t)=>{this.isInitialized();const i=t||yA(e);return await this.keychain.set(i,e),i}),ST(this,"deleteKeyPair",async e=>{this.isInitialized(),await this.keychain.del(e)}),ST(this,"deleteSymKey",async e=>{this.isInitialized(),await this.keychain.del(e)}),ST(this,"encode",async(e,t,i)=>{this.isInitialized();const s=AA(i),n=(0,v.v)(t);if(SA(s))return function(e,t){const i=bA(2),s=oE(12);return EA({type:i,sealed:(0,v.f)(e,wA),iv:s,encoding:t})}(n,null==i?void 0:i.encoding);if(CA(s)){const t=s.senderPublicKey,i=s.receiverPublicKey;e=await this.generateSharedKey(t,i)}const r=this.getSymKey(e),{type:o,senderPublicKey:a}=s;return function(e){const t=bA(typeof e.type<"u"?e.type:0);if(1===IA(t)&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof e.senderPublicKey<"u"?(0,v.f)(e.senderPublicKey,pA):void 0,s=typeof e.iv<"u"?(0,v.f)(e.iv,pA):oE(12),n=(0,v.f)(e.symKey,pA);return EA({type:t,sealed:IN(n,s).encrypt((0,v.f)(e.message,wA)),iv:s,senderPublicKey:i,encoding:e.encoding})}({type:o,symKey:r,message:n,senderPublicKey:a,encoding:null==i?void 0:i.encoding})}),ST(this,"decode",async(e,t,i)=>{this.isInitialized();const s=function(e,t){const i=NA({encoded:e,encoding:null==t?void 0:t.encoding});return AA({type:IA(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?(0,v.t)(i.senderPublicKey,pA):void 0,receiverPublicKey:null==t?void 0:t.receiverPublicKey})}(t,i);if(SA(s)){const e=function(e,t){const{sealed:i}=NA({encoded:e,encoding:t});return(0,v.t)(i,wA)}(t,null==i?void 0:i.encoding);return(0,v.w)(e)}if(CA(s)){const t=s.receiverPublicKey,i=s.senderPublicKey;e=await this.generateSharedKey(t,i)}try{const s=function(e){const t=(0,v.f)(e.symKey,pA),{sealed:i,iv:s}=NA(e),n=IN(t,s).decrypt(i);if(null===n)throw new Error("Failed to decrypt");return(0,v.t)(n,wA)}({symKey:this.getSymKey(e),encoded:t,encoding:null==i?void 0:i.encoding});return(0,v.w)(s)}catch(n){this.logger.error("Failed to decode message from topic: '".concat(e,"', clientId: '").concat(await this.getClientId(),"'")),this.logger.error(n)}}),ST(this,"getPayloadType",function(e){return IA(NA({encoded:e,encoding:arguments.length>1&&void 0!==arguments[1]?arguments[1]:gA}).type)}),ST(this,"getPayloadSenderPublicKey",function(e){const t=NA({encoded:e,encoding:arguments.length>1&&void 0!==arguments[1]?arguments[1]:gA});return t.senderPublicKey?(0,v.t)(t.senderPublicKey,pA):void 0}),this.core=e,this.logger=(0,v.E)(t,this.name),this.keychain=i||new AT(this.core,this.logger)}get context(){return(0,v.y)(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(fC)}catch(t){e=mA(),await this.keychain.set(fC,e)}return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";const i=IT[t];if(!i)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?i.decoder.decode("".concat(i.prefix).concat(e)):globalThis.Buffer.from(e,"utf8")}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}}var TT=Object.defineProperty,MT=Object.defineProperties,_T=Object.getOwnPropertyDescriptors,OT=Object.getOwnPropertySymbols,xT=Object.prototype.hasOwnProperty,kT=Object.prototype.propertyIsEnumerable,DT=(e,t,i)=>t in e?TT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,jT=(e,t,i)=>DT(e,"symbol"!=typeof t?t+"":t,i);class RT extends lv{constructor(e,t){super(e,t),this.logger=e,this.core=t,jT(this,"messages",new Map),jT(this,"messagesWithoutClientAck",new Map),jT(this,"name","messages"),jT(this,"version","0.3"),jT(this,"initialized",!1),jT(this,"storagePrefix",uC),jT(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const e=await this.getRelayerMessages();typeof e<"u"&&(this.messages=e);const t=await this.getRelayerMessagesWithoutClientAck();typeof t<"u"&&(this.messagesWithoutClientAck=t),this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e)}finally{this.initialized=!0}}}),jT(this,"set",async(e,t,i)=>{this.isInitialized();const s=vA(t);let n=this.messages.get(e);if(typeof n>"u"&&(n={}),typeof n[s]<"u")return s;if(n[s]=t,this.messages.set(e,n),i===xC){const i=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,((e,t)=>MT(e,_T(t)))(((e,t)=>{for(var i in t||(t={}))xT.call(t,i)&&DT(e,i,t[i]);if(OT)for(var i of OT(t))kT.call(t,i)&&DT(e,i,t[i]);return e})({},i),{[s]:t}))}return await this.persist(),s}),jT(this,"get",e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t}),jT(this,"getWithoutAck",e=>{this.isInitialized();const t={};for(const i of e){const e=this.messagesWithoutClientAck.get(i)||{};t[i]=Object.values(e)}return t}),jT(this,"has",(e,t)=>{this.isInitialized();return typeof this.get(e)[vA(t)]<"u"}),jT(this,"ack",async(e,t)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(e);if(typeof i>"u")return;delete i[vA(t)],0===Object.keys(i).length?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,i),await this.persist()}),jT(this,"del",async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=(0,v.E)(e,this.name),this.core=t}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,TI(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,TI(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?MI(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?MI(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}}var UT=Object.defineProperty,LT=Object.defineProperties,zT=Object.getOwnPropertyDescriptors,qT=Object.getOwnPropertySymbols,BT=Object.prototype.hasOwnProperty,VT=Object.prototype.propertyIsEnumerable,HT=(e,t,i)=>t in e?UT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,KT=(e,t)=>{for(var i in t||(t={}))BT.call(t,i)&&HT(e,i,t[i]);if(qT)for(var i of qT(t))VT.call(t,i)&&HT(e,i,t[i]);return e},WT=(e,t)=>LT(e,zT(t)),FT=(e,t,i)=>HT(e,"symbol"!=typeof t?t+"":t,i);class GT extends hv{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,FT(this,"events",new g.e.EventEmitter),FT(this,"name","publisher"),FT(this,"queue",new Map),FT(this,"publishTimeout",v.c.toMiliseconds(v.c.ONE_MINUTE)),FT(this,"initialPublishTimeout",v.c.toMiliseconds(15*v.c.ONE_SECOND)),FT(this,"needsTransportRestart",!1),FT(this,"publish",async(e,t,i)=>{var s;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:i}});const n=(null==i?void 0:i.ttl)||mC,r=TA(i),o=(null==i?void 0:i.prompt)||!1,a=(null==i?void 0:i.tag)||0,c=(null==i?void 0:i.id)||(0,v.x)().toString(),l={topic:e,message:t,opts:{ttl:n,relay:r,prompt:o,tag:a,id:c,attestation:null==i?void 0:i.attestation,tvf:null==i?void 0:i.tvf}},h="Failed to publish payload, please try again. id:".concat(c," tag:").concat(a);try{const s=new Promise(async s=>{const r=e=>{let{id:t}=e;l.opts.id===t&&(this.removeRequestFromQueue(t),this.relayer.events.removeListener(CC,r),s(l))};this.relayer.events.on(CC,r);const h=OI(new Promise((s,r)=>{this.rpcPublish({topic:e,message:t,ttl:n,prompt:o,tag:a,id:c,attestation:null==i?void 0:i.attestation,tvf:null==i?void 0:i.tvf}).then(s).catch(e=>{this.logger.warn(e,null==e?void 0:e.message),r(e)})}),this.initialPublishTimeout,"Failed initial publish, retrying.... id:".concat(c," tag:").concat(a));try{await h,this.events.removeListener(CC,r)}catch(d){this.queue.set(c,WT(KT({},l),{attempt:1})),this.logger.warn(d,null==d?void 0:d.message)}});this.logger.trace({type:"method",method:"publish",params:{id:c,topic:e,message:t,opts:i}}),await OI(s,this.publishTimeout,h)}catch(d){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(d),null!=(s=null==i?void 0:i.internal)&&s.throwOnFailedPublish)throw d}finally{this.queue.delete(c)}}),FT(this,"on",(e,t)=>{this.events.on(e,t)}),FT(this,"once",(e,t)=>{this.events.once(e,t)}),FT(this,"off",(e,t)=>{this.events.off(e,t)}),FT(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=(0,v.E)(t,this.name),this.registerEventListeners()}get context(){return(0,v.y)(this.logger)}async rpcPublish(e){var t,i,s,n;const{topic:r,message:o,ttl:a=mC,prompt:c,tag:l,id:h,attestation:d,tvf:u}=e,p={method:MA(TA().protocol).publish,params:KT({topic:r,message:o,ttl:a,prompt:c,tag:l,attestation:d},u),id:h};WA(null==(t=p.params)?void 0:t.prompt)&&(null==(i=p.params)||delete i.prompt),WA(null==(s=p.params)?void 0:s.tag)&&(null==(n=p.params)||delete n.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p});const g=await this.relayer.request(p);return this.relayer.events.emit(CC,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{const i=e.attempt+1;this.queue.set(t,WT(KT({},e),{attempt:i}));const{topic:s,message:n,opts:r,attestation:o}=e;this.logger.warn({},"Publisher: queue->publishing: ".concat(e.opts.id,", tag: ").concat(e.opts.tag,", attempt: ").concat(i)),await this.rpcPublish(WT(KT({},e),{topic:s,message:n,ttl:r.ttl,prompt:r.prompt,tag:r.tag,id:r.id,attestation:o,tvf:r.tvf})),this.logger.warn({},"Publisher: queue->published: ".concat(e.opts.id))})}registerEventListeners(){this.relayer.core.heartbeat.on(v.r.pulse,()=>{if(this.needsTransportRestart)return this.needsTransportRestart=!1,void this.relayer.events.emit(AC);this.checkQueue()}),this.relayer.on(bC,e=>{this.removeRequestFromQueue(e.id.toString())})}}var YT=Object.defineProperty,QT=(e,t,i)=>((e,t,i)=>t in e?YT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class ZT{constructor(){QT(this,"map",new Map),QT(this,"set",(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),QT(this,"get",e=>this.map.get(e)||[]),QT(this,"exists",(e,t)=>this.get(e).includes(t)),QT(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(e=>e!==t);s.length?this.map.set(e,s):this.map.delete(e)}),QT(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var JT=Object.defineProperty,XT=Object.defineProperties,$T=Object.getOwnPropertyDescriptors,eM=Object.getOwnPropertySymbols,tM=Object.prototype.hasOwnProperty,iM=Object.prototype.propertyIsEnumerable,sM=(e,t,i)=>t in e?JT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,nM=(e,t)=>{for(var i in t||(t={}))tM.call(t,i)&&sM(e,i,t[i]);if(eM)for(var i of eM(t))iM.call(t,i)&&sM(e,i,t[i]);return e},rM=(e,t)=>XT(e,$T(t)),oM=(e,t,i)=>sM(e,"symbol"!=typeof t?t+"":t,i);class aM extends pv{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,oM(this,"subscriptions",new Map),oM(this,"topicMap",new ZT),oM(this,"events",new g.e.EventEmitter),oM(this,"name","subscription"),oM(this,"version","0.3"),oM(this,"pending",new Map),oM(this,"cached",[]),oM(this,"initialized",!1),oM(this,"storagePrefix",uC),oM(this,"subscribeTimeout",v.c.toMiliseconds(v.c.ONE_MINUTE)),oM(this,"initialSubscribeTimeout",v.c.toMiliseconds(15*v.c.ONE_SECOND)),oM(this,"clientId"),oM(this,"batchSubscribeTopicsLimit",500),oM(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),oM(this,"subscribe",async(e,t)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{const i=TA(t),s={topic:e,relay:i,transportType:null==t?void 0:t.transportType};this.pending.set(e,s);const n=await this.rpcSubscribe(e,i,t);return"string"==typeof n&&(this.onSubscribe(n,s),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),n}catch(i){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(i),i}}),oM(this,"unsubscribe",async(e,t)=>{this.isInitialized(),typeof(null==t?void 0:t.id)<"u"?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),oM(this,"isSubscribed",e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),oM(this,"isKnownTopic",e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),oM(this,"on",(e,t)=>{this.events.on(e,t)}),oM(this,"once",(e,t)=>{this.events.once(e,t)}),oM(this,"off",(e,t)=>{this.events.off(e,t)}),oM(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),oM(this,"start",async()=>{await this.onConnect()}),oM(this,"stop",async()=>{await this.onDisconnect()}),oM(this,"restart",async()=>{await this.restore(),await this.onRestart()}),oM(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),oM(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(v.r.pulse,async()=>{await this.checkPending()}),this.events.on(jC,async e=>{const t=jC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(RC,async e=>{const t=RC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}),this.relayer=e,this.logger=(0,v.E)(t,this.name),this.clientId=""}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch(s){}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async i=>await this.unsubscribeById(e,i,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=TA(i);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const n=VA("USER_DISCONNECTED","".concat(this.name,", ").concat(e));await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,i){var s;(!i||(null==i?void 0:i.transportType)===OC.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const n={method:MA(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});const r=null==(s=null==i?void 0:i.internal)?void 0:s.throwOnFailedPublish;try{const t=await this.getSubscriptionId(e);if((null==i?void 0:i.transportType)===OC.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(n).catch(e=>this.logger.warn(e))},v.c.toMiliseconds(v.c.ONE_SECOND)),t;const s=new Promise(async t=>{const i=s=>{s.topic===e&&(this.events.removeListener(jC,i),t(s.id))};this.events.on(jC,i);try{const s=await OI(new Promise((e,t)=>{this.relayer.request(n).catch(e=>{this.logger.warn(e,null==e?void 0:e.message),t(e)}).then(e)}),this.initialSubscribeTimeout,"Subscribing to ".concat(e," failed, please try again"));this.events.removeListener(jC,i),t(s)}catch(s){}}),o=await OI(s,this.subscribeTimeout,"Subscribing to ".concat(e," failed, please try again"));if(!o&&r)throw new Error("Subscribing to ".concat(e," failed, please try again"));return o?t:null}catch(o){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(AC),r)throw o}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t={method:MA(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{await await OI(new Promise(e=>{this.relayer.request(t).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch(i){this.relayer.events.emit(AC)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t={method:MA(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};let i;this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{i=await await OI(new Promise((e,i)=>{this.relayer.request(t).catch(e=>{this.logger.warn(e),i(e)}).then(e)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch(s){this.relayer.events.emit(AC)}return i}rpcUnsubscribe(e,t,i){const s={method:MA(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,rM(nM({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,nM({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,nM({},t)),this.topicMap.set(t.topic,e),this.events.emit(jC,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:t}=BA("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw new Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(RC,rM(nM({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(UC)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){const t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit(LC)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:e}=BA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error("".concat(this.name,": ").concat(JSON.stringify(this.values))),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored subscriptions for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug("Failed to Restore subscriptions for ".concat(this.name)),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>rM(nM({},e),{id:await this.getSubscriptionId(e.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace("Fetching batch messages for ".concat(e.length," subscriptions"));const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await function(e){return new Promise(t=>setTimeout(t,e))}(v.c.toMiliseconds(v.c.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return vA(e+await this.getClientId())}}var cM=Object.defineProperty,lM=Object.getOwnPropertySymbols,hM=Object.prototype.hasOwnProperty,dM=Object.prototype.propertyIsEnumerable,uM=(e,t,i)=>t in e?cM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,pM=(e,t)=>{for(var i in t||(t={}))hM.call(t,i)&&uM(e,i,t[i]);if(lM)for(var i of lM(t))dM.call(t,i)&&uM(e,i,t[i]);return e},gM=(e,t,i)=>uM(e,"symbol"!=typeof t?t+"":t,i);class fM extends dv{constructor(e){super(e),gM(this,"protocol","wc"),gM(this,"version",2),gM(this,"core"),gM(this,"logger"),gM(this,"events",new g.e.EventEmitter),gM(this,"provider"),gM(this,"messages"),gM(this,"subscriber"),gM(this,"publisher"),gM(this,"name","relayer"),gM(this,"transportExplicitlyClosed",!1),gM(this,"initialized",!1),gM(this,"connectionAttemptInProgress",!1),gM(this,"relayUrl"),gM(this,"projectId"),gM(this,"packageName"),gM(this,"bundleId"),gM(this,"hasExperiencedNetworkDisruption",!1),gM(this,"pingTimeout"),gM(this,"heartBeatTimeout",v.c.toMiliseconds(v.c.THIRTY_SECONDS+v.c.FIVE_SECONDS)),gM(this,"reconnectTimeout"),gM(this,"connectPromise"),gM(this,"reconnectInProgress",!1),gM(this,"requestsInFlight",[]),gM(this,"connectTimeout",v.c.toMiliseconds(15*v.c.ONE_SECOND)),gM(this,"request",async e=>{var t,i;this.logger.debug("Publishing Request Payload");const s=e.id||(0,v.x)().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");const n="".concat(s,":").concat((null==(i=e.params)?void 0:i.tag)||"");this.requestsInFlight.push(n);const r=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==n),r}catch(n){throw this.logger.debug("Failed to Publish Request: ".concat(s)),n}}),gM(this,"resetPingTimeout",()=>{vI()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(s=null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.terminate)||s.call(i)}catch(n){this.logger.warn(n,null==n?void 0:n.message)}},this.heartBeatTimeout))}),gM(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),gM(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \ud83d\udedc"),this.startPingTimeout(),this.events.emit(IC)}),gM(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \ud83d\uded1"),this.requestsInFlight=[],this.onProviderDisconnect()}),gM(this,"onProviderErrorHandler",e=>{this.logger.fatal("Fatal socket error: ".concat(e.message)),this.events.emit(NC,e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),gM(this,"registerProviderListeners",()=>{this.provider.on(SC,this.onPayloadHandler),this.provider.on(PC,this.onConnectHandler),this.provider.on(TC,this.onDisconnectHandler),this.provider.on(MC,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&"string"!=typeof e.logger?(0,v.E)(e.logger,this.name):(0,v.O)((0,v.k)({level:e.logger||"error"})),this.messages=new RT(this.logger,e.core),this.subscriber=new aM(this,this.logger),this.publisher=new GT(this,this.logger),this.relayUrl=(null==e?void 0:e.relayUrl)||yC,this.projectId=e.projectId,bI()&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Platform)<"u"&&"android"===(null==p.d.global?void 0:p.d.global.Platform.OS)?this.packageName=NI():bI()&&typeof p.d.global<"u"&&typeof(null==p.d.global?void 0:p.d.global.Platform)<"u"&&"ios"===(null==p.d.global?void 0:p.d.global.Platform.OS)&&(this.bundleId=NI()),this.provider={}}async init(){if(this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.subscriber.hasAnyTopics)try{await this.transportOpen()}catch(e){this.logger.warn(e,null==e?void 0:e.message)}}get context(){return(0,v.y)(this.logger)}get connected(){var e,t,i;return 1===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||!1}get connecting(){var e,t,i;return 0===(null==(i=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:i.readyState)||void 0!==this.connectPromise||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:OC.relay},kC)}async subscribe(e,t){var i,s,n;this.isInitialized(),(null==t||!t.transportType||"relay"===(null==t?void 0:t.transportType))&&await this.toEstablishConnection();const r=typeof(null==(i=null==t?void 0:t.internal)?void 0:i.throwOnFailedPublish)>"u"||(null==(s=null==t?void 0:t.internal)?void 0:s.throwOnFailedPublish);let o,a=(null==(n=this.subscriber.topicMap.get(e))?void 0:n[0])||"";const c=t=>{t.topic===e&&(this.subscriber.off(jC,c),o())};return await Promise.all([new Promise(e=>{o=e,this.subscriber.on(jC,c)}),new Promise(async(i,s)=>{a=await this.subscriber.subscribe(e,pM({internal:{throwOnFailedPublish:r}},t)).catch(e=>{r&&s(e)})||a,i()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await OI(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(this.subscriber.hasAnyTopics){if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error("Couldn't establish socket connection to the relay server: ".concat(this.relayUrl))}else this.logger.warn("Starting WS connection skipped because the client has no topics to work with.")}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await aC())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(0===(null==e?void 0:e.length))return void this.logger.trace("Batch message events is empty. Ignoring...");const t=e.sort((e,t)=>e.publishedAt-t.publishedAt);this.logger.debug("Batch of ".concat(t.length," message events sorted"));for(const s of t)try{await this.onMessageEvent(s)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(null==i?void 0:i.message))}this.logger.trace("Batch of ".concat(t.length," message events processed"))}async onLinkMessageEvent(e,t){const{topic:i}=e;if(!t.sessionExists){const e={topic:i,expiry:DI(v.c.FIVE_MINUTES),relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,e)}this.events.emit(vC,e),await this.recordMessageEvent(e,xC)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},"Connecting to ".concat(this.relayUrl,", attempt: ").concat(t,"...")),await this.createProvider(),await new Promise(async(e,t)=>{const i=()=>{t(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(TC,i),await OI(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,"Socket stalled when trying to connect to ".concat(this.relayUrl)).catch(e=>{t(e)}).finally(()=>{this.provider.off(TC,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,t)=>{const i=()=>{t(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(TC,i),await this.subscriber.start().then(e).catch(t).finally(()=>{this.provider.off(TC,i)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(i){await this.subscriber.stop();const e=i;this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},"Connected to ".concat(this.relayUrl," successfully on attempt: ").concat(t));break}await new Promise(e=>setTimeout(e,v.c.toMiliseconds(1*t))),t++}}startPingTimeout(){var e,t,i,s,n;if(vI())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(n=null==(s=null==(i=this.provider)?void 0:i.connection)?void 0:s.socket)||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(r){this.logger.warn(r,null==r?void 0:r.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new v.o(new v.m(SI({sdkVersion:_C,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:i,message:s}=e;await this.messages.set(i,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;if(!i||0===i.length)return this.logger.warn("Ignoring invalid/empty message: ".concat(i)),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn("Ignoring message for unknown topic ".concat(t)),!0;const s=this.messages.has(t,i);return s&&this.logger.warn("Ignoring duplicate message: ".concat(i)),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,v.n)(e)){if(!e.method.endsWith("_subscription"))return;const t=e.params,{topic:i,message:s,publishedAt:n,attestation:r}=t.data,o={topic:i,message:s,publishedAt:n,transportType:OC.relay,attestation:r};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(pM({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}else(0,v.p)(e)&&this.events.emit(bC,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,xC),this.events.emit(vC,e))}async acknowledgePayload(e){const t=(0,v.q)(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(SC,this.onPayloadHandler),this.provider.off(PC,this.onConnectHandler),this.provider.off(TC,this.onDisconnectHandler),this.provider.off(MC,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await aC();cC(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(e=>this.logger.error(e,null==e?void 0:e.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(EC),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,null==e?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},v.c.toMiliseconds(.1)))))}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&await this.connect()}}function wM(){}function mM(e){if(!e||"object"!=typeof e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&"[object Object]"===Object.prototype.toString.call(e)}function yM(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function vM(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const bM="[object Arguments]",IM="[object Object]";function EM(e,t,i,s,n,r,o){const a=o(e,t,i,s,n,r);if(void 0!==a)return a;if(typeof e==typeof t)switch(typeof e){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return e===t;case"number":return e===t||Object.is(e,t);case"object":return NM(e,t,r,o)}return NM(e,t,r,o)}function NM(e,t,i,s){if(Object.is(e,t))return!0;let n=vM(e),r=vM(t);if(n===bM&&(n=IM),r===bM&&(r=IM),n!==r)return!1;switch(n){case"[object String]":return e.toString()===t.toString();case"[object Number]":return function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}(e.valueOf(),t.valueOf());case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(e.valueOf(),t.valueOf());case"[object RegExp]":return e.source===t.source&&e.flags===t.flags;case"[object Function]":return e===t}const o=(i=null!==i&&void 0!==i?i:new Map).get(e),a=i.get(t);if(null!=o&&null!=a)return o===t;i.set(e,t),i.set(t,e);try{switch(n){case"[object Map]":if(e.size!==t.size)return!1;for(const[n,r]of e.entries())if(!t.has(n)||!EM(r,t.get(n),n,e,t,i,s))return!1;return!0;case"[object Set]":{if(e.size!==t.size)return!1;const n=Array.from(e.values()),r=Array.from(t.values());for(let o=0;o<n.length;o++){const a=n[o],c=r.findIndex(n=>EM(a,n,void 0,e,t,i,s));if(-1===c)return!1;r.splice(c,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if(typeof p.d.Buffer<"u"&&p.d.Buffer.isBuffer(e)!==p.d.Buffer.isBuffer(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!EM(e[n],t[n],n,e,t,i,s))return!1;return!0;case"[object ArrayBuffer]":return e.byteLength===t.byteLength&&NM(new Uint8Array(e),new Uint8Array(t),i,s);case"[object DataView]":return e.byteLength===t.byteLength&&e.byteOffset===t.byteOffset&&NM(new Uint8Array(e),new Uint8Array(t),i,s);case"[object Error]":return e.name===t.name&&e.message===t.message;case IM:{if(!(NM(e.constructor,t.constructor,i,s)||mM(e)&&mM(t)))return!1;const n=[...Object.keys(e),...yM(e)],r=[...Object.keys(t),...yM(t)];if(n.length!==r.length)return!1;for(let o=0;o<n.length;o++){const r=n[o],a=e[r];if(!Object.hasOwn(t,r))return!1;if(!EM(a,t[r],r,e,t,i,s))return!1}return!0}default:return!1}}finally{i.delete(e),i.delete(t)}}function AM(e,t){return function(e,t,i){return EM(e,t,void 0,void 0,void 0,void 0,i)}(e,t,wM)}var CM=Object.defineProperty,SM=Object.getOwnPropertySymbols,PM=Object.prototype.hasOwnProperty,TM=Object.prototype.propertyIsEnumerable,MM=(e,t,i)=>t in e?CM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,_M=(e,t)=>{for(var i in t||(t={}))PM.call(t,i)&&MM(e,i,t[i]);if(SM)for(var i of SM(t))TM.call(t,i)&&MM(e,i,t[i]);return e},OM=(e,t,i)=>MM(e,"symbol"!=typeof t?t+"":t,i);class xM extends uv{constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:uC,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;super(e,t,i,s),this.core=e,this.logger=t,this.name=i,OM(this,"map",new Map),OM(this,"version","0.3"),OM(this,"cached",[]),OM(this,"initialized",!1),OM(this,"getKey"),OM(this,"storagePrefix",uC),OM(this,"recentlyDeleted",[]),OM(this,"recentlyDeletedLimit",200),OM(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>{this.getKey&&null!==e&&!WA(e)?this.map.set(this.getKey(e),e):function(e){var t;return null==(t=null==e?void 0:e.proposer)?void 0:t.publicKey}(e)?this.map.set(e.id,e):function(e){return null==e?void 0:e.topic}(e)&&this.map.set(e.topic,e)}),this.cached=[],this.initialized=!0)}),OM(this,"set",async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())}),OM(this,"get",e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e))),OM(this,"getAll",e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(i=>AM(t[i],e[i]))):this.values)),OM(this,"update",async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});const i=_M(_M({},this.getData(e)),t);this.map.set(e,i),await this.persist()}),OM(this,"delete",async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=(0,v.E)(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:t}=BA("MISSING_OR_INVALID","Record was recently deleted - ".concat(this.name,": ").concat(e));throw this.logger.error(t),new Error(t)}const{message:t}=BA("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw this.logger.error(t),new Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:e}=BA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored value for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug("Failed to Restore value for ".concat(this.name)),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}}var kM=Object.defineProperty,DM=(e,t,i)=>((e,t,i)=>t in e?kM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class jM{constructor(e,t){this.core=e,this.logger=t,DM(this,"name","pairing"),DM(this,"version","0.3"),DM(this,"events",new g.E),DM(this,"pairings"),DM(this,"initialized",!1),DM(this,"storagePrefix",uC),DM(this,"ignoredPayloadTypes",[1]),DM(this,"registeredMethods",[]),DM(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),DM(this,"register",e=>{let{methods:t}=e;this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...t])]}),DM(this,"create",async e=>{this.isInitialized();const t=mA(),i=await this.core.crypto.setSymKey(t),s=DI(v.c.FIVE_MINUTES),n={protocol:"irn"},r={topic:i,expiry:s,relay:n,active:!1,methods:null==e?void 0:e.methods},o=kA({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:t,relay:n,expiryTimestamp:s,methods:null==e?void 0:e.methods});return this.events.emit(qC,r),this.core.expirer.set(i,s),await this.pairings.set(i,r),await this.core.relayer.subscribe(i,{transportType:null==e?void 0:e.transportType}),{topic:i,uri:o}}),DM(this,"pair",async e=>{this.isInitialized();const t=this.core.eventClient.createEvent({properties:{topic:null==e?void 0:e.uri,trace:[iS]}});this.isValidPair(e,t);const{topic:i,symKey:s,relay:n,expiryTimestamp:r,methods:o}=OA(e.uri);let a;if(t.props.properties.topic=i,t.addTrace(sS),t.addTrace(nS),this.pairings.keys.includes(i)){if(a=this.pairings.get(i),t.addTrace(cS),a.active)throw t.setError(gS),new Error("Pairing already exists: ".concat(i,". Please try again with a new connection URI."));t.addTrace(lS)}const c=r||DI(v.c.FIVE_MINUTES),l={topic:i,relay:n,expiry:c,active:!1,methods:o};this.core.expirer.set(i,c),await this.pairings.set(i,l),t.addTrace(rS),e.activatePairing&&await this.activate({topic:i}),this.events.emit(qC,l),t.addTrace(hS),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(s,i),t.addTrace(oS);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch(h){t.setError(uS)}try{await this.core.relayer.subscribe(i,{relay:n})}catch(d){throw t.setError(fS),d}return t.addTrace(aS),l}),DM(this,"activate",async e=>{let{topic:t}=e;this.isInitialized();const i=DI(v.c.FIVE_MINUTES);this.core.expirer.set(t,i),await this.pairings.update(t,{active:!0,expiry:i})}),DM(this,"ping",async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:t}=e;if(this.pairings.keys.includes(t)){const e=await this.sendRequest(t,"wc_pairingPing",{}),{done:i,resolve:s,reject:n}=_I();this.events.once(RI("pairing_ping",e),e=>{let{error:t}=e;t?n(t):s()}),await i()}}),DM(this,"updateExpiry",async e=>{let{topic:t,expiry:i}=e;this.isInitialized(),await this.pairings.update(t,{expiry:i})}),DM(this,"updateMetadata",async e=>{let{topic:t,metadata:i}=e;this.isInitialized(),await this.pairings.update(t,{peerMetadata:i})}),DM(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),DM(this,"disconnect",async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",VA("USER_DISCONNECTED")),await this.deletePairing(t))}),DM(this,"formatUriFromPairing",e=>{this.isInitialized();const{topic:t,relay:i,expiry:s,methods:n}=e,r=this.core.crypto.keychain.get(t);return kA({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:r,relay:i,expiryTimestamp:s,methods:n})}),DM(this,"sendRequest",async(e,t,i)=>{const s=(0,v.l)(t,i),n=await this.core.crypto.encode(e,s),r=zC[t].req;return this.core.history.set(e,s),this.core.relayer.publish(e,n,r),s.id}),DM(this,"sendResult",async(e,t,i)=>{const s=(0,v.q)(e,i),n=await this.core.crypto.encode(t,s),r=(await this.core.history.get(t,e)).request.method,o=zC[r].res;await this.core.relayer.publish(t,n,o),await this.core.history.resolve(s)}),DM(this,"sendError",async(e,t,i)=>{const s=(0,v.z)(e,i),n=await this.core.crypto.encode(t,s),r=(await this.core.history.get(t,e)).request.method,o=zC[r]?zC[r].res:zC.unregistered_method.res;await this.core.relayer.publish(t,n,o),await this.core.history.resolve(s)}),DM(this,"deletePairing",async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,VA("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),DM(this,"cleanup",async()=>{const e=this.pairings.getAll().filter(e=>jI(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),DM(this,"onRelayEventRequest",async e=>{const{topic:t,payload:i}=e;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(t,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(t,i);default:return await this.onUnknownRpcMethodRequest(t,i)}}),DM(this,"onRelayEventResponse",async e=>{const{topic:t,payload:i}=e,s=(await this.core.history.get(t,i.id)).request.method;return"wc_pairingPing"===s?this.onPairingPingResponse(t,i):this.onUnknownRpcMethodResponse(s)}),DM(this,"onPairingPingRequest",async(e,t)=>{const{id:i}=t;try{this.isValidPing({topic:e}),await this.sendResult(i,e,!0),this.events.emit(HC,{id:i,topic:e})}catch(s){await this.sendError(i,e,s),this.logger.error(s)}}),DM(this,"onPairingPingResponse",(e,t)=>{const{id:i}=t;setTimeout(()=>{(0,v.B)(t)?this.events.emit(RI("pairing_ping",i),{}):(0,v.D)(t)&&this.events.emit(RI("pairing_ping",i),{error:t.error})},500)}),DM(this,"onPairingDeleteRequest",async(e,t)=>{const{id:i}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(VC,{id:i,topic:e})}catch(s){await this.sendError(i,e,s),this.logger.error(s)}}),DM(this,"onUnknownRpcMethodRequest",async(e,t)=>{const{id:i,method:s}=t;try{if(this.registeredMethods.includes(s))return;const t=VA("WC_METHOD_UNSUPPORTED",s);await this.sendError(i,e,t),this.logger.error(t)}catch(n){await this.sendError(i,e,n),this.logger.error(n)}}),DM(this,"onUnknownRpcMethodResponse",e=>{this.registeredMethods.includes(e)||this.logger.error(VA("WC_METHOD_UNSUPPORTED",e))}),DM(this,"isValidPair",(e,t)=>{var i;if(!tC(e)){const{message:i}=BA("MISSING_OR_INVALID","pair() params: ".concat(e));throw t.setError(pS),new Error(i)}if(!function(e){function t(e){try{return typeof new URL(e)<"u"}catch(t){return!1}}try{if(FA(e,!1))return!!t(e)||t(VI(e))}catch(i){}return!1}(e.uri)){const{message:i}=BA("MISSING_OR_INVALID","pair() uri: ".concat(e.uri));throw t.setError(pS),new Error(i)}const s=OA(null==e?void 0:e.uri);if(null==(i=null==s?void 0:s.relay)||!i.protocol){const{message:e}=BA("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(pS),new Error(e)}if(null==s||!s.symKey){const{message:e}=BA("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(pS),new Error(e)}if(null!=s&&s.expiryTimestamp&&v.c.toMiliseconds(null==s?void 0:s.expiryTimestamp)<Date.now()){t.setError(wS);const{message:e}=BA("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(e)}}),DM(this,"isValidPing",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","ping() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)}),DM(this,"isValidDisconnect",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","disconnect() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidPairingTopic(t)}),DM(this,"isValidPairingTopic",async e=>{if(!FA(e,!1)){const{message:t}=BA("MISSING_OR_INVALID","pairing topic should be a string: ".concat(e));throw new Error(t)}if(!this.pairings.keys.includes(e)){const{message:t}=BA("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(e));throw new Error(t)}if(jI(this.pairings.get(e).expiry)){await this.deletePairing(e);const{message:t}=BA("EXPIRED","pairing topic: ".concat(e));throw new Error(t)}}),this.core=e,this.logger=(0,v.E)(t,this.name),this.pairings=new xM(this.core,this.logger,this.name,this.storagePrefix)}get context(){return(0,v.y)(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(vC,async e=>{const{topic:t,message:i,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==OC.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const e=await this.core.crypto.decode(t,i);(0,v.n)(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):(0,v.p)(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(ZC,async e=>{const{topic:t}=kI(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(BC,{topic:t}))})}}var RM=Object.defineProperty,UM=(e,t,i)=>((e,t,i)=>t in e?RM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class LM extends cv{constructor(e,t){super(e,t),this.core=e,this.logger=t,UM(this,"records",new Map),UM(this,"events",new g.e.EventEmitter),UM(this,"name","history"),UM(this,"version","0.3"),UM(this,"cached",[]),UM(this,"initialized",!1),UM(this,"storagePrefix",uC),UM(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),UM(this,"set",(e,t,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:i}),this.records.has(t.id))return;const s={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:i,expiry:DI(v.c.THIRTY_DAYS)};this.records.set(s.id,s),this.persist(),this.events.emit(KC,s)}),UM(this,"resolve",async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;const t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=(0,v.D)(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(WC,t))}),UM(this,"get",async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t))),UM(this,"delete",(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(i=>{if(i.topic===e){if(typeof t<"u"&&i.id!==t)return;this.records.delete(i.id),this.events.emit(FC,i)}}),this.persist()}),UM(this,"exists",async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e)),UM(this,"on",(e,t)=>{this.events.on(e,t)}),UM(this,"once",(e,t)=>{this.events.once(e,t)}),UM(this,"off",(e,t)=>{this.events.off(e,t)}),UM(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=(0,v.E)(t,this.name)}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:(0,v.l)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:t}=BA("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw new Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(GC)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:e}=BA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored records for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug("Failed to Restore records for ".concat(this.name)),this.logger.error(e)}}registerEventListeners(){this.events.on(KC,e=>{const t=KC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(WC,e=>{const t=WC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(FC,e=>{const t=FC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(v.r.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{v.c.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info("Deleting expired history log: ".concat(t.id)),this.records.delete(t.id),this.events.emit(FC,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zM=Object.defineProperty,qM=(e,t,i)=>((e,t,i)=>t in e?zM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class BM extends gv{constructor(e,t){super(e,t),this.core=e,this.logger=t,qM(this,"expirations",new Map),qM(this,"events",new g.e.EventEmitter),qM(this,"name","expirer"),qM(this,"version","0.3"),qM(this,"cached",[]),qM(this,"initialized",!1),qM(this,"storagePrefix",uC),qM(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),qM(this,"has",e=>{try{const t=this.formatTarget(e);return typeof this.getExpiration(t)<"u"}catch(t){return!1}}),qM(this,"set",(e,t)=>{this.isInitialized();const i=this.formatTarget(e),s={target:i,expiry:t};this.expirations.set(i,s),this.checkExpiry(i,s),this.events.emit(YC,{target:i,expiration:s})}),qM(this,"get",e=>{this.isInitialized();const t=this.formatTarget(e);return this.getExpiration(t)}),qM(this,"del",e=>{if(this.isInitialized(),this.has(e)){const t=this.formatTarget(e),i=this.getExpiration(t);this.expirations.delete(t),this.events.emit(QC,{target:t,expiration:i})}}),qM(this,"on",(e,t)=>{this.events.on(e,t)}),qM(this,"once",(e,t)=>{this.events.once(e,t)}),qM(this,"off",(e,t)=>{this.events.off(e,t)}),qM(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=(0,v.E)(t,this.name)}get context(){return(0,v.y)(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return function(e){return xI("topic",e)}(e);if("number"==typeof e)return function(e){return xI("id",e)}(e);const{message:t}=BA("UNKNOWN_TYPE","Target type: ".concat(typeof e));throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(JC)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:e}=BA("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),new Error(e)}this.cached=e,this.logger.debug("Successfully Restored expirations for ".concat(this.name)),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug("Failed to Restore expirations for ".concat(this.name)),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:t}=BA("NO_MATCHING_KEY","".concat(this.name,": ").concat(e));throw this.logger.warn(t),new Error(t)}return t}checkExpiry(e,t){const{expiry:i}=t;v.c.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(ZC,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(v.r.pulse,()=>this.checkExpirations()),this.events.on(YC,e=>{const t=YC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(ZC,e=>{const t=ZC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(QC,e=>{const t=QC;this.logger.info("Emitting ".concat(t)),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}}var VM=Object.defineProperty,HM=(e,t,i)=>((e,t,i)=>t in e?VM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class KM extends fv{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,HM(this,"name","verify-api"),HM(this,"abortController"),HM(this,"isDevEnv"),HM(this,"verifyUrlV3",eS),HM(this,"storagePrefix",uC),HM(this,"version",2),HM(this,"publicKey"),HM(this,"fetchPromise"),HM(this,"init",async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&v.c.toMiliseconds(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),HM(this,"register",async e=>{if(!II()||this.isDevEnv)return;const t=window.location.origin,{id:i,decryptedId:s}=e,n="".concat(this.verifyUrlV3,"/attestation?projectId=").concat(this.core.projectId,"&origin=").concat(t,"&id=").concat(i,"&decryptedId=").concat(s);try{const e=(0,v.a)(),t=this.startAbortTimer(5*v.c.ONE_SECOND),s=await new Promise((s,r)=>{const o=()=>{window.removeEventListener("message",c),e.body.removeChild(a),r("attestation aborted")};this.abortController.signal.addEventListener("abort",o);const a=e.createElement("iframe");a.src=n,a.style.display="none",a.addEventListener("error",o,{signal:this.abortController.signal});const c=n=>{if(n.data&&"string"==typeof n.data)try{const r=JSON.parse(n.data);if("verify_attestation"===r.type){if((0,v.s)(r.attestation).payload.id!==i)return;clearInterval(t),e.body.removeChild(a),this.abortController.signal.removeEventListener("abort",o),window.removeEventListener("message",c),s(null===r.attestation?"":r.attestation)}}catch(r){this.logger.warn(r)}};e.body.appendChild(a),window.addEventListener("message",c,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",s),s}catch(r){this.logger.warn(r)}return""}),HM(this,"resolve",async e=>{if(this.isDevEnv)return"";const{attestationId:t,hash:i,encryptedId:s}=e;if(""===t)return void this.logger.debug("resolve: attestationId is empty, skipping");if(t){if((0,v.s)(t).payload.id!==s)return;const e=await this.isValidJwtAttestation(t);if(e)return e.isVerified?e:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!i)return;const n=this.getVerifyUrl(null==e?void 0:e.verifyUrl);return this.fetchAttestation(i,n)}),HM(this,"fetchAttestation",async(e,t)=>{this.logger.debug("resolving attestation: ".concat(e," from url: ").concat(t));const i=this.startAbortTimer(5*v.c.ONE_SECOND),s=await fetch("".concat(t,"/attestation/").concat(e,"?v2Supported=true"),{signal:this.abortController.signal});return clearTimeout(i),200===s.status?await s.json():void 0}),HM(this,"getVerifyUrl",e=>{let t=e||$C;return tS.includes(t)||(this.logger.info("verify url: ".concat(t,", not included in trusted list, assigning default: ").concat($C)),t=$C),t}),HM(this,"fetchPublicKey",async()=>{try{this.logger.debug("fetching public key from: ".concat(this.verifyUrlV3));const e=this.startAbortTimer(v.c.FIVE_SECONDS),t=await fetch("".concat(this.verifyUrlV3,"/public-key"),{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),HM(this,"persistPublicKey",async e=>{this.logger.debug("persisting public key to local storage",e),await this.store.setItem(this.storeKey,e),this.publicKey=e}),HM(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),HM(this,"isValidJwtAttestation",async e=>{const t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(s){this.logger.error(s),this.logger.warn("error validating attestation")}const i=await this.fetchAndPersistPublicKey();try{if(i)return this.validateAttestation(e,i)}catch(s){this.logger.error(s),this.logger.warn("error validating attestation")}}),HM(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),HM(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{const t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});const e=await this.fetchPromise;return this.fetchPromise=void 0,e}),HM(this,"validateAttestation",(e,t)=>{const i=PA(e,t.publicKey),s={hasExpired:v.c.toMiliseconds(i.exp)<Date.now(),payload:i};if(s.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:s.payload.origin,isScam:s.payload.isScam,isVerified:s.payload.isVerified}}),this.logger=(0,v.E)(t,this.name),this.abortController=new AbortController,this.isDevEnv=BI(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return(0,v.y)(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),v.c.toMiliseconds(e))}}var WM=Object.defineProperty,FM=(e,t,i)=>((e,t,i)=>t in e?WM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class GM extends wv{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,FM(this,"context","echo"),FM(this,"registerDeviceToken",async e=>{const{clientId:t,token:i,notificationType:s,enableEncrypted:n=!1}=e,r="".concat("https://echo.walletconnect.com","/").concat(this.projectId,"/clients");await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:s,token:i,always_raw:n})})}),this.logger=(0,v.E)(t,this.context)}}var YM=Object.defineProperty,QM=Object.getOwnPropertySymbols,ZM=Object.prototype.hasOwnProperty,JM=Object.prototype.propertyIsEnumerable,XM=(e,t,i)=>t in e?YM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,$M=(e,t)=>{for(var i in t||(t={}))ZM.call(t,i)&&XM(e,i,t[i]);if(QM)for(var i of QM(t))JM.call(t,i)&&XM(e,i,t[i]);return e},e_=(e,t,i)=>XM(e,"symbol"!=typeof t?t+"":t,i);class t_ extends mv{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(e,t,i),this.core=e,this.logger=t,e_(this,"context","event-client"),e_(this,"storagePrefix",uC),e_(this,"storageVersion",.1),e_(this,"events",new Map),e_(this,"shouldPersist",!1),e_(this,"init",async()=>{if(!BI())try{const e={eventId:qI(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:CI(this.core.relayer.protocol,this.core.relayer.version,_C)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),e_(this,"createEvent",e=>{const{event:t="ERROR",type:i="",properties:{topic:s,trace:n}}=e,r=qI(),o=this.core.projectId||"",a=Date.now(),c=$M({eventId:r,timestamp:a,props:{event:t,type:i,properties:{topic:s,trace:n}},bundleId:o,domain:this.getAppDomain()},this.setMethods(r));return this.telemetryEnabled&&(this.events.set(r,c),this.shouldPersist=!0),c}),e_(this,"getEvent",e=>{const{eventId:t,topic:i}=e;if(t)return this.events.get(t);const s=Array.from(this.events.values()).find(e=>e.props.properties.topic===i);return s?$M($M({},s),this.setMethods(s.eventId)):void 0}),e_(this,"deleteEvent",e=>{const{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),e_(this,"setEventListeners",()=>{this.core.heartbeat.on(v.r.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{v.c.fromMiliseconds(Date.now())-v.c.fromMiliseconds(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),e_(this,"setMethods",e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),e_(this,"addTrace",(e,t)=>{const i=this.events.get(e);i&&(i.props.properties.trace.push(t),this.events.set(e,i),this.shouldPersist=!0)}),e_(this,"setError",(e,t)=>{const i=this.events.get(e);i&&(i.props.type=t,i.timestamp=Date.now(),this.events.set(e,i),this.shouldPersist=!0)}),e_(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),e_(this,"restore",async()=>{try{const e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,$M($M({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),e_(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;const e=[];for(const[i,s]of this.events)s.props.type&&e.push(s);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(const t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(t){this.logger.warn(t)}}),e_(this,"sendEvent",async e=>{const t=this.getAppDomain()?"":"&sp=desktop";return await fetch("".concat("https://pulse.walletconnect.org/batch","?projectId=").concat(this.core.projectId,"&st=events_sdk&sv=js-").concat(_C).concat(t),{method:"POST",body:JSON.stringify(e)})}),e_(this,"getAppDomain",()=>AI().url),this.logger=(0,v.E)(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var i_=Object.defineProperty,s_=Object.getOwnPropertySymbols,n_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,o_=(e,t,i)=>t in e?i_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,a_=(e,t)=>{for(var i in t||(t={}))n_.call(t,i)&&o_(e,i,t[i]);if(s_)for(var i of s_(t))r_.call(t,i)&&o_(e,i,t[i]);return e},c_=(e,t,i)=>o_(e,"symbol"!=typeof t?t+"":t,i);const l_=class e extends rv{constructor(e){var t;super(e),c_(this,"protocol","wc"),c_(this,"version",2),c_(this,"name",dC),c_(this,"relayUrl"),c_(this,"projectId"),c_(this,"customStoragePrefix"),c_(this,"events",new g.e.EventEmitter),c_(this,"logger"),c_(this,"heartbeat"),c_(this,"relayer"),c_(this,"crypto"),c_(this,"storage"),c_(this,"history"),c_(this,"expirer"),c_(this,"pairing"),c_(this,"verify"),c_(this,"echoClient"),c_(this,"linkModeSupportedApps"),c_(this,"eventClient"),c_(this,"initialized",!1),c_(this,"logChunkController"),c_(this,"on",(e,t)=>this.events.on(e,t)),c_(this,"once",(e,t)=>this.events.once(e,t)),c_(this,"off",(e,t)=>this.events.off(e,t)),c_(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),c_(this,"dispatchEnvelope",e=>{let{topic:t,message:i,sessionExists:s}=e;if(!t||!i)return;const n={topic:t,message:i,publishedAt:Date.now(),transportType:OC.link_mode};this.relayer.onLinkMessageEvent(n,{sessionExists:s})}),this.projectId=null==e?void 0:e.projectId,this.relayUrl=(null==e?void 0:e.relayUrl)||yC,this.customStoragePrefix=null!=e&&e.customStoragePrefix?":".concat(e.customStoragePrefix):"";const i=(0,v.k)({level:"string"==typeof(null==e?void 0:e.logger)&&e.logger?e.logger:pC,name:dC}),{logger:s,chunkLoggerController:n}=(0,v.A)({opts:i,maxSizeInBytes:null==e?void 0:e.maxLogBlobSizeInBytes,loggerOverride:null==e?void 0:e.logger});this.logChunkController=n,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=(0,v.E)(s,this.name),this.heartbeat=new v.i,this.crypto=new PT(this,this.logger,null==e?void 0:e.keychain),this.history=new LM(this,this.logger),this.expirer=new BM(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new v.j(a_(a_({},gC),null==e?void 0:e.storageOptions)),this.relayer=new fM({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new jM(this,this.logger),this.verify=new KM(this,this.logger,this.storage),this.echoClient=new GM(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new t_(this,this.logger,null==e?void 0:e.telemetryEnabled)}static async init(t){const i=new e(t);await i.initialize();const s=await i.crypto.getClientId();return await i.storage.setItem("WALLETCONNECT_CLIENT_ID",s),i}get context(){return(0,v.y)(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(DC,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(DC)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn("Core Initialization Failure at epoch ".concat(Date.now()),e),this.logger.error(e.message),e}}},h_="client",d_="".concat("wc","@").concat(2,":").concat(h_,":"),u_=h_,p_="error",g_="WALLETCONNECT_DEEPLINK_CHOICE",f_="Proposal expired",w_=v.c.SEVEN_DAYS,m_={wc_sessionPropose:{req:{ttl:v.c.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1104},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1106},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:v.c.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:v.c.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1112},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:v.c.ONE_DAY,prompt:!1,tag:1114},res:{ttl:v.c.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:v.c.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:v.c.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:v.c.FIVE_MINUTES,prompt:!1,tag:1119}}},y_={min:v.c.FIVE_MINUTES,max:v.c.SEVEN_DAYS},v_="IDLE",b_="ACTIVE",I_={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"}},E_=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],N_="".concat("wc","@",1.5,":").concat("auth",":"),A_="".concat(N_,":PUB_KEY");var C_=Object.defineProperty,S_=Object.defineProperties,P_=Object.getOwnPropertyDescriptors,T_=Object.getOwnPropertySymbols,M_=Object.prototype.hasOwnProperty,__=Object.prototype.propertyIsEnumerable,O_=(e,t,i)=>t in e?C_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,x_=(e,t)=>{for(var i in t||(t={}))M_.call(t,i)&&O_(e,i,t[i]);if(T_)for(var i of T_(t))__.call(t,i)&&O_(e,i,t[i]);return e},k_=(e,t)=>S_(e,P_(t)),D_=(e,t,i)=>O_(e,"symbol"!=typeof t?t+"":t,i);class j_ extends Iv{constructor(e){var t;super(e),t=this,D_(this,"name","engine"),D_(this,"events",new g.E),D_(this,"initialized",!1),D_(this,"requestQueue",{state:v_,queue:[]}),D_(this,"sessionRequestQueue",{state:v_,queue:[]}),D_(this,"requestQueueDelay",v.c.ONE_SECOND),D_(this,"expectedPairingMethodMap",new Map),D_(this,"recentlyDeletedMap",new Map),D_(this,"recentlyDeletedLimit",200),D_(this,"relayMessageCache",[]),D_(this,"pendingSessions",new Map),D_(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(m_)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},v.c.toMiliseconds(this.requestQueueDelay)))}),D_(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const t=k_(x_({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(t);const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:r,scopedProperties:o,relays:a}=t;let c,l=i,h=!1;try{if(l){const e=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),h=e.active}}catch(I){throw this.client.logger.error("connect() -> pairing.get(".concat(l,") failed")),I}if(!l||!h){const{topic:e,uri:t}=await this.client.core.pairing.create();l=e,c=t}if(!l){const{message:e}=BA("NO_MATCHING_KEY","connect() pairing topic: ".concat(l));throw new Error(e)}const d=await this.client.core.crypto.generateKeyPair(),u=m_.wc_sessionPropose.req.ttl||v.c.FIVE_MINUTES,p=DI(u),g=k_(x_(x_({requiredNamespaces:s,optionalNamespaces:n,relays:null!==a&&void 0!==a?a:[{protocol:"irn"}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:l},r&&{sessionProperties:r}),o&&{scopedProperties:o}),{id:(0,v.F)()}),f=RI("session_connect",g.id),{reject:w,resolve:m,done:y}=_I(u,f_),b=e=>{let{id:t}=e;t===g.id&&(this.client.events.off("proposal_expire",b),this.pendingSessions.delete(g.id),this.events.emit(f,{error:{message:f_,code:0}}))};return this.client.events.on("proposal_expire",b),this.events.once(f,e=>{let{error:t,session:i}=e;this.client.events.off("proposal_expire",b),t?w(t):i&&m(i)}),await this.sendRequest({topic:l,method:"wc_sessionPropose",params:g,throwOnFailedPublish:!0,clientRpcId:g.id}),await this.setProposal(g.id,g),{uri:c,approval:y}}),D_(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(t){throw this.client.logger.error("pair() failed"),t}}),D_(this,"approve",async e=>{var t,i,s;const n=this.client.core.eventClient.createEvent({properties:{topic:null==(t=null==e?void 0:e.id)?void 0:t.toString(),trace:[yS]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(N){throw n.setError(PS),N}try{await this.isValidProposalId(null==e?void 0:e.id)}catch(N){throw this.client.logger.error("approve() -> proposal.get(".concat(null==e?void 0:e.id,") failed")),n.setError(kS),N}try{await this.isValidApprove(e)}catch(N){throw this.client.logger.error("approve() -> isValidApprove() failed"),n.setError(xS),N}const{id:r,relayProtocol:o,namespaces:a,sessionProperties:c,scopedProperties:l,sessionConfig:h}=e,d=this.client.proposal.get(r);this.client.core.eventClient.deleteEvent({eventId:n.eventId});const{pairingTopic:u,proposer:p,requiredNamespaces:g,optionalNamespaces:f}=d;let w=null==(i=this.client.core.eventClient)?void 0:i.getEvent({topic:u});w||(w=null==(s=this.client.core.eventClient)?void 0:s.createEvent({type:yS,properties:{topic:u,trace:[yS,vS]}}));const m=await this.client.core.crypto.generateKeyPair(),y=p.publicKey,v=await this.client.core.crypto.generateSharedKey(m,y),b=x_(x_(x_({relay:{protocol:null!==o&&void 0!==o?o:"irn"},namespaces:a,controller:{publicKey:m,metadata:this.client.metadata},expiry:DI(w_)},c&&{sessionProperties:c}),l&&{scopedProperties:l}),h&&{sessionConfig:h}),I=OC.relay;w.addTrace(bS);try{await this.client.core.relayer.subscribe(v,{transportType:I})}catch(N){throw w.setError(MS),N}w.addTrace(IS);const E=k_(x_({},b),{topic:v,requiredNamespaces:g,optionalNamespaces:f,pairingTopic:u,acknowledged:!1,self:b.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:m,transportType:OC.relay});await this.client.session.set(v,E),w.addTrace(AS);try{w.addTrace(CS),await this.sendRequest({topic:v,method:"wc_sessionSettle",params:b,throwOnFailedPublish:!0}).catch(e=>{throw null==w||w.setError(OS),e}),w.addTrace(SS),w.addTrace(ES),await this.sendResult({id:r,topic:u,result:{relay:{protocol:null!==o&&void 0!==o?o:"irn"},responderPublicKey:m},throwOnFailedPublish:!0}).catch(e=>{throw null==w||w.setError(_S),e}),w.addTrace(NS)}catch(N){throw this.client.logger.error(N),this.client.session.delete(v,VA("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(v),N}return this.client.core.eventClient.deleteEvent({eventId:w.eventId}),await this.client.core.pairing.updateMetadata({topic:u,metadata:p.metadata}),await this.client.proposal.delete(r,VA("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:u}),await this.setExpiry(v,DI(w_)),{topic:v,acknowledged:()=>Promise.resolve(this.client.session.get(v))}}),D_(this,"reject",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(n){throw this.client.logger.error("reject() -> isValidReject() failed"),n}const{id:t,reason:i}=e;let s;try{s=this.client.proposal.get(t).pairingTopic}catch(n){throw this.client.logger.error("reject() -> proposal.get(".concat(t,") failed")),n}s&&(await this.sendError({id:t,topic:s,error:i,rpcOpts:m_.wc_sessionPropose.reject}),await this.client.proposal.delete(t,VA("USER_DISCONNECTED")))}),D_(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(l){throw this.client.logger.error("update() -> isValidUpdate() failed"),l}const{topic:t,namespaces:i}=e,{done:s,resolve:n,reject:r}=_I(),o=(0,v.F)(),a=(0,v.x)().toString(),c=this.client.session.get(t).namespaces;return this.events.once(RI("session_update",o),e=>{let{error:t}=e;t?r(t):n()}),await this.client.session.update(t,{namespaces:i}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:o,relayRpcId:a}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:c}),r(e)}),{acknowledged:s}}),D_(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(o){throw this.client.logger.error("extend() -> isValidExtend() failed"),o}const{topic:t}=e,i=(0,v.F)(),{done:s,resolve:n,reject:r}=_I();return this.events.once(RI("session_extend",i),e=>{let{error:t}=e;t?r(t):n()}),await this.setExpiry(t,DI(w_)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(e=>{r(e)}),{acknowledged:s}}),D_(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(f){throw this.client.logger.error("request() -> isValidRequest() failed"),f}const{chainId:t,request:i,topic:s,expiry:n=m_.wc_sessionRequest.req.ttl}=e,r=this.client.session.get(s);(null==r?void 0:r.transportType)===OC.relay&&await this.confirmOnlineStateOrThrow();const o=(0,v.F)(),a=(0,v.x)().toString(),{done:c,resolve:l,reject:h}=_I(n,"Request expired. Please try again.");this.events.once(RI("session_request",o),e=>{let{error:t,result:i}=e;t?h(t):l(i)});const d="wc_sessionRequest",u=this.getAppLinkIfEnabled(r.peer.metadata,r.transportType);if(u)return await this.sendRequest({clientRpcId:o,relayRpcId:a,topic:s,method:d,params:{request:k_(x_({},i),{expiryTimestamp:DI(n)}),chainId:t},expiry:n,throwOnFailedPublish:!0,appLink:u}).catch(e=>h(e)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:t,id:o}),await c();const p={request:k_(x_({},i),{expiryTimestamp:DI(n)}),chainId:t},g=this.shouldSetTVF(d,p);return await Promise.all([new Promise(async e=>{await this.sendRequest(x_({clientRpcId:o,relayRpcId:a,topic:s,method:d,params:p,expiry:n,throwOnFailedPublish:!0},g&&{tvf:this.getTVFParams(o,p)})).catch(e=>h(e)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:t,id:o}),e()}),new Promise(async e=>{var i;if(null==(i=r.sessionConfig)||!i.disableDeepLink){const e=await async function(e,i){let s="";try{if(II()&&(s=localStorage.getItem(i),s))return s;s=await e.getItem(i)}catch(t){console.error(t)}return s}(this.client.core.storage,g_);await LI({id:o,topic:s,wcDeepLink:e})}e()}),c()]).then(e=>e[2])}),D_(this,"respond",async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:t,response:i}=e,{id:s}=i,n=this.client.session.get(t);n.transportType===OC.relay&&await this.confirmOnlineStateOrThrow();const r=this.getAppLinkIfEnabled(n.peer.metadata,n.transportType);(0,v.B)(i)?await this.sendResult({id:s,topic:t,result:i.result,throwOnFailedPublish:!0,appLink:r}):(0,v.D)(i)&&await this.sendError({id:s,topic:t,error:i.error,appLink:r}),this.cleanupAfterResponse(e)}),D_(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:t}=e;if(this.client.session.keys.includes(t)){const e=(0,v.F)(),i=(0,v.x)().toString(),{done:s,resolve:n,reject:r}=_I();this.events.once(RI("session_ping",e),e=>{let{error:t}=e;t?r(t):n()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:i}),s()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),D_(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);const{topic:t,event:i,chainId:s}=e,n=(0,v.x)().toString(),r=(0,v.F)();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:n,clientRpcId:r})}),D_(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);const{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:VA("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else{if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:e}=BA("MISMATCHED_TOPIC","Session or pairing topic not found: ".concat(t));throw new Error(e)}await this.client.core.pairing.disconnect({topic:t})}}),D_(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>function(e,t){const{requiredNamespaces:i}=t,s=Object.keys(e.namespaces),n=Object.keys(i);let r=!0;return!!PI(n,s)&&(s.forEach(t=>{const{accounts:s,methods:n,events:o}=e.namespaces[t],a=jA(s),c=i[t];(!PI(pI(t,c),a)||!PI(c.methods,n)||!PI(c.events,o))&&(r=!1)}),r)}(t,e)))),D_(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),D_(this,"authenticate",async(e,t)=>{var i;this.isInitialized(),this.isValidAuthenticate(e);const s=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(i=this.client.metadata.redirect)?void 0:i.linkMode),n=s?OC.link_mode:OC.relay;n===OC.relay&&await this.confirmOnlineStateOrThrow();const{chains:r,statement:o="",uri:a,domain:c,nonce:l,type:h,exp:d,nbf:u,methods:p=[],expiry:g}=e,f=[...e.resources||[]],{topic:w,uri:m}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:n});this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:m}});const y=await this.client.core.crypto.generateKeyPair(),b=yA(y);if(await Promise.all([this.client.auth.authKeys.set(A_,{responseTopic:b,publicKey:y}),this.client.auth.pairingTopics.set(b,{topic:b,pairingTopic:w})]),await this.client.core.relayer.subscribe(b,{transportType:n}),this.client.logger.info("sending request to new pairing topic: ".concat(w)),p.length>0){const{namespace:e}=uI(r[0]);let t=VE(e,"request",p);FE(f)&&(t=HE(t,f.pop())),f.push(t)}const I=g&&g>m_.wc_sessionAuthenticate.req.ttl?g:m_.wc_sessionAuthenticate.req.ttl,E={authPayload:{type:null!==h&&void 0!==h?h:"caip122",chains:r,statement:o,aud:a,domain:c,version:"1",nonce:l,iat:(new Date).toISOString(),exp:d,nbf:u,resources:f},requester:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:DI(I)},N={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:r,methods:[...new Set(["personal_sign",...p])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:w,proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:DI(m_.wc_sessionPropose.req.ttl),id:(0,v.F)()},{done:A,resolve:C,reject:S}=_I(I,"Request expired"),P=(0,v.F)(),T=RI("session_connect",N.id),M=RI("session_request",P),_=async e=>{let{error:t,session:i}=e;this.events.off(M,O),t?S(t):i&&C({session:i})},O=async e=>{var i,s,r;if(await this.deletePendingAuthRequest(P,{message:"fulfilled",code:0}),e.error){const t=VA("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(T,_),S(e.error.message))}await this.deleteProposal(N.id),this.events.off(T,_);const{cacaos:o,responder:a}=e.result,c=[],l=[];for(const t of o){await RE({cacao:t,projectId:this.client.core.projectId})||(this.client.logger.error(t,"Signature verification failed"),S(VA("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:e}=t,i=FE(e.resources),s=[DE(e.iss)],n=jE(e.iss);if(i){const e=KE(i),t=WE(i);c.push(...e),s.push(...t)}for(const t of s)l.push("".concat(t,":").concat(n))}const h=await this.client.core.crypto.generateSharedKey(y,a.publicKey);let d;c.length>0&&(d={topic:h,acknowledged:!0,self:{publicKey:y,metadata:this.client.metadata},peer:a,controller:a.publicKey,expiry:DI(w_),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:w,namespaces:LA([...new Set(c)],[...new Set(l)]),transportType:n},await this.client.core.relayer.subscribe(h,{transportType:n}),await this.client.session.set(h,d),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:a.metadata}),d=this.client.session.get(h)),null!=(i=this.client.metadata.redirect)&&i.linkMode&&null!=(s=a.metadata.redirect)&&s.linkMode&&null!=(r=a.metadata.redirect)&&r.universal&&t&&(this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.session.update(h,{transportType:OC.link_mode})),C({auths:o,session:d})};let x;this.events.once(T,_),this.events.once(M,O);try{if(s){const e=(0,v.l)("wc_sessionAuthenticate",E,P);this.client.core.history.set(w,e);const i=await this.client.core.crypto.encode("",e,{type:2,encoding:fA});x=DA(t,w,i)}else await Promise.all([this.sendRequest({topic:w,method:"wc_sessionAuthenticate",params:E,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:P}),this.sendRequest({topic:w,method:"wc_sessionPropose",params:N,expiry:m_.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:N.id})])}catch(k){throw this.events.off(T,_),this.events.off(M,O),k}return await this.setProposal(N.id,N),await this.setAuthRequest(P,{request:k_(x_({},E),{verifyContext:{}}),pairingTopic:w,transportType:n}),{uri:null!==x&&void 0!==x?x:m,response:A}}),D_(this,"approveSessionAuthenticate",async e=>{const{id:t,auths:i}=e,s=this.client.core.eventClient.createEvent({properties:{topic:t.toString(),trace:[DS]}});try{this.isInitialized()}catch(g){throw s.setError(BS),g}const n=this.getPendingAuthRequest(t);if(!n)throw s.setError(WS),new Error("Could not find pending auth request with id ".concat(t));const r=n.transportType||OC.relay;r===OC.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=yA(o),l={type:1,receiverPublicKey:o,senderPublicKey:a},h=[],d=[];for(const f of i){if(!await RE({cacao:f,projectId:this.client.core.projectId})){s.setError(VS);const e=VA("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:t,topic:c,error:e,encodeOpts:l}),new Error(e.message)}s.addTrace(RS);const{p:e}=f,i=FE(e.resources),n=[DE(e.iss)],r=jE(e.iss);if(i){const e=KE(i),t=WE(i);h.push(...e),n.push(...t)}for(const t of n)d.push("".concat(t,":").concat(r))}const u=await this.client.core.crypto.generateSharedKey(a,o);let p;if(s.addTrace(jS),(null==h?void 0:h.length)>0){p={topic:u,acknowledged:!0,self:{publicKey:a,metadata:this.client.metadata},peer:{publicKey:o,metadata:n.requester.metadata},controller:o,expiry:DI(w_),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:n.pairingTopic,namespaces:LA([...new Set(h)],[...new Set(d)]),transportType:r},s.addTrace(LS);try{await this.client.core.relayer.subscribe(u,{transportType:r})}catch(g){throw s.setError(HS),g}s.addTrace(zS),await this.client.session.set(u,p),s.addTrace(US),await this.client.core.pairing.updateMetadata({topic:n.pairingTopic,metadata:n.requester.metadata})}s.addTrace(qS);try{await this.sendResult({topic:c,id:t,result:{cacaos:i,responder:{publicKey:a,metadata:this.client.metadata}},encodeOpts:l,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(n.requester.metadata,r)})}catch(g){throw s.setError(KS),g}return await this.client.auth.requests.delete(t,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:n.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:p}}),D_(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();const{id:t,reason:i}=e,s=this.getPendingAuthRequest(t);if(!s)throw new Error("Could not find pending auth request with id ".concat(t));s.transportType===OC.relay&&await this.confirmOnlineStateOrThrow();const n=s.requester.publicKey,r=await this.client.core.crypto.generateKeyPair(),o=yA(n),a={type:1,receiverPublicKey:n,senderPublicKey:r};await this.sendError({id:t,topic:o,error:i,encodeOpts:a,rpcOpts:m_.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.client.proposal.delete(t,VA("USER_DISCONNECTED"))}),D_(this,"formatAuthMessage",e=>{this.isInitialized();const{request:t,iss:i}=e;return UE(t,i)}),D_(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{const e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),D_(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{const t=this.client.core.pairing.pairings.get(e.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(i=>{var s,n;return(null==(s=i.peerMetadata)?void 0:s.url)&&(null==(n=i.peerMetadata)?void 0:n.url)===e.peer.metadata.url&&i.topic&&i.topic!==t.topic});if(0===i.length)return;this.client.logger.info("Cleaning up ".concat(i.length," duplicate pairing(s)")),await Promise.all(i.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(t){this.client.logger.error(t)}}),D_(this,"deleteSession",async e=>{var t;const{topic:i,expirerHasDeleted:s=!1,emitEvent:n=!0,id:r=0}=e,{self:o}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,VA("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(g_).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===i&&this.deletePendingSessionRequest(e.id,VA("USER_DISCONNECTED"))}),i===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=v_),n&&this.client.events.emit("session_delete",{id:r,topic:i})}),D_(this,"deleteProposal",async(e,t)=>{if(t)try{const t=this.client.proposal.get(e),i=this.client.core.eventClient.getEvent({topic:t.pairingTopic});null==i||i.setError(TS)}catch(i){}await Promise.all([this.client.proposal.delete(e,VA("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),D_(this,"deletePendingSessionRequest",async function(e,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];await Promise.all([t.client.pendingRequest.delete(e,i),s?Promise.resolve():t.client.core.expirer.del(e)]),t.addToRecentlyDeleted(e,"request"),t.sessionRequestQueue.queue=t.sessionRequestQueue.queue.filter(t=>t.id!==e),s&&(t.sessionRequestQueue.state=v_,t.client.events.emit("session_request_expire",{id:e}))}),D_(this,"deletePendingAuthRequest",async function(e,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];await Promise.all([t.client.auth.requests.delete(e,i),s?Promise.resolve():t.client.core.expirer.del(e)])}),D_(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),D_(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,DI(m_.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),D_(this,"setAuthRequest",async(e,t)=>{const{request:i,pairingTopic:s,transportType:n=OC.relay}=t;this.client.core.expirer.set(e,i.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:e,pairingTopic:s,verifyContext:i.verifyContext,transportType:n})}),D_(this,"setPendingSessionRequest",async e=>{const{id:t,topic:i,params:s,verifyContext:n}=e,r=s.request.expiryTimestamp||DI(m_.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,r),await this.client.pendingRequest.set(t,{id:t,topic:i,params:s,verifyContext:n})}),D_(this,"sendRequest",async e=>{const{topic:t,method:i,params:s,expiry:n,relayRpcId:r,clientRpcId:o,throwOnFailedPublish:a,appLink:c,tvf:l}=e,h=(0,v.l)(i,s,o);let d;const u=!!c;try{const e=u?fA:gA;d=await this.client.core.crypto.encode(t,h,{encoding:e})}catch(w){throw await this.cleanup(),this.client.logger.error("sendRequest() -> core.crypto.encode() for topic ".concat(t," failed")),w}let g;if(E_.includes(i)){const e=vA(JSON.stringify(h)),t=vA(d);g=await this.client.core.verify.register({id:t,decryptedId:e})}const f=m_[i].req;if(f.attestation=g,n&&(f.ttl=n),r&&(f.id=r),this.client.core.history.set(t,h),u){const e=DA(c,t,d);await p.d.global.Linking.openURL(e,this.client.name)}else{const e=m_[i].req;n&&(e.ttl=n),r&&(e.id=r),e.tvf=k_(x_({},l),{correlationId:h.id}),a?(e.internal=k_(x_({},e.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(t,d,e)):this.client.core.relayer.publish(t,d,e).catch(e=>this.client.logger.error(e))}return h.id}),D_(this,"sendResult",async e=>{const{id:t,topic:i,result:s,throwOnFailedPublish:n,encodeOpts:r,appLink:o}=e,a=(0,v.q)(t,s);let c;const l=o&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u";try{const e=l?fA:gA;c=await this.client.core.crypto.encode(i,a,k_(x_({},r||{}),{encoding:e}))}catch(u){throw await this.cleanup(),this.client.logger.error("sendResult() -> core.crypto.encode() for topic ".concat(i," failed")),u}let h,d;try{h=await this.client.core.history.get(i,t);const e=h.request;try{this.shouldSetTVF(e.method,e.params)&&(d=this.getTVFParams(t,e.params,s))}catch(g){this.client.logger.warn("sendResult() -> getTVFParams() failed",g)}}catch(u){throw this.client.logger.error("sendResult() -> history.get(".concat(i,", ").concat(t,") failed")),u}if(l){const e=DA(o,i,c);await p.d.global.Linking.openURL(e,this.client.name)}else{const e=h.request.method,s=m_[e].res;s.tvf=k_(x_({},d),{correlationId:t}),n?(s.internal=k_(x_({},s.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,c,s)):this.client.core.relayer.publish(i,c,s).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(a)}),D_(this,"sendError",async e=>{const{id:t,topic:i,error:s,encodeOpts:n,rpcOpts:r,appLink:o}=e,a=(0,v.z)(t,s);let c;const l=o&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u";try{const e=l?fA:gA;c=await this.client.core.crypto.encode(i,a,k_(x_({},n||{}),{encoding:e}))}catch(d){throw await this.cleanup(),this.client.logger.error("sendError() -> core.crypto.encode() for topic ".concat(i," failed")),d}let h;try{h=await this.client.core.history.get(i,t)}catch(d){throw this.client.logger.error("sendError() -> history.get(".concat(i,", ").concat(t,") failed")),d}if(l){const e=DA(o,i,c);await p.d.global.Linking.openURL(e,this.client.name)}else{const e=h.request.method,t=r||m_[e].res;this.client.core.relayer.publish(i,c,t)}await this.client.core.history.resolve(a)}),D_(this,"cleanup",async()=>{const e=[],t=[];this.client.session.getAll().forEach(t=>{let i=!1;jI(t.expiry)&&(i=!0),this.client.core.crypto.keychain.has(t.topic)||(i=!0),i&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{jI(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),D_(this,"onProviderMessageEvent",async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),D_(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),D_(this,"processRequestsQueue",async()=>{if(this.requestQueue.state!==b_){for(this.client.logger.info("Request queue starting with ".concat(this.requestQueue.queue.length," requests"));this.requestQueue.queue.length>0;){this.requestQueue.state=b_;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=v_}else this.client.logger.info("Request queue already active, skipping...")}),D_(this,"processRequest",async e=>{const{topic:t,payload:i,attestation:s,transportType:n,encryptedId:r}=e,o=i.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:o}))switch(o){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:i,attestation:s,encryptedId:r});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,i);case"wc_sessionPing":return await this.onSessionPingRequest(t,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:i,attestation:s,encryptedId:r,transportType:n});case"wc_sessionEvent":return await this.onSessionEventRequest(t,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:i,attestation:s,encryptedId:r,transportType:n});default:return this.client.logger.info("Unsupported request method ".concat(o))}}),D_(this,"onRelayEventResponse",async e=>{const{topic:t,payload:i,transportType:s}=e,n=(await this.client.core.history.get(t,i.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(t,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(t,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,i);case"wc_sessionExtend":return this.onSessionExtendResponse(t,i);case"wc_sessionPing":return this.onSessionPingResponse(t,i);case"wc_sessionRequest":return this.onSessionRequestResponse(t,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,i);default:return this.client.logger.info("Unsupported response method ".concat(n))}}),D_(this,"onRelayEventUnknownPayload",e=>{const{topic:t}=e,{message:i}=BA("MISSING_OR_INVALID","Decoded payload on topic ".concat(t," is not identifiable as a JSON-RPC request or a response."));throw new Error(i)}),D_(this,"shouldIgnorePairingRequest",e=>{const{topic:t,requestMethod:i}=e,s=this.expectedPairingMethodMap.get(t);return!(!s||s.includes(i))&&!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),D_(this,"onSessionProposeRequest",async e=>{const{topic:t,payload:i,attestation:s,encryptedId:n}=e,{params:r,id:o}=i;try{const e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),null==e||e.setError(mS)),this.isValidConnect(x_({},i.params));const a=r.expiryTimestamp||DI(m_.wc_sessionPropose.req.ttl),c=x_({id:o,pairingTopic:t,expiryTimestamp:a},r);await this.setProposal(o,c);const l=await this.getVerifyContext({attestationId:s,hash:vA(JSON.stringify(i)),encryptedId:n,metadata:c.proposer.metadata});null==e||e.addTrace(dS),this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:l})}catch(a){await this.sendError({id:o,topic:t,error:a,rpcOpts:m_.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),D_(this,"onSessionProposeResponse",async(e,t,i)=>{const{id:s}=t;if((0,v.B)(t)){const{result:n}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});const r=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:r});const o=r.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:o});const a=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:a});const c=await this.client.core.crypto.generateSharedKey(o,a);this.pendingSessions.set(s,{sessionTopic:c,pairingTopic:e,proposalId:s,publicKey:o});const l=await this.client.core.relayer.subscribe(c,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:l}),await this.client.core.pairing.activate({topic:e})}else if((0,v.D)(t)){await this.client.proposal.delete(s,VA("USER_DISCONNECTED"));const e=RI("session_connect",s);if(0===this.events.listenerCount(e))throw new Error("emitting ".concat(e," without any listeners, 954"));this.events.emit(e,{error:t.error})}}),D_(this,"onSessionSettleRequest",async(e,t)=>{const{id:i,params:s}=t;try{this.isValidSessionSettleRequest(s);const{relay:i,controller:n,expiry:r,namespaces:o,sessionProperties:a,scopedProperties:c,sessionConfig:l}=t.params,h=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!h)return this.client.logger.error("Pending session not found for topic ".concat(e));const d=this.client.proposal.get(h.proposalId),u=k_(x_(x_(x_({topic:e,relay:i,expiry:r,namespaces:o,acknowledged:!0,pairingTopic:h.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:n.publicKey,self:{publicKey:h.publicKey,metadata:this.client.metadata},peer:{publicKey:n.publicKey,metadata:n.metadata}},a&&{sessionProperties:a}),c&&{scopedProperties:c}),l&&{sessionConfig:l}),{transportType:OC.relay});await this.client.session.set(u.topic,u),await this.setExpiry(u.topic,u.expiry),await this.client.core.pairing.updateMetadata({topic:h.pairingTopic,metadata:u.peer.metadata}),this.client.events.emit("session_connect",{session:u}),this.events.emit(RI("session_connect",h.proposalId),{session:u}),this.pendingSessions.delete(h.proposalId),this.deleteProposal(h.proposalId,!1),this.cleanupDuplicatePairings(u),await this.sendResult({id:t.id,topic:e,result:!0,throwOnFailedPublish:!0})}catch(n){await this.sendError({id:i,topic:e,error:n}),this.client.logger.error(n)}}),D_(this,"onSessionSettleResponse",async(e,t)=>{const{id:i}=t;(0,v.B)(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(RI("session_approve",i),{})):(0,v.D)(t)&&(await this.client.session.delete(e,VA("USER_DISCONNECTED")),this.events.emit(RI("session_approve",i),{error:t.error}))}),D_(this,"onSessionUpdateRequest",async(e,t)=>{const{params:i,id:s}=t;try{const t="".concat(e,"_session_update"),r=hC.get(t);if(r&&this.isRequestOutOfSync(r,s))return this.client.logger.warn("Discarding out of sync request - ".concat(s)),void this.sendError({id:s,topic:e,error:VA("INVALID_UPDATE_REQUEST")});this.isValidUpdate(x_({topic:e},i));try{hC.set(t,s),await this.client.session.update(e,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:e,result:!0,throwOnFailedPublish:!0})}catch(n){throw hC.delete(t),n}this.client.events.emit("session_update",{id:s,topic:e,params:i})}catch(r){await this.sendError({id:s,topic:e,error:r}),this.client.logger.error(r)}}),D_(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),D_(this,"onSessionUpdateResponse",(e,t)=>{const{id:i}=t,s=RI("session_update",i);if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners"));(0,v.B)(t)?this.events.emit(RI("session_update",i),{}):(0,v.D)(t)&&this.events.emit(RI("session_update",i),{error:t.error})}),D_(this,"onSessionExtendRequest",async(e,t)=>{const{id:i}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,DI(w_)),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:i,topic:e})}catch(s){await this.sendError({id:i,topic:e,error:s}),this.client.logger.error(s)}}),D_(this,"onSessionExtendResponse",(e,t)=>{const{id:i}=t,s=RI("session_extend",i);if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners"));(0,v.B)(t)?this.events.emit(RI("session_extend",i),{}):(0,v.D)(t)&&this.events.emit(RI("session_extend",i),{error:t.error})}),D_(this,"onSessionPingRequest",async(e,t)=>{const{id:i}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:e})}catch(s){await this.sendError({id:i,topic:e,error:s}),this.client.logger.error(s)}}),D_(this,"onSessionPingResponse",(e,t)=>{const{id:i}=t,s=RI("session_ping",i);setTimeout(()=>{if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners 2176"));(0,v.B)(t)?this.events.emit(RI("session_ping",i),{}):(0,v.D)(t)&&this.events.emit(RI("session_ping",i),{error:t.error})},500)}),D_(this,"onSessionDeleteRequest",async(e,t)=>{const{id:i}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),Promise.all([new Promise(t=>{this.client.core.relayer.once(CC,async()=>{t(await this.deleteSession({topic:e,id:i}))})}),this.sendResult({id:i,topic:e,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:VA("USER_DISCONNECTED")})]).catch(e=>this.client.logger.error(e))}catch(s){this.client.logger.error(s)}}),D_(this,"onSessionRequest",async e=>{var t,i,s;const{topic:n,payload:r,attestation:o,encryptedId:a,transportType:c}=e,{id:l,params:h}=r;try{await this.isValidRequest(x_({topic:n},h));const e=this.client.session.get(n),r={id:l,topic:n,params:h,verifyContext:await this.getVerifyContext({attestationId:o,hash:vA(JSON.stringify((0,v.l)("wc_sessionRequest",h,l))),encryptedId:a,metadata:e.peer.metadata,transportType:c})};await this.setPendingSessionRequest(r),c===OC.link_mode&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(i=e.peer.metadata.redirect)?void 0:i.universal),null!=(s=this.client.signConfig)&&s.disableRequestQueue?this.emitSessionRequest(r):(this.addSessionRequestToSessionRequestQueue(r),this.processSessionRequestQueue())}catch(d){await this.sendError({id:l,topic:n,error:d}),this.client.logger.error(d)}}),D_(this,"onSessionRequestResponse",(e,t)=>{const{id:i}=t,s=RI("session_request",i);if(0===this.events.listenerCount(s))throw new Error("emitting ".concat(s," without any listeners"));(0,v.B)(t)?this.events.emit(RI("session_request",i),{result:t.result}):(0,v.D)(t)&&this.events.emit(RI("session_request",i),{error:t.error})}),D_(this,"onSessionEventRequest",async(e,t)=>{const{id:i,params:s}=t;try{const t="".concat(e,"_session_event_").concat(s.event.name),n=hC.get(t);if(n&&this.isRequestOutOfSync(n,i))return void this.client.logger.info("Discarding out of sync request - ".concat(i));this.isValidEmit(x_({topic:e},s)),this.client.events.emit("session_event",{id:i,topic:e,params:s}),hC.set(t,i)}catch(n){await this.sendError({id:i,topic:e,error:n}),this.client.logger.error(n)}}),D_(this,"onSessionAuthenticateResponse",(e,t)=>{const{id:i}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),(0,v.B)(t)?this.events.emit(RI("session_request",i),{result:t.result}):(0,v.D)(t)&&this.events.emit(RI("session_request",i),{error:t.error})}),D_(this,"onSessionAuthenticateRequest",async e=>{var t;const{topic:i,payload:s,attestation:n,encryptedId:r,transportType:o}=e;try{const{requester:e,authPayload:a,expiryTimestamp:c}=s.params,l=await this.getVerifyContext({attestationId:n,hash:vA(JSON.stringify(s)),encryptedId:r,metadata:e.metadata,transportType:o}),h={requester:e,pairingTopic:i,id:s.id,authPayload:a,verifyContext:l,expiryTimestamp:c};await this.setAuthRequest(s.id,{request:h,pairingTopic:i,transportType:o}),o===OC.link_mode&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:l})}catch(a){this.client.logger.error(a);const e=s.params.requester.publicKey,t=await this.client.core.crypto.generateKeyPair(),n=this.getAppLinkIfEnabled(s.params.requester.metadata,o),r={type:1,receiverPublicKey:e,senderPublicKey:t};await this.sendError({id:s.id,topic:i,error:a,encodeOpts:r,rpcOpts:m_.wc_sessionAuthenticate.autoReject,appLink:n})}}),D_(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),D_(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=v_,this.processSessionRequestQueue()},v.c.toMiliseconds(this.requestQueueDelay))}),D_(this,"cleanupPendingSentRequestsForTopic",e=>{let{topic:t,error:i}=e;const s=this.client.core.history.pending;s.length>0&&s.filter(e=>e.topic===t&&"wc_sessionRequest"===e.request.method).forEach(e=>{const t=RI("session_request",e.request.id);if(0===this.events.listenerCount(t))throw new Error("emitting ".concat(t," without any listeners"));this.events.emit(RI("session_request",e.request.id),{error:i})})}),D_(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===b_)return void this.client.logger.info("session request queue is already active.");const e=this.sessionRequestQueue.queue[0];if(e)try{this.sessionRequestQueue.state=b_,this.emitSessionRequest(e)}catch(t){this.client.logger.error(t)}else this.client.logger.info("session request queue is empty.")}),D_(this,"emitSessionRequest",e=>{this.client.events.emit("session_request",e)}),D_(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;const t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:(0,v.l)("wc_sessionPropose",k_(x_({},t),{requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties}),t.id)})}),D_(this,"isValidConnect",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","connect() params: ".concat(JSON.stringify(e)));throw new Error(t)}const{pairingTopic:t,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:n,scopedProperties:r,relays:o}=e;if(WA(t)||await this.isValidPairingTopic(t),!function(e){let t=!1;return e?e&&HA(e)&&e.length&&e.forEach(e=>{t=eC(e)}):t=!0,t}(o)){const{message:e}=BA("MISSING_OR_INVALID","connect() relays: ".concat(o));throw new Error(e)}if(!WA(i)&&0!==KA(i)&&this.validateNamespaces(i,"requiredNamespaces"),!WA(s)&&0!==KA(s)&&this.validateNamespaces(s,"optionalNamespaces"),WA(n)||this.validateSessionProps(n,"sessionProperties"),!WA(r)){this.validateSessionProps(r,"scopedProperties");const e=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(r).every(t=>e.includes(t)))throw new Error("Scoped properties must be a subset of required/optional namespaces, received: ".concat(JSON.stringify(r),", required/optional namespaces: ").concat(JSON.stringify(e)))}}),D_(this,"validateNamespaces",(e,t)=>{const i=function(e,t,i){let s=null;if(e&&KA(e)){const n=XA(e,t);n&&(s=n);const r=ZA(e,t,i);r&&(s=r)}else s=BA("MISSING_OR_INVALID","".concat(t,", ").concat(i," should be an object with data"));return s}(e,"connect()",t);if(i)throw new Error(i.message)}),D_(this,"isValidApprove",async e=>{if(!tC(e))throw new Error(BA("MISSING_OR_INVALID","approve() params: ".concat(e)).message);const{id:t,namespaces:i,relayProtocol:s,sessionProperties:n,scopedProperties:r}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);const o=this.client.proposal.get(t),a=$A(i,"approve()");if(a)throw new Error(a.message);const c=rC(o.requiredNamespaces,i,"approve()");if(c)throw new Error(c.message);if(!FA(s,!0)){const{message:e}=BA("MISSING_OR_INVALID","approve() relayProtocol: ".concat(s));throw new Error(e)}if(WA(n)||this.validateSessionProps(n,"sessionProperties"),!WA(r)){this.validateSessionProps(r,"scopedProperties");const e=new Set(Object.keys(i));if(!Object.keys(r).every(t=>e.has(t)))throw new Error("Scoped properties must be a subset of approved namespaces, received: ".concat(JSON.stringify(r),", approved namespaces: ").concat(Array.from(e).join(", ")))}}),D_(this,"isValidReject",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","reject() params: ".concat(e));throw new Error(t)}const{id:t,reason:i}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!function(e){return!(!e||"object"!=typeof e||!e.code||!GA(e.code,!1)||!e.message||!FA(e.message,!1))}(i)){const{message:e}=BA("MISSING_OR_INVALID","reject() reason: ".concat(JSON.stringify(i)));throw new Error(e)}}),D_(this,"isValidSessionSettleRequest",e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","onSessionSettleRequest() params: ".concat(e));throw new Error(t)}const{relay:t,controller:i,namespaces:s,expiry:n}=e;if(!eC(t)){const{message:e}=BA("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(e)}const r=function(e,t){let i=null;return FA(null==e?void 0:e.publicKey,!1)||(i=BA("MISSING_OR_INVALID","".concat(t," controller public key should be a string"))),i}(i,"onSessionSettleRequest()");if(r)throw new Error(r.message);const o=$A(s,"onSessionSettleRequest()");if(o)throw new Error(o.message);if(jI(n)){const{message:e}=BA("EXPIRED","onSessionSettleRequest()");throw new Error(e)}}),D_(this,"isValidUpdate",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","update() params: ".concat(e));throw new Error(t)}const{topic:t,namespaces:i}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const s=this.client.session.get(t),n=$A(i,"update()");if(n)throw new Error(n.message);const r=rC(s.requiredNamespaces,i,"update()");if(r)throw new Error(r.message)}),D_(this,"isValidExtend",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","extend() params: ".concat(e));throw new Error(t)}const{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),D_(this,"isValidRequest",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","request() params: ".concat(e));throw new Error(t)}const{topic:t,request:i,chainId:s,expiry:n}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);const{namespaces:r}=this.client.session.get(t);if(!iC(r,s)){const{message:e}=BA("MISSING_OR_INVALID","request() chainId: ".concat(s));throw new Error(e)}if(!function(e){return!(WA(e)||!FA(e.method,!1))}(i)){const{message:e}=BA("MISSING_OR_INVALID","request() ".concat(JSON.stringify(i)));throw new Error(e)}if(!sC(r,s,i.method)){const{message:e}=BA("MISSING_OR_INVALID","request() method: ".concat(i.method));throw new Error(e)}if(n&&!function(e,t){return GA(e,!1)&&e<=t.max&&e>=t.min}(n,y_)){const{message:e}=BA("MISSING_OR_INVALID","request() expiry: ".concat(n,". Expiry must be a number (in seconds) between ").concat(y_.min," and ").concat(y_.max));throw new Error(e)}}),D_(this,"isValidRespond",async e=>{var t;if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","respond() params: ".concat(e));throw new Error(t)}const{topic:i,response:s}=e;try{await this.isValidSessionTopic(i)}catch(n){throw null!=(t=null==e?void 0:e.response)&&t.id&&this.cleanupAfterResponse(e),n}if(!function(e){return!(WA(e)||WA(e.result)&&WA(e.error)||!GA(e.id,!1)||!FA(e.jsonrpc,!1))}(s)){const{message:e}=BA("MISSING_OR_INVALID","respond() response: ".concat(JSON.stringify(s)));throw new Error(e)}}),D_(this,"isValidPing",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","ping() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),D_(this,"isValidEmit",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","emit() params: ".concat(e));throw new Error(t)}const{topic:t,event:i,chainId:s}=e;await this.isValidSessionTopic(t);const{namespaces:n}=this.client.session.get(t);if(!iC(n,s)){const{message:e}=BA("MISSING_OR_INVALID","emit() chainId: ".concat(s));throw new Error(e)}if(!function(e){return!(WA(e)||!FA(e.name,!1))}(i)){const{message:e}=BA("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(i)));throw new Error(e)}if(!nC(n,s,i.name)){const{message:e}=BA("MISSING_OR_INVALID","emit() event: ".concat(JSON.stringify(i)));throw new Error(e)}}),D_(this,"isValidDisconnect",async e=>{if(!tC(e)){const{message:t}=BA("MISSING_OR_INVALID","disconnect() params: ".concat(e));throw new Error(t)}const{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),D_(this,"isValidAuthenticate",e=>{const{chains:t,uri:i,domain:s,nonce:n}=e;if(!Array.isArray(t)||0===t.length)throw new Error("chains is required and must be a non-empty array");if(!FA(i,!1))throw new Error("uri is required parameter");if(!FA(s,!1))throw new Error("domain is required parameter");if(!FA(n,!1))throw new Error("nonce is required parameter");if([...new Set(t.map(e=>uI(e).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:r}=uI(t[0]);if("eip155"!==r)throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),D_(this,"getVerifyContext",async e=>{const{attestationId:t,hash:i,encryptedId:s,metadata:n,transportType:r}=e,o={verified:{verifyUrl:n.verifyUrl||$C,validation:"UNKNOWN",origin:n.url||""}};try{if(r===OC.link_mode){const e=this.getAppLinkIfEnabled(n,r);return o.verified.validation=e&&new URL(e).origin===new URL(n.url).origin?"VALID":"INVALID",o}const e=await this.client.core.verify.resolve({attestationId:t,hash:i,encryptedId:s,verifyUrl:n.verifyUrl});e&&(o.verified.origin=e.origin,o.verified.isScam=e.isScam,o.verified.validation=e.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug("Verify context: ".concat(JSON.stringify(o))),o}),D_(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach((i,s)=>{if(null==i){const{message:n}=BA("MISSING_OR_INVALID","".concat(t," must contain an existing value for each key. Received: ").concat(i," for key ").concat(Object.keys(e)[s]));throw new Error(n)}})}),D_(this,"getPendingAuthRequest",e=>{const t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),D_(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0;const t=this.recentlyDeletedLimit/2;for(const i of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(i)}}}),D_(this,"checkRecentlyDeleted",e=>{const t=this.recentlyDeletedMap.get(e);if(t){const{message:i}=BA("MISSING_OR_INVALID","Record was recently deleted - ".concat(t,": ").concat(e));throw new Error(i)}}),D_(this,"isLinkModeEnabled",(e,t)=>{var i,s,n,r,o,a,c,l,h;return!(!e||t!==OC.link_mode)&&(!0===(null==(s=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:s.linkMode)&&void 0!==(null==(r=null==(n=this.client.metadata)?void 0:n.redirect)?void 0:r.universal)&&""!==(null==(a=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:a.universal)&&void 0!==(null==(c=null==e?void 0:e.redirect)?void 0:c.universal)&&""!==(null==(l=null==e?void 0:e.redirect)?void 0:l.universal)&&!0===(null==(h=null==e?void 0:e.redirect)?void 0:h.linkMode)&&this.client.core.linkModeSupportedApps.includes(e.redirect.universal)&&typeof(null==p.d.global?void 0:p.d.global.Linking)<"u")}),D_(this,"getAppLinkIfEnabled",(e,t)=>{var i;return this.isLinkModeEnabled(e,t)?null==(i=null==e?void 0:e.redirect)?void 0:i.universal:void 0}),D_(this,"handleLinkModeMessage",e=>{let{url:t}=e;if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const i=zI(t,"topic")||"",s=decodeURIComponent(zI(t,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:OC.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),D_(this,"registerLinkModeListeners",async()=>{var e;if(BI()||bI()&&null!=(e=this.client.metadata.redirect)&&e.linkMode){const e=null==p.d.global?void 0:p.d.global.Linking;if(typeof e<"u"){e.addEventListener("url",this.handleLinkModeMessage,this.client.name);const t=await e.getInitialURL();t&&setTimeout(()=>{this.handleLinkModeMessage({url:t})},50)}}}),D_(this,"shouldSetTVF",(e,t)=>{if(!t||"wc_sessionRequest"!==e)return!1;const{request:i}=t;return Object.keys(I_).includes(i.method)}),D_(this,"getTVFParams",(e,t,i)=>{var s,n;try{const r=t.request.method,o=this.extractTxHashesFromResult(r,i);return k_(x_({correlationId:e,rpcMethods:[r],chainId:t.chainId},this.isValidContractData(t.request.params)&&{contractAddresses:[null==(n=null==(s=t.request.params)?void 0:s[0])?void 0:n.to]}),{txHashes:o})}catch(r){this.client.logger.warn("Error getting TVF params",r)}return{}}),D_(this,"isValidContractData",e=>{var t;if(!e)return!1;try{const i=(null==e?void 0:e.data)||(null==(t=null==e?void 0:e[0])?void 0:t.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return!!/^[0-9a-fA-F]*$/.test(s)&&s.length%2===0}catch(i){}return!1}),D_(this,"extractTxHashesFromResult",(e,t)=>{try{if("string"==typeof t)return[t];const i=t[I_[e].key];if(HA(i))return"solana_signAllTransactions"===e?i.map(e=>function(e){const t=atob(e),i=new Uint8Array(t.length);for(let o=0;o<t.length;o++)i[o]=t.charCodeAt(o);const s=i[0];if(0===s)throw new Error("No signatures found");const n=1+64*s;if(i.length<n)throw new Error("Transaction data too short for claimed signature count");if(i.length<100)throw new Error("Transaction too short");const r=p.d.Buffer.from(e,"base64").slice(1,65);return dI.encode(r)}(e)):i;if("string"==typeof i)return[i]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const t=this.client.session.keys,i=this.client.core.relayer.messages.getWithoutAck(t);for(const[s,n]of Object.entries(i))for(const t of n)try{await this.onProviderMessageEvent({topic:s,message:t,publishedAt:Date.now()})}catch(e){this.client.logger.warn("Error processing pending message event for topic: ".concat(s,", message: ").concat(t))}}catch(t){this.client.logger.warn("processPendingMessageEvents failed",t)}}isInitialized(){if(!this.initialized){const{message:e}=BA("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(vC,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:i,attestation:s,transportType:n}=e,{publicKey:r}=this.client.auth.authKeys.keys.includes(A_)?this.client.auth.authKeys.get(A_):{publicKey:void 0};try{const e=await this.client.core.crypto.decode(t,i,{receiverPublicKey:r,encoding:n===OC.link_mode?fA:gA});(0,v.n)(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:s,transportType:n,encryptedId:vA(i)})):(0,v.p)(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:n}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:n}),await this.client.core.relayer.messages.ack(t,i)}catch(o){this.client.logger.error(o)}}registerExpirerEvents(){this.client.core.expirer.on(ZC,async e=>{const{topic:t,id:i}=kI(e.target);return i&&this.client.pendingRequest.keys.includes(i)?await this.deletePendingSessionRequest(i,BA("EXPIRED"),!0):i&&this.client.auth.requests.keys.includes(i)?await this.deletePendingAuthRequest(i,BA("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i})))})}registerPairingEvents(){this.client.core.pairing.events.on(qC,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(VC,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!FA(e,!1)){const{message:t}=BA("MISSING_OR_INVALID","pairing topic should be a string: ".concat(e));throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=BA("NO_MATCHING_KEY","pairing topic doesn't exist: ".concat(e));throw new Error(t)}if(jI(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=BA("EXPIRED","pairing topic: ".concat(e));throw new Error(t)}}async isValidSessionTopic(e){if(!FA(e,!1)){const{message:t}=BA("MISSING_OR_INVALID","session topic should be a string: ".concat(e));throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=BA("NO_MATCHING_KEY","session topic doesn't exist: ".concat(e));throw new Error(t)}if(jI(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=BA("EXPIRED","session topic: ".concat(e));throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=BA("MISSING_OR_INVALID","session topic does not exist in keychain: ".concat(e));throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else{if(!this.client.core.pairing.pairings.keys.includes(e)){if(FA(e,!1)){const{message:t}=BA("NO_MATCHING_KEY","session or pairing topic doesn't exist: ".concat(e));throw new Error(t)}{const{message:t}=BA("MISSING_OR_INVALID","session or pairing topic should be a string: ".concat(e));throw new Error(t)}}this.isValidPairingTopic(e)}}async isValidProposalId(e){if(!function(e){return"number"==typeof e}(e)){const{message:t}=BA("MISSING_OR_INVALID","proposal id should be a number: ".concat(e));throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=BA("NO_MATCHING_KEY","proposal id doesn't exist: ".concat(e));throw new Error(t)}if(jI(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=BA("EXPIRED","proposal id: ".concat(e));throw new Error(t)}}}class R_ extends xM{constructor(e,t){super(e,t,"proposal",d_),this.core=e,this.logger=t}}let U_=class extends xM{constructor(e,t){super(e,t,"session",d_),this.core=e,this.logger=t}};class L_ extends xM{constructor(e,t){super(e,t,"request",d_,e=>e.id),this.core=e,this.logger=t}}class z_ extends xM{constructor(e,t){super(e,t,"authKeys",N_,()=>A_),this.core=e,this.logger=t}}class q_ extends xM{constructor(e,t){super(e,t,"pairingTopics",N_),this.core=e,this.logger=t}}class B_ extends xM{constructor(e,t){super(e,t,"requests",N_,e=>e.id),this.core=e,this.logger=t}}var V_=Object.defineProperty,H_=(e,t,i)=>((e,t,i)=>t in e?V_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class K_{constructor(e,t){this.core=e,this.logger=t,H_(this,"authKeys"),H_(this,"pairingTopics"),H_(this,"requests"),this.authKeys=new z_(this.core,this.logger),this.pairingTopics=new q_(this.core,this.logger),this.requests=new B_(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var W_=Object.defineProperty,F_=(e,t,i)=>((e,t,i)=>t in e?W_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);let G_=class e extends bv{constructor(e){super(e),F_(this,"protocol","wc"),F_(this,"version",2),F_(this,"name",u_),F_(this,"metadata"),F_(this,"core"),F_(this,"logger"),F_(this,"events",new g.e.EventEmitter),F_(this,"engine"),F_(this,"session"),F_(this,"proposal"),F_(this,"pendingRequest"),F_(this,"auth"),F_(this,"signConfig"),F_(this,"on",(e,t)=>this.events.on(e,t)),F_(this,"once",(e,t)=>this.events.once(e,t)),F_(this,"off",(e,t)=>this.events.off(e,t)),F_(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),F_(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),F_(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"update",async e=>{try{return await this.engine.update(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"request",async e=>{try{return await this.engine.request(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"find",e=>{try{return this.engine.find(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),F_(this,"authenticate",async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(i){throw this.logger.error(i.message),i}}),F_(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}}),F_(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(t){throw this.logger.error(t.message),t}}),this.name=(null==e?void 0:e.name)||u_,this.metadata=(null==e?void 0:e.metadata)||AI(),this.signConfig=null==e?void 0:e.signConfig;const t=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:(0,v.O)((0,v.k)({level:(null==e?void 0:e.logger)||p_}));this.core=(null==e?void 0:e.core)||new l_(e),this.logger=(0,v.E)(t,this.name),this.session=new U_(this.core,this.logger),this.proposal=new R_(this.core,this.logger),this.pendingRequest=new L_(this.core,this.logger),this.engine=new j_(this),this.auth=new K_(this.core,this.logger)}static async init(t){const i=new e(t);return await i.initialize(),i}get context(){return(0,v.y)(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},v.c.toMiliseconds(v.c.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};const Y_="error",Q_="".concat("wc","@2:").concat("universal_provider",":"),Z_="https://rpc.walletconnect.org/v1/",J_="generic",X_="".concat(Z_,"bundler"),$_="default_chain_changed";function eO(){}function tO(e){return null==e||"object"!=typeof e&&"function"!=typeof e}function iO(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function sO(e){return"object"==typeof e&&null!==e}function nO(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function rO(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const oO="[object RegExp]",aO="[object String]",cO="[object Number]",lO="[object Boolean]",hO="[object Arguments]",dO="[object Symbol]",uO="[object Date]",pO="[object Map]",gO="[object Set]",fO="[object Array]",wO="[object ArrayBuffer]",mO="[object Object]",yO="[object DataView]",vO="[object Uint8Array]",bO="[object Uint8ClampedArray]",IO="[object Uint16Array]",EO="[object Uint32Array]",NO="[object Int8Array]",AO="[object Int16Array]",CO="[object Int32Array]",SO="[object Float32Array]",PO="[object Float64Array]";function TO(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const r=null==n?void 0:n(e,t,i,s);if(null!=r)return r;if(tO(e))return e;if(s.has(e))return s.get(e);if(Array.isArray(e)){const t=new Array(e.length);s.set(e,t);for(let r=0;r<e.length;r++)t[r]=TO(e[r],r,i,s,n);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){const t=new Map;s.set(e,t);for(const[r,o]of e)t.set(r,TO(o,r,i,s,n));return t}if(e instanceof Set){const t=new Set;s.set(e,t);for(const r of e)t.add(TO(r,void 0,i,s,n));return t}if(typeof p.d.Buffer<"u"&&p.d.Buffer.isBuffer(e))return e.subarray();if(iO(e)){const t=new(Object.getPrototypeOf(e).constructor)(e.length);s.set(e,t);for(let r=0;r<e.length;r++)t[r]=TO(e[r],r,i,s,n);return t}if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){const t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return s.set(e,t),MO(t,e,i,s,n),t}if(typeof File<"u"&&e instanceof File){const t=new File([e],e.name,{type:e.type});return s.set(e,t),MO(t,e,i,s,n),t}if(e instanceof Blob){const t=new Blob([e],{type:e.type});return s.set(e,t),MO(t,e,i,s,n),t}if(e instanceof Error){const t=new e.constructor;return s.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,MO(t,e,i,s,n),t}if("object"==typeof e&&function(e){switch(rO(e)){case hO:case fO:case wO:case yO:case lO:case uO:case SO:case PO:case NO:case AO:case CO:case pO:case cO:case mO:case oO:case gO:case aO:case dO:case vO:case bO:case IO:case EO:return!0;default:return!1}}(e)){const t=Object.create(Object.getPrototypeOf(e));return s.set(e,t),MO(t,e,i,s,n),t}return e}function MO(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,s=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;const r=[...Object.keys(t),...nO(t)];for(let o=0;o<r.length;o++){const a=r[o],c=Object.getOwnPropertyDescriptor(e,a);(null==c||c.writable)&&(e[a]=TO(t[a],a,i,s,n))}}function _O(e,t){return function(e,t){return TO(e,void 0,e,new Map,t)}(e,(t,i,s,n)=>{if("object"==typeof e)switch(Object.prototype.toString.call(e)){case cO:case aO:case lO:{const t=new e.constructor(null==e?void 0:e.valueOf());return MO(t,e),t}case hO:{const t={};return MO(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}})}function OO(e){return _O(e)}function xO(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===rO(e)}function kO(e){return iO(e)}function DO(e){var t;if("object"!=typeof e||null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){const i=e[Symbol.toStringTag];return!(null==i||null==(t=Object.getOwnPropertyDescriptor(e,Symbol.toStringTag))||!t.writable)&&e.toString()==="[object ".concat(i,"]")}let i=e;for(;null!==Object.getPrototypeOf(i);)i=Object.getPrototypeOf(i);return Object.getPrototypeOf(e)===i}function jO(e,t,i,s){if(tO(e)&&(e=Object(e)),null==t||"object"!=typeof t)return e;if(s.has(t))return function(e){if(tO(e))return e;if(Array.isArray(e)||iO(e)||e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer)return e.slice(0);const t=Object.getPrototypeOf(e),i=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new i(e);if(e instanceof RegExp){const t=new i(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new i(e.buffer.slice(0));if(e instanceof Error){const t=new i(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}if(typeof File<"u"&&e instanceof File)return new i([e],e.name,{type:e.type,lastModified:e.lastModified});if("object"==typeof e){const i=Object.create(t);return Object.assign(i,e)}return e}(s.get(t));if(s.set(t,e),Array.isArray(t)){t=t.slice();for(let e=0;e<t.length;e++){var n;t[e]=null!==(n=t[e])&&void 0!==n?n:void 0}}const r=[...Object.keys(t),...nO(t)];for(let o=0;o<r.length;o++){const n=r[o];let a=t[n],c=e[n];if(xO(a)&&(a=(0,d.A)({},a)),xO(c)&&(c=(0,d.A)({},c)),typeof p.d.Buffer<"u"&&p.d.Buffer.isBuffer(a)&&(a=OO(a)),Array.isArray(a))if("object"==typeof c&&null!=c){const e=[],t=Reflect.ownKeys(c);for(let i=0;i<t.length;i++){const s=t[i];e[s]=c[s]}c=e}else c=[];const l=i(c,a,n,e,t,s);null!=l?e[n]=l:Array.isArray(a)||sO(c)&&sO(a)?e[n]=jO(c,a,i,s):null==c&&DO(a)?e[n]=jO({},a,i,s):null==c&&kO(a)?e[n]=OO(a):(void 0===c||void 0!==a)&&(e[n]=a)}return e}function RO(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];return function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];const n=i.slice(0,-1),r=i[i.length-1];let o=e;for(let a=0;a<n.length;a++)o=jO(o,n[a],r,new Map);return o}(e,...i,eO)}var UO=Object.defineProperty,LO=Object.defineProperties,zO=Object.getOwnPropertyDescriptors,qO=Object.getOwnPropertySymbols,BO=Object.prototype.hasOwnProperty,VO=Object.prototype.propertyIsEnumerable,HO=(e,t,i)=>t in e?UO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,KO=(e,t)=>{for(var i in t||(t={}))BO.call(t,i)&&HO(e,i,t[i]);if(qO)for(var i of qO(t))VO.call(t,i)&&HO(e,i,t[i]);return e},WO=(e,t)=>LO(e,zO(t));function FO(e,t,i){var s;const n=uI(e);return(null==(s=t.rpcMap)?void 0:s[n.reference])||"".concat(Z_,"?chainId=").concat(n.namespace,":").concat(n.reference,"&projectId=").concat(i)}function GO(e){return e.includes(":")?e.split(":")[1]:e}function YO(e){return e.map(e=>"".concat(e.split(":")[0],":").concat(e.split(":")[1]))}function QO(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return RO(ZO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),ZO(e))}function ZO(e){var t,i,s,n;const r={};if(!KA(e))return r;for(const[o,a]of Object.entries(e)){const e=RA(o)?[o]:a.chains,c=a.methods||[],l=a.events||[],h=a.rpcMap||{},d=UA(o);r[d]=WO(KO(KO({},r[d]),a),{chains:UI(e,null==(t=r[d])?void 0:t.chains),methods:UI(c,null==(i=r[d])?void 0:i.methods),events:UI(l,null==(s=r[d])?void 0:s.events),rpcMap:KO(KO({},h),null==(n=r[d])?void 0:n.rpcMap)})}return r}function JO(e){return e.includes(":")?e.split(":")[2]:e}function XO(e){const t={};for(const[i,s]of Object.entries(e)){const e=s.methods||[],n=s.events||[],r=s.accounts||[],o=RA(i)?[i]:s.chains?s.chains:YO(s.accounts);t[i]={chains:o,methods:e,events:n,accounts:r}}return t}function $O(e){return"number"==typeof e?e:e.includes("0x")?parseInt(e,16):(e=e.includes(":")?e.split(":")[1]:e,isNaN(Number(e))?e:Number(e))}const ex={},tx=e=>ex[e],ix=(e,t)=>{ex[e]=t};var sx=Object.defineProperty,nx=(e,t,i)=>((e,t,i)=>t in e?sx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class rx{constructor(e){nx(this,"name","polkadot"),nx(this,"client"),nx(this,"httpProviders"),nx(this,"events"),nx(this,"namespace"),nx(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(e))}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=GO(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}}var ox=Object.defineProperty,ax=Object.defineProperties,cx=Object.getOwnPropertyDescriptors,lx=Object.getOwnPropertySymbols,hx=Object.prototype.hasOwnProperty,dx=Object.prototype.propertyIsEnumerable,ux=(e,t,i)=>t in e?ox(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,px=(e,t)=>{for(var i in t||(t={}))hx.call(t,i)&&ux(e,i,t[i]);if(lx)for(var i of lx(t))dx.call(t,i)&&ux(e,i,t[i]);return e},gx=(e,t)=>ax(e,cx(t)),fx=(e,t,i)=>ux(e,"symbol"!=typeof t?t+"":t,i);class wx{constructor(e){fx(this,"name","eip155"),fx(this,"client"),fx(this,"chainId"),fx(this,"namespace"),fx(this,"httpProviders"),fx(this,"events"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit($_,"".concat(this.name,":").concat(e))}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const i=t||FO("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=parseInt(GO(t));e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}async handleSwitchChain(e){var t,i;let s=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:"0x".concat(s);const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain("".concat(n));else{if(!this.namespace.methods.includes("wallet_switchEthereumChain"))throw new Error("Failed to switch to chain 'eip155:".concat(n,"'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method."));await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:null==(i=this.namespace.chains)?void 0:i[0]}),this.setDefaultChain("".concat(n))}return null}isChainApproved(e){return this.namespace.chains.includes("".concat(this.name,":").concat(e))}async getCapabilities(e){var t,i,s;const n=null==(i=null==(t=e.request)?void 0:t.params)?void 0:i[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const r=this.client.session.get(e.topic),o=(null==(s=null==r?void 0:r.sessionProperties)?void 0:s.capabilities)||{};if(null!=o&&o[n])return null==o?void 0:o[n];const a=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:gx(px({},r.sessionProperties||{}),{capabilities:gx(px({},o||{}),{[n]:a})})})}catch(c){console.warn("Failed to update session with capabilities",c)}return a}async getCallStatus(e){var t,i;const s=this.client.session.get(e.topic),n=null==(t=s.sessionProperties)?void 0:t.bundler_name;if(n){const t=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(t,e)}catch(o){console.warn("Failed to fetch call status from bundler",o,t)}}const r=null==(i=s.sessionProperties)?void 0:i.bundler_url;if(r)try{return await this.getUserOperationReceipt(r,e)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,r)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,v.l)("eth_getUserOperationReceipt",[null==(i=t.request.params)?void 0:i[0]]))});if(!n.ok)throw new Error("Failed to fetch user operation receipt - ".concat(n.status));return await n.json()}getBundlerUrl(e,t){return"".concat(X_,"?projectId=").concat(this.client.core.projectId,"&chainId=").concat(e,"&bundler=").concat(t)}}var mx=Object.defineProperty,yx=(e,t,i)=>((e,t,i)=>t in e?mx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class vx{constructor(e){yx(this,"name","solana"),yx(this,"client"),yx(this,"httpProviders"),yx(this,"events"),yx(this,"namespace"),yx(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=GO(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}}var bx=Object.defineProperty,Ix=(e,t,i)=>((e,t,i)=>t in e?bx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Ex{constructor(e){Ix(this,"name","cosmos"),Ix(this,"client"),Ix(this,"httpProviders"),Ix(this,"events"),Ix(this,"namespace"),Ix(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=GO(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}}var Nx=Object.defineProperty,Ax=(e,t,i)=>((e,t,i)=>t in e?Nx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Cx{constructor(e){Ax(this,"name","algorand"),Ax(this,"client"),Ax(this,"httpProviders"),Ax(this,"events"),Ax(this,"namespace"),Ax(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const i=t||FO("".concat(this.name,":").concat(e),this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,i)}this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(this.chainId))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace,this.client.core.projectId);return typeof i>"u"?void 0:new v.o(new v.G(i,tx("disableProviderPing")))}}var Sx=Object.defineProperty,Px=(e,t,i)=>((e,t,i)=>t in e?Sx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Tx{constructor(e){Px(this,"name","cip34"),Px(this,"client"),Px(this,"httpProviders"),Px(this,"events"),Px(this,"namespace"),Px(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const i=this.getCardanoRPCUrl(t),s=GO(t);e[s]=this.createHttpProvider(s,i)}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||this.getCardanoRPCUrl(e);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}}var Mx=Object.defineProperty,_x=(e,t,i)=>((e,t,i)=>t in e?Mx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Ox{constructor(e){_x(this,"name","elrond"),_x(this,"client"),_x(this,"httpProviders"),_x(this,"events"),_x(this,"namespace"),_x(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=GO(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}}var xx=Object.defineProperty,kx=(e,t,i)=>((e,t,i)=>t in e?xx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Dx{constructor(e){kx(this,"name","multiversx"),kx(this,"client"),kx(this,"httpProviders"),kx(this,"events"),kx(this,"namespace"),kx(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;const s=GO(t);e[s]=this.createHttpProvider(s,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}}var jx=Object.defineProperty,Rx=(e,t,i)=>((e,t,i)=>t in e?jx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Ux{constructor(e){Rx(this,"name","near"),Rx(this,"client"),Rx(this,"httpProviders"),Rx(this,"events"),Rx(this,"namespace"),Rx(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||FO("".concat(this.name,":").concat(e),this.namespace);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,i)}this.events.emit($_,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var i;e[t]=this.createHttpProvider(t,null==(i=this.namespace.rpcMap)?void 0:i[t])}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace);return typeof i>"u"?void 0:new v.o(new v.G(i,tx("disableProviderPing")))}}var Lx=Object.defineProperty,zx=(e,t,i)=>((e,t,i)=>t in e?Lx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class qx{constructor(e){zx(this,"name","tezos"),zx(this,"client"),zx(this,"httpProviders"),zx(this,"events"),zx(this,"namespace"),zx(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||FO("".concat(this.name,":").concat(e),this.namespace);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));this.setHttpProvider(e,i)}this.events.emit($_,"".concat(this.name,":").concat(this.chainId))}getAccounts(){const e=this.namespace.accounts;return e&&e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2])||[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e="".concat(this.name,":").concat(this.chainId),t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace);return typeof i>"u"?void 0:new v.o(new v.G(i))}}var Bx=Object.defineProperty,Vx=(e,t,i)=>((e,t,i)=>t in e?Bx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);class Hx{constructor(e){Vx(this,"name",J_),Vx(this,"client"),Vx(this,"httpProviders"),Vx(this,"events"),Vx(this,"namespace"),Vx(this,"chainId"),this.namespace=e.namespace,this.events=tx("events"),this.client=tx("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit($_,"".concat(this.name,":").concat(e))}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var e,t;const i={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(e=>{const t=uI(e);i["".concat(t.namespace,":").concat(t.reference)]=this.createHttpProvider(e)}),i}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error("JSON-RPC provider for ".concat(e," not found"));return t}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||FO(e,this.namespace,this.client.core.projectId);if(!i)throw new Error("No RPC url provided for chainId: ".concat(e));return new v.o(new v.G(i,tx("disableProviderPing")))}}var Kx=Object.defineProperty,Wx=Object.defineProperties,Fx=Object.getOwnPropertyDescriptors,Gx=Object.getOwnPropertySymbols,Yx=Object.prototype.hasOwnProperty,Qx=Object.prototype.propertyIsEnumerable,Zx=(e,t,i)=>t in e?Kx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Jx=(e,t)=>{for(var i in t||(t={}))Yx.call(t,i)&&Zx(e,i,t[i]);if(Gx)for(var i of Gx(t))Qx.call(t,i)&&Zx(e,i,t[i]);return e},Xx=(e,t)=>Wx(e,Fx(t)),$x=(e,t,i)=>Zx(e,"symbol"!=typeof t?t+"":t,i);class ek{constructor(e){$x(this,"client"),$x(this,"namespaces"),$x(this,"optionalNamespaces"),$x(this,"sessionProperties"),$x(this,"scopedProperties"),$x(this,"events",new g.E),$x(this,"rpcProviders",{}),$x(this,"session"),$x(this,"providerOpts"),$x(this,"logger"),$x(this,"uri"),$x(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(null==e?void 0:e.logger)<"u"&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:(0,v.O)((0,v.k)({level:(null==e?void 0:e.logger)||Y_})),this.disableProviderPing=(null==e?void 0:e.disableProviderPing)||!1}static async init(e){const t=new ek(e);return await t.initialize(),t}async request(e,t,i){const[s,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Jx({},e),chainId:"".concat(s,":").concat(n),topic:this.session.topic,expiry:i})}sendAsync(e,t,i,s){const n=(new Date).getTime();this.request(e,i,s).then(e=>t(null,(0,v.q)(n,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:VA("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,t);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const e=XO(this.session.namespaces);this.namespaces=QO(this.namespaces,e),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await i();this.session=s;const n=XO(s.namespaces);return this.namespaces=QO(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n.name===J_?n.setDefaultChain("".concat(i,":").concat(s),t):n.setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(HA(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info("Inactive pairings cleared: ".concat(t.length))}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await G_.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Y_,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error("Failed to get session",i),new Error("The provided session: ".concat(null==(t=null==(e=this.providerOpts)?void 0:e.session)?void 0:t.topic," doesn't exist in the Sign client"))}else{const e=this.client.session.getAll();this.session=e[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(e=>UA(e)))];ix("client",this.client),ix("events",this.events),ix("disableProviderPing",this.disableProviderPing),e.forEach(e=>{if(!this.session)return;const t=function(e,t){const i=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!i.length)return[];const s=[];return i.forEach(e=>{const i=t.namespaces[e].accounts;s.push(...i)}),s}(e,this.session),i=YO(t),s=QO(this.namespaces,this.optionalNamespaces),n=Xx(Jx({},s[e]),{accounts:t,chains:i});switch(e){case"eip155":this.rpcProviders[e]=new wx({namespace:n});break;case"algorand":this.rpcProviders[e]=new Cx({namespace:n});break;case"solana":this.rpcProviders[e]=new vx({namespace:n});break;case"cosmos":this.rpcProviders[e]=new Ex({namespace:n});break;case"polkadot":this.rpcProviders[e]=new rx({namespace:n});break;case"cip34":this.rpcProviders[e]=new Tx({namespace:n});break;case"elrond":this.rpcProviders[e]=new Ox({namespace:n});break;case"multiversx":this.rpcProviders[e]=new Dx({namespace:n});break;case"near":this.rpcProviders[e]=new Ux({namespace:n});break;case"tezos":this.rpcProviders[e]=new qx({namespace:n});break;default:this.rpcProviders[J_]?this.rpcProviders[J_].updateNamespace(n):this.rpcProviders[J_]=new Hx({namespace:n})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:i}=e;i===(null==(t=this.session)?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:i,topic:s}=e;if(s!==(null==(t=this.session)?void 0:t.topic))return;const{event:n}=i;if("accountsChanged"===n.name){const e=n.data;e&&HA(e)&&this.events.emit("accountsChanged",e.map(JO))}else if("chainChanged"===n.name){const e=i.chainId,t=i.event.data,s=UA(e),n=$O(e)!==$O(t)?"".concat(s,":").concat($O(t)):e;this.onChainChanged(n)}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",e=>{let{topic:t,params:i}=e;var s,n;if(t!==(null==(s=this.session)?void 0:s.topic))return;const{namespaces:r}=i,o=null==(n=this.client)?void 0:n.session.get(t);this.session=Xx(Jx({},o),{namespaces:r}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:i})}),this.client.on("session_delete",async e=>{var t;e.topic===(null==(t=this.session)?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Xx(Jx({},VA("USER_DISCONNECTED")),{data:e.topic})))}),this.on($_,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[J_]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:i,sessionProperties:s,scopedProperties:n}=e;t&&Object.keys(t).length&&(this.namespaces=t),i&&Object.keys(i).length&&(this.optionalNamespaces=i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[t,i]=(null==e?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,i];if(t&&!Object.keys(this.namespaces||{}).map(e=>UA(e)).includes(t))throw new Error("Namespace '".concat(t,"' is not configured. Please call connect() first with namespace config."));if(t&&i)return[t,i];const s=UA(Object.keys(this.namespaces)[0]);return[s,this.rpcProviders[s].getDefaultChain()]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.namespaces)return;const[i,s]=this.validateChain(e);s&&(t||this.getProvider(i).setDefaultChain(s),this.namespaces[i]?this.namespaces[i].defaultChain=s:this.namespaces["".concat(i,":").concat(s)]?this.namespaces["".concat(i,":").concat(s)].defaultChain=s:this.namespaces["".concat(i,":").concat(s)]={defaultChain:s},this.events.emit("chainChanged",s),await this.persist("namespaces",this.namespaces))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var i;const s=(null==(i=this.session)?void 0:i.topic)||"";await this.client.core.storage.setItem("".concat(Q_,"/").concat(e).concat(s),t)}async getFromStore(e){var t;const i=(null==(t=this.session)?void 0:t.topic)||"";return await this.client.core.storage.getItem("".concat(Q_,"/").concat(e).concat(i))}async deleteFromStore(e){var t;const i=(null==(t=this.session)?void 0:t.topic)||"";await this.client.core.storage.removeItem("".concat(Q_,"/").concat(e).concat(i))}async cleanupStorage(){var e;try{if((null==(e=this.client)?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const e of t)e.startsWith(Q_)&&await this.client.core.storage.removeItem(e)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}}const tk="eip155",ik="WALLET_CONNECT",sk="INJECTED",nk="ANNOUNCED",rk={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200"},ConnectorImageIds:{[sy.CONNECTOR_ID.COINBASE]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[sy.CONNECTOR_ID.COINBASE_SDK]:"0c2840c3-5b04-4c44-9661-fbd4b49e1800",[sy.CONNECTOR_ID.SAFE]:"461db637-8616-43ce-035a-d89b8a1d5800",[sy.CONNECTOR_ID.LEDGER]:"54a1aa77-d202-4f8d-0fb2-5d2bb6db0300",[sy.CONNECTOR_ID.WALLET_CONNECT]:"ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",[sy.CONNECTOR_ID.INJECTED]:"07ba87ed-43aa-4adf-4540-9e6a2b9cae00"},ConnectorNamesMap:{[sy.CONNECTOR_ID.INJECTED]:"Browser Wallet",[sy.CONNECTOR_ID.WALLET_CONNECT]:"WalletConnect",[sy.CONNECTOR_ID.COINBASE]:"Coinbase",[sy.CONNECTOR_ID.COINBASE_SDK]:"Coinbase",[sy.CONNECTOR_ID.LEDGER]:"Ledger",[sy.CONNECTOR_ID.SAFE]:"Safe"}},ok={getCaipTokens(e){if(!e)return;const t={};return Object.entries(e).forEach(e=>{let[i,s]=e;t["".concat(tk,":").concat(i)]=s}),t},isLowerCaseMatch:(e,t)=>(null==e?void 0:e.toLowerCase())===(null==t?void 0:t.toLowerCase())},ak={UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"INVALID_APP_CONFIGURATION"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{shortMessage:"Network Not Found",longMessage:"Network not found - please make sure it is included in 'networks' array in createAppKit function"},INVALID_APP_CONFIGURATION:{shortMessage:"Invalid App Configuration",longMessage:()=>"Origin ".concat(typeof window<"u"?window.origin:"unknown"," not found on Allowlist - update configuration on cloud.reown.com")},SOCIALS_TIMEOUT:{shortMessage:"Invalid App Configuration",longMessage:()=>"There was an issue loading the embedded wallet. Please verify that your domain is allowed at cloud.reown.com"},JWT_TOKEN_NOT_VALID:{shortMessage:"Session Expired",longMessage:"Invalid session found on UniversalProvider - please check your time settings and connect again"},INVALID_PROJECT_ID:{shortMessage:"Invalid App Configuration",longMessage:"Invalid Project ID - update configuration"},PROJECT_ID_NOT_CONFIGURED:{shortMessage:"Project ID Not Configured",longMessage:"Project ID Not Configured - update configuration on cloud.reown.com"}}};const ck={createLogger(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"error";const i=(0,v.k)({level:t}),{logger:s}=(0,v.A)({opts:i});return s.error=function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];for(const n of i)if(n instanceof Error)return void e(n,...i);e(void 0,...i)},s}};const lk=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],hk={extendRpcUrlWithProjectId(e,t){let i=!1;try{i="rpc.walletconnect.org"===new URL(e).host}catch(s){i=!1}if(i){const i=new URL(e);return i.searchParams.has("projectId")||i.searchParams.set("projectId",t),i.toString()}return e},isCaipNetwork:e=>"chainNamespace"in e&&"caipNetworkId"in e,getChainNamespace(e){return this.isCaipNetwork(e)?e.chainNamespace:sy.CHAIN.EVM},getCaipNetworkId(e){return this.isCaipNetwork(e)?e.caipNetworkId:"".concat(sy.CHAIN.EVM,":").concat(e.id)},getDefaultRpcUrl(e,t,i){var s,n,r;const o=null==(r=null==(n=null==(s=e.rpcUrls)?void 0:s.default)?void 0:n.http)?void 0:r[0];return lk.includes(t)?function(e,t){const i=new URL("https://rpc.walletconnect.org/v1/");return i.searchParams.set("chainId",e),i.searchParams.set("projectId",t),i.toString()}(t,i):o||""},extendCaipNetwork(e,t){let{customNetworkImageUrls:i,projectId:s,customRpcUrls:n}=t;var r,o,a,c,l;const h=this.getChainNamespace(e),u=this.getCaipNetworkId(e),p=null==(r=e.rpcUrls.default.http)?void 0:r[0],g=this.getDefaultRpcUrl(e,u,s),f=(null==(c=null==(a=null==(o=null==e?void 0:e.rpcUrls)?void 0:o.chainDefault)?void 0:a.http)?void 0:c[0])||p,w=(null==(l=null==n?void 0:n[u])?void 0:l.map(e=>e.url))||[],m=[...w,g],y=[...w];return f&&!y.includes(f)&&y.push(f),(0,d.A)((0,d.A)({},e),{},{chainNamespace:h,caipNetworkId:u,assets:{imageId:rk.NetworkImageIds[e.id],imageUrl:null==i?void 0:i[e.id]},rpcUrls:(0,d.A)((0,d.A)({},e.rpcUrls),{},{default:{http:m},chainDefault:{http:y}})})},extendCaipNetworks(e,t){let{customNetworkImageUrls:i,projectId:s,customRpcUrls:n}=t;return e.map(e=>hk.extendCaipNetwork(e,{customNetworkImageUrls:i,customRpcUrls:n,projectId:s}))},getViemTransport(e,t,i){const s=[];if(null==i||i.forEach(e=>{s.push((0,I.x)(e.url,e.config))}),lk.includes(e.caipNetworkId)){const i=this.getDefaultRpcUrl(e,e.caipNetworkId,t);s.push((0,I.x)(i,{fetchOptions:{headers:{"Content-Type":"text/plain"}}}))}return(0,b.f)(s)},extendWagmiTransports(e,t,i){if(lk.includes(e.caipNetworkId)){const s=this.getDefaultRpcUrl(e,e.caipNetworkId,t);return(0,b.f)([i,(0,I.x)(s)])}return i},getUnsupportedNetwork:e=>({id:e.split(":")[1],caipNetworkId:e,name:sy.UNSUPPORTED_NETWORK_NAME,chainNamespace:e.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}),getCaipNetworkFromStorage(e){var t;const i=Cy.getActiveCaipNetworkId(),s=Bv.getAllRequestedCaipNetworks(),n=Array.from((null==(t=Bv.state.chains)?void 0:t.keys())||[]),r=null==i?void 0:i.split(":")[0],o=!!r&&n.includes(r),a=null==s?void 0:s.find(e=>e.caipNetworkId===i);return o&&!a&&i?this.getUnsupportedNetwork(i):a||e||(null==s?void 0:s[0])}},dk={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0},uk=(0,b.p)({providers:(0,d.A)({},dk),providerIds:(0,d.A)({},dk)}),pk={state:uk,subscribeKey:(e,t)=>(0,b.a)(uk,e,t),subscribe:e=>(0,b.s)(uk,()=>{e(uk)}),subscribeProviders:e=>(0,b.s)(uk.providers,()=>e(uk.providers)),setProvider(e,t){t&&(uk.providers[e]=(0,b.r)(t))},getProvider:e=>uk.providers[e],setProviderId(e,t){t&&(uk.providerIds[e]=t)},getProviderId(e){if(e)return uk.providerIds[e]},reset(){uk.providers=(0,d.A)({},dk),uk.providerIds=(0,d.A)({},dk)},resetChain(e){uk.providers[e]=void 0,uk.providerIds[e]=void 0}},gk={SECURE_SITE_ORIGIN:(typeof p.d.process<"u"&&typeof p.d.process.env<"u"?p.d.process.env.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",VIEW_DIRECTION:{Next:"next",Prev:"prev"},DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"],ANIMATION_DURATIONS:{HeaderText:120,ModalHeight:150,ViewTransition:150}},fk={filterOutDuplicatesByRDNS(e){const t=Uy.state.enableEIP6963?tv.state.connectors:[],i=Cy.getRecentWallets(),s=t.map(e=>{var t;return null==(t=e.info)?void 0:t.rdns}).filter(Boolean),n=i.map(e=>e.rdns).filter(Boolean),r=s.concat(n);if(r.includes("io.metamask.mobile")&&Sy.isMobile()){const e=r.indexOf("io.metamask.mobile");r[e]="io.metamask"}return e.filter(e=>!r.includes(String(null==e?void 0:e.rdns)))},filterOutDuplicatesByIds(e){const t=tv.state.connectors.filter(e=>"ANNOUNCED"===e.type||"INJECTED"===e.type),i=Cy.getRecentWallets(),s=t.map(e=>e.explorerId),n=i.map(e=>e.id),r=s.concat(n);return e.filter(e=>!r.includes(null==e?void 0:e.id))},filterOutDuplicateWallets(e){const t=this.filterOutDuplicatesByRDNS(e);return this.filterOutDuplicatesByIds(t)},markWalletsAsInstalled(e){const{connectors:t}=tv.state,i=t.filter(e=>"ANNOUNCED"===e.type).reduce((e,t)=>{var i;return null!=(i=t.info)&&i.rdns&&(e[t.info.rdns]=!0),e},{});return e.map(e=>{var t;return(0,d.A)((0,d.A)({},e),{},{installed:!!e.rdns&&!!i[null!==(t=e.rdns)&&void 0!==t?t:""]})}).sort((e,t)=>Number(t.installed)-Number(e.installed))},getConnectOrderMethod(e,t){var i;const s=(null==e?void 0:e.connectMethodsOrder)||(null==(i=Uy.state.features)?void 0:i.connectMethodsOrder),n=t||tv.state.connectors;if(s)return s;const{injected:r,announced:o}=wk.getConnectorsByType(n,Yy.state.recommended,Yy.state.featured),a=r.filter(wk.showConnector),c=o.filter(wk.showConnector);return a.length||c.length?["wallet","email","social"]:gk.DEFAULT_CONNECT_METHOD_ORDER}},wk={getConnectorsByType(e,t,i){const{customWallets:s}=Uy.state,n=Cy.getRecentWallets(),r=fk.filterOutDuplicateWallets(t),o=fk.filterOutDuplicateWallets(i),a=e.filter(e=>"MULTI_CHAIN"===e.type),c=e.filter(e=>"ANNOUNCED"===e.type),l=e.filter(e=>"INJECTED"===e.type);return{custom:s,recent:n,external:e.filter(e=>"EXTERNAL"===e.type),multiChain:a,announced:c,injected:l,recommended:r,featured:o}},showConnector(e){var t;const i=null==(t=e.info)?void 0:t.rdns,s=!!i&&Yy.state.excludedWallets.some(e=>e.rdns===i),n=!!e.name&&Yy.state.excludedWallets.some(t=>ok.isLowerCaseMatch(t.name,e.name));return!("INJECTED"===e.type&&(!Sy.isMobile()&&"Browser Wallet"===e.name||!i&&!Ov.checkInstalled()||s||n)||"ANNOUNCED"===e.type&&(s||n))},getIsConnectedWithWC:()=>Array.from(Bv.state.chains.values()).some(e=>tv.getConnectorId(e.namespace)===sy.CONNECTOR_ID.WALLET_CONNECT),getConnectorTypeOrder(e){var t;let{recommended:i,featured:s,custom:n,recent:r,announced:o,injected:a,multiChain:c,external:l,overriddenConnectors:h=(null!==(t=(e=>null==(e=Uy.state.features)?void 0:e.connectorTypeOrder)())&&void 0!==t?t:[])}=e;const d=wk.getIsConnectedWithWC(),u=[{type:"walletConnect",isEnabled:Uy.state.enableWalletConnect&&!d},{type:"recent",isEnabled:r.length>0},{type:"injected",isEnabled:[...a,...o,...c].length>0},{type:"featured",isEnabled:s.length>0},{type:"custom",isEnabled:n&&n.length>0},{type:"external",isEnabled:l.length>0},{type:"recommended",isEnabled:i.length>0}].filter(e=>e.isEnabled),p=new Set(u.map(e=>e.type)),g=h.filter(e=>p.has(e)).map(e=>({type:e,isEnabled:!0})),f=u.filter(e=>{let{type:t}=e;return!g.some(e=>{let{type:i}=e;return i===t})});return Array.from(new Set([...g,...f].map(e=>{let{type:t}=e;return t})))}};let mk,yk,vk;function bk(e,t){mk=document.createElement("style"),yk=document.createElement("style"),vk=document.createElement("style"),mk.textContent=Ek(e).core.cssText,yk.textContent=Ek(e).dark.cssText,vk.textContent=Ek(e).light.cssText,document.head.appendChild(mk),document.head.appendChild(yk),document.head.appendChild(vk),Ik(t)}function Ik(e){yk&&vk&&("light"===e?(yk.removeAttribute("media"),vk.media="enabled"):(vk.removeAttribute("media"),yk.media="enabled"))}function Ek(e){return{core:(0,b.i)(s||(s=(0,h.A)(["\n      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n      @keyframes w3m-shake {\n        0% {\n          transform: scale(1) rotate(0deg);\n        }\n        20% {\n          transform: scale(1) rotate(-1deg);\n        }\n        40% {\n          transform: scale(1) rotate(1.5deg);\n        }\n        60% {\n          transform: scale(1) rotate(-1.5deg);\n        }\n        80% {\n          transform: scale(1) rotate(1deg);\n        }\n        100% {\n          transform: scale(1) rotate(0deg);\n        }\n      }\n      @keyframes w3m-iframe-fade-out {\n        0% {\n          opacity: 1;\n        }\n        100% {\n          opacity: 0;\n        }\n      }\n      @keyframes w3m-iframe-zoom-in {\n        0% {\n          transform: translateY(50px);\n          opacity: 0;\n        }\n        100% {\n          transform: translateY(0px);\n          opacity: 1;\n        }\n      }\n      @keyframes w3m-iframe-zoom-in-mobile {\n        0% {\n          transform: scale(0.95);\n          opacity: 0;\n        }\n        100% {\n          transform: scale(1);\n          opacity: 1;\n        }\n      }\n      :root {\n        --w3m-modal-width: 360px;\n        --w3m-color-mix-strength: ",";\n        --w3m-font-family: ",";\n        --w3m-font-size-master: ",";\n        --w3m-border-radius-master: ",";\n        --w3m-z-index: ",";\n\n        --wui-font-family: var(--w3m-font-family);\n\n        --wui-font-size-mini: calc(var(--w3m-font-size-master) * 0.8);\n        --wui-font-size-micro: var(--w3m-font-size-master);\n        --wui-font-size-tiny: calc(var(--w3m-font-size-master) * 1.2);\n        --wui-font-size-small: calc(var(--w3m-font-size-master) * 1.4);\n        --wui-font-size-paragraph: calc(var(--w3m-font-size-master) * 1.6);\n        --wui-font-size-medium: calc(var(--w3m-font-size-master) * 1.8);\n        --wui-font-size-large: calc(var(--w3m-font-size-master) * 2);\n        --wui-font-size-title-6: calc(var(--w3m-font-size-master) * 2.2);\n        --wui-font-size-medium-title: calc(var(--w3m-font-size-master) * 2.4);\n        --wui-font-size-2xl: calc(var(--w3m-font-size-master) * 4);\n\n        --wui-border-radius-5xs: var(--w3m-border-radius-master);\n        --wui-border-radius-4xs: calc(var(--w3m-border-radius-master) * 1.5);\n        --wui-border-radius-3xs: calc(var(--w3m-border-radius-master) * 2);\n        --wui-border-radius-xxs: calc(var(--w3m-border-radius-master) * 3);\n        --wui-border-radius-xs: calc(var(--w3m-border-radius-master) * 4);\n        --wui-border-radius-s: calc(var(--w3m-border-radius-master) * 5);\n        --wui-border-radius-m: calc(var(--w3m-border-radius-master) * 7);\n        --wui-border-radius-l: calc(var(--w3m-border-radius-master) * 9);\n        --wui-border-radius-3xl: calc(var(--w3m-border-radius-master) * 20);\n\n        --wui-font-weight-light: 400;\n        --wui-font-weight-regular: 500;\n        --wui-font-weight-medium: 600;\n        --wui-font-weight-bold: 700;\n\n        --wui-letter-spacing-2xl: -1.6px;\n        --wui-letter-spacing-medium-title: -0.96px;\n        --wui-letter-spacing-title-6: -0.88px;\n        --wui-letter-spacing-large: -0.8px;\n        --wui-letter-spacing-medium: -0.72px;\n        --wui-letter-spacing-paragraph: -0.64px;\n        --wui-letter-spacing-small: -0.56px;\n        --wui-letter-spacing-tiny: -0.48px;\n        --wui-letter-spacing-micro: -0.2px;\n        --wui-letter-spacing-mini: -0.16px;\n\n        --wui-spacing-0: 0px;\n        --wui-spacing-4xs: 2px;\n        --wui-spacing-3xs: 4px;\n        --wui-spacing-xxs: 6px;\n        --wui-spacing-2xs: 7px;\n        --wui-spacing-xs: 8px;\n        --wui-spacing-1xs: 10px;\n        --wui-spacing-s: 12px;\n        --wui-spacing-m: 14px;\n        --wui-spacing-l: 16px;\n        --wui-spacing-2l: 18px;\n        --wui-spacing-xl: 20px;\n        --wui-spacing-xxl: 24px;\n        --wui-spacing-2xl: 32px;\n        --wui-spacing-3xl: 40px;\n        --wui-spacing-4xl: 90px;\n        --wui-spacing-5xl: 95px;\n\n        --wui-icon-box-size-xxs: 14px;\n        --wui-icon-box-size-xs: 20px;\n        --wui-icon-box-size-sm: 24px;\n        --wui-icon-box-size-md: 32px;\n        --wui-icon-box-size-mdl: 36px;\n        --wui-icon-box-size-lg: 40px;\n        --wui-icon-box-size-2lg: 48px;\n        --wui-icon-box-size-xl: 64px;\n\n        --wui-icon-size-inherit: inherit;\n        --wui-icon-size-xxs: 10px;\n        --wui-icon-size-xs: 12px;\n        --wui-icon-size-sm: 14px;\n        --wui-icon-size-md: 16px;\n        --wui-icon-size-mdl: 18px;\n        --wui-icon-size-lg: 20px;\n        --wui-icon-size-xl: 24px;\n        --wui-icon-size-xxl: 28px;\n\n        --wui-wallet-image-size-inherit: inherit;\n        --wui-wallet-image-size-sm: 40px;\n        --wui-wallet-image-size-md: 56px;\n        --wui-wallet-image-size-lg: 80px;\n\n        --wui-visual-size-size-inherit: inherit;\n        --wui-visual-size-sm: 40px;\n        --wui-visual-size-md: 55px;\n        --wui-visual-size-lg: 80px;\n\n        --wui-box-size-md: 100px;\n        --wui-box-size-lg: 120px;\n\n        --wui-ease-out-power-2: cubic-bezier(0, 0, 0.22, 1);\n        --wui-ease-out-power-1: cubic-bezier(0, 0, 0.55, 1);\n\n        --wui-ease-in-power-3: cubic-bezier(0.66, 0, 1, 1);\n        --wui-ease-in-power-2: cubic-bezier(0.45, 0, 1, 1);\n        --wui-ease-in-power-1: cubic-bezier(0.3, 0, 1, 1);\n\n        --wui-ease-inout-power-1: cubic-bezier(0.45, 0, 0.55, 1);\n\n        --wui-duration-lg: 200ms;\n        --wui-duration-md: 125ms;\n        --wui-duration-sm: 75ms;\n\n        --wui-path-network-sm: path(\n          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'\n        );\n\n        --wui-path-network-md: path(\n          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'\n        );\n\n        --wui-path-network-lg: path(\n          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'\n        );\n\n        --wui-width-network-sm: 36px;\n        --wui-width-network-md: 48px;\n        --wui-width-network-lg: 86px;\n\n        --wui-height-network-sm: 40px;\n        --wui-height-network-md: 54px;\n        --wui-height-network-lg: 96px;\n\n        --wui-icon-size-network-xs: 12px;\n        --wui-icon-size-network-sm: 16px;\n        --wui-icon-size-network-md: 24px;\n        --wui-icon-size-network-lg: 42px;\n\n        --wui-color-inherit: inherit;\n\n        --wui-color-inverse-100: #fff;\n        --wui-color-inverse-000: #000;\n\n        --wui-cover: rgba(20, 20, 20, 0.8);\n\n        --wui-color-modal-bg: var(--wui-color-modal-bg-base);\n\n        --wui-color-accent-100: var(--wui-color-accent-base-100);\n        --wui-color-accent-090: var(--wui-color-accent-base-090);\n        --wui-color-accent-080: var(--wui-color-accent-base-080);\n\n        --wui-color-success-100: var(--wui-color-success-base-100);\n        --wui-color-success-125: var(--wui-color-success-base-125);\n\n        --wui-color-warning-100: var(--wui-color-warning-base-100);\n\n        --wui-color-error-100: var(--wui-color-error-base-100);\n        --wui-color-error-125: var(--wui-color-error-base-125);\n\n        --wui-color-blue-100: var(--wui-color-blue-base-100);\n        --wui-color-blue-90: var(--wui-color-blue-base-90);\n\n        --wui-icon-box-bg-error-100: var(--wui-icon-box-bg-error-base-100);\n        --wui-icon-box-bg-blue-100: var(--wui-icon-box-bg-blue-base-100);\n        --wui-icon-box-bg-success-100: var(--wui-icon-box-bg-success-base-100);\n        --wui-icon-box-bg-inverse-100: var(--wui-icon-box-bg-inverse-base-100);\n\n        --wui-all-wallets-bg-100: var(--wui-all-wallets-bg-100);\n\n        --wui-avatar-border: var(--wui-avatar-border-base);\n\n        --wui-thumbnail-border: var(--wui-thumbnail-border-base);\n\n        --wui-wallet-button-bg: var(--wui-wallet-button-bg-base);\n\n        --wui-box-shadow-blue: var(--wui-color-accent-glass-020);\n      }\n\n      @supports (background: color-mix(in srgb, white 50%, black)) {\n        :root {\n          --wui-color-modal-bg: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-modal-bg-base)\n          );\n\n          --wui-box-shadow-blue: color-mix(in srgb, var(--wui-color-accent-100) 20%, transparent);\n\n          --wui-color-accent-100: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 100%,\n            transparent\n          );\n          --wui-color-accent-090: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 90%,\n            transparent\n          );\n          --wui-color-accent-080: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 80%,\n            transparent\n          );\n          --wui-color-accent-glass-090: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 90%,\n            transparent\n          );\n          --wui-color-accent-glass-080: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 80%,\n            transparent\n          );\n          --wui-color-accent-glass-020: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 20%,\n            transparent\n          );\n          --wui-color-accent-glass-015: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 15%,\n            transparent\n          );\n          --wui-color-accent-glass-010: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 10%,\n            transparent\n          );\n          --wui-color-accent-glass-005: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 5%,\n            transparent\n          );\n          --wui-color-accent-002: color-mix(\n            in srgb,\n            var(--wui-color-accent-base-100) 2%,\n            transparent\n          );\n\n          --wui-color-fg-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-100)\n          );\n          --wui-color-fg-125: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-125)\n          );\n          --wui-color-fg-150: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-150)\n          );\n          --wui-color-fg-175: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-175)\n          );\n          --wui-color-fg-200: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-200)\n          );\n          --wui-color-fg-225: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-225)\n          );\n          --wui-color-fg-250: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-250)\n          );\n          --wui-color-fg-275: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-275)\n          );\n          --wui-color-fg-300: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-300)\n          );\n          --wui-color-fg-325: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-325)\n          );\n          --wui-color-fg-350: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-fg-350)\n          );\n\n          --wui-color-bg-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-100)\n          );\n          --wui-color-bg-125: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-125)\n          );\n          --wui-color-bg-150: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-150)\n          );\n          --wui-color-bg-175: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-175)\n          );\n          --wui-color-bg-200: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-200)\n          );\n          --wui-color-bg-225: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-225)\n          );\n          --wui-color-bg-250: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-250)\n          );\n          --wui-color-bg-275: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-275)\n          );\n          --wui-color-bg-300: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-300)\n          );\n          --wui-color-bg-325: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-325)\n          );\n          --wui-color-bg-350: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-bg-350)\n          );\n\n          --wui-color-success-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-success-base-100)\n          );\n          --wui-color-success-125: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-success-base-125)\n          );\n\n          --wui-color-warning-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-warning-base-100)\n          );\n\n          --wui-color-error-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-error-base-100)\n          );\n          --wui-color-blue-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-blue-base-100)\n          );\n          --wui-color-blue-90: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-blue-base-90)\n          );\n          --wui-color-error-125: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-color-error-base-125)\n          );\n\n          --wui-icon-box-bg-error-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-icon-box-bg-error-base-100)\n          );\n          --wui-icon-box-bg-accent-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-icon-box-bg-blue-base-100)\n          );\n          --wui-icon-box-bg-success-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-icon-box-bg-success-base-100)\n          );\n          --wui-icon-box-bg-inverse-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-icon-box-bg-inverse-base-100)\n          );\n\n          --wui-all-wallets-bg-100: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-all-wallets-bg-100)\n          );\n\n          --wui-avatar-border: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-avatar-border-base)\n          );\n\n          --wui-thumbnail-border: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-thumbnail-border-base)\n          );\n\n          --wui-wallet-button-bg: color-mix(\n            in srgb,\n            var(--w3m-color-mix) var(--w3m-color-mix-strength),\n            var(--wui-wallet-button-bg-base)\n          );\n        }\n      }\n    "])),(0,b.d)(null!=e&&e["--w3m-color-mix-strength"]?"".concat(e["--w3m-color-mix-strength"],"%"):"0%"),(0,b.d)((null==e?void 0:e["--w3m-font-family"])||"Inter, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;"),(0,b.d)((null==e?void 0:e["--w3m-font-size-master"])||"10px"),(0,b.d)((null==e?void 0:e["--w3m-border-radius-master"])||"4px"),(0,b.d)((null==e?void 0:e["--w3m-z-index"])||999)),light:(0,b.i)(n||(n=(0,h.A)(["\n      :root {\n        --w3m-color-mix: ",";\n        --w3m-accent: ",";\n        --w3m-default: #fff;\n\n        --wui-color-modal-bg-base: ",";\n        --wui-color-accent-base-100: var(--w3m-accent);\n\n        --wui-color-blueberry-100: hsla(230, 100%, 67%, 1);\n        --wui-color-blueberry-090: hsla(231, 76%, 61%, 1);\n        --wui-color-blueberry-080: hsla(230, 59%, 55%, 1);\n        --wui-color-blueberry-050: hsla(231, 100%, 70%, 0.1);\n\n        --wui-color-fg-100: #e4e7e7;\n        --wui-color-fg-125: #d0d5d5;\n        --wui-color-fg-150: #a8b1b1;\n        --wui-color-fg-175: #a8b0b0;\n        --wui-color-fg-200: #949e9e;\n        --wui-color-fg-225: #868f8f;\n        --wui-color-fg-250: #788080;\n        --wui-color-fg-275: #788181;\n        --wui-color-fg-300: #6e7777;\n        --wui-color-fg-325: #9a9a9a;\n        --wui-color-fg-350: #363636;\n\n        --wui-color-bg-100: #141414;\n        --wui-color-bg-125: #191a1a;\n        --wui-color-bg-150: #1e1f1f;\n        --wui-color-bg-175: #222525;\n        --wui-color-bg-200: #272a2a;\n        --wui-color-bg-225: #2c3030;\n        --wui-color-bg-250: #313535;\n        --wui-color-bg-275: #363b3b;\n        --wui-color-bg-300: #3b4040;\n        --wui-color-bg-325: #252525;\n        --wui-color-bg-350: #ffffff;\n\n        --wui-color-success-base-100: #26d962;\n        --wui-color-success-base-125: #30a46b;\n\n        --wui-color-warning-base-100: #f3a13f;\n\n        --wui-color-error-base-100: #f25a67;\n        --wui-color-error-base-125: #df4a34;\n\n        --wui-color-blue-base-100: rgba(102, 125, 255, 1);\n        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);\n\n        --wui-color-success-glass-001: rgba(38, 217, 98, 0.01);\n        --wui-color-success-glass-002: rgba(38, 217, 98, 0.02);\n        --wui-color-success-glass-005: rgba(38, 217, 98, 0.05);\n        --wui-color-success-glass-010: rgba(38, 217, 98, 0.1);\n        --wui-color-success-glass-015: rgba(38, 217, 98, 0.15);\n        --wui-color-success-glass-020: rgba(38, 217, 98, 0.2);\n        --wui-color-success-glass-025: rgba(38, 217, 98, 0.25);\n        --wui-color-success-glass-030: rgba(38, 217, 98, 0.3);\n        --wui-color-success-glass-060: rgba(38, 217, 98, 0.6);\n        --wui-color-success-glass-080: rgba(38, 217, 98, 0.8);\n\n        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);\n\n        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);\n\n        --wui-color-error-glass-001: rgba(242, 90, 103, 0.01);\n        --wui-color-error-glass-002: rgba(242, 90, 103, 0.02);\n        --wui-color-error-glass-005: rgba(242, 90, 103, 0.05);\n        --wui-color-error-glass-010: rgba(242, 90, 103, 0.1);\n        --wui-color-error-glass-015: rgba(242, 90, 103, 0.15);\n        --wui-color-error-glass-020: rgba(242, 90, 103, 0.2);\n        --wui-color-error-glass-025: rgba(242, 90, 103, 0.25);\n        --wui-color-error-glass-030: rgba(242, 90, 103, 0.3);\n        --wui-color-error-glass-060: rgba(242, 90, 103, 0.6);\n        --wui-color-error-glass-080: rgba(242, 90, 103, 0.8);\n\n        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);\n\n        --wui-color-gray-glass-001: rgba(255, 255, 255, 0.01);\n        --wui-color-gray-glass-002: rgba(255, 255, 255, 0.02);\n        --wui-color-gray-glass-005: rgba(255, 255, 255, 0.05);\n        --wui-color-gray-glass-010: rgba(255, 255, 255, 0.1);\n        --wui-color-gray-glass-015: rgba(255, 255, 255, 0.15);\n        --wui-color-gray-glass-020: rgba(255, 255, 255, 0.2);\n        --wui-color-gray-glass-025: rgba(255, 255, 255, 0.25);\n        --wui-color-gray-glass-030: rgba(255, 255, 255, 0.3);\n        --wui-color-gray-glass-060: rgba(255, 255, 255, 0.6);\n        --wui-color-gray-glass-080: rgba(255, 255, 255, 0.8);\n        --wui-color-gray-glass-090: rgba(255, 255, 255, 0.9);\n\n        --wui-color-dark-glass-100: rgba(42, 42, 42, 1);\n\n        --wui-icon-box-bg-error-base-100: #3c2426;\n        --wui-icon-box-bg-blue-base-100: #20303f;\n        --wui-icon-box-bg-success-base-100: #1f3a28;\n        --wui-icon-box-bg-inverse-base-100: #243240;\n\n        --wui-all-wallets-bg-100: #222b35;\n\n        --wui-avatar-border-base: #252525;\n\n        --wui-thumbnail-border-base: #252525;\n\n        --wui-wallet-button-bg-base: var(--wui-color-bg-125);\n\n        --w3m-card-embedded-shadow-color: rgb(17 17 18 / 25%);\n      }\n    "])),(0,b.d)((null==e?void 0:e["--w3m-color-mix"])||"#fff"),(0,b.d)(Ey(e,"dark")["--w3m-accent"]),(0,b.d)(Ey(e,"dark")["--w3m-background"])),dark:(0,b.i)(r||(r=(0,h.A)(["\n      :root {\n        --w3m-color-mix: ",";\n        --w3m-accent: ",";\n        --w3m-default: #000;\n\n        --wui-color-modal-bg-base: ",";\n        --wui-color-accent-base-100: var(--w3m-accent);\n\n        --wui-color-blueberry-100: hsla(231, 100%, 70%, 1);\n        --wui-color-blueberry-090: hsla(231, 97%, 72%, 1);\n        --wui-color-blueberry-080: hsla(231, 92%, 74%, 1);\n\n        --wui-color-fg-100: #141414;\n        --wui-color-fg-125: #2d3131;\n        --wui-color-fg-150: #474d4d;\n        --wui-color-fg-175: #636d6d;\n        --wui-color-fg-200: #798686;\n        --wui-color-fg-225: #828f8f;\n        --wui-color-fg-250: #8b9797;\n        --wui-color-fg-275: #95a0a0;\n        --wui-color-fg-300: #9ea9a9;\n        --wui-color-fg-325: #9a9a9a;\n        --wui-color-fg-350: #d0d0d0;\n\n        --wui-color-bg-100: #ffffff;\n        --wui-color-bg-125: #f5fafa;\n        --wui-color-bg-150: #f3f8f8;\n        --wui-color-bg-175: #eef4f4;\n        --wui-color-bg-200: #eaf1f1;\n        --wui-color-bg-225: #e5eded;\n        --wui-color-bg-250: #e1e9e9;\n        --wui-color-bg-275: #dce7e7;\n        --wui-color-bg-300: #d8e3e3;\n        --wui-color-bg-325: #f3f3f3;\n        --wui-color-bg-350: #202020;\n\n        --wui-color-success-base-100: #26b562;\n        --wui-color-success-base-125: #30a46b;\n\n        --wui-color-warning-base-100: #f3a13f;\n\n        --wui-color-error-base-100: #f05142;\n        --wui-color-error-base-125: #df4a34;\n\n        --wui-color-blue-base-100: rgba(102, 125, 255, 1);\n        --wui-color-blue-base-90: rgba(102, 125, 255, 0.9);\n\n        --wui-color-success-glass-001: rgba(38, 181, 98, 0.01);\n        --wui-color-success-glass-002: rgba(38, 181, 98, 0.02);\n        --wui-color-success-glass-005: rgba(38, 181, 98, 0.05);\n        --wui-color-success-glass-010: rgba(38, 181, 98, 0.1);\n        --wui-color-success-glass-015: rgba(38, 181, 98, 0.15);\n        --wui-color-success-glass-020: rgba(38, 181, 98, 0.2);\n        --wui-color-success-glass-025: rgba(38, 181, 98, 0.25);\n        --wui-color-success-glass-030: rgba(38, 181, 98, 0.3);\n        --wui-color-success-glass-060: rgba(38, 181, 98, 0.6);\n        --wui-color-success-glass-080: rgba(38, 181, 98, 0.8);\n\n        --wui-color-success-glass-reown-020: rgba(48, 164, 107, 0.2);\n\n        --wui-color-warning-glass-reown-020: rgba(243, 161, 63, 0.2);\n\n        --wui-color-error-glass-001: rgba(240, 81, 66, 0.01);\n        --wui-color-error-glass-002: rgba(240, 81, 66, 0.02);\n        --wui-color-error-glass-005: rgba(240, 81, 66, 0.05);\n        --wui-color-error-glass-010: rgba(240, 81, 66, 0.1);\n        --wui-color-error-glass-015: rgba(240, 81, 66, 0.15);\n        --wui-color-error-glass-020: rgba(240, 81, 66, 0.2);\n        --wui-color-error-glass-025: rgba(240, 81, 66, 0.25);\n        --wui-color-error-glass-030: rgba(240, 81, 66, 0.3);\n        --wui-color-error-glass-060: rgba(240, 81, 66, 0.6);\n        --wui-color-error-glass-080: rgba(240, 81, 66, 0.8);\n\n        --wui-color-error-glass-reown-020: rgba(223, 74, 52, 0.2);\n\n        --wui-icon-box-bg-error-base-100: #f4dfdd;\n        --wui-icon-box-bg-blue-base-100: #d9ecfb;\n        --wui-icon-box-bg-success-base-100: #daf0e4;\n        --wui-icon-box-bg-inverse-base-100: #dcecfc;\n\n        --wui-all-wallets-bg-100: #e8f1fa;\n\n        --wui-avatar-border-base: #f3f4f4;\n\n        --wui-thumbnail-border-base: #eaefef;\n\n        --wui-wallet-button-bg-base: var(--wui-color-bg-125);\n\n        --wui-color-gray-glass-001: rgba(0, 0, 0, 0.01);\n        --wui-color-gray-glass-002: rgba(0, 0, 0, 0.02);\n        --wui-color-gray-glass-005: rgba(0, 0, 0, 0.05);\n        --wui-color-gray-glass-010: rgba(0, 0, 0, 0.1);\n        --wui-color-gray-glass-015: rgba(0, 0, 0, 0.15);\n        --wui-color-gray-glass-020: rgba(0, 0, 0, 0.2);\n        --wui-color-gray-glass-025: rgba(0, 0, 0, 0.25);\n        --wui-color-gray-glass-030: rgba(0, 0, 0, 0.3);\n        --wui-color-gray-glass-060: rgba(0, 0, 0, 0.6);\n        --wui-color-gray-glass-080: rgba(0, 0, 0, 0.8);\n        --wui-color-gray-glass-090: rgba(0, 0, 0, 0.9);\n\n        --wui-color-dark-glass-100: rgba(233, 233, 233, 1);\n\n        --w3m-card-embedded-shadow-color: rgb(224 225 233 / 25%);\n      }\n    "])),(0,b.d)((null==e?void 0:e["--w3m-color-mix"])||"#000"),(0,b.d)(Ey(e,"light")["--w3m-accent"]),(0,b.d)(Ey(e,"light")["--w3m-background"]))}}const Nk=(0,b.i)(o||(o=(0,h.A)(["\n  *,\n  *::after,\n  *::before,\n  :host {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n    font-style: normal;\n    text-rendering: optimizeSpeed;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    -webkit-tap-highlight-color: transparent;\n    font-family: var(--wui-font-family);\n    backface-visibility: hidden;\n  }\n"]))),Ak=(0,b.i)(a||(a=(0,h.A)(["\n  button,\n  a {\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    position: relative;\n    transition:\n      color var(--wui-duration-lg) var(--wui-ease-out-power-1),\n      background-color var(--wui-duration-lg) var(--wui-ease-out-power-1),\n      border var(--wui-duration-lg) var(--wui-ease-out-power-1),\n      border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1),\n      box-shadow var(--wui-duration-lg) var(--wui-ease-out-power-1);\n    will-change: background-color, color, border, box-shadow, border-radius;\n    outline: none;\n    border: none;\n    column-gap: var(--wui-spacing-3xs);\n    background-color: transparent;\n    text-decoration: none;\n  }\n\n  wui-flex {\n    transition: border-radius var(--wui-duration-lg) var(--wui-ease-out-power-1);\n    will-change: border-radius;\n  }\n\n  button:disabled > wui-wallet-image,\n  button:disabled > wui-all-wallets-image,\n  button:disabled > wui-network-image,\n  button:disabled > wui-image,\n  button:disabled > wui-transaction-visual,\n  button:disabled > wui-logo {\n    filter: grayscale(1);\n  }\n\n  @media (hover: hover) and (pointer: fine) {\n    button:hover:enabled {\n      background-color: var(--wui-color-gray-glass-005);\n    }\n\n    button:active:enabled {\n      background-color: var(--wui-color-gray-glass-010);\n    }\n  }\n\n  button:disabled > wui-icon-box {\n    opacity: 0.5;\n  }\n\n  input {\n    border: none;\n    outline: none;\n    appearance: none;\n  }\n"]))),Ck=(0,b.i)(c||(c=(0,h.A)(["\n  .wui-color-inherit {\n    color: var(--wui-color-inherit);\n  }\n\n  .wui-color-accent-100 {\n    color: var(--wui-color-accent-100);\n  }\n\n  .wui-color-error-100 {\n    color: var(--wui-color-error-100);\n  }\n\n  .wui-color-blue-100 {\n    color: var(--wui-color-blue-100);\n  }\n\n  .wui-color-blue-90 {\n    color: var(--wui-color-blue-90);\n  }\n\n  .wui-color-error-125 {\n    color: var(--wui-color-error-125);\n  }\n\n  .wui-color-success-100 {\n    color: var(--wui-color-success-100);\n  }\n\n  .wui-color-success-125 {\n    color: var(--wui-color-success-125);\n  }\n\n  .wui-color-inverse-100 {\n    color: var(--wui-color-inverse-100);\n  }\n\n  .wui-color-inverse-000 {\n    color: var(--wui-color-inverse-000);\n  }\n\n  .wui-color-fg-100 {\n    color: var(--wui-color-fg-100);\n  }\n\n  .wui-color-fg-200 {\n    color: var(--wui-color-fg-200);\n  }\n\n  .wui-color-fg-300 {\n    color: var(--wui-color-fg-300);\n  }\n\n  .wui-color-fg-325 {\n    color: var(--wui-color-fg-325);\n  }\n\n  .wui-color-fg-350 {\n    color: var(--wui-color-fg-350);\n  }\n\n  .wui-bg-color-inherit {\n    background-color: var(--wui-color-inherit);\n  }\n\n  .wui-bg-color-blue-100 {\n    background-color: var(--wui-color-accent-100);\n  }\n\n  .wui-bg-color-error-100 {\n    background-color: var(--wui-color-error-100);\n  }\n\n  .wui-bg-color-error-125 {\n    background-color: var(--wui-color-error-125);\n  }\n\n  .wui-bg-color-success-100 {\n    background-color: var(--wui-color-success-100);\n  }\n\n  .wui-bg-color-success-125 {\n    background-color: var(--wui-color-success-100);\n  }\n\n  .wui-bg-color-inverse-100 {\n    background-color: var(--wui-color-inverse-100);\n  }\n\n  .wui-bg-color-inverse-000 {\n    background-color: var(--wui-color-inverse-000);\n  }\n\n  .wui-bg-color-fg-100 {\n    background-color: var(--wui-color-fg-100);\n  }\n\n  .wui-bg-color-fg-200 {\n    background-color: var(--wui-color-fg-200);\n  }\n\n  .wui-bg-color-fg-300 {\n    background-color: var(--wui-color-fg-300);\n  }\n\n  .wui-color-fg-325 {\n    background-color: var(--wui-color-fg-325);\n  }\n\n  .wui-color-fg-350 {\n    background-color: var(--wui-color-fg-350);\n  }\n"]))),Sk=4902,Pk=5e3,Tk=32603;function Mk(e){return(0,d.A)({formatters:void 0,fees:void 0,serializers:void 0},e)}const _k=Mk({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),Ok=Mk({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"}),xk=Mk({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"});Mk({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}}),Mk({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});const kk={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},Dk={getMethodsByChainNamespace:e=>kk[e]||[],createDefaultNamespace(e){return{methods:this.getMethodsByChainNamespace(e),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(e,t){if(!t)return(0,d.A)({},e);const i=(0,d.A)({},e),s=new Set;if(t.methods&&Object.keys(t.methods).forEach(e=>s.add(e)),t.chains&&Object.keys(t.chains).forEach(e=>s.add(e)),t.events&&Object.keys(t.events).forEach(e=>s.add(e)),t.rpcMap&&Object.keys(t.rpcMap).forEach(e=>{const[t]=e.split(":");t&&s.add(t)}),s.forEach(e=>{i[e]||(i[e]=this.createDefaultNamespace(e))}),t.methods&&Object.entries(t.methods).forEach(e=>{let[t,s]=e;i[t]&&(i[t].methods=s)}),t.chains&&Object.entries(t.chains).forEach(e=>{let[t,s]=e;i[t]&&(i[t].chains=s)}),t.events&&Object.entries(t.events).forEach(e=>{let[t,s]=e;i[t]&&(i[t].events=s)}),t.rpcMap){const e=new Set;Object.entries(t.rpcMap).forEach(t=>{let[s,n]=t;const[r,o]=s.split(":");!r||!o||!i[r]||(i[r].rpcMap||(i[r].rpcMap={}),e.has(r)||(i[r].rpcMap={},e.add(r)),i[r].rpcMap[o]=n)})}return i},createNamespaces(e,t){const i=e.reduce((e,t)=>{const{id:i,chainNamespace:s,rpcUrls:n}=t,r=n.default.http[0];e[s]||(e[s]=this.createDefaultNamespace(s));const o="".concat(s,":").concat(i),a=e[s];switch(a.chains.push(o),o){case _k.caipNetworkId:a.chains.push(_k.deprecatedCaipNetworkId);break;case Ok.caipNetworkId:a.chains.push(Ok.deprecatedCaipNetworkId)}return null!=a&&a.rpcMap&&r&&(a.rpcMap[i]=r),e},{});return this.applyNamespaceOverrides(i,t)},resolveReownName:async e=>{var t;const i=await $v.resolveName(e);return(null==(t=(Object.values(null==i?void 0:i.addresses)||[])[0])?void 0:t.address)||!1},getChainsFromNamespaces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.values(e).flatMap(e=>{const t=e.chains||[],i=e.accounts.map(e=>{const[t,i]=e.split(":");return"".concat(t,":").concat(i)});return Array.from(new Set([...t,...i]))})},isSessionEventData:e=>"object"==typeof e&&null!==e&&"id"in e&&"topic"in e&&"params"in e&&"object"==typeof e.params&&null!==e.params&&"chainId"in e.params&&"event"in e.params&&"object"==typeof e.params.event&&null!==e.params.event};class jk{constructor(e){let{provider:t,caipNetworks:i,namespace:s}=e;this.id=sy.CONNECTOR_ID.WALLET_CONNECT,this.name=rk.ConnectorNamesMap[sy.CONNECTOR_ID.WALLET_CONNECT],this.type="WALLET_CONNECT",this.imageId=rk.ConnectorImageIds[sy.CONNECTOR_ID.WALLET_CONNECT],this.caipNetworks=i,this.provider=t,this.chain=s}get chains(){return this.caipNetworks}async connectWalletConnect(){if(!await this.authenticate()){const e=Uy.state.universalProviderConfigOverride,t=Dk.createNamespaces(this.caipNetworks,e);await this.provider.connect({optionalNamespaces:t})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(e=>e.caipNetworkId);return Sv.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:Rk})}}const Rk=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];class Uk{constructor(e){this.availableConnectors=[],this.eventListeners=new Map,e&&this.construct(e)}construct(e){this.caipNetworks=e.networks,this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get networks(){return this.caipNetworks||[]}setAuthProvider(e){this.addConnector({id:sy.CONNECTOR_ID.AUTH,type:"AUTH",name:sy.CONNECTOR_NAMES.AUTH,provider:e,imageId:rk.ConnectorImageIds[sy.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}addConnector(){const e=new Set;for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];this.availableConnectors=[...i,...this.availableConnectors].filter(t=>!e.has(t.id)&&(e.add(t.id),!0)),this.emit("connectors",this.availableConnectors)}setStatus(e,t){Gv.setStatus(e,t)}on(e,t){var i;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),null==(i=this.eventListeners.get(e))||i.add(t)}off(e,t){const i=this.eventListeners.get(e);i&&i.delete(t)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,t){const i=this.eventListeners.get(e);i&&i.forEach(e=>e(t))}async connectWalletConnect(e){return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}async switchNetwork(e){const{caipNetwork:t,providerType:i}=e;if(!e.provider)return;const s="provider"in e.provider?e.provider.provider:e.provider;if("WALLET_CONNECT"!==i){if(s&&"AUTH"===i){const e=s;await e.switchNetwork(t.caipNetworkId);const i=await e.getUser({chainId:t.caipNetworkId,preferredAccountType:Uy.state.defaultAccountTypes[t.chainNamespace]});this.emit("switchNetwork",i)}}else s.setDefaultChain(t.caipNetworkId)}getWalletConnectConnector(){const e=this.connectors.find(e=>e instanceof jk);if(!e)throw new Error("WalletConnectConnector not found");return e}}class Lk extends Uk{setUniversalProvider(e){this.addConnector(new jk({provider:e,caipNetworks:this.caipNetworks||[],namespace:this.namespace}))}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect()}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}}async getAccounts(e){let{namespace:t}=e;var i,s,n,r;const o=this.provider,a=(null==(r=null==(n=null==(s=null==(i=null==o?void 0:o.session)?void 0:i.namespaces)?void 0:s[t])?void 0:n.accounts)?void 0:r.map(e=>{const[,,t]=e.split(":");return t}).filter((e,t,i)=>i.indexOf(e)===t))||[];return Promise.resolve({accounts:a.map(e=>Sy.createAccount(t,e,"bip122"===t?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var t,i,s,n,r;if(!e.caipNetwork||!Ay.BALANCE_SUPPORTED_CHAINS.includes(null==(t=e.caipNetwork)?void 0:t.chainNamespace)||null!=(i=e.caipNetwork)&&i.testnet)return{balance:"0.00",symbol:(null==(s=e.caipNetwork)?void 0:s.nativeCurrency.symbol)||""};if(Gv.state.balanceLoading&&e.chainId===(null==(n=Bv.state.activeCaipNetwork)?void 0:n.id))return{balance:Gv.state.balance||"0.00",symbol:Gv.state.balanceSymbol||""};const o=(await Gv.fetchTokenBalance()).find(t=>{var i,s;return t.chainId==="".concat(null==(i=e.caipNetwork)?void 0:i.chainNamespace,":").concat(e.chainId)&&t.symbol===(null==(s=e.caipNetwork)?void 0:s.nativeCurrency.symbol)});return{balance:(null==o?void 0:o.quantity.numeric)||"0.00",symbol:(null==o?void 0:o.symbol)||(null==(r=e.caipNetwork)?void 0:r.nativeCurrency.symbol)||""}}async signMessage(e){var t,i,s;const{provider:n,message:r,address:o}=e;if(!n)throw new Error("UniversalAdapter:signMessage - provider is undefined");let a="";return a=(null==(t=Bv.state.activeCaipNetwork)?void 0:t.chainNamespace)===sy.CHAIN.SOLANA?(await n.request({method:"solana_signMessage",params:{message:dI.encode((new TextEncoder).encode(r)),pubkey:o}},null==(i=Bv.state.activeCaipNetwork)?void 0:i.caipNetworkId)).signature:await n.request({method:"personal_sign",params:[r,o]},null==(s=Bv.state.activeCaipNetwork)?void 0:s.caipNetworkId),{signature:a}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async getProfile(){return Promise.resolve({profileImage:"",profileName:""})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}async getEnsAddress(){return Promise.resolve({address:!1})}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var t,i,s,n,r,o;const{caipNetwork:a}=e,c=this.getWalletConnectConnector();if(a.chainNamespace===sy.CHAIN.EVM)try{await(null==(t=c.provider)?void 0:t.request({method:"wallet_switchEthereumChain",params:[{chainId:(0,I.t)(a.id)}]}))}catch(l){if(l.code===Sk||l.code===Tk||l.code===Pk||(null==(s=null==(i=null==l?void 0:l.data)?void 0:i.originalError)?void 0:s.code)===Sk)try{await(null==(o=c.provider)?void 0:o.request({method:"wallet_addEthereumChain",params:[{chainId:(0,I.t)(a.id),rpcUrls:[null==(n=null==a?void 0:a.rpcUrls.chainDefault)?void 0:n.http],chainName:a.name,nativeCurrency:a.nativeCurrency,blockExplorerUrls:[null==(r=a.blockExplorers)?void 0:r.default.url]}]}))}catch(h){throw new Error("Chain is not supported")}}c.provider.setDefaultChain(a.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(e=>"WALLET_CONNECT"===e.type);return null==e?void 0:e.provider}}class zk{constructor(e){var t;this.hasSwitchedToPreferredAccountTypeOnConnect=!1,this.chainNamespaces=[],this.reportedAlertErrors={},this.getCaipNetwork=e=>{var t,i;if(e){return(null==(t=Bv.getNetworkData(e))?void 0:t.caipNetwork)||(null==(i=Bv.getRequestedCaipNetworks(e).filter(t=>t.chainNamespace===e))?void 0:i[0])}return Bv.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const e=this.getCaipNetwork();if(e)return e.id},this.getCaipNetworks=e=>Bv.getRequestedCaipNetworks(e),this.getActiveChainNamespace=()=>Bv.state.activeChain,this.setRequestedCaipNetworks=(e,t)=>{Bv.setRequestedCaipNetworks(e,t)},this.getApprovedCaipNetworkIds=()=>Bv.getAllApprovedCaipNetworkIds(),this.getCaipAddress=e=>Bv.state.activeChain!==e&&e?Bv.getAccountProp("caipAddress",e):Bv.state.activeCaipAddress,this.setClientId=e=>{Wv.setClientId(e)},this.getProvider=e=>pk.getProvider(e),this.getProviderType=e=>pk.getProviderId(e),this.getPreferredAccountType=()=>Gv.state.preferredAccountType,this.setCaipAddress=(e,t)=>{Gv.setCaipAddress(e,t)},this.setBalance=(e,t,i)=>{Gv.setBalance(e,t,i)},this.setProfileName=(e,t)=>{Gv.setProfileName(e,t)},this.setProfileImage=(e,t)=>{Gv.setProfileImage(e,t)},this.setUser=(e,t)=>{Gv.setUser(e,t),Uy.state.enableEmbedded&&Qv.close()},this.resetAccount=e=>{Gv.resetAccount(e)},this.setCaipNetwork=e=>{Bv.setActiveCaipNetwork(e)},this.setCaipNetworkOfNamespace=(e,t)=>{Bv.setChainNetworkData(t,{caipNetwork:e})},this.setAllAccounts=(e,t)=>{Gv.setAllAccounts(e,t),Uy.setHasMultipleAddresses((null==e?void 0:e.length)>1)},this.setStatus=(e,t)=>{Gv.setStatus(e,t),tv.isConnected()?Cy.setConnectionStatus("connected"):Cy.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=e=>Bv.getAccountProp("address",e),this.setConnectors=e=>{const t=[...tv.getConnectors(),...e];tv.setConnectors(t)},this.fetchIdentity=e=>Wv.fetchIdentity(e),this.getReownName=e=>$v.getNamesForAddress(e),this.getConnectors=()=>tv.getConnectors(),this.getConnectorImage=e=>Dy.getConnectorImage(e),this.setConnectedWalletInfo=(e,t)=>{const i=pk.getProviderId(t),s=e?(0,d.A)((0,d.A)({},e),{},{type:i}):void 0;Gv.setConnectedWalletInfo(s,t)},this.getIsConnectedState=()=>!!Bv.state.activeCaipAddress,this.addAddressLabel=(e,t,i)=>{Gv.addAddressLabel(e,t,i)},this.removeAddressLabel=(e,t)=>{Gv.removeAddressLabel(e,t)},this.getAddress=e=>Bv.state.activeChain!==e&&e?Bv.getAccountProp("address",e):Gv.state.address,this.setApprovedCaipNetworksData=e=>Bv.setApprovedCaipNetworksData(e),this.resetNetwork=e=>{Bv.resetNetwork(e)},this.addConnector=e=>{tv.addConnector(e)},this.resetWcConnection=()=>{Ov.resetWcConnection()},this.setAddressExplorerUrl=(e,t)=>{Gv.setAddressExplorerUrl(e,t)},this.setSmartAccountDeployed=(e,t)=>{Gv.setSmartAccountDeployed(e,t)},this.setSmartAccountEnabledNetworks=(e,t)=>{Bv.setSmartAccountEnabledNetworks(e,t)},this.setPreferredAccountType=(e,t)=>{Gv.setPreferredAccountType(e,t)},this.setEIP6963Enabled=e=>{Uy.setEIP6963Enabled(e)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=[...new Set(null==(t=this.caipNetworks)?void 0:t.map(e=>e.chainNamespace))],this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.initialize(e),this.sendInitializeEvent(e)}async initialize(e){this.initControllers(e),await this.initChainAdapters(),await this.injectModalUi(),await this.syncExistingConnection(),kv.set({initialized:!0})}sendInitializeEvent(e){var t;const i=Object.assign({},((0,l.A)(e),e));delete i.adapters,Ky.sendEvent({type:"track",event:"INITIALIZE",properties:(0,d.A)((0,d.A)({},i),{},{networks:e.networks.map(e=>e.id),siweConfig:{options:(null==(t=e.siweConfig)?void 0:t.options)||{}}})})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initializeThemeController(e){e.themeMode&&Xy.setThemeMode(e.themeMode),e.themeVariables&&Xy.setThemeVariables(e.themeVariables)}initializeChainController(e){var t;if(!this.connectionControllerClient||!this.networkControllerClient)throw new Error("ConnectionControllerClient and NetworkControllerClient must be set");Bv.initialize(null!==(t=e.adapters)&&void 0!==t?t:[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient});const i=this.getDefaultNetwork();i&&Bv.setActiveCaipNetwork(i)}initializeConnectionController(e){var t;Ov.setWcBasic(null!==(t=e.basic)&&void 0!==t&&t)}initializeConnectorController(){tv.initialize(this.chainNamespaces)}initializeOptionsController(e){var t;Uy.setDebug(!1!==e.debug),Uy.setEnableWalletConnect(!1!==e.enableWalletConnect),Uy.setEnableWalletGuide(!1!==e.enableWalletGuide),Uy.setEnableWallets(!1!==e.enableWallets),Uy.setEIP6963Enabled(!1!==e.enableEIP6963),Uy.setEnableNetworkSwitch(!1!==e.enableNetworkSwitch),Uy.setEnableAuthLogger(!1!==e.enableAuthLogger),Uy.setCustomRpcUrls(e.customRpcUrls),Uy.setSdkVersion(e.sdkVersion),Uy.setProjectId(e.projectId),Uy.setEnableEmbedded(e.enableEmbedded),Uy.setAllWallets(e.allWallets),Uy.setIncludeWalletIds(e.includeWalletIds),Uy.setExcludeWalletIds(e.excludeWalletIds),Uy.setFeaturedWalletIds(e.featuredWalletIds),Uy.setTokens(e.tokens),Uy.setTermsConditionsUrl(e.termsConditionsUrl),Uy.setPrivacyPolicyUrl(e.privacyPolicyUrl),Uy.setCustomWallets(e.customWallets),Uy.setFeatures(e.features),Uy.setAllowUnsupportedChain(e.allowUnsupportedChain),Uy.setDefaultAccountTypes(e.defaultAccountTypes),Uy.setUniversalProviderConfigOverride(e.universalProviderConfigOverride);const i=this.getDefaultMetaData();if(!e.metadata&&i&&(e.metadata=i),Uy.setMetadata(e.metadata),Uy.setDisableAppend(e.disableAppend),Uy.setEnableEmbedded(e.enableEmbedded),Uy.setSIWX(e.siwx),e.projectId){if((null==(t=e.adapters)?void 0:t.find(e=>e.namespace===sy.CHAIN.EVM))&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");Uy.setSIWX(e.siweConfig.mapToSIWX())}}else zy.open(ak.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error")}getDefaultMetaData(){var e,t,i,s;return typeof window<"u"&&typeof document<"u"?{name:(null==(t=null==(e=document.getElementsByTagName("title"))?void 0:e[0])?void 0:t.textContent)||"",description:(null==(i=document.querySelector('meta[property="og:description"]'))?void 0:i.content)||"",url:window.location.origin,icons:[(null==(s=document.querySelector('link[rel~="icon"]'))?void 0:s.href)||""]}:null}setUnsupportedNetwork(e){const t=this.getActiveChainNamespace();if(t){const i=hk.getUnsupportedNetwork("".concat(t,":").concat(e));Bv.setActiveCaipNetwork(i)}}getDefaultNetwork(){return hk.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,t){return hk.extendCaipNetwork(e,{customNetworkImageUrls:t.chainImages,projectId:t.projectId})}extendCaipNetworks(e){return hk.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const t=e.networks.find(t=>{var i;return t.id===(null==(i=e.defaultNetwork)?void 0:i.id)});return t?hk.extendCaipNetwork(t,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var e;const t=Bv.state.activeChain,i=this.getAdapter(t),s=null==(e=this.getCaipNetwork(t))?void 0:e.id;if(!i)throw new Error("Adapter not found");const n=await i.connectWalletConnect(s);this.close(),this.setClientId((null==n?void 0:n.clientId)||null),Cy.setConnectedNamespaces([...Bv.state.chains.keys()]),this.chainNamespaces.forEach(e=>{tv.setConnectorId(ik,e)}),await this.syncWalletConnectAccount()},connectExternal:async e=>{let{id:t,info:i,type:s,provider:n,chain:r,caipNetwork:o}=e;var a,c,l,h,u,p,g;const f=Bv.state.activeChain,w=r||f,m=this.getAdapter(w);if(r&&r!==f&&!o){const e=null==(a=this.caipNetworks)?void 0:a.find(e=>e.chainNamespace===r);e&&this.setCaipNetwork(e)}if(!m)throw new Error("Adapter not found");const y=this.getCaipNetwork(w),v=await m.connect({id:t,info:i,type:s,provider:n,chainId:(null==o?void 0:o.id)||(null==y?void 0:y.id),rpcUrl:(null==(h=null==(l=null==(c=null==o?void 0:o.rpcUrls)?void 0:c.default)?void 0:l.http)?void 0:h[0])||(null==(g=null==(p=null==(u=null==y?void 0:y.rpcUrls)?void 0:u.default)?void 0:p.http)?void 0:g[0])});if(!v)return;Cy.addConnectedNamespace(w),this.syncProvider((0,d.A)((0,d.A)({},v),{},{chainNamespace:w})),await this.syncAccount((0,d.A)((0,d.A)({},v),{},{chainNamespace:w}));const{accounts:b}=await m.getAccounts({namespace:w,id:t});this.setAllAccounts(b,w)},reconnectExternal:async e=>{let{id:t,info:i,type:s,provider:n}=e;var r;const o=Bv.state.activeChain,a=this.getAdapter(o);null!=a&&a.reconnect&&(await(null==a?void 0:a.reconnect({id:t,info:i,type:s,provider:n,chainId:null==(r=this.getCaipNetwork())?void 0:r.id})),Cy.addConnectedNamespace(o))},disconnect:async e=>{const t=e||Bv.state.activeChain,i=this.getAdapter(t),s=pk.getProvider(t),n=pk.getProviderId(t);await(null==i?void 0:i.disconnect({provider:s,providerType:n})),Cy.removeConnectedNamespace(t),pk.resetChain(t),this.setUser(void 0,t),this.setStatus("disconnected",t),this.hasSwitchedToPreferredAccountTypeOnConnect=!1},checkInstalled:e=>e?e.some(e=>{var t;return!(null==(t=window.ethereum)||!t[String(e)])}):!!window.ethereum,signMessage:async e=>{const t=this.getAdapter(Bv.state.activeChain),i=await(null==t?void 0:t.signMessage({message:e,address:Gv.state.address,provider:pk.getProvider(Bv.state.activeChain)}));return(null==i?void 0:i.signature)||""},sendTransaction:async e=>{if(e.chainNamespace===sy.CHAIN.EVM){const t=this.getAdapter(Bv.state.activeChain),i=pk.getProvider(Bv.state.activeChain),s=await(null==t?void 0:t.sendTransaction((0,d.A)((0,d.A)({},e),{},{caipNetwork:this.getCaipNetwork(),provider:i})));return(null==s?void 0:s.hash)||""}return""},estimateGas:async e=>{if(e.chainNamespace===sy.CHAIN.EVM){const t=this.getAdapter(Bv.state.activeChain),i=pk.getProvider(Bv.state.activeChain),s=this.getCaipNetwork();if(!s)throw new Error("CaipNetwork is undefined");const n=await(null==t?void 0:t.estimateGas((0,d.A)((0,d.A)({},e),{},{provider:i,caipNetwork:s})));return(null==n?void 0:n.gas)||0n}return 0n},getEnsAvatar:async()=>{var e;const t=this.getAdapter(Bv.state.activeChain),i=await(null==t?void 0:t.getProfile({address:Gv.state.address,chainId:Number(null==(e=this.getCaipNetwork())?void 0:e.id)}));return(null==i?void 0:i.profileImage)||!1},getEnsAddress:async e=>{const t=this.getAdapter(Bv.state.activeChain),i=this.getCaipNetwork();if(!i)return!1;const s=await(null==t?void 0:t.getEnsAddress({name:e,caipNetwork:i}));return(null==s?void 0:s.address)||!1},writeContract:async e=>{const t=this.getAdapter(Bv.state.activeChain),i=this.getCaipNetwork(),s=this.getCaipAddress(),n=pk.getProvider(Bv.state.activeChain);if(!i||!s)throw new Error("CaipNetwork or CaipAddress is undefined");const r=await(null==t?void 0:t.writeContract((0,d.A)((0,d.A)({},e),{},{caipNetwork:i,provider:n,caipAddress:s})));return null==r?void 0:r.hash},parseUnits:(e,t)=>{var i;const s=this.getAdapter(Bv.state.activeChain);return null!==(i=null==s?void 0:s.parseUnits({value:e,decimals:t}))&&void 0!==i?i:0n},formatUnits:(e,t)=>{var i;const s=this.getAdapter(Bv.state.activeChain);return null!==(i=null==s?void 0:s.formatUnits({value:e,decimals:t}))&&void 0!==i?i:"0"},getCapabilities:async e=>{const t=this.getAdapter(Bv.state.activeChain);return await(null==t?void 0:t.getCapabilities(e))},grantPermissions:async e=>{const t=this.getAdapter(Bv.state.activeChain);return await(null==t?void 0:t.grantPermissions(e))},revokePermissions:async e=>{const t=this.getAdapter(Bv.state.activeChain);return null!=t&&t.revokePermissions?await t.revokePermissions(e):"0x"},walletGetAssets:async e=>{var t;const i=this.getAdapter(Bv.state.activeChain);return null!==(t=await(null==i?void 0:i.walletGetAssets(e)))&&void 0!==t?t:{}}},this.networkControllerClient={switchCaipNetwork:async e=>await this.switchCaipNetwork(e),getApprovedCaipNetworksData:async()=>this.getApprovedCaipNetworksData()},Ov.setClient(this.connectionControllerClient)}getApprovedCaipNetworksData(){var e,t,i,s,n;if(pk.getProviderId(Bv.state.activeChain)===ik){const r=null==(t=null==(e=this.universalProvider)?void 0:e.session)?void 0:t.namespaces;return{supportsAllNetworks:"MetaMask Wallet"===(null==(n=null==(s=null==(i=this.universalProvider)?void 0:i.session)?void 0:s.peer)?void 0:n.metadata.name),approvedCaipNetworkIds:this.getChainsFromNamespaces(r)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){if(!e)return;const t=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const i=pk.getProvider(t),s=pk.getProviderId(t);if(e.chainNamespace===Bv.state.activeChain){const n=this.getAdapter(t);await(null==n?void 0:n.switchNetwork({caipNetwork:e,provider:i,providerType:s}))}else if(this.setCaipNetwork(e),s===ik)this.syncWalletConnectAccount();else{const i=this.getAddressByChainNamespace(t);i&&this.syncAccount({address:i,chainId:e.id,chainNamespace:t})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.values(e).flatMap(e=>{const t=e.chains||[],i=e.accounts.map(e=>{const{chainId:t,chainNamespace:i}=ry.parseCaipAddress(e);return"".concat(i,":").concat(t)});return Array.from(new Set([...t,...i]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((t,i)=>{var s;const n=null==e?void 0:e.find(e=>e.namespace===i);return n?(t[i]=n,t[i].namespace=i,t[i].construct({namespace:i,projectId:null==(s=this.options)?void 0:s.projectId,networks:this.caipNetworks})):t[i]=new Lk({namespace:i,networks:this.caipNetworks}),t},{})}async initChainAdapter(e){var t;this.onConnectors(e),this.listenAdapter(e),null==(t=this.chainAdapters)||t[e].syncConnectors(this.options,this),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)}))}onConnectors(e){const t=this.getAdapter(e);null==t||t.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const t=this.getAdapter(e);if(!t)return;const i=Cy.getConnectionStatus();"connected"===i?this.setStatus("connecting",e):"disconnected"===i?(Cy.clearAddressCache(),this.setStatus(i,e)):this.setStatus(i,e),t.on("switchNetwork",t=>{let{address:i,chainId:s}=t;var n;const r=null==(n=this.caipNetworks)?void 0:n.find(e=>e.id===s||e.caipNetworkId===s),o=Bv.state.activeChain===e,a=Bv.getAccountProp("address",e);if(r){const t=o&&i?i:a;t&&this.syncAccount({address:t,chainId:s,chainNamespace:e})}else this.setUnsupportedNetwork(s)}),t.on("disconnect",this.disconnect.bind(this,e)),t.on("pendingTransactions",()=>{const e=Gv.state.address,t=Bv.state.activeCaipNetwork;!e||null==t||!t.id||this.updateNativeBalance(e,t.id,t.chainNamespace)}),t.on("accountChanged",t=>{let{address:i,chainId:s}=t;var n,r;const o=Bv.state.activeChain===e;o&&s?this.syncAccount({address:i,chainId:s,chainNamespace:e}):o&&null!=(n=Bv.state.activeCaipNetwork)&&n.id?this.syncAccount({address:i,chainId:null==(r=Bv.state.activeCaipNetwork)?void 0:r.id,chainNamespace:e}):this.syncAccountInfo(i,s,e)})}async createUniversalProviderForAdapter(e){var t,i,s;await this.getUniversalProvider(),this.universalProvider&&(null==(s=null==(i=null==(t=this.chainAdapters)?void 0:t[e])?void 0:i.setUniversalProvider)||s.call(i,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async syncNamespaceConnection(e){try{const t=tv.getConnectorId(e);switch(this.setStatus("connecting",e),t){case sy.CONNECTOR_ID.WALLET_CONNECT:await this.syncWalletConnectAccount();break;case sy.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(t){console.warn("AppKit couldn't sync existing connection",t),this.setStatus("disconnected",e)}}async syncAdapterConnection(e){var t,i,s;const n=this.getAdapter(e),r=tv.getConnectorId(e),o=this.getCaipNetwork(e),a=tv.getConnectors(e).find(e=>e.id===r);try{if(!n||!a)throw new Error("Adapter or connector not found for namespace ".concat(e));if(null==o||!o.id)throw new Error("CaipNetwork not found");const r=await(null==n?void 0:n.syncConnection({namespace:e,id:a.id,chainId:o.id,rpcUrl:null==(s=null==(i=null==(t=null==o?void 0:o.rpcUrls)?void 0:t.default)?void 0:i.http)?void 0:s[0]}));if(r){const t=await(null==n?void 0:n.getAccounts({namespace:e,id:a.id}));t&&t.accounts.length>0?this.setAllAccounts(t.accounts,e):this.setAllAccounts([Sy.createAccount(e,r.address,"eoa")],e),this.syncProvider((0,d.A)((0,d.A)({},r),{},{chainNamespace:e})),await this.syncAccount((0,d.A)((0,d.A)({},r),{},{chainNamespace:e})),this.setStatus("connected",e)}else this.setStatus("disconnected",e)}catch(c){this.setStatus("disconnected",e)}}async syncWalletConnectAccount(){const e=this.chainNamespaces.map(async e=>{var t,i,s,n,r;const o=this.getAdapter(e),a=(null==(n=null==(s=null==(i=null==(t=this.universalProvider)?void 0:t.session)?void 0:i.namespaces)?void 0:s[e])?void 0:n.accounts)||[],c=null==(r=Bv.state.activeCaipNetwork)?void 0:r.id,l=a.find(e=>{const{chainId:t}=ry.parseCaipAddress(e);return t===(null==c?void 0:c.toString())})||a[0];if(l){const t=ry.validateCaipAddress(l),{chainId:i,address:s}=ry.parseCaipAddress(t);if(pk.setProviderId(e,ik),this.caipNetworks&&Bv.state.activeCaipNetwork&&(null==o?void 0:o.namespace)!==sy.CHAIN.EVM){const t=null==o?void 0:o.getWalletConnectProvider({caipNetworks:this.caipNetworks,provider:this.universalProvider,activeCaipNetwork:Bv.state.activeCaipNetwork});pk.setProvider(e,t)}else pk.setProvider(e,this.universalProvider);tv.setConnectorId(sy.CONNECTOR_ID.WALLET_CONNECT,e),Cy.addConnectedNamespace(e),this.syncWalletConnectAccounts(e),await this.syncAccount({address:s,chainId:i,chainNamespace:e})}else this.setStatus("disconnected",e);await Bv.setApprovedCaipNetworksData(e)});await Promise.all(e)}syncWalletConnectAccounts(e){var t,i,s,n,r;const o=null==(r=null==(n=null==(s=null==(i=null==(t=this.universalProvider)?void 0:t.session)?void 0:i.namespaces)?void 0:s[e])?void 0:n.accounts)?void 0:r.map(e=>{const{address:t}=ry.parseCaipAddress(e);return t}).filter((e,t,i)=>i.indexOf(e)===t);o&&this.setAllAccounts(o.map(t=>Sy.createAccount(e,t,"bip122"===e?"payment":"eoa")),e)}syncProvider(e){let{type:t,provider:i,id:s,chainNamespace:n}=e;pk.setProviderId(n,t),pk.setProvider(n,i),tv.setConnectorId(s,n)}async syncAccount(e){var t,i,s,n,r,o;const a=e.chainNamespace===Bv.state.activeChain,c=Bv.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:l,chainId:h,chainNamespace:d}=e,{chainId:u}=Cy.getActiveNetworkProps(),p=h||u,g=(null==(t=Bv.state.activeCaipNetwork)?void 0:t.name)===sy.UNSUPPORTED_NETWORK_NAME,f=Bv.getNetworkProp("supportsAllNetworks",d);if(this.setStatus("connected",d),(!g||f)&&p){let e=null==(i=this.caipNetworks)?void 0:i.find(e=>e.id.toString()===p.toString()),t=null==(s=this.caipNetworks)?void 0:s.find(e=>e.chainNamespace===d);if(!f&&!e&&!t){const i=this.getApprovedCaipNetworkIds()||[],s=i.find(e=>{var t;return(null==(t=ry.parseCaipNetworkId(e))?void 0:t.chainId)===p.toString()}),o=i.find(e=>{var t;return(null==(t=ry.parseCaipNetworkId(e))?void 0:t.chainNamespace)===d});e=null==(n=this.caipNetworks)?void 0:n.find(e=>e.caipNetworkId===s),t=null==(r=this.caipNetworks)?void 0:r.find(e=>e.caipNetworkId===o||"deprecatedCaipNetworkId"in e&&e.deprecatedCaipNetworkId===o)}const h=e||t;(null==h?void 0:h.chainNamespace)===Bv.state.activeChain?Uy.state.enableNetworkSwitch&&!Uy.state.allowUnsupportedChain&&(null==(o=Bv.state.activeCaipNetwork)?void 0:o.name)===sy.UNSUPPORTED_NETWORK_NAME?Bv.showUnsupportedChainUI():this.setCaipNetwork(h):a||c&&this.setCaipNetworkOfNamespace(c,d),this.syncConnectedWalletInfo(d),ok.isLowerCaseMatch(l,Gv.state.address)||this.syncAccountInfo(l,null==h?void 0:h.id,d),a?await this.syncBalance({address:l,chainId:null==h?void 0:h.id,chainNamespace:d}):await this.syncBalance({address:l,chainId:null==c?void 0:c.id,chainNamespace:d})}}async syncAccountInfo(e,t,i){const s=this.getCaipAddress(i),n=t||(null==s?void 0:s.split(":")[1]);if(!n)return;const r="".concat(i,":").concat(n,":").concat(e);this.setCaipAddress(r,i),await this.syncIdentity({address:e,chainId:n,chainNamespace:i})}async syncReownName(e,t){try{const i=await this.getReownName(e);if(i[0]){const e=i[0];this.setProfileName(e.name,t)}else this.setProfileName(null,t)}catch(i){this.setProfileName(null,t)}}syncConnectedWalletInfo(e){var t;const i=tv.getConnectorId(e),s=pk.getProviderId(e);if(s===nk||s===sk){if(i){const t=this.getConnectors().find(e=>e.id===i);if(t){const{info:i,name:s,imageUrl:n}=t,r=n||this.getConnectorImage(t);this.setConnectedWalletInfo((0,d.A)({name:s,icon:r},i),e)}}}else if(s===ik){const i=pk.getProvider(e);null!=i&&i.session&&this.setConnectedWalletInfo((0,d.A)((0,d.A)({},i.session.peer.metadata),{},{name:i.session.peer.metadata.name,icon:null==(t=i.session.peer.metadata.icons)?void 0:t[0]}),e)}else if(i)if(i===sy.CONNECTOR_ID.COINBASE){const t=this.getConnectors().find(e=>e.id===sy.CONNECTOR_ID.COINBASE);this.setConnectedWalletInfo({name:"Coinbase Wallet",icon:this.getConnectorImage(t)},e)}else this.setConnectedWalletInfo({name:i},e)}async syncBalance(e){!$m.getNetworksByNamespace(this.caipNetworks,e.chainNamespace).find(t=>{var i;return t.id.toString()===(null==(i=e.chainId)?void 0:i.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async updateNativeBalance(e,t,i){const s=this.getAdapter(i);if(s){const n=await s.getBalance({address:e,chainId:t,caipNetwork:this.getCaipNetwork(i),tokens:this.options.tokens});this.setBalance(n.balance,n.symbol,i)}}async initializeUniversalAdapter(){var e,t,i,s,n,r,o,a,c,l,h,d=this;const u=ck.createLogger(function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];e&&d.handleAlertError(e),console.error(...i)}),p={projectId:null==(t=this.options)?void 0:t.projectId,metadata:{name:null!=(i=this.options)&&i.metadata?null==(s=this.options)?void 0:s.metadata.name:"",description:null!=(n=this.options)&&n.metadata?null==(r=this.options)?void 0:r.metadata.description:"",url:null!=(o=this.options)&&o.metadata?null==(a=this.options)?void 0:a.metadata.url:"",icons:null!=(c=this.options)&&c.metadata?null==(l=this.options)?void 0:l.metadata.icons:[""]},logger:u};Uy.setManualWCControl(!(null==(h=this.options)||!h.manualWCControl)),this.universalProvider=null!==(e=this.options.universalProvider)&&void 0!==e?e:await ek.init(p),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&(this.universalProvider.on("display_uri",e=>{Ov.setUri(e)}),this.universalProvider.on("connect",Ov.finalizeWcConnection),this.universalProvider.on("disconnect",()=>{this.chainNamespaces.forEach(e=>{this.resetAccount(e)}),Ov.resetWcConnection()}),this.universalProvider.on("chainChanged",e=>{var t;const i=null==(t=this.caipNetworks)?void 0:t.find(t=>t.id==e),s=this.getCaipNetwork();i?(null==s?void 0:s.id)!==(null==i?void 0:i.id)&&this.setCaipNetwork(i):this.setUnsupportedNetwork(e)}),this.universalProvider.on("session_event",e=>{if(Dk.isSessionEventData(e)){const{name:t,data:i}=e.params.event;"accountsChanged"===t&&Array.isArray(i)&&Sy.isCaipAddress(i[0])&&this.syncAccount(ry.parseCaipAddress(i[0]))}}))}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&Sy.isClient()&&null!=(e=this.options)&&e.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){Ky.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}handleAlertError(e){const t=Object.entries(ak.UniversalProviderErrors).find(t=>{let[,{message:i}]=t;return e.message.includes(i)}),[i,s]=null!==t&&void 0!==t?t:[],{message:n,alertErrorKey:r}=null!==s&&void 0!==s?s:{};if(i&&n&&!this.reportedAlertErrors[i]){const e=ak.ALERT_ERRORS[r];e&&(zy.open(e,"error"),this.reportedAlertErrors[i]=!0)}}getAdapter(e){var t;if(e)return null==(t=this.chainAdapters)?void 0:t[e]}createAdapter(e){var t;if(!e)return;const i=e.namespace;if(!i)return;this.createClients();const s=e;s.namespace=i,s.construct({namespace:i,projectId:null==(t=this.options)?void 0:t.projectId,networks:this.caipNetworks}),this.chainNamespaces.includes(i)||this.chainNamespaces.push(i),this.chainAdapters&&(this.chainAdapters[i]=s)}async open(e){await this.injectModalUi(),null!=e&&e.uri&&Ov.setUri(e.uri),await Qv.open(e)}async close(){await this.injectModalUi(),Qv.close()}setLoading(e,t){Qv.setLoading(e,t)}async disconnect(e){await Ov.disconnect(e)}getError(){return""}getChainId(){var e;return null==(e=Bv.state.activeCaipNetwork)?void 0:e.id}async switchNetwork(e){var t;const i=null==(t=this.caipNetworks)?void 0:t.find(t=>t.id===e.id);i?await Bv.switchActiveNetwork(i):zy.open(ak.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error")}getWalletProvider(){return Bv.state.activeChain?pk.state.providers[Bv.state.activeChain]:null}getWalletProviderType(){return pk.getProviderId(Bv.state.activeChain)}subscribeProviders(e){return pk.subscribeProviders(e)}getThemeMode(){return Xy.state.themeMode}getThemeVariables(){return Xy.state.themeVariables}setThemeMode(e){Xy.setThemeMode(e),Ik(Xy.state.themeMode)}setTermsConditionsUrl(e){Uy.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){Uy.setPrivacyPolicyUrl(e)}setThemeVariables(e){Xy.setThemeVariables(e),function(e){mk&&yk&&vk&&(mk.textContent=Ek(e).core.cssText,yk.textContent=Ek(e).dark.cssText,vk.textContent=Ek(e).light.cssText)}(Xy.state.themeVariables)}subscribeTheme(e){return Xy.subscribe(e)}getWalletInfo(){return Gv.state.connectedWalletInfo}getAccount(e){const t=tv.getAuthConnector(e),i=Bv.getAccountData(e);if(i)return{allAccounts:i.allAccounts,caipAddress:i.caipAddress,address:Sy.getPlainAddress(i.caipAddress),isConnected:!!i.caipAddress,status:i.status,embeddedWalletInfo:t?{user:i.user,authProvider:i.socialProvider||"email",accountType:i.preferredAccountType,isSmartAccountDeployed:!!i.smartAccountDeployed}:void 0}}subscribeAccount(e,t){const i=()=>{const i=this.getAccount(t);i&&e(i)};t?Bv.subscribeChainProp("accountState",i,t):Bv.subscribe(i),tv.subscribe(i)}subscribeNetwork(e){return Bv.subscribe(t=>{let{activeCaipNetwork:i}=t;e({caipNetwork:i,chainId:null==i?void 0:i.id,caipNetworkId:null==i?void 0:i.caipNetworkId})})}subscribeWalletInfo(e){return Gv.subscribeKey("connectedWalletInfo",e)}subscribeShouldUpdateToAddress(e){Gv.subscribeKey("shouldUpdateToAddress",e)}subscribeCaipNetworkChange(e){Bv.subscribeKey("activeCaipNetwork",e)}getState(){return kv.state}subscribeState(e){return kv.subscribe(e)}showErrorMessage(e){Cv.showError(e)}showSuccessMessage(e){Cv.showSuccess(e)}getEvent(){return(0,d.A)({},Ky.state)}subscribeEvents(e){return Ky.subscribe(e)}replace(e){Zy.replace(e)}redirect(e){Zy.push(e)}popTransactionStack(e){Zy.popTransactionStack(e)}isOpen(){return Qv.state.open}isTransactionStackEmpty(){return 0===Zy.state.transactionStack.length}isTransactionShouldReplaceView(){var e;return null==(e=Zy.state.transactionStack[Zy.state.transactionStack.length-1])?void 0:e.replace}static getInstance(){return this.instance}updateFeatures(e){Uy.setFeatures(e)}updateOptions(e){const t=(0,d.A)((0,d.A)({},Uy.state||{}),e);Uy.setOptions(t)}setConnectMethodsOrder(e){Uy.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){Uy.setWalletFeaturesOrder(e)}setCollapseWallets(e){Uy.setCollapseWallets(e)}setSocialsOrder(e){Uy.setSocialsOrder(e)}getConnectMethodsOrder(){return fk.getConnectOrderMethod(Uy.state.features,tv.getConnectors())}removeAdapter(e){var t;const i=this.getIsConnectedState(),s=this.getAdapter(e);if(!s||!this.chainAdapters||i)return;const n=null==(t=this.caipNetworks)?void 0:t.filter(t=>t.chainNamespace!==e);Bv.removeAdapter(e),tv.removeAdapter(e),this.chainNamespaces=this.chainNamespaces.filter(t=>t!==e),this.caipNetworks=n,s.removeAllEventListeners(),Reflect.deleteProperty(this.chainAdapters,e)}addAdapter(e,t){const i=e.namespace;if(!this.connectionControllerClient||!this.networkControllerClient||!this.chainAdapters||!i)return;const s=this.extendCaipNetworks((0,d.A)((0,d.A)({},this.options),{},{networks:t}));this.caipNetworks=[...this.caipNetworks||[],...s],this.createAdapter(e),this.initChainAdapter(i),Bv.addAdapter(e,{connectionControllerClient:this.connectionControllerClient,networkControllerClient:this.networkControllerClient},s)}addNetwork(e,t){var i;if(this.chainAdapters&&!this.chainAdapters[e])throw new Error("Adapter for namespace ".concat(e," doesn't exist"));const s=this.extendCaipNetwork(t,this.options);Bv.addNetwork(s),this.caipNetworks&&(null==(i=this.caipNetworks)||!i.find(e=>e.id===s.id))&&this.caipNetworks.push(s)}removeNetwork(e,t){var i;if(this.chainAdapters&&!this.chainAdapters[e])throw new Error("Adapter for namespace ".concat(e," doesn't exist"));if(!(null==(i=this.caipNetworks)?void 0:i.find(e=>e.id===t)))throw new Error("Network with ID ".concat(t," not found"));if(!this.caipNetworks)return;const s=this.caipNetworks.filter(i=>i.chainNamespace===e&&i.id!==t);if(null==s||!s.length)throw new Error("Cannot remove last network for a namespace");Bv.removeNetwork(e,t),this.caipNetworks=[...s]}}let qk=!1;class Bk extends zk{async open(e){tv.isConnected()||await super.open(e)}async close(){await super.close(),this.options.manualWCControl&&Ov.finalizeWcConnection()}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!qk&&Sy.isClient()){if(await Promise.all([i.e(554),i.e(6683),i.e(5694)]).then(i.bind(i,5694)),await Promise.all([i.e(6683),i.e(2292)]).then(i.bind(i,2292)),!document.querySelector("w3m-modal")){const e=document.createElement("w3m-modal");!Uy.state.disableAppend&&!Uy.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",e)}qk=!0}}}const Vk=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let a=0;a<t.length;a++)t[a]=255;for(let a=0;a<e.length;a++){const i=e.charAt(a),s=i.charCodeAt(0);if(255!==t[s])throw new TypeError(i+" is ambiguous");t[s]=a}const i=e.length,s=e.charAt(0),n=Math.log(i)/Math.log(256),r=Math.log(256)/Math.log(i);function o(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let r=0,o=0,a=0;for(;e[r]===s;)o++,r++;const c=(e.length-r)*n+1>>>0,l=new Uint8Array(c);for(;r<e.length;){const s=e.charCodeAt(r);if(s>255)return;let n=t[s];if(255===n)return;let o=0;for(let e=c-1;(0!==n||o<a)&&-1!==e;e--,o++)n+=i*l[e]>>>0,l[e]=n%256>>>0,n=n/256>>>0;if(0!==n)throw new Error("Non-zero carry");a=o,r++}let h=c-a;for(;h!==c&&0===l[h];)h++;const d=new Uint8Array(o+(c-h));let u=o;for(;h!==c;)d[u++]=l[h++];return d}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let n=0,o=0,a=0;const c=t.length;for(;a!==c&&0===t[a];)a++,n++;const l=(c-a)*r+1>>>0,h=new Uint8Array(l);for(;a!==c;){let e=t[a],s=0;for(let t=l-1;(0!==e||s<o)&&-1!==t;t--,s++)e+=256*h[t]>>>0,h[t]=e%i>>>0,e=e/i>>>0;if(0!==e)throw new Error("Non-zero carry");o=s,a++}let d=l-o;for(;d!==l&&0===h[d];)d++;let u=s.repeat(n);for(;d<l;++d)u+=e.charAt(h[d]);return u},decodeUnsafe:o,decode:function(e){const t=o(e);if(t)return t;throw new Error("Non-base"+i+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");class Hk extends Error{constructor(){super(),Object.setPrototypeOf(this,Hk.prototype)}}class Kk extends Error{constructor(e){super("WalletConnect Adapter - Method ".concat(e," is not supported by the wallet")),this.name="WalletConnectFeatureNotSupportedError"}}function Wk(e){let t=[e];return e===be||e===Ee?(t=[be,Ee],e===Ee&&console.warn(Fk.mainnet)):(e===Ne||e===Ie)&&(t=[Ie,Ne],console.warn(Fk.devnet)),t}const Fk={mainnet:"You are using a deprecated chain ID for Solana Mainnet, please use ".concat(be," instead."),devnet:"You are using a deprecated chain ID for Solana Devnet, please use ".concat(Ie," instead."),wallet:"The connected wallet is using a deprecated chain ID for Solana. Please, contact them to upgrade. You can learn more at https://github.com/ChainAgnostic/namespaces/blob/main/solana/caip10.md#chain-ids"};function Gk(e,t){var i;const s=null==(i=e.namespaces.solana)?void 0:i.accounts.map(e=>"solana:".concat(e.split(":")[1]));if(t===be)return null!=s&&s.find(e=>e===be)?be:(console.warn(Fk.wallet),Ee);if(t===Ie)return null!=s&&s.find(e=>e===Ie)?Ie:(console.warn(Fk.wallet),Ne);throw Error("WalletConnect Solana Adapter: Unable to get a default chain from the session.")}class Yk extends Error{constructor(){super("QR Code Modal was closed by user"),Object.setPrototypeOf(this,Yk.prototype),this.name="QRCodeModalError"}}class Qk{constructor(e){if(k(this,"_UniversalProvider"),k(this,"_session"),k(this,"_modal"),k(this,"_projectId"),k(this,"_network"),k(this,"_ConnectQueueResolver"),this.initClient(e.options),this._network=e.network,!e.options.projectId)throw Error("WalletConnect Adapter: Project ID is undefined");this._projectId=e.options.projectId}async connect(){var e,t,i,s,n,r;if(this._UniversalProvider||await new Promise(e=>{this._ConnectQueueResolver=e}),!this._UniversalProvider)throw new Error("WalletConnect Adapter - Universal Provider was undefined while calling 'connect()'");if(this._UniversalProvider.session){this._session=this._UniversalProvider.session;const e=Gk(this._session,this._network);return this._network=e,this._UniversalProvider.setDefaultChain(e),{publicKey:this.publicKey}}await this.initModal();const o=function(e){return{optionalNamespaces:{solana:{chains:Wk(e),methods:[ve.signTransaction,ve.signMessage],events:[]}}}}(this._network);null==(e=this._modal)||e.open();const a=new AbortController,c=a.signal;null==(t=this._modal)||t.subscribeState(e=>{e.open||a.abort(new Yk)});try{const e=await Promise.race([null==(i=this._UniversalProvider)?void 0:i.connect(o),new Promise((e,t)=>{c.addEventListener("abort",()=>{t(c.reason)})})]);if(null==(s=this._modal)||s.close(),this._session=e,!e)throw new L;const t=Gk(e,this._network);return this._network=t,null==(n=this._UniversalProvider)||n.setDefaultChain(t),{publicKey:this.publicKey}}catch(l){throw null==(r=this._modal)||r.close(),l}}async disconnect(){var e;if(null==(e=this._UniversalProvider)||!e.session)throw new Hk;if(await this.initModal(),!this._modal)throw Error("WalletConnect Adapter -Modal is undefined: unable to disconnect");await this.client.disconnect(),this._session=void 0}get client(){if(this._UniversalProvider)return this._UniversalProvider;throw new Hk}get session(){if(!this._session)throw new Hk;return this._session}get publicKey(){var e,t,i;if(null!=(e=this._UniversalProvider)&&e.session&&this._session){var s;const{address:e}=function(e){const[t,i,s]=e.split(":");return{namespace:t,reference:i,address:s}}(null!==(s=null==(i=null==(t=this._session)?void 0:t.namespaces.solana)?void 0:i.accounts[0])&&void 0!==s?s:"");return new p.P(e)}throw new Hk}async signTransaction(e){this.checkIfWalletSupportsMethod(ve.signTransaction);const t=J(e),i=t?{}:e,{signature:s,transaction:n}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:ve.signTransaction,params:(0,d.A)((0,d.A)({},i),{},{transaction:this.serialize(e)})}});return n?this.deserialize(n,t):(e.addSignature(this.publicKey,p.d.Buffer.from(Vk.decode(s))),e)}async signMessage(e){this.checkIfWalletSupportsMethod(ve.signMessage);const{signature:t}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:ve.signMessage,params:{pubkey:this.publicKey.toString(),message:Vk.encode(e)}}});return Vk.decode(t)}async signAndSendTransaction(e){this.checkIfWalletSupportsMethod(ve.signAndSendTransaction);const{signature:t}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:ve.signAndSendTransaction,params:{transaction:this.serialize(e)}}});return t}async signAllTransactions(e){try{this.checkIfWalletSupportsMethod(ve.signAllTransactions);const t=e.map(e=>this.serialize(e)),{transactions:i}=await this.client.client.request({chainId:this._network,topic:this.session.topic,request:{method:ve.signAllTransactions,params:{transactions:t}}});return e.map((e,t)=>{var s,n;return J(e)?this.deserialize(null!==(s=i[t])&&void 0!==s?s:"",!0):this.deserialize(null!==(n=i[t])&&void 0!==n?n:"")})}catch(t){if(t instanceof Kk){const t=e.map(e=>this.signTransaction(e));return await Promise.all(t)}throw t}}async initClient(e){const t=await Xm.init(e);this._UniversalProvider=t,this._ConnectQueueResolver&&this._ConnectQueueResolver(!0)}async initModal(){if(!this._modal){if(!this._UniversalProvider)throw new Error("WalletConnect Adapter - cannot init modal when Universal Provider is undefined");this._modal=function(e){return new Bk((0,d.A)((0,d.A)({},e),{},{basic:!0,sdkVersion:"html-core-".concat("1.7.2")}))}({projectId:this._projectId,universalProvider:this._UniversalProvider,networks:[_k,Ok,xk],manualWCControl:!0})}}serialize(e){return p.d.Buffer.from(e.serialize({verifySignatures:!1})).toString("base64")}deserialize(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?p.ai.deserialize(p.d.Buffer.from(e,"base64")):p.aN.from(p.d.Buffer.from(e,"base64"))}checkIfWalletSupportsMethod(e){var t;if(null==(t=this.session.namespaces.solana)||!t.methods.includes(e))throw new Kk(e)}}class Zk extends X{constructor(e){super(),k(this,"name","WalletConnect"),k(this,"url","https://walletconnect.org"),k(this,"icon","data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE4NSIgdmlld0JveD0iMCAwIDMwMCAxODUiIHdpZHRoPSIzMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTYxLjQzODU0MjkgMzYuMjU2MjYxMmM0OC45MTEyMjQxLTQ3Ljg4ODE2NjMgMTI4LjIxMTk4NzEtNDcuODg4MTY2MyAxNzcuMTIzMjA5MSAwbDUuODg2NTQ1IDUuNzYzNDE3NGMyLjQ0NTU2MSAyLjM5NDQwODEgMi40NDU1NjEgNi4yNzY1MTEyIDAgOC42NzA5MjA0bC0yMC4xMzY2OTUgMTkuNzE1NTAzYy0xLjIyMjc4MSAxLjE5NzIwNTEtMy4yMDUzIDEuMTk3MjA1MS00LjQyODA4MSAwbC04LjEwMDU4NC03LjkzMTE0NzljLTM0LjEyMTY5Mi0zMy40MDc5ODE3LTg5LjQ0Mzg4Ni0zMy40MDc5ODE3LTEyMy41NjU1Nzg4IDBsLTguNjc1MDU2MiA4LjQ5MzYwNTFjLTEuMjIyNzgxNiAxLjE5NzIwNDEtMy4yMDUzMDEgMS4xOTcyMDQxLTQuNDI4MDgwNiAwbC0yMC4xMzY2OTQ5LTE5LjcxNTUwMzFjLTIuNDQ1NTYxMi0yLjM5NDQwOTItMi40NDU1NjEyLTYuMjc2NTEyMiAwLTguNjcwOTIwNHptMjE4Ljc2Nzc5NjEgNDAuNzczNzQ0OSAxNy45MjE2OTcgMTcuNTQ2ODk3YzIuNDQ1NTQ5IDIuMzk0Mzk2OSAyLjQ0NTU2MyA2LjI3NjQ3NjkuMDAwMDMxIDguNjcwODg5OWwtODAuODEwMTcxIDc5LjEyMTEzNGMtMi40NDU1NDQgMi4zOTQ0MjYtNi40MTA1ODIgMi4zOTQ0NTMtOC44NTYxNi4wMDAwNjItLjAwMDAxLS4wMDAwMS0uMDAwMDIyLS4wMDAwMjItLjAwMDAzMi0uMDAwMDMybC01Ny4zNTQxNDMtNTYuMTU0NTcyYy0uNjExMzktLjU5ODYwMi0xLjYwMjY1LS41OTg2MDItMi4yMTQwNCAwLS4wMDAwMDQuMDAwMDA0LS4wMDAwMDcuMDAwMDA4LS4wMDAwMTEuMDAwMDExbC01Ny4zNTI5MjEyIDU2LjE1NDUzMWMtMi40NDU1MzY4IDIuMzk0NDMyLTYuNDEwNTc1NSAyLjM5NDQ3Mi04Ljg1NjE2MTIuMDAwMDg3LS4wMDAwMTQzLS4wMDAwMTQtLjAwMDAyOTYtLjAwMDAyOC0uMDAwMDQ0OS0uMDAwMDQ0bC04MC44MTI0MTk0My03OS4xMjIxODVjLTIuNDQ1NTYwMjEtMi4zOTQ0MDgtMi40NDU1NjAyMS02LjI3NjUxMTUgMC04LjY3MDkxOTdsMTcuOTIxNzI5NjMtMTcuNTQ2ODY3M2MyLjQ0NTU2MDItMi4zOTQ0MDgyIDYuNDEwNTk4OS0yLjM5NDQwODIgOC44NTYxNjAyIDBsNTcuMzU0OTc3NSA1Ni4xNTUzNTdjLjYxMTM5MDguNTk4NjAyIDEuNjAyNjQ5LjU5ODYwMiAyLjIxNDAzOTggMCAuMDAwMDA5Mi0uMDAwMDA5LjAwMDAxNzQtLjAwMDAxNy4wMDAwMjY1LS4wMDAwMjRsNTcuMzUyMTAzMS01Ni4xNTUzMzNjMi40NDU1MDUtMi4zOTQ0NjMzIDYuNDEwNTQ0LTIuMzk0NTUzMSA4Ljg1NjE2MS0uMDAwMi4wMDAwMzQuMDAwMDMzNi4wMDAwNjguMDAwMDY3My4wMDAxMDEuMDAwMTAxbDU3LjM1NDkwMiA1Ni4xNTU0MzJjLjYxMTM5LjU5ODYwMSAxLjYwMjY1LjU5ODYwMSAyLjIxNDA0IDBsNTcuMzUzOTc1LTU2LjE1NDMyNDljMi40NDU1NjEtMi4zOTQ0MDkyIDYuNDEwNTk5LTIuMzk0NDA5MiA4Ljg1NjE2IDB6IiBmaWxsPSIjM2I5OWZjIi8+PC9zdmc+"),k(this,"supportedTransactionVersions",new Set(["legacy",0])),k(this,"_publicKey"),k(this,"_connecting"),k(this,"_wallet"),k(this,"_config"),k(this,"_readyState"),k(this,"_onDisconnect"),this._publicKey=null,this._connecting=!1,this._config=e,this._wallet=null,this._readyState=typeof window>"u"?_.Unsupported:_.Loadable,this._onDisconnect=this.disconnect.bind(this)}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==_.Loadable)throw new j;this._connecting=!0,this._wallet=new Qk({network:this._config.network===ce.Mainnet?ye.Mainnet:ye.Devnet,options:this._config.options});const{publicKey:e}=await this._wallet.connect();this._publicKey=e,this.emit("connect",e),this._wallet.client.on("session_delete",this._onDisconnect)}catch(e){throw"QRCodeModalError"===e.constructor.name||e instanceof Error&&"QRCodeModalError"===e.name?new Y:(this._connecting=!1,e)}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){e.client.off("session_delete",this._onDisconnect),this._publicKey=null;try{e.client.session&&await e.disconnect()}catch(t){console.error("WalletConnectWalletAdapter: disconnect error",t),this.emit("error",new q(null==t?void 0:t.message,t))}}this.emit("disconnect")}async signTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signTransaction(e)}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signMessage(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signMessage(e)}catch(t){throw new F(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signAndSendTransaction(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signAndSendTransaction(e)}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}async signAllTransactions(e){try{const i=this._wallet;if(!i)throw new H;try{return await i.signAllTransactions(e)}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}}}const Jk=[{icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjU2IiBoZWlnaHQ9IjI1NiIgdmlld0JveD0iMCAwIDI1NiAyNTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF8yMDM1XzExMDYpIj4KPHJlY3Qgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiIGZpbGw9IiM1NEZGRjUiLz4KPGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZl8yMDM1XzExMDYpIj4KPHBhdGggZD0iTTEzLjQ4MDYgMTk4LjYwNUMtMjkuMzI3NiAzMTkuMDQzIDE5OS42NjEgMjg1LjAyNyAzMTkuNTA3IDI1Mi45NjRDNDQyLjE2NSAyMTIuMjU5IDM1Ny4zODYgMzIuODI2OSAyNjkuNDE1IDI4Ljg1NThDMTgxLjQ0MyAyNC44ODQ3IDI4MC4zMjIgMTExLjgyNCAyMDUuNTk1IDEzNi42NTZDMTMwLjg2OCAxNjEuNDg3IDY2Ljk5MDcgNDguMDU4MyAxMy40ODA2IDE5OC42MDVaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjxnIGZpbHRlcj0idXJsKCNmaWx0ZXIxX2ZfMjAzNV8xMTA2KSI+CjxwYXRoIGQ9Ik04NS41MTE4IC00NS44MjI1QzYzLjA1NjIgLTEwNy4xNzYgLTE2LjkxODkgLTIzLjk5NTMgLTU0LjA5OTUgMjUuMjY0M0MtODkuNTY1MiA3OC44NDc5IDMuMDA5MzcgMTI1LjE1MiAzOS4zMjA4IDEwMC4wMzdDNzUuNjMyMyA3NC45MjI3IDcuNzc0NDggNzAuMDM2MyAyOS4zNzA4IDM3LjM3ODVDNTAuOTY3MSA0LjcyMDc2IDExMy41ODEgMzAuODY5NSA4NS41MTE4IC00NS44MjI1WiIgZmlsbD0iIzAwRkZGMCIgZmlsbC1vcGFjaXR5PSIwLjY3Ii8+CjwvZz4KPGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjJfZl8yMDM1XzExMDYpIj4KPHBhdGggZD0iTTk2LjQ3OTYgMjI1LjQyNEM2NS44NTAyIDEyMi4zNjMgLTY2LjA4MTggMTc2LjYzNyAtMTI4LjIxOSAyMTYuNjU3Qy0xODcuOTkgMjY0LjA0MiAtNDYuMDcxMSA0MDAuMzQ4IDEyLjg3MjUgMzkzLjM3NkM3MS44MTYxIDM4Ni40MDMgLTM0LjQxMTggMzI3LjA2NSAxLjk4NzAyIDI5OC4xN0MzOC4zODU4IDI2OS4yNzYgMTM0Ljc2NiAzNTQuMjQ5IDk2LjQ3OTYgMjI1LjQyNFoiIGZpbGw9IiM5RDgxRkYiLz4KPC9nPgo8ZyBmaWx0ZXI9InVybCgjZmlsdGVyM19mXzIwMzVfMTEwNikiPgo8cGF0aCBkPSJNMjgyLjEyIC0xMDcuMzUzQzIxNi4wNDcgLTE4Ni4wMzEgMTIxLjQ2MyAtMTIwLjk3IDgyLjQyOTYgLTc4LjYwNDdDNDguMjczOSAtMzAuNjQ0NiAyMjQuMjc1IDU3LjIzMTIgMjczLjEyMSA0Mi4xNzE0QzMyMS45NjggMjcuMTExNSAyMDYuNTEyIC00LjA1MDM4IDIyNy4yOTcgLTMzLjI4NzlDMjQ4LjA4MiAtNjIuNTI1NSAzNjQuNzEyIC05LjAwNTY2IDI4Mi4xMiAtMTA3LjM1M1oiIGZpbGw9IiM0RDk0RkYiLz4KPC9nPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTkzLjE4OSAxNTIuODM2SDEzNi42NzRMODcuMjA4NiAxMDMuMDUxTDEzNy4zMSA1My4yNjYzTDE1MC45NTUgNDBIMTA1LjgxOUw0OC4zMzU5IDk3Ljc3NzNDNDUuNDM0OSAxMDAuNjg5IDQ1LjQ0OTggMTA1LjQwMiA0OC4zNjU2IDEwOC4yOTlMOTMuMTg5IDE1Mi44MzZaTTExOS4zMyAxMDMuMTY4SDExOC45OTVMMTE5LjMyNiAxMDMuMTY0TDExOS4zMyAxMDMuMTY4Wk0xMTkuMzMgMTAzLjE2OEwxNjguNzkxIDE1Mi45NDlMMTE4LjY5IDIwMi43MzRMMTA1LjA0NSAyMTZIMTUwLjE4TDIwNy42NjQgMTU4LjIyNkMyMTAuNTY1IDE1NS4zMTQgMjEwLjU1IDE1MC42MDIgMjA3LjYzNCAxNDcuNzA1TDE2Mi44MTEgMTAzLjE2OEgxMTkuMzNaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2ZfMjAzNV8xMTA2IiB4PSItOTAuMjQxMSIgeT0iLTY5LjczNjkiIHdpZHRoPSI1NjkuNTU4IiBoZWlnaHQ9IjQ1MS40MzEiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNDkuMjMwOCIgcmVzdWx0PSJlZmZlY3QxX2ZvcmVncm91bmRCbHVyXzIwMzVfMTEwNiIvPgo8L2ZpbHRlcj4KPGZpbHRlciBpZD0iZmlsdGVyMV9mXzIwMzVfMTEwNiIgeD0iLTE2MC41MTEiIHk9Ii0xNjUuOTg3IiB3aWR0aD0iMzUxLjU5NiIgaGVpZ2h0PSIzNzEuNTA3IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9InNoYXBlIi8+CjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQ5LjIzMDgiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl8yMDM1XzExMDYiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjJfZl8yMDM1XzExMDYiIHg9Ii0yNDEuMDc4IiB5PSI2Ny42NDIiIHdpZHRoPSI0NDQuODUxIiBoZWlnaHQ9IjQyNC40NTIiIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj4KPGZlRmxvb2QgZmxvb2Qtb3BhY2l0eT0iMCIgcmVzdWx0PSJCYWNrZ3JvdW5kSW1hZ2VGaXgiLz4KPGZlQmxlbmQgbW9kZT0ibm9ybWFsIiBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0ic2hhcGUiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iNDkuMjMwOCIgcmVzdWx0PSJlZmZlY3QxX2ZvcmVncm91bmRCbHVyXzIwMzVfMTEwNiIvPgo8L2ZpbHRlcj4KPGZpbHRlciBpZD0iZmlsdGVyM19mXzIwMzVfMTEwNiIgeD0iLTIwLjM5NjgiIHk9Ii0yNDIuNzU4IiB3aWR0aD0iNDMwLjE5MSIgaGVpZ2h0PSIzODUuMTA1IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9InNoYXBlIi8+CjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQ5LjIzMDgiIHJlc3VsdD0iZWZmZWN0MV9mb3JlZ3JvdW5kQmx1cl8yMDM1XzExMDYiLz4KPC9maWx0ZXI+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMjAzNV8xMTA2Ij4KPHJlY3Qgd2lkdGg9IjI1NiIgaGVpZ2h0PSIyNTYiIGZpbGw9IndoaXRlIi8+CjwvY2xpcFBhdGg+CjwvZGVmcz4KPC9zdmc+Cg==",name:"Bitget Wallet"}],Xk=(e,t)=>((e,t,i)=>t[e]||i[e])(e,(e=>Jk.find(t=>t.name.toLocaleLowerCase().includes(e.name.toLocaleLowerCase()))||e)(t),t);class $k extends g.W{constructor(e,t){super(),this.adapter=e,this.connection=t}getAdapter(){return this.adapter}getName(){return Xk("name",this.adapter)}getUrl(){return this.adapter.url}async connect(){if(this.isConnected())return this.getAddresses();const e=await new Promise((e,t)=>{this.adapter.on("connect",()=>{this.adapter.off("connect"),this.adapter.off("error"),e(this.getAddresses())}),this.adapter.on("error",e=>{this.adapter.off("connect"),this.adapter.off("error"),t(e)}),this.adapter.connect().catch(t)});return this.emit("connect"),this.adapter.on("disconnect",()=>this.emit("disconnect")),e}getNetworkInfo(){return{}}isConnected(){return this.adapter.connected}async disconnect(){this.isConnected()&&(await new Promise((e,t)=>{this.adapter.on("disconnect",()=>{this.adapter.off("disconnect"),this.adapter.off("error"),e(void 0)}),this.adapter.on("error",e=>{this.adapter.off("disconnect"),this.adapter.off("error"),t(e)}),this.adapter.disconnect().catch(t)}),this.adapter.removeAllListeners(),this.emit("disconnect"))}getChainId(){return g.F}getAddress(){var e;return null==(e=this.adapter.publicKey)?void 0:e.toString()}getAddresses(){const e=this.getAddress();return e?[e]:[]}setMainAddress(){throw new Error("Not supported")}getBalance(){throw new Error("Not supported")}async signTransaction(e){if(!this.adapter.signTransaction||!this.adapter.signAllTransactions)throw new Error("Not supported");return Array.isArray(e)?this.adapter.signAllTransactions(e):this.adapter.signTransaction(e)}async sendTransaction(e){var t;const{transaction:i}=e,s=Array.isArray(i)?i:[i];if(0===s.length)throw new Error("Empty transactions array");const n=[];for(const r of s){const t=await this.adapter.sendTransaction(r,this.connection,(0,d.A)({},e.options));n.push(t)}return await this.connection.confirmTransaction(n[0],null==(t=e.options)?void 0:t.commitment),{id:n[0],data:1===n.length?n[0]:n}}async signAndSendTransaction(e){return this.sendTransaction(e)}signMessage(e){if(!this.adapter.signMessage)throw new Error("Not supported");return this.adapter.signMessage(e)}getIcon(){return Xk("icon",this.adapter)}getWalletState(){const e=this.adapter.readyState;if(!(e in g.x))throw new Error("Unknown wallet state ".concat(e));return g.x[e]}getFeatures(){const e=[g.B.SendTransaction,g.B.SignAndSendTransaction];return this.adapter.signTransaction&&this.adapter.signAllTransactions&&e.push(g.B.SignTransaction),this.adapter.signMessage&&e.push(g.B.SignMessage),e}supportsChain(e){return e===g.F}}const eD=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");const t=new Uint8Array(256);for(let a=0;a<t.length;a++)t[a]=255;for(let a=0;a<e.length;a++){const i=e.charAt(a),s=i.charCodeAt(0);if(255!==t[s])throw new TypeError(i+" is ambiguous");t[s]=a}const i=e.length,s=e.charAt(0),n=Math.log(i)/Math.log(256),r=Math.log(256)/Math.log(i);function o(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;let r=0,o=0,a=0;for(;e[r]===s;)o++,r++;const c=(e.length-r)*n+1>>>0,l=new Uint8Array(c);for(;r<e.length;){const s=e.charCodeAt(r);if(s>255)return;let n=t[s];if(255===n)return;let o=0;for(let e=c-1;(0!==n||o<a)&&-1!==e;e--,o++)n+=i*l[e]>>>0,l[e]=n%256>>>0,n=n/256>>>0;if(0!==n)throw new Error("Non-zero carry");a=o,r++}let h=c-a;for(;h!==c&&0===l[h];)h++;const d=new Uint8Array(o+(c-h));let u=o;for(;h!==c;)d[u++]=l[h++];return d}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";let n=0,o=0,a=0;const c=t.length;for(;a!==c&&0===t[a];)a++,n++;const l=(c-a)*r+1>>>0,h=new Uint8Array(l);for(;a!==c;){let e=t[a],s=0;for(let t=l-1;(0!==e||s<o)&&-1!==t;t--,s++)e+=256*h[t]>>>0,h[t]=e%i>>>0,e=e/i>>>0;if(0!==e)throw new Error("Non-zero carry");o=s,a++}let d=l-o;for(;d!==l&&0===h[d];)d++;let u=s.repeat(n);for(;d<l;++d)u+=e.charAt(h[d]);return u},decodeUnsafe:o,decode:function(e){const t=o(e);if(t)return t;throw new Error("Non-base"+i+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var tD,iD,sD,nD,rD,oD,aD,cD,lD,hD,dD,uD,pD,gD,fD,wD,mD,yD,vD=function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)},bD=function(e,t,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,i):n?n.value=i:t.set(e,i),i};class ID extends Q{get name(){return vD(this,cD,"f").name}get url(){return"https://github.com/solana-labs/wallet-standard"}get icon(){return vD(this,cD,"f").icon}get readyState(){return vD(this,lD,"f")}get publicKey(){return vD(this,sD,"f")}get connecting(){return vD(this,nD,"f")}get supportedTransactionVersions(){return vD(this,aD,"f")}get wallet(){return vD(this,cD,"f")}get standard(){return!0}constructor(e){let{wallet:t}=e;super(),tD.add(this),iD.set(this,void 0),sD.set(this,void 0),nD.set(this,void 0),rD.set(this,void 0),oD.set(this,void 0),aD.set(this,void 0),cD.set(this,void 0),lD.set(this,typeof window>"u"||typeof document>"u"?_.Unsupported:_.Installed),gD.set(this,e=>{if("accounts"in e){const e=vD(this,cD,"f").accounts[0];vD(this,iD,"f")&&!vD(this,rD,"f")&&e!==vD(this,iD,"f")&&(e?vD(this,tD,"m",dD).call(this,e):(this.emit("error",new z),vD(this,tD,"m",uD).call(this)))}"features"in e&&vD(this,tD,"m",pD).call(this)}),bD(this,cD,t,"f"),bD(this,iD,null,"f"),bD(this,sD,null,"f"),bD(this,nD,!1,"f"),bD(this,rD,!1,"f"),bD(this,oD,vD(this,cD,"f").features[oe].on("change",vD(this,gD,"f")),"f"),vD(this,tD,"m",pD).call(this)}destroy(){bD(this,iD,null,"f"),bD(this,sD,null,"f"),bD(this,nD,!1,"f"),bD(this,rD,!1,"f");const e=vD(this,oD,"f");e&&(bD(this,oD,null,"f"),e())}async autoConnect(){return vD(this,tD,"m",hD).call(this,{silent:!0})}async connect(){return vD(this,tD,"m",hD).call(this)}async disconnect(){if(re in vD(this,cD,"f").features)try{bD(this,rD,!0,"f"),await vD(this,cD,"f").features[re].disconnect()}catch(e){this.emit("error",new q(null==e?void 0:e.message,e))}finally{bD(this,rD,!1,"f")}vD(this,tD,"m",uD).call(this)}async sendTransaction(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const n=vD(this,iD,"f");if(!n)throw new H;let r;if(ee in vD(this,cD,"f").features)if(n.features.includes(ee))r=ee;else{if(!(se in vD(this,cD,"f").features)||!n.features.includes(se))throw new B;r=se}else{if(!(se in vD(this,cD,"f").features))throw new U;if(!n.features.includes(se))throw new B;r=se}const o=function(e){return e.includes("https://api.mainnet-beta.solana.com")?ge:/\bdevnet\b/i.test(e)?"solana:devnet":/\btestnet\b/i.test(e)?"solana:testnet":/\blocalhost\b/i.test(e)||/\b127\.0\.0\.1\b/.test(e)?"solana:localnet":ge}(t.rpcEndpoint);if(!n.chains.includes(o))throw new K;try{const{signers:s}=i,a=(0,u.A)(i,M);let c;if(J(e)?(null!=s&&s.length&&e.sign(s),c=e.serialize()):(e=await this.prepareTransaction(e,t,a),null!=s&&s.length&&e.partialSign(...s),c=new Uint8Array(e.serialize({requireAllSignatures:!1,verifySignatures:!1}))),r===ee){const[e]=await vD(this,cD,"f").features[ee].signAndSendTransaction({account:n,chain:o,transaction:c,options:{preflightCommitment:me(a.preflightCommitment||t.commitment),skipPreflight:a.skipPreflight,maxRetries:a.maxRetries,minContextSlot:a.minContextSlot}});return eD.encode(e.signature)}{const[e]=await vD(this,cD,"f").features[se].signTransaction({account:n,chain:o,transaction:c,options:{preflightCommitment:me(a.preflightCommitment||t.commitment),minContextSlot:a.minContextSlot}});return await t.sendRawTransaction(e.signedTransaction,(0,d.A)((0,d.A)({},a),{},{preflightCommitment:me(a.preflightCommitment||t.commitment)}))}}catch(s){throw s instanceof D?s:new K(null==s?void 0:s.message,s)}}catch(n){throw this.emit("error",n),n}}}async function ED(e,t,i){var s,n;let r=2e5,o=0;const a=p._.setComputeUnitLimit({units:3e5});let c;if((0,m.i)(t)){const i=(await Promise.all(t.message.addressTableLookups.map(t=>e.getAddressLookupTable(t.accountKey)))).map(e=>e.value).filter(e=>null!==e),s=p.aI.decompile(t.message,{addressLookupTableAccounts:i});s.instructions=[a,...s.instructions],c=new p.ai(s.compileToV0Message(i)),c.signatures=[...t.signatures]}else{const e=new p.aN;e.recentBlockhash=t.recentBlockhash,e.feePayer=t.feePayer,e.instructions=[a,...t.instructions],e.signatures=[...t.signatures],c=e}e:for(;;){if((0,m.i)(c)&&!c.message.recentBlockhash){const{blockhash:t}=await e.getLatestBlockhash(i);c.message.recentBlockhash=t}const t=await((0,m.i)(c)?e.simulateTransaction(c,{commitment:i,replaceRecentBlockhash:!0}):e.simulateTransaction(c));if(t.value.err){if(ND(t.value)){if(o<5){o++,await(0,g.z)(1e3);continue e}}else if(o<3){o++,await(0,g.z)(1e3);continue e}throw new Error("Simulation failed: ".concat(JSON.stringify(t.value.err),"\nLogs:\n").concat((t.value.logs||[]).join("\n  ")))}t.value.unitsConsumed&&(r=t.value.unitsConsumed);break}const l=Math.floor(1.2*r),h=[];h.push(p._.setComputeUnitLimit({units:l}));const d=(null==(n=null==(s=g.A.transactionSettings)?void 0:s.Solana)?void 0:n.priorityFee)||{},{percentile:u=.9,percentileMultiple:f=1,min:w=1e5,max:v=1e8}=d,b=function(e){return e.includes("rpcpool.com")?"triton":e.includes("helius-rpc.com")?"helius":e.includes("rpc.ankr.com")?"ankr":"unknown"}(e.rpcEndpoint),{fee:I,methodUsed:E}=await(async i=>{if("triton"===i)try{return{fee:await(0,y.d)(e,t,u,f,w,v),methodUsed:"triton"}}catch(s){console.warn("Failed to determine priority fee using Triton RPC:",s)}try{return{fee:await(0,y.a)(e,t,u,f,w,v),methodUsed:"default"}}catch(s){return console.warn("Failed to determine priority fee using Triton RPC:",s),{fee:w,methodUsed:"minimum"}}})(b),N=I/1e6/p.aL*l;return console.table({"RPC Provider":b,"Method used":E,"Percentile used":u,"Multiple used":f,"Compute budget":l,"Priority fee":I,"Max fee in SOL":N}),h.push(p._.setComputeUnitPrice({microLamports:I})),h}function ND(e){const t={};if("BlockhashNotFound"===e.err&&(t.BlockhashNotFound="Blockhash not found during simulation. Trying again."),e.logs)for(const i of e.logs)i.includes("SlippageToleranceExceeded")&&(t.SlippageToleranceExceeded="Slippage failure during simulation. Trying again."),i.includes("RequireGteViolated")&&(t.RequireGteViolated="Swap instruction failure during simulation. Trying again.");return!(0,g.G)(t)&&(console.table(t),!0)}iD=new WeakMap,sD=new WeakMap,nD=new WeakMap,rD=new WeakMap,oD=new WeakMap,aD=new WeakMap,cD=new WeakMap,lD=new WeakMap,gD=new WeakMap,tD=new WeakSet,hD=async function(e){try{if(this.connected||this.connecting)return;if(vD(this,lD,"f")!==_.Installed)throw new j;if(bD(this,nD,!0,"f"),!vD(this,cD,"f").accounts.length)try{await vD(this,cD,"f").features[ne].connect(e)}catch(t){throw new L(null==t?void 0:t.message,t)}const i=vD(this,cD,"f").accounts[0];if(!i)throw new B;vD(this,tD,"m",dD).call(this,i)}catch(i){throw this.emit("error",i),i}finally{bD(this,nD,!1,"f")}},dD=function(e){let t;try{t=new p.P(e.address)}catch(i){throw new V(null==i?void 0:i.message,i)}bD(this,iD,e,"f"),bD(this,sD,t,"f"),vD(this,tD,"m",pD).call(this),this.emit("connect",t)},uD=function(){bD(this,iD,null,"f"),bD(this,sD,null,"f"),vD(this,tD,"m",pD).call(this),this.emit("disconnect")},pD=function(){var e,t;const i=ee in vD(this,cD,"f").features?vD(this,cD,"f").features[ee].supportedTransactionVersions:vD(this,cD,"f").features[se].supportedTransactionVersions;bD(this,aD,(0,f.a)(i,["legacy"])?null:new Set(i),"f"),se in vD(this,cD,"f").features&&null!=(e=vD(this,iD,"f"))&&e.features.includes(se)?(this.signTransaction=vD(this,tD,"m",fD),this.signAllTransactions=vD(this,tD,"m",wD)):(delete this.signTransaction,delete this.signAllTransactions),ie in vD(this,cD,"f").features&&null!=(t=vD(this,iD,"f"))&&t.features.includes(ie)?this.signMessage=vD(this,tD,"m",mD):delete this.signMessage,te in vD(this,cD,"f").features?this.signIn=vD(this,tD,"m",yD):delete this.signIn},fD=async function(e){try{const i=vD(this,iD,"f");if(!i)throw new H;if(!(se in vD(this,cD,"f").features))throw new U;if(!i.features.includes(se))throw new B;try{const t=(await vD(this,cD,"f").features[se].signTransaction({account:i,transaction:J(e)?e.serialize():new Uint8Array(e.serialize({requireAllSignatures:!1,verifySignatures:!1}))}))[0].signedTransaction;return J(e)?p.ai.deserialize(t):p.aN.from(t)}catch(t){throw t instanceof D?t:new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}},wD=async function(e){try{const i=vD(this,iD,"f");if(!i)throw new H;if(!(se in vD(this,cD,"f").features))throw new U;if(!i.features.includes(se))throw new B;try{const t=await vD(this,cD,"f").features[se].signTransaction(...e.map(e=>({account:i,transaction:J(e)?e.serialize():new Uint8Array(e.serialize({requireAllSignatures:!1,verifySignatures:!1}))})));return e.map((e,i)=>{const s=t[i].signedTransaction;return J(e)?p.ai.deserialize(s):p.aN.from(s)})}catch(t){throw new W(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}},mD=async function(e){try{const i=vD(this,iD,"f");if(!i)throw new H;if(!(ie in vD(this,cD,"f").features))throw new U;if(!i.features.includes(ie))throw new B;try{return(await vD(this,cD,"f").features[ie].signMessage({account:i,message:e}))[0].signature}catch(t){throw new F(null==t?void 0:t.message,t)}}catch(i){throw this.emit("error",i),i}},yD=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!(te in vD(this,cD,"f").features))throw new U;let i;try{[i]=await vD(this,cD,"f").features[te].signIn(e)}catch(t){throw new G(null==t?void 0:t.message,t)}if(!i)throw new G;return vD(this,tD,"m",dD).call(this,i.account),i}catch(i){throw this.emit("error",i),i}};const AD=Object.freeze(Object.defineProperty({__proto__:null,fetchOptions:function(){const e=g.A.isMainnet?"mainnet-beta":"devnet",t=new p.H(g.A.rpcs.Solana||(0,p.cd)(e));return(0,d.A)((0,d.A)({},function(e){return(0,w.g)().get().filter(ae).map(t=>new $k(new ID({wallet:t}),e))}(t).reduce((e,t)=>(e[(e=>e.getName().toLowerCase().replaceAll("wallet","").trim())(t)]=t,e),{})),{},{bitget:new $k(new le,t),clover:new $k(new he,t),coin98:new $k(new ue,t),solong:new $k(new fe,t),torus:new $k(new we,t),nightly:new $k(new pe,t)},g.A.ui.walletConnectProjectId?{walletConnect:new $k(new Zk({network:g.A.isMainnet?ce.Mainnet:ce.Devnet,options:{projectId:g.A.ui.walletConnectProjectId,customStoragePrefix:"wh-connect-solana-adapter"}}),t)}:{})},signAndSendTransaction:async function(e,t,i){var s;if(!t)throw new Error("Wallet not found");if(!g.A.rpcs.Solana)throw new Error("Solana RPC not found");const n=null!==(s=null==i?void 0:i.commitment)&&void 0!==s?s:"finalized",r=new p.H(g.A.rpcs.Solana),{blockhash:o,lastValidBlockHeight:a}=await r.getLatestBlockhash(n),c=await async function(e,t,i,s){const n=s.transaction.transaction,r=e=>"ComputeBudget111111111111111111111111111111"!==e.programId.toString();if((0,m.i)(n)){var o;const i=(await Promise.all(n.message.addressTableLookups.map(t=>e.getAddressLookupTable(t.accountKey)))).map(e=>e.value).filter(e=>null!==e),a=p.aI.decompile(n.message,{addressLookupTableAccounts:i});a.recentBlockhash=t,n.message.recentBlockhash=t,a.instructions=a.instructions.filter(r),n.message=a.compileToV0Message(i),a.instructions.push(...await ED(e,n)),n.message=a.compileToV0Message(i),n.sign(null!==(o=s.transaction.signers)&&void 0!==o?o:[])}else n.recentBlockhash=t,n.lastValidBlockHeight=i,n.instructions=n.instructions.filter(r),n.add(...await ED(e,n)),s.transaction.signers&&n.partialSign(...s.transaction.signers);return n}(r,o,a,e);let l=null,h=null,d=1,u="";const f=(await t.signTransaction(c)).serialize(),w={skipPreflight:!0,maxRetries:0,preFlightCommitment:n};u=await r.sendRawTransaction(f,w),l=r.confirmTransaction({signature:u,blockhash:o,lastValidBlockHeight:a},n);try{for(;!h&&(h=await Promise.race([l,new Promise(e=>setTimeout(()=>{e(null)},5e3))]),!h);){console.log("Tx not confirmed after ".concat(5e3*d++,"ms, resending"));try{await r.sendRawTransaction(f,w)}catch(y){console.error("Failed to resend transaction:",y)}}}catch(v){if(v instanceof Error&&"TransactionExpiredBlockheightExceededError"===v.name)for(let e=0;e<5;++e){try{if(await r.getTransaction(u,{commitment:"confirmed",maxSupportedTransactionVersion:0}))return u}catch(b){}await(0,g.z)(2e3)}throw v}if(h.value.err){let e="Transaction failed: ".concat(h.value.err);if("object"==typeof h.value.err)try{e="Transaction failed: ".concat(JSON.stringify(h.value.err,(e,t)=>"bigint"==typeof t?t.toString():t))}catch(I){e="Transaction failed: Unknown error"}throw new Error("Transaction failed: ".concat(e))}return u}},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=7805.6127e11d.chunk.js.map